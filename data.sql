-- MySQL dump 10.13  Distrib 5.6.29, for Linux (x86_64)
--
-- Host: localhost    Database: blog
-- ------------------------------------------------------
-- Server version	5.6.29-log

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `sdfsdf`
--

DROP TABLE IF EXISTS `sdfsdf`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sdfsdf` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `sdf` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sdfsdf`
--

LOCK TABLES `sdfsdf` WRITE;
/*!40000 ALTER TABLE `sdfsdf` DISABLE KEYS */;
INSERT INTO `sdfsdf` VALUES (1,'23'),(2,'sdf');
/*!40000 ALTER TABLE `sdfsdf` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sph_counter`
--

DROP TABLE IF EXISTS `sph_counter`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sph_counter` (
  `counter_id` int(10) unsigned NOT NULL,
  `max_doc_id` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`counter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sph_counter`
--

LOCK TABLES `sph_counter` WRITE;
/*!40000 ALTER TABLE `sph_counter` DISABLE KEYS */;
INSERT INTO `sph_counter` VALUES (1,163);
/*!40000 ALTER TABLE `sph_counter` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_black_email`
--

DROP TABLE IF EXISTS `z_black_email`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_black_email` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_black_email`
--

LOCK TABLES `z_black_email` WRITE;
/*!40000 ALTER TABLE `z_black_email` DISABLE KEYS */;
/*!40000 ALTER TABLE `z_black_email` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_black_website`
--

DROP TABLE IF EXISTS `z_black_website`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_black_website` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_black_website`
--

LOCK TABLES `z_black_website` WRITE;
/*!40000 ALTER TABLE `z_black_website` DISABLE KEYS */;
INSERT INTO `z_black_website` VALUES (1,'ayosport'),(2,'amazonaws'),(3,'ayospdort'),(4,'magc'),(5,'letschat'),(6,'sb-u.ch');
/*!40000 ALTER TABLE `z_black_website` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_category`
--

DROP TABLE IF EXISTS `z_category`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_category` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(25) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_category`
--

LOCK TABLES `z_category` WRITE;
/*!40000 ALTER TABLE `z_category` DISABLE KEYS */;
INSERT INTO `z_category` VALUES (2,'生活'),(3,'说说'),(4,'php'),(5,'js'),(6,'转载'),(7,'工作'),(8,'算法'),(9,'linux'),(10,'mac'),(13,'node'),(14,'mysql'),(15,'html'),(16,'AngularJS'),(17,'散文'),(18,'诗歌'),(19,'读书'),(20,'故事'),(21,'书信'),(22,'laravel5.2入门'),(23,'laravel5.2入');
/*!40000 ALTER TABLE `z_category` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_comment`
--

DROP TABLE IF EXISTS `z_comment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_comment` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(30) NOT NULL DEFAULT '' COMMENT '评论者姓名',
  `email` varchar(50) NOT NULL DEFAULT '' COMMENT '评论者邮箱',
  `content` varchar(255) NOT NULL DEFAULT '' COMMENT '评论内容',
  `pid` int(11) NOT NULL DEFAULT '0' COMMENT '评论的父id',
  `postid` int(11) NOT NULL DEFAULT '0' COMMENT '评论所属文章id',
  `depth` tinyint(4) NOT NULL DEFAULT '1' COMMENT '评论深度',
  `website` varchar(255) NOT NULL DEFAULT '' COMMENT '评论者网址',
  `ctime` int(11) NOT NULL DEFAULT '0' COMMENT '评论发表时间',
  `ip` varchar(255) NOT NULL DEFAULT '',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态值,1.显示，0.隐藏',
  `uid` int(11) NOT NULL DEFAULT '1' COMMENT '用户id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=530 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_comment`
--

LOCK TABLES `z_comment` WRITE;
/*!40000 ALTER TABLE `z_comment` DISABLE KEYS */;
INSERT INTO `z_comment` VALUES (466,'阮文武','379879523@qq.com','很实用。',0,60,1,'',1486470290,'203.130.43.156',1,1),(470,'感动','290224603@qq.com','看了第一感受，有点莫名的感动！',0,44,1,'',1486544235,'111.198.71.131',1,1),(471,'同感','379879523@qq.com','这就是历史。',470,44,2,'',1486544433,'203.130.43.155',1,1),(524,'ruanwenwu','379879523@qq.com','测试一下。',0,76,1,'',1489864278,'203.130.43.155',1,1),(525,'ruanwenwu','379879523@qq.com','测试一下。again',0,76,1,'',1489864302,'203.130.43.155',1,1),(526,'ruanwenwu','379879523@qq.com','测试一下。again more.',0,76,1,'',1489864489,'203.130.43.155',1,1),(527,'ruanwenwu','379879523@qq.com','测试子回复。',526,76,2,'',1489864535,'203.130.43.155',1,1),(528,'gh72029002','666@qq.com','这个功能66的',0,77,1,'http://www.wayde.org',1490001197,'222.128.110.245',1,2),(529,'ruanwenwu','379879523@qq.com','还行，git有点慢。',528,77,2,'',1490452922,'203.130.43.155',1,1);
/*!40000 ALTER TABLE `z_comment` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_editor_read_log`
--

DROP TABLE IF EXISTS `z_editor_read_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_editor_read_log` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `replyid` int(11) NOT NULL DEFAULT '0',
  `editor` varchar(20) NOT NULL DEFAULT '',
  `ctime` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_editor_read_log`
--

LOCK TABLES `z_editor_read_log` WRITE;
/*!40000 ALTER TABLE `z_editor_read_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `z_editor_read_log` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_post`
--

DROP TABLE IF EXISTS `z_post`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_post` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `ctime` int(11) NOT NULL,
  `mtime` int(11) NOT NULL,
  `pubtime` int(11) NOT NULL,
  `content` longtext NOT NULL,
  `tag` varchar(255) NOT NULL,
  `title` varchar(255) NOT NULL DEFAULT '',
  `summary` varchar(255) NOT NULL DEFAULT '',
  `category` varchar(11) NOT NULL,
  `comment_num` int(11) NOT NULL DEFAULT '0' COMMENT '评论数量',
  `pv` int(11) NOT NULL DEFAULT '0' COMMENT '阅读量',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '1.可见2.不可见',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=164 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_post`
--

LOCK TABLES `z_post` WRITE;
/*!40000 ALTER TABLE `z_post` DISABLE KEYS */;
INSERT INTO `z_post` VALUES (1,1477217510,1477217510,1477217510,'<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不知庐山真面目，只缘身在此山中。<br/></p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这世界也许你最近亲却最不了解的人，就是你自己。所以自我介绍，说履历容易，讲真性情却是难极了的事。</p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;很多年前，就是刚毕业那一阵，我是一个“极浪漫主义”的青年。那时的我，用生活践行着轰轰烈烈的诗与歌的亢奋。<br/></p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;08年的夏天，奥运会正如火如荼的进行的时候，那也是我浪漫主义的极致：新沟镇的月与夜与雨，持刀与黑夜搏斗的激情，漏居数雨的情怀，至今是我最美的回忆。<br/></p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;原来一切人生的大悲大喜均是形而上的。<br/></p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后来，社会大学教会了我做实事，这样才是真正有意义的生活。从那以后，我基本上告别了那些细腻的体会，封了笔，在工作中践行自己的价值观。<br/></p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 现在的我觉得，无论做什么工作，能体现出自己的价值就是幸福的；有梦就要勇敢追，任何事从今天开始做都不算晚。<br/></p><p><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;写这个博客的初衷是希望认真地，重新地捡起自己内心非常喜欢做的那件事：分享生命，留住感动。<br/></p>','自我介绍','关于我','你了解你自己吗？','生活',11,1060,1),(12,1478104850,1478104850,1478104850,'','','时光教会了我们一切','','说说',0,328,1),(17,1479020435,1479020435,1479020435,'','','不要跑，当你还没学会走之前','','说说',0,281,1),(18,1479020763,1479020763,1479020763,'','','怀念友情','','说说',0,220,1),(19,1479026114,1479534220,1479026114,'<p>								</p><h3>题外话<br/></h3><p>不知道怎么去表达。只希望能够帮到有需要的同学。</p><p>这将是个简单的不能再简单的mvc框架，但是足以让你了解框架的奥秘了。</p><h3>框架原理<br/></h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>首先你需要做rewrite重写，将网站的所有请求指向到你的index.php来实现单一入口。</p></li><li><p>一般我们在index.php中定义很多的常量，比如项目目录，框架核心文件目录，业务目录，静态文件目录等等。除了定义这些常量之外，我们只需要做另外一件事：启动框架。（这都是套路^_^）</p></li><li><p>启动框架实际上就是实现路由寻址。所谓路由寻址，就是将url指向到对应的控制器和方法，并且保存参数以供使用。</p></li><li><p>接下来在根据路由得到的控制器和方法里写业务逻辑。</p></li><li><p>最后将业务逻辑中得到的数据分配到模板就完事了。</p></li></ol><p>是不是很简单呢？接下来我们来熟悉一下这个框架。</p><h3>目录</h3><p><img src=\"/ueditor/php/upload/image/20161113/1479029828670748.png\" title=\"1479029828670748.png\" alt=\"blob.png\"/></p><p><br/></p><p>这里可以先忽略vendor目录和composer.json以及composer.lock这三个文件。这是框架写完之后，利用了 composer 来扩展框架的健壮性。<br/></p><p><br/></p><p>目录很简单。app里放业务。core里是核心文件和类库。.htaccess负责将请求指向index.php，入口文件index.php。我有理由相信，如果你对php的命名空间，自动加载，类和对象的知识比较熟悉的话，半个小时你就能掌握这个小东西。</p><p><br/></p><h3>index.php</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\n/**\r\n&nbsp;*&nbsp;入口文件\r\n&nbsp;*&nbsp;1.定义常量\r\n&nbsp;*&nbsp;2.加载函数库\r\n&nbsp;*&nbsp;3.运行框架\r\n&nbsp;*/\r\ndefine(&quot;PROJECT_PATH&quot;,realpath(&quot;./&quot;).&quot;/&quot;);\r\ndefine(&quot;APP_PATH&quot;,PROJECT_PATH.&quot;app/&quot;);\r\ndefine(&quot;CORE&quot;,PROJECT_PATH.&quot;core/&quot;);\r\ndefine(&quot;MODULE&quot;,&#39;app&#39;);\r\ndefine(&quot;DEBUG&quot;,true);\r\ninclude(&quot;vendor/autoload.php&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//引入composer自动加载文件\r\n\r\nif(DEBUG){\r\n&nbsp;&nbsp;&nbsp;&nbsp;$whoops&nbsp;=&nbsp;new&nbsp;\\Whoops\\Run;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$whoops-&gt;pushHandler(new&nbsp;\\Whoops\\Handler\\PrettyPageHandler);\r\n&nbsp;&nbsp;&nbsp;&nbsp;$whoops-&gt;register();\r\n&nbsp;&nbsp;&nbsp;&nbsp;ini_set(&quot;display_errors&quot;,&quot;On&quot;);\r\n}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;ini_set(&quot;display_errors&quot;,&quot;Off&quot;);\r\n}\r\n\r\ninclude&nbsp;CORE.&quot;common/functions.php&quot;;\r\ninclude&nbsp;CORE.&quot;core.php&quot;;\r\nspl_autoload_register(&#39;core\\Core::load&#39;);\r\ncore\\Core::run();</pre><p>这里定义了几个常量。引入了common/function.php这个供系统使用的函数库。然后，引入框架核心文件core.php，最后调用core.php中的core类下的load方法进行自动加载配置。最后运行core类下的run方法运行整个框架。</p><p><br/></p><p>接下来我们看看框架的核心文件core.php。</p><p><br/></p><h3>core.php</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\n/**\r\n&nbsp;*&nbsp;框架核心文件，负责加载类，解析路由等\r\n&nbsp;*/\r\nnamespace&nbsp;core;\r\n\r\nclass&nbsp;Core\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;$classMap&nbsp;=&nbsp;array();\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;load($class){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$classDir&nbsp;=&nbsp;str_replace(&quot;\\\\&quot;,&quot;/&quot;,$class);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$classPath&nbsp;=&nbsp;PROJECT_PATH.$classDir.&quot;.php&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(in_array($class,self::$classMap)){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_file($classPath)){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;$classPath;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$classMap[]&nbsp;=&nbsp;$class;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;run(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$router&nbsp;=&nbsp;new&nbsp;\\core\\lib\\Router();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctrl&nbsp;=&nbsp;\\core\\lib\\Router::$ctrl;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$act&nbsp;=&nbsp;\\core\\lib\\Router::$act;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;\\core\\lib\\Router::$params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctrlClass&nbsp;=&nbsp;&quot;\\\\&quot;.MODULE.&quot;\\\\controller\\\\&quot;.$ctrl.&quot;Controller&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctrlObj&nbsp;=&nbsp;new&nbsp;$ctrlClass();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctrlObj-&gt;$act();\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>如果您曾经读过其他框架的源码，那么core.php将是你见过最短的框架核心文件。它只有两个方法。</p><p><br/></p><p>load方法用在index.php中来初始化自动加载。spl_autoload_register方法能接收带有命名空间的类名，并根据方法中定义的规则引入指定的类。</p><p><br/></p><p>run用在index.php启动整个框架。实际上它只做了一件事，就是将Router类中得到的控制器和方法名称拿来，拼接出我们最终需要进入的控制器和方法，并进行实例化和调用。<br/></p><p><br/></p><p>我们看到core类中只用到一个其他的类：Router。我们来看看它长什么样吧。</p><h3>Router</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\nnamespace&nbsp;core\\lib;\r\n\r\nclass&nbsp;Router\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$ctrl;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$act;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$params;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;__construct(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($_SERVER[&#39;REQUEST_URI&#39;]&nbsp;==&nbsp;&quot;/&quot;){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$ctrl&nbsp;=&nbsp;Config::get(&quot;CTRL&quot;,&quot;router.php&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$act&nbsp;&nbsp;=&nbsp;Config::get(&quot;ACTION&quot;,&quot;router.php&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pathArr&nbsp;=&nbsp;explode(&quot;/&quot;,trim($_SERVER[&#39;REQUEST_URI&#39;],&quot;/&quot;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pathNum&nbsp;=&nbsp;count($pathArr);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($pathNum&nbsp;==&nbsp;1){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$ctrl&nbsp;=&nbsp;$pathArr[0];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$act&nbsp;=&nbsp;&quot;index&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if($pathNum&nbsp;==&nbsp;2){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$ctrl&nbsp;=&nbsp;$pathArr[0];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$act&nbsp;=&nbsp;$pathArr[1];&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$ctrl&nbsp;=&nbsp;$pathArr[0];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$act&nbsp;=&nbsp;$pathArr[1];&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for($i&nbsp;=&nbsp;2;&nbsp;$i&nbsp;&lt;&nbsp;$pathNum&nbsp;-&nbsp;1&nbsp;;&nbsp;$i&nbsp;+=&nbsp;2){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($pathArr[$i+1]){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$params[$pathArr[$i]]&nbsp;=&nbsp;$pathArr[$i+1];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_GET&nbsp;=&nbsp;self::$params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n}</pre><p>这个路由类只有一个构造函数。它的作用就是根据当前的url得到我们需要的控制器和方法名称，并把参数放到$_GET这个超全局变量中。</p><p><br/></p><p>这里使用了config类。这个类让我们可以很方便的管理我们的配置，比如路由配置，数据库配置，缓存配置等等，非常有用。</p><h3>config</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\n/**\r\n&nbsp;*&nbsp;配置加载类\r\n&nbsp;*&nbsp;\r\n&nbsp;*&nbsp;@author&nbsp;rww\r\n&nbsp;*&nbsp;@date&nbsp;2016/11/06\r\n&nbsp;*/\r\nnamespace&nbsp;core\\lib;\r\n\r\nclass&nbsp;Config\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$config&nbsp;=&nbsp;array();\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;根据对应的文件和key加载配置\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$key\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$file\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;get($key,&nbsp;$file)\r\n&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($config[$file]))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config[$file][$key];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filePath&nbsp;=&nbsp;CORE.&quot;config/&quot;.$file;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(file_exists($filePath))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$config[$file]&nbsp;=&nbsp;$config&nbsp;=&nbsp;include($filePath);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($config[$key]){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config[$key];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\\Exception(&quot;$key&nbsp;not&nbsp;exist&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\\Exception(&quot;$filePath&nbsp;not&nbsp;found&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;加载所有配置\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;all($file)\r\n&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($config[$file]))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config[$file];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filePath&nbsp;=&nbsp;CORE.&quot;config/&quot;.$file;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(file_exists($filePath))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$config[$file]&nbsp;=&nbsp;$config&nbsp;=&nbsp;include($filePath);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\\Exception(&quot;$filePath&nbsp;not&nbsp;found&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>config类只有两个方法。一个方法用来获取某文件中的某个配置，另一个方法用来获取某配置文件中的所有配置。<br/></p><p><br/></p><p>到这里，我们已经可以在对应的控制器里写业务逻辑了。我们来看看控制器。</p><h3>controller</h3><p>以IndexController为例：</p><pre class=\"brush:php;toolbar:false\">&lt;?php\r\nnamespace&nbsp;app\\controller;\r\nuse&nbsp;core\\lib\\Model&nbsp;as&nbsp;Model;\r\nuse&nbsp;core\\lib\\Router&nbsp;as&nbsp;Router;\r\nuse&nbsp;core\\lib\\View&nbsp;as&nbsp;View;\r\nclass&nbsp;IndexController\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;addData(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pdo&nbsp;=&nbsp;Model::getInstance();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;insert&nbsp;into&nbsp;z_post&nbsp;(title,content)&nbsp;values&nbsp;(&#39;this&nbsp;is&nbsp;test&#39;,&#39;this&nbsp;i&nbsp;test&#39;)&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($pdo-&gt;insertData($sql)){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;chenggong&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;index(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;$_GET[&#39;a&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;$_GET[&#39;b&#39;];&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pdo&nbsp;=&nbsp;Model::getInstance();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;select&nbsp;*&nbsp;from&nbsp;z_post&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;$pdo-&gt;query($sql);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$view&nbsp;=&nbsp;new&nbsp;View();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$view-&gt;assign(&quot;data&quot;,$data[0]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$view-&gt;display();\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;p(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;&#39;&lt;pre&gt;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//var_dump(Router::$params);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;Router::$params[&#39;id&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>先看index这个方法。在这里我们实例化Model类，得到pdo实例，并且执行了一条sql查询语句。然后实例化view类，输出了页面。逻辑很简单。我们接下来看看Model类和View类，看看数据对象的实例化和模板的使用。</p><h3>Model</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\nnamespace&nbsp;core\\lib;\r\n\r\nclass&nbsp;Model{\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$instance=null;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$dbLink;\r\n&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;__construct($params=null){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dsn&quot;&nbsp;=&gt;&nbsp;&quot;mysql:host=localhost;dbname=blog&quot;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;username&quot;&nbsp;=&gt;&nbsp;&quot;root&quot;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;pwd&quot;&nbsp;=&gt;&nbsp;&quot;&quot;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;option&quot;=&gt;&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\PDO::ATTR_ERRMODE&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;\\PDO::ERRMODE_EXCEPTION,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($params){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options&nbsp;=&nbsp;array_merge($options,$params);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extract($options);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;dbLink&nbsp;=&nbsp;new&nbsp;\\PDO($dsn,$username,$pwd,$options);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;dbLink-&gt;exec(&quot;set&nbsp;names&nbsp;utf8&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;__clone(){}&nbsp;&nbsp;//禁止克隆\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;getInstance(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!self::$instance&nbsp;instanceof&nbsp;self){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$instance&nbsp;=&nbsp;new&nbsp;self();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self::$instance;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;insertData($sql){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;dbLink-&gt;exec($sql);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;query($sql){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$record&nbsp;=&nbsp;$this-&gt;dbLink-&gt;query($sql);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($record){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$record-&gt;fetchAll(\\PDO::FETCH_ASSOC);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n}</pre><p>重点看一下getInstance和构造函数。这里单例模式的典型写法。这样每次我们getInstance得到的都是同一个实例。</p><h3>view</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\nnamespace&nbsp;core\\lib;\r\n\r\nclass&nbsp;View\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$data&nbsp;=&nbsp;array();\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;assign($name,$data){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;data[$name]&nbsp;=&nbsp;$data;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;display($filename=&quot;&quot;){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extract($this-&gt;data);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($filename){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filePath&nbsp;=&nbsp;APP_PATH.&quot;view/&quot;.Router::$ctrl.&quot;/&quot;.$filename;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filePath&nbsp;=&nbsp;APP_PATH.&quot;view/&quot;.Router::$ctrl.&quot;/&quot;.Router::$act.&quot;.php&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_file($filePath)){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;$filePath;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(&#39;模版文件不存在&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>原理就是将assign方法使用到的数据放到data这个属性中。当display的时候，找到模板，并将分配过去的数据放到模板中。</p><p><br/></p><p>项目github地址：https://github.com/ruanwenwu/rwwfrm</p><p><br/></p><p><br/></p><p>							</p>','框架','php框架原理','框架完成项目中的基础布置，让开发人员将更多的精力放在业务的实现上。','php',0,287,1),(20,1479181613,1479181935,1479181613,'<p>								</p><h3>题记</h3><p>Zol_config的原理和大多数框架里的config类没有太大区别，甚至更加简单，而有些地方比较臃肿。简单在只有一个方法，臃肿在多了很多不必要的判断，像ini后缀的根本不必要。最好再加一个all方法，能获取指定配置文件的所有配置。</p><h3>源码</h3><pre class=\"brush:php;toolbar:false\">&lt;?php\r\n/**\r\n*&nbsp;获取配置\r\n*&nbsp;@author&nbsp;wiki&lt;wu.kun@zol.com.cn&gt;\r\n*&nbsp;@copyright&nbsp;(c)&nbsp;2010-06-22\r\n*&nbsp;@version&nbsp;v1.0\r\n*/\r\n\r\nclass&nbsp;ZOL_Config\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;配置缓存\r\n&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array\r\n&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n	private&nbsp;static&nbsp;$_cache;\r\n\r\n	/**\r\n	*&nbsp;获取\r\n	*\r\n	*&nbsp;@param&nbsp;mixed&nbsp;$key&nbsp;配置地址\r\n	*&nbsp;@param&nbsp;mixed&nbsp;$arrKeyName&nbsp;配置子键，可多维，用.号分隔\r\n	*&nbsp;@param&nbsp;enum&nbsp;$type&nbsp;PHP|INI|EVAL\r\n	*&nbsp;@return&nbsp;array|false\r\n	*/\r\n	public&nbsp;static&nbsp;function&nbsp;get($key,&nbsp;$arrKeyName&nbsp;=&nbsp;&#39;&#39;,&nbsp;$type&nbsp;=&nbsp;&#39;PHP&#39;)\r\n	{\r\n		if&nbsp;(!defined(&#39;PRODUCTION_CONFIG_PATH&#39;))&nbsp;{\r\n			define(&#39;PRODUCTION_CONFIG_PATH&#39;,&nbsp;PRODUCTION_ROOT&nbsp;.&nbsp;&#39;/Config&#39;);\r\n		}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileExt&nbsp;=&nbsp;array(&nbsp;#不同配置文件的扩展名映射关系\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;ini&#39;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&#39;ini&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;php&#39;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&#39;php&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;eval&#39;&nbsp;&nbsp;=&gt;&nbsp;&#39;php&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);\r\n\r\n		$path&nbsp;=&nbsp;PRODUCTION_CONFIG_PATH&nbsp;.&nbsp;&#39;/&#39;&nbsp;.&nbsp;str_replace(&#39;_&#39;,&nbsp;&#39;/&#39;,&nbsp;$key)&nbsp;.&nbsp;&#39;.&#39;&nbsp;.&nbsp;$fileExt[strtolower($type)];\r\n		if&nbsp;(isset(self::$_cache[$path]))&nbsp;{\r\n			$config&nbsp;=&nbsp;self::$_cache[$path];\r\n		}&nbsp;else&nbsp;{\r\n			if&nbsp;(!ZOL_File::exists($path))&nbsp;{\r\n				self::$_cache[$path]&nbsp;=&nbsp;false;\r\n				return&nbsp;false;\r\n			}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$type&nbsp;=&nbsp;strtoupper($type);\r\n			switch&nbsp;($type)&nbsp;{\r\n				case&nbsp;&#39;INI&#39;:\r\n					$config&nbsp;=&nbsp;parse_ini_file($path);\r\n					break;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&#39;EVAL&#39;:&nbsp;#config中可以有变量，这样可以将变量传入到config中\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_array($arrKeyName)){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extract($arrKeyName);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n					$config&nbsp;=&nbsp;include($path);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\r\n				default:\r\n				case&nbsp;&#39;PHP&#39;:\r\n					$config&nbsp;=&nbsp;include($path);\r\n					break;\r\n			}\r\n			self::$_cache[$path]&nbsp;=&nbsp;$config;\r\n		}\r\n\r\n		if&nbsp;($arrKeyName&nbsp;&amp;&amp;&nbsp;$type&nbsp;!=&nbsp;&#39;EVAL&#39;)&nbsp;{\r\n			if&nbsp;(strpos(&#39;.&#39;,&nbsp;$arrKeyName))&nbsp;{\r\n				$keyArr&nbsp;=&nbsp;explode(&#39;.&#39;,&nbsp;$arrKeyName);\r\n				foreach&nbsp;($keyArr&nbsp;as&nbsp;$key)&nbsp;{\r\n					if&nbsp;(!$config)&nbsp;{\r\n						break;\r\n					}\r\n\r\n					$config&nbsp;=&nbsp;empty($config[$key])&nbsp;?&nbsp;false&nbsp;:&nbsp;$config[$key];\r\n				}\r\n			}&nbsp;else&nbsp;{\r\n				$config&nbsp;=&nbsp;empty($config[$arrKeyName])&nbsp;?&nbsp;false&nbsp;:&nbsp;$config[$arrKeyName];\r\n			}\r\n		}\r\n		return&nbsp;$config;\r\n	}\r\n}</pre><h3>解读</h3><p>还是套路。^_^。首先定义一个static的$_cache变量来做缓存。然后解析文件名获得配置数组。<br/></p><p><br/></p><p>只有一个方法get()用来获取配置文件。get里传入配置文件名和需要取得键名。如果已经缓存过该文件就直接取，如果没有就看文件是否存在，存在的话就取出来。个人觉得ini后缀不用管，拿实用的php就可以了。</p><p><br/></p><p>最后附上被加载的配置文件的格式：</p><p><img src=\"/ueditor/php/upload/image/20161115/1479181931403201.png\" title=\"1479181931403201.png\" alt=\"blob.png\"/></p><p>							</p>','zolframework','Zol_config','Zol_config的原理和大多数框架里的config类没有太大区别，甚至更加简单。','php',0,192,1),(21,1479181734,1479181734,1479181734,'','','持续前进！','','说说',0,190,1),(22,1479199655,1479211407,1479199655,'<p>								</p><h3>题记</h3><p>当公司项目发展到一定阶段，出现了a.domain.com,b.domain.com,c.domain.com并且各个domain下的开发人员对彼此的项目不了解，但需要对方的数据或者进行交互的时候，依赖问题就出现了。</p><p><br/></p><p>比如a.domain.com需要b.domain提供数据。一般情况下a项目的开发人员需要b项目的开发人员提供接口。接口写好了：b.domain.com/api.php。用了一段时间挺好。可是突然有一天，b.domain.com出现问题挂了，a.domain.com也跟着遭殃了。这就是依赖。也是私有云出现的原因。</p><p><br/></p><h3>私有云的优势</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>切断各个业务的耦合。用了私有云，a.domain.com下的开发人员，可以直接调用私有云下的方法，尽管这些方法仍然需要b.domain.com下的开发人员开发。</p></li><li><p>没有单点问题，a.domain.com下的私有云入口是自己的独立的一份文件。b.domain.com也是一样。每小时或者推送数据同步，保持各服务器私有云程序一致。</p></li><li><p>减少不必要的请求。数据就在本应用内得到，省去b.domain.com在还要复制一份a.domain.com的请求与处理。效率加倍。<br/></p><p><br/></p></li></ol><h3>私有云的使用</h3><p>私有云的使用很简单，只需要在项目中引入私有云这个项目中的api.php，然后就可以了，就像这样：</p><p class=\"p1\"><span class=\"s1\">ZOL_Api</span><span class=\"s2\">::<em>run</em>(</span>&quot;Service.Area.getClientIp&quot;<span class=\"s2\">, </span><span class=\"s3\"><strong>array</strong></span><span class=\"s2\">())。</span></p><p class=\"p1\"><span class=\"s2\"><br/></span></p><p>这个api.php里有个ZOL_API类里，有个autoload方法控制了私有云类和方法的加载，有个run方法来进行执行对应的类的方法。<br/></p><p><br/></p><p>autoload方法：</p><pre class=\"brush:php;toolbar:false\">public&nbsp;static&nbsp;function&nbsp;autoload($name)\r\n&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(trim($name)&nbsp;==&nbsp;&#39;&#39;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;exception(&#39;No&nbsp;class&nbsp;or&nbsp;interface&nbsp;named&nbsp;for&nbsp;loading&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(class_exists($name,&nbsp;false)&nbsp;||&nbsp;interface_exists($name,&nbsp;false))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$namespace&nbsp;=&nbsp;substr($name,&nbsp;0,&nbsp;strpos($name,&nbsp;&#39;_&#39;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ZOL_API_ISFW&nbsp;&amp;&amp;&nbsp;in_array($namespace,&nbsp;array(&#39;Db&#39;,&#39;ZOL&#39;))&nbsp;){&nbsp;#框架的自动加载加载\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file&nbsp;=&nbsp;&#39;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($namespace&nbsp;==&nbsp;&#39;API&#39;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file&nbsp;=&nbsp;ZOL_API_BASE&nbsp;.&nbsp;&#39;/&#39;&nbsp;.&nbsp;str_replace(&#39;_&#39;,&nbsp;DIRECTORY_SEPARATOR,&nbsp;$name)&nbsp;.&nbsp;&#39;.php&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;对个性的命名空间做处理\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elseif&nbsp;(isset(self::$_namespace[$namespace])){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file&nbsp;=&nbsp;self::$_namespace[$namespace]&nbsp;.&nbsp;&#39;/&#39;&nbsp;.&nbsp;str_replace(&#39;_&#39;,&nbsp;DIRECTORY_SEPARATOR,&nbsp;$name)&nbsp;.&nbsp;&#39;.php&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($file){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;$file;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!&nbsp;class_exists($name,&nbsp;false)&nbsp;&amp;&amp;&nbsp;!&nbsp;interface_exists($name,&nbsp;false))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ZOL_Exception(&#39;Class&nbsp;or&nbsp;interface&nbsp;does&nbsp;not&nbsp;exist&nbsp;in&nbsp;loaded&nbsp;file&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p>这个方法里，定义：如果$name的第一段是ZOL或者Db,那么不进行任何操作，直接返回，交给框架自带的自动加载进行处理；如果$name的第一段以API开头，那么就进行文件名拼接并进行加载；如果是自定义的命名空间，就加载自定义空间下的类文件。<br/></p><p><br/></p><p>run方法：</p><pre class=\"brush:php;toolbar:false\">public&nbsp;static&nbsp;function&nbsp;run($method,$param=false){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$method)return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$method&nbsp;=&nbsp;str_replace(&quot;.&quot;,&nbsp;&quot;_&quot;,&nbsp;$method);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$class&nbsp;=&nbsp;&quot;API_Item_&quot;&nbsp;.&nbsp;substr($method,&nbsp;0,strrpos($method,&quot;_&quot;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$func&nbsp;&nbsp;=&nbsp;substr($method,&nbsp;strrpos($method,&quot;_&quot;)+1);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$_nowMethod&nbsp;=&nbsp;$method;//通过私有云run调用\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;&nbsp;=&nbsp;call_user_func_array(array($class,&nbsp;$func),&nbsp;array($param));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$data;\r\n}</pre><p>run方法的作用就是利用ZOL_API类里的autoload方法将私有云类文件加载进来，并执行对应的方法了。</p><p><br/></p><h3>私有云里的spl_autoload_register和框架里的spl_autoload_register</h3><p>两个自动加载都是生效的，但是要避免两个不互相干扰。</p><h3>同步</h3><p>a.domain.com的开发修改完代码之后，会同步到b.domain.com的相同位置。由于每台使用私有云的服务器都有自己的代码，这样即使b.domain.com挂了，a.domain.com也能正常使用。</p><p>							</p>','架构','私有云','当公司项目发展到一定阶段，出现了a.domain.com,b.domain.com,c.domain.com并且各个domain下的开发人员对彼此的项目不了解，但需要对方的数据或者进行交互的时候，依赖问题就出现了。比如a.domain.com需要b.domain提供数据...','php',0,205,1),(23,1479302069,1479302069,1479302069,'','','世间总是你好','','说说',0,172,1),(24,1479378141,1479378141,1479378141,'','','好强烈的恋爱中的感觉','','',0,183,1),(25,1479394790,1479394790,1479394790,'<h3>题记</h3><p>js是非常容易引起人们兴趣的一门语言。有一千种理由让你爱上他，瀑布流就是其中之一。</p><h3>demo</h3><p><a href=\"/demo/pubuliu/\" target=\"_blank\" title=\"瀑布流\">瀑布流演示</a><br/></p><h3>原理</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>首先计算出屏幕大小。根据预设的图片的宽度，求出列数。</p></li><li><p>将通过php加载过来的数据依次，每次计算出最低的那一列，然后算出绝对top值和left值，放到容器中就好了。</p></li><li><p>当屏幕尺寸改变时，只需要从新按照这个思想走一遍就行了。</p><p></p></li></ol><h3>php代码</h3><p>js的代码，大家可以查看demo的源代码，php的我贴出来一下：</p><pre class=\"brush:php;toolbar:false\">&lt;?php\r\n/**\r\n&nbsp;*&nbsp;获取瀑布流图片数据\r\n&nbsp;*/\r\n$dataArr&nbsp;=&nbsp;array(&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;status&quot;&nbsp;=&gt;&nbsp;true,\r\n);\r\nfor&nbsp;($i&nbsp;=&nbsp;1;&nbsp;$i&nbsp;&lt;=&nbsp;30;&nbsp;$i++)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$file&nbsp;=&nbsp;&quot;./img/$i.jpg&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;if(!file_exists($file)){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file&nbsp;=&nbsp;&quot;./img/$i.jpeg&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$src&nbsp;&nbsp;=&nbsp;&nbsp;&quot;/demo/pubuliu/img/$i.jpeg&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$src&nbsp;=&nbsp;&quot;/demo/pubuliu/img/$i.jpg&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;list($width,&nbsp;$height,&nbsp;$type,&nbsp;$attr)&nbsp;=&nbsp;getimagesize($file);\r\n&nbsp;&nbsp;&nbsp;&nbsp;$dataArr[&#39;data&#39;][]&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;src&quot;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;$src,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;width&quot;&nbsp;=&gt;&nbsp;&nbsp;$width,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;height&quot;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;$height,\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n}\r\necho&nbsp;json_encode($dataArr);\r\n?&gt;</pre><p><br/></p>','瀑布流','瀑布流原理','瀑布流在图片网站的应用非常广泛。今天我就跟大家一起研究一下瀑布流的原理。','js',0,297,1),(26,1479485091,1479485920,1479485091,'<p>								</p><h3>1.引入css和js文件<br/></h3><pre class=\"brush:css;toolbar:false\">&lt;link&nbsp;href=&quot;http://www.js-css.cn/jscode/highlight/highlight1/prettify.css&quot;&nbsp;type=&quot;text/css&quot;&nbsp;rel=&quot;stylesheet&quot;/&gt;\r\n&lt;script&nbsp;type=&quot;text/javascript&quot;&nbsp;src=&quot;http://www.js-css.cn/jscode/highlight/highlight1/prettify.js&quot;&gt;&lt;/script&gt;</pre><h3>2.给pre标签添加样式</h3><pre class=\"brush:php;toolbar:false\">var&nbsp;preObj&nbsp;=&nbsp;document.getElementsByTagName(&quot;pre&quot;);\r\nfor(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;preObj.length;&nbsp;i++){\r\n&nbsp;&nbsp;&nbsp;&nbsp;preObj[i].className&nbsp;=&nbsp;&quot;prettyprint&nbsp;lang-php&quot;;\r\n}</pre><h3>3.渲染pre标签</h3><pre class=\"brush:php;toolbar:false\">&lt;body&nbsp;onload=&quot;prettyPrint()&quot;&gt;</pre><p>其实，如果发表文章的时候，如果事先给pre标签写好样式，也就不需要第二部了。因为懒得改编辑器，所以就在页面里用这段脚本加了样式。<br/></p><p><br/></p><p><br/></p><p>							</p>','代码高亮','用google-code-prettify为博客添加代码高亮','博客上线了，发现代码没有高亮，不怎么好看。刚才添加了，记录一下。','js',0,192,1),(27,1479488679,1479488679,1479488679,'','','有一种幸福叫做相守','相爱容易，相守不易，且行且珍惜！','说说',0,210,1),(28,1479525922,1479525922,1479525922,'','','沉着冷静','静静的看完这篇文章','说说',0,177,1),(29,1479531074,1479532022,1479531074,'<p>								</p><h3>1.优化工具使用<br/></h3><p>chrom浏览器自带。打开浏览器，按f12。如果没有发现Rending选项，按ESC键。出现的界面如图：</p><p><img src=\"/ueditor/php/upload/image/20161119/1479531538979342.png\" title=\"1479531538979342.png\" alt=\"7F580AD9-4F4B-46A8-B45F-4BFDA5BB8979.png\"/></p><p>打开页面之后，需要点击左上角的小圆球，开始录制，录制结束后，在summary里就能看到了。如果重绘区域比较大，而且<span style=\"color: rgb(192, 0, 0);\">非常频繁</span>，那么就要采取优化措施了。</p><h3>2.优化措施<br/></h3><h4>2.1.对待优化区域采取absolute或者fixed处理。</h4><p>使用position属性后可以降低回流，从而减少重绘面积。原理就好像是你丢一块石头到河里，发现水波会一圈一圈的荡漾开来，最终一直蔓延到河边，结果是影响到整条河了。而如果你在河上放一个装上水的小盆，把石子扔在小盆里，影响就没那么大了。下面接下来要讲的layer层其实是一样的原理。</p><h4>2.2.添加layer层。<br/></h4><p>从图中可以看出，layer层以橘黄色的边框包着。以下几个方法可以添加layer层：</p><ol style=\"padding: 0px 0px 0px 40px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; white-space: normal;\" class=\" list-paddingleft-2\"><ol style=\"list-style-type: lower-alpha;\" class=\" list-paddingleft-2\"><li><p>有3D元素的属性；</p></li><li><p>video标签并使用加速视频解码；</p></li><li><p>canvas元素并启用3D；</p></li><li><p>插件，比如flash；</p></li><li><p>CSS动画；</p></li><li><p>CSS滤镜；</p></li><li><p>有一个后代元素是独立的layer；</p></li><li><p>元素的相邻元素是独立layer。</p></li></ol></ol><p>注意，添加layer层会增加ram和gpu的开销，过多的layer层可能会发挥反作用，使页面变得更卡。</p><p><br/></p><p>看上去挺多挺复杂的，其实最简单、最容易理解、也最容易滥用的是第一条。实现第一条仅需要在元素的样式加上:transform:translateZ(0);-webkit-transform:translateZ(0);就可以了。</p><h3>2.3.动画优化<br/></h3><p>javascript是单线程，一个耗时较长的任务会影响到下一帧的动画。而css3是一个独立运行的线程，效果比js好很多，但是使用不够灵活。<br/></p><h3>2.4.减少gif动画的使用<br/></h3><p>因为gif会以非常高的频率进行重绘，验证影响页面流畅度。</p><p><br/></p><p>以上是我的阅读笔记，原文请参考：<a href=\"http://www.cnblogs.com/aser1989/p/4527491.html\" target=\"_blank\" title=\"http://www.cnblogs.com/aser1989/p/4527491.html\">http://www.cnblogs.com/aser1989/p/4527491.html</a>，谢谢ASER的辛勤付出与智慧。</p><p><br/></p><p><br/></p><p>							</p>','移动端性能优化','移动端性能优化阅读笔记','1.移动端优化的工具使用。2.降低重绘的两种方法。','js',0,186,1),(30,1479533192,1479533270,1479533192,'','温暖','给你们','张宇的《给你们》：\"一定是特别的缘分，才可以一路走来变成一家人\"。','说说',0,185,1),(31,1479539654,1479539861,1479539654,'<p>								</p><blockquote><p>工作中经常要用到BOM里的东西，每次用都要查，比较麻烦。今天周末，做个总结，省的以后麻烦。</p><p class=\"p1\"><span class=\"s1\">找到合适的资料，刚开始看，就碰到offsetParent这个东西，不懂，就先学习一下这个东西吧。</span></p></blockquote><h3><span class=\"s1\">1. 看图</span></h3><h3><img src=\"/ueditor/php/upload/image/20161119/1479536320781372.png\" title=\"1479536320781372.png\" alt=\"blob.png\"/></h3><p>元素的offsetParent实际上找的是元素拥有定位属性的父级元素。<br/></p><p><br/></p><h3>2.解析<br/></h3><p>比如下面这个dom结构：</p><pre class=\"brush:html;toolbar:false\">&lt;div&nbsp;id=&quot;parent&quot;&nbsp;style=&quot;position:absolute;&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;id=&quot;child&quot;&gt;&lt;div&gt;\r\n&lt;div&gt;</pre><p>id为child的元素的offsetParent实际上就是id为parent的div了。如果parent元素没有定位属性，它会一直往上找，如果一直没有，最后会找到body。<br/></p><p><br/></p><p>							</p>','offsetParent','js的offsetParent','今天，我们一起来探一探offsetParent的究竟。','js',0,323,1),(32,1479615443,1479615475,1479615443,'<p>								</p><p><img src=\"/ueditor/php/upload/image/20161120/1479615416907472.png\" title=\"1479615416907472.png\" alt=\"blob.png\"/></p><p>							</p>','','宽带升级到100M啦，哇哈哈','从此进入高速模式！','生活',0,219,1),(33,1479639425,1479827275,1479639425,'<p>								</p><p><br/></p><p>懒得看文章的可以戳这里：<a href=\"/demo/sizeandpos/\" target=\"_self\">js位置和大小demo</a><br/></p><h3 style=\"text-align: left;\">1.元素的偏移量</h3><p style=\"text-align:center\"><img src=\"/ueditor/php/upload/image/20161120/1479638455572006.png\" title=\"1479638455572006.png\" alt=\"blob.png\"/></p><p><img src=\"/ueditor/php/upload/image/20161120/1479638429919622.png\" title=\"1479638429919622.png\" alt=\"blob.png\"/></p><h3>2.客户区大小<br/></h3><p><span style=\"color: rgb(51, 51, 51); font-family: &#39;Helvetica Neue&#39;, Helvetica, Arial, &#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;WenQuanYi Micro Hei&#39;, &#39;Microsoft Yahei&#39;, sans-serif; font-size: 14px; line-height: 22.4px; background-color: rgb(255, 255, 255);\">元素的客户区大小指的是元素内容机器内边距占据空间的大小。</span></p><p><span style=\"color: rgb(51, 51, 51); font-family: &#39;Helvetica Neue&#39;, Helvetica, Arial, &#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;WenQuanYi Micro Hei&#39;, &#39;Microsoft Yahei&#39;, sans-serif; font-size: 14px; line-height: 22.4px; background-color: rgb(255, 255, 255);\"><img src=\"/ueditor/php/upload/image/20161120/1479638505782196.png\" title=\"1479638505782196.png\" alt=\"blob.png\"/></span></p><p><span style=\"color: rgb(51, 51, 51); font-family: &#39;Helvetica Neue&#39;, Helvetica, Arial, &#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;WenQuanYi Micro Hei&#39;, &#39;Microsoft Yahei&#39;, sans-serif; font-size: 14px; line-height: 22.4px; background-color: rgb(255, 255, 255);\"><img src=\"/ueditor/php/upload/image/20161120/1479638531535862.png\" title=\"1479638531535862.png\" alt=\"blob.png\"/></span></p><p><span style=\"color: rgb(51, 51, 51); font-family: &#39;Helvetica Neue&#39;, Helvetica, Arial, &#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;WenQuanYi Micro Hei&#39;, &#39;Microsoft Yahei&#39;, sans-serif; font-size: 14px; line-height: 22.4px; background-color: rgb(255, 255, 255);\"></span></p><p>要确定浏览器可见窗口的大小，可以使用document.documentElement或document.body（IE7之前的版本中）。</p><p>从以上两个我们可以看出元素偏移量（offset）与客户区大小（client）的区别在于有没有包含边框，客户区大小不包含边框。</p><h3>3.滚动大小<br/></h3><p><img src=\"/ueditor/php/upload/image/20161120/1479638684483523.png\" title=\"1479638684483523.png\" alt=\"blob.png\"/></p><p>scrollWidth和scrollHeight主要用于确定元素内容的实际大小。所以带有垂直滚动条的页面总高度就是document.documentElement.scrollHeight。</p><p><img src=\"/ueditor/php/upload/image/20161120/1479638735393838.png\" title=\"1479638735393838.png\" alt=\"blob.png\"/></p><h3>4.窗口大小</h3><p>在现代主流浏览器中提供了四个属性确定窗口的大小，分别为：innerWidth、innerHeight、outerWidth和outerHeight。</p><p><br/></p><p>在主流浏览器中，<code>document.documentElement.clientWidth</code>和<code>window.innerWidth</code>的值一样。但是在ie8及以下，<code>window.innerHeight</code>的值为undefined,而<code>document.documentElement.clientHeight</code>仍然有值。以下是求出适口的代码：</p><pre class=\"brush:php;toolbar:false\">var&nbsp;pageWidth=window.innerWidth,\r\npageHeight=window.innerHeight;\r\nif(typeof&nbsp;pageWidth&nbsp;!==&nbsp;&#39;number&#39;){\r\n&nbsp;&nbsp;&nbsp;&nbsp;if(document.compatMode&nbsp;===&nbsp;&#39;CSS1Compat&#39;){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pageWidth=document.documentElement.clientWidth;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pageHeight=document.documentElement.clientHeight;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}else{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pageWidth=document.body.clientWidth;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pageHeight=document.body.clientHeight;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>解释：如果是现代浏览器，直接使用window.innerWidth和window.innerHeight就可以得到适口信息，如果是非现代浏览器。判断是标准模式，则用documentElement，否则的话就是body。</p><p><br/></p><p>代码中document.compatMode用于判断浏览器处于什么模式，它有两个值：BackCompat:浏览器处于怪异模式CSS1Compat:浏览器处于标准模式。</p><p><br/></p><p>本文摘录自：<a href=\"https://segmentfault.com/a/1190000005967868\" target=\"_self\">https://segmentfault.com/a/1190000005967868</a></p><p><br/></p><p>							</p>','scrollTop','js中的位置和大小','js中的位置和大小的知识点比较多，而且存在严重的兼容问题。','js',0,295,1),(34,1479731665,1479827494,1479731665,'<p>								</p><h3>1.题记<br/></h3><p>js运动是js学习中的一个难点，也是一个最能勾起你兴趣的点。看着各种动画效果，就有一种想去掌握的冲动。今天，我们就开始一步一步的来学习，掌握js运动。</p><p>js运动的核心是一个运动框架，有了这个框架，写任何运动都会事半功倍。看到框架不要害怕，所谓的框架就是一系列经验的总结，保证运动在各个平台，各种情况下都能正常运行。</p><p>废话不多说了，看我们的第一个简单到不能再简单的运动框架：</p><p>点击demo:<a href=\"/demo.php/Move/basic\" target=\"_blank\" title=\"阮文武-js运动基础\">/demo.php/Move/basic</a></p><pre class=\"brush:html;toolbar:false\">&lt;!doctype&nbsp;html&gt;\r\n&lt;html&gt;\r\n	&lt;head&gt;\r\n		&lt;meta&nbsp;charset=&quot;utf-8&quot;&nbsp;/&gt;\r\n		&lt;title&gt;js运动基础&lt;/title&gt;\r\n		&lt;style&gt;\r\n			*{padding:0;margin:0;}\r\n			#div1{width:200px;height:200px;position:absolute;left:0;top:0;background:red;}\r\n			#btn{position:absolute;top:250px;}\r\n		&lt;/style&gt;\r\n	&lt;/head&gt;\r\n	&lt;body&gt;\r\n		&lt;div&nbsp;id=&quot;div1&quot;&gt;&lt;/div&gt;\r\n		&lt;button&nbsp;id=&quot;btn&quot;&nbsp;onclick=&quot;startMove()&quot;&gt;click&nbsp;me&lt;/button&gt;\r\n	&lt;/body&gt;\r\n	&lt;script&gt;\r\n		var&nbsp;timer;\r\n		function&nbsp;startMove(){\r\n			var&nbsp;oDiv1&nbsp;=&nbsp;document.getElementById(&quot;div1&quot;);\r\n			var&nbsp;oBtn&nbsp;=&nbsp;document.getElementById(&quot;btn&quot;);\r\n			clearInterval(timer);&nbsp;&nbsp;&nbsp;&nbsp;//需要加上这一句，否则每次点击，定时器就会叠加，速度就会越来越快\r\n			timer&nbsp;=&nbsp;setInterval(function(){\r\n				if(oDiv1.offsetLeft&nbsp;&lt;&nbsp;300){\r\n					oDiv1.style.left&nbsp;=&nbsp;oDiv1.offsetLeft&nbsp;+&nbsp;10&nbsp;+&nbsp;&quot;px&quot;;&nbsp;&nbsp;&nbsp;&nbsp;//如果没到就继续运动，offsetLeft加10\r\n				}else{\r\n					clearInterval(timer);&nbsp;&nbsp;&nbsp;&nbsp;//如果到了就停止\r\n				}\r\n			},30);\r\n		}		\r\n	&lt;/script&gt;\r\n&lt;/html&gt;</pre><h3>2.代码解读</h3><p>原理就是，获取按钮元素和div元素。前提是div元素必须具有position属性才能动起来。</p><p>开启一个定时器，不断改变div的offsetLeft就可以了。就这么简单。</p><p>在完成这个最基本的运动框架的时候，有几个需要注意的点：</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>运动到固定位置的时候需要挺下来，不能没完没了的运动。</p></li><li><p>运动到了指定位置之后，再点按钮不能接着走。</p></li><li><p>在运动的过程中，点击按钮不能重复开启定时器，否则速度会倍增的。</p></li></ol><p>大家发现了没有，所谓的框架就是一个startMove方法而已。当然，随着我们学习的深入，这个方法会越来越“大”，也会越来越强大。</p><p>下面我将写几个基于这个最基本运动框架的例子。</p><p>							</p>','js运动','js运动基础（一）','跟我一起来温习一下js的运动知识吧。','js',0,182,1),(35,1479736213,1479827138,1479736213,'<p>								</p><h3>1.题记</h3><p>原理不多说了，参照我的前一篇博文。</p><h3>2.demo示例</h3><p><a href=\"/demo.php/Move/basicdemo\" target=\"_blank\">基本运动框架实例</a></p><p>							</p>','js运动','js运动基础（二）','js运动框架基础的简单应用的2个例子。这里的两个例子都是匀速运动。','js',0,252,1),(36,1479826963,1479895801,1479826963,'<p>								</p><h3>题记<br/></h3><p>前面两节，我们讲的都是匀速运动。今天我们学习一下缓冲运动的原理。缓冲运动的应用非常广泛。各大门户的焦点图基本都是缓冲运动。很常见的图片切换效果，大多也是缓冲。</p><h3>原理</h3><p>写一个控制器，不断的循环下面两个步骤就ok了。</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>运动的“目标点”减去“出发点”除以“速度系数”得到速度。</p></li><li><p>按照这个速度运动一次。</p></li></ol><h3>需要注意的点</h3><p>显示屏上的最小单位是1像素，在求得“速度”的时候，会出现小数的情况，出现小数，表现在运动上就是“走不动了”。解决办法就是取整：<span style=\"color: rgb(255, 0, 0);\">当正向运动时向上取整，当反向运动时向下取整。</span></p><p><span style=\"color:#ff0000\"><span style=\"color: rgb(0, 0, 0);\">代码我就不贴了，现在对贴代码有点反感，想看代码的同学，可以看我下面的链接。</span></span></p><h3>demo</h3><p>猛戳这里：<a href=\"/demo.php/Move/buffermove\" target=\"_blank\" title=\"缓冲运动实例\">缓冲运动实例（一）</a></p><p>猛戳这里：<a href=\"/demo.php/Move/chunlian\" target=\"_blank\">缓冲运动示例（二）春联效果</a></p><p>							</p>','缓冲运动','js运动基础（三）','写缓冲运动有两点要特别注意：1.运动“到位”，2.速度控制。','js',0,217,1),(37,1479828032,1481595931,1479828032,'<p>坚持就是你，不坚持就是nothing...</p>','干劲','keep moving...','坚持就是你，不坚持就是nothing...','说说',0,252,1),(38,1479950653,1479950653,1479950653,'<h3>题记</h3><p>运动的原理在上面几节都已经讲过了，这一节只是将上面讲的运动框架进行扩展，让它能支持多个物体同时运动起来，其实本质都是一样。不贴代码了，想看源码的同学，欢迎猛戳下面的demo。</p><h3>demo</h3><p>猛戳：<a href=\"/demo.php/Move/duowuti\" target=\"_blank\">js多物体运动框架</a></p>','js运动','js运动基础（四）','js多物体运动框架的核心是给每一个运动分配一个定时器，让他们互不干扰','js',0,162,1),(39,1479951940,1479951940,1479951940,'<h3>题记</h3><p>任意值运动框架仍然由我们前面熟悉的startMove函数扩展而来。只是在原来的基础上引入了getStyle方法来解决了一些再特殊情况下会发生的bug，并且让框架支持所有属性。</p><h3>核心代码</h3><p>startMove函数</p><pre class=\"brush:js;toolbar:false\">function&nbsp;startMove(obj,&nbsp;attr,&nbsp;target){\r\n	clearInterval(obj.timer);\r\n	obj.timer&nbsp;=&nbsp;setInterval(function(){\r\n		var&nbsp;cur&nbsp;=&nbsp;0;\r\n		if(attr&nbsp;==&nbsp;&quot;opacity&quot;){\r\n			//需要round，因为计算机的不精确性\r\n			cur&nbsp;=&nbsp;Math.round(parseFloat(getStyle(obj,attr))*100);\r\n			console.log(cur);\r\n		}else{\r\n		&nbsp;&nbsp;&nbsp;&nbsp;cur&nbsp;=&nbsp;parseInt(getStyle(obj,attr));\r\n		}\r\n		var&nbsp;speed&nbsp;=&nbsp;(target&nbsp;-&nbsp;cur)/10;\r\n		speed&nbsp;=&nbsp;speed&nbsp;&gt;&nbsp;0&nbsp;?&nbsp;Math.ceil(speed)&nbsp;:&nbsp;Math.floor(speed);\r\n		if(target&nbsp;==&nbsp;cur){\r\n			clearInterval(obj.timer);\r\n		}else{\r\n			if(attr&nbsp;!=&nbsp;&quot;opacity&quot;){\r\n				obj.style[attr]&nbsp;=&nbsp;cur&nbsp;+&nbsp;speed&nbsp;+&nbsp;&quot;px&quot;;\r\n			}else{\r\n				obj.style[attr]&nbsp;=&nbsp;(cur&nbsp;+&nbsp;speed)/100;\r\n				obj.style.filter&nbsp;=&nbsp;&quot;alpha(opacity:&quot;+(cur+speed)+&quot;)&quot;;\r\n			}\r\n		}\r\n	},30);\r\n}</pre><p>getStyle函数</p><pre class=\"brush:js;toolbar:false\">function&nbsp;getStyle(obj,&nbsp;attr){\r\n	if(obj.currentstyle){\r\n		return&nbsp;obj.currentStyle[attr];\r\n	}else{\r\n		return&nbsp;getComputedStyle(obj,false)[attr];\r\n	}\r\n}</pre><h3>demo</h3><p>猛戳这里：<a href=\"/demo.php/Move/renyizhi\" target=\"_blank\">js任意值运动框架，里面包含了一个透明度无线循环的例子</a></p>','js运动','js运动基础（五）','任意值运动框架要解决的问题，是让除了位置和大小以外的比如border，opacity等任意属性值动起来。','js',0,334,1),(40,1480228323,1480386511,1480228323,'<p>								</p><h3>题记<br/></h3><p>毫不夸张，这是一次足以让人受益终身的分享。虽说这次训练营是为新员工而发起，但是我觉得，这次分享对任何人都是极受用的。</p><p>肖总的《企业发展史》，蔡总的《有一份工作叫做中关村在线》，老大的《小东成功心法》，板凳的《员工职业路径规划》，王晔的《关键词解读》，沛哥的《数说ZOL》。这些分享，内容不同，但是分享的人都有一个共同点：正能量满满！</p><p>以下是我对这次分享的一些感悟，希望对读到它的人能有所帮助。</p><h3>企业发展史</h3><p>肖总讲企业发展史再合适不过了，因为他基本上见证了公司发展的各个时期。从1999年3月至今，这中间发生了很多故事，我摘其中几个印象比较深刻的说：<br/></p><p>1.2000年小东总加入公司。虽说职位是设计，但是他什么都做，而且都做的很优秀。且不论他是如何做到把专业之外的工作做的很优秀，只这种愿意多做，勇于担当的精神足以让人信赖。第一年加入公司就全面接手公司，抛开一些时机因素，其他的也就没什么好奇怪的了。</p><p>2.大概是2002年，我记不太清楚了，公司实现初次盈利。这次盈利意义重大，它不单是挽救公司于倒闭的边缘，更是证明了互联网盈利模式的可行性。</p><p>3.2003年非典肆虐期间，所有的公司都歇业了，唯有我们ZOL人，冒着生命的危险前往一线采集行情。正是这种超越同行的智慧与勇气，让ZOL在当时众多的竞争对手当中脱颖而出，从此ZOL进入飞速发展时期。</p><p>4.大概是2013年，在CBSi对中国国情不了解，对ZOL的发展不太看好的情况下，老大筹措数亿元将ZOL从CBSi买了回来，这是一个企业家对梦想的坚持，是对数代ZOL人的负责！</p><h3>有一份工作叫做中关村在线</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>创新。</p><p>我到现在还记得荣耀V8拍摄的地球画面，太震撼了。原来我们能做到比自己想象的更多。</p></li><li><p>传承与创新。</p><p>传承的是精神，年轻就应该做些不一样的事情。</p></li><li><p>责任心。</p><p>我们要时刻的记住，我们不是在做一件主管或者经理交代的事情，我们是在客户负责，对客户的每一分钱负责，也是对自己同事负责，对自己的青春负责。</p></li><li><p>团队的力量</p><p>这些奇思妙想，没有团队的合作，是不可能完成的。</p></li></ol><h3>小东成功心法</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>如何在逆境中生存。</p><p>小东总刚入社会时十分不顺利，辗转4个城市，换了几十份工作。后来好不容易在深圳一家知名的设计公司任职，工资是最低的不说，还不为老板认可。可是小东总并没有退缩，他谦卑为人，虚心请教，自掏腰包请客取经，团结同事最终得到同事和老板认可。</p></li><li><p>如何缩短自己和别人的差距。</p><p>向行业里最优秀的人学习，研究他们的长处，弥补自己的短处。凭借这一点，小东总那时候无论是在设计上还是在撰文上，都能在最短的时间内做的比周围的人优秀。</p></li><li><p>勤奋。</p><p>小东总十分谦虚，他在分享时说自己凭什么能获得成功？他说有些人是因为别的，而他是因为勤奋。可见勤奋对他的影响有多大，勤奋对一个人是多么重要。</p></li><li><p>负责。</p><p>小东总提到责任心这块就能挡住85%的人。确实，摸摸自己的良心，自己尽到自己最大的责任心了吗？在这个点上，小东总特别提到了女厕所的改造，和马桶品牌的选择。马桶比五星级酒店用的还好。而女厕的改造，因为大厦结构的原因，实施起来特别不容易，但是小东总仍然坚持做了。引用小东总的一句话：大的方面我们暂时比不过BAT，但是我们先从这些小的方面超越他们。他不希望女生上厕所总是要排队。这是一个企业家的责任心，也是一份善意。</p></li><li><p>情商。</p><p>小东总说以前公司小的时候，经常要求人。现在公司大了，比好多客户还要大。但是小东总出去见客户仍然十分谦卑，他总会跟对方提到三句话：您看我们那些方面做到不好的，给我们提个建议。您看有什么我们可以帮您的。还有一句记不得了，总之，要秉承利他原则。再就是要树立自己的品牌，朋友多了路好走。</p><p>一个人能走多远，不是由你的智商决定的，更多的由情商决定的。</p></li><li><p>正能量。</p><p>要充满正能量。负能量会让朋友远离你，何必自己给自己挖坑呢？</p></li><li><p>设定一个更高的目标。</p><p>没有一个更高的目标，怎么超越自己。</p></li><li><p>感恩。<br/></p></li></ol><h3>职业路径规划</h3><p>罗总的分享特别实用。他从自身的发展过程来讲述了这四个阶段：</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>起步。</p><p>首先做好自己的本职工作，提高职业技能。</p></li><li><p>发展期。</p><p>从小事做起，让自己成为一个靠谱的人，被依赖的人。</p></li><li><p>拓展自己的接触面。</p><p>我做好了设计，可不可以尝试一下其他的方面呢？比如产品。</p></li><li><p>进一步拓展自己。</p><p>做了产品，可不可以参加产品的运营了？</p></li></ol><p>这其中，罗总还考了我们一道题：说是有一个banner图，怎么改造这个banner图，让它获得更多的用户点击。结果让人都非常惊讶，改造后的方案是：把这个banner图变成了一个实用的小工具。一下子点击率从万分之一飙升到百分之一。创意实在是太有力的东西！</p><p>总之就是，做好每一件简单的事情，让自己成为一个值得依赖的人，不给自己设限。</p><h3>关键词解读</h3><p>王晔十分年轻，90后，来公司至今3年多。做的十分出色，2014，2015年的优秀员工都有他。他开始讲之前我一直很好奇，他是如何做到在三年内成为为数不多的资深编辑之一的。他分享完后，我就一点也不意外了。他阐述了12个关键词，我不能都记得了，但以下几个我印象深刻。</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>勇敢。</p><p>敢于做错，而不是粗心大意。</p></li><li><p>果敢。</p><p>敢于决断，有所为，而不是不把主管或者经理放在眼里。最近上映的《我不是潘金莲》传达了这样一个意思：不作为才是最大的腐败。确实，不作为不会做错，但是有什么值得称道的呢？</p></li><li><p>正直。</p><p>自己是否对的起自己的良心？</p><p>树立自己的品牌，走遍天下都不怕。</p></li><li><p>正能量。</p><p>不要受负能量的影响，把注意力放在自己最应该关注的方面。</p></li></ol><h3>数说ZOL</h3><p>作为一个技术员，我对沛哥列举的这些数字十分敏感。</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>平均每秒3万次的请求。</p><p>这对我们的网站架构和开发人员的技术要求都很高。也是我的技术目标。希望自己将来能传承这些技术，并做出自己的贡献。<br/></p></li><li><p>500多条产品线，平均每天更新4000+的产品和数量巨大的报价等相关信息。</p><p>据说市面上的产品库都是从ZOL取经学习而来的，实在是太牛了。</p></li><li><p>ZOL的技术布局。</p><p>这让我了解到自己所在公司的哪一环，自我定位和奋斗目标更明确了。</p></li></ol><p>以上这些都是我根据自己的记忆和感受所写，一来记录下来对自己是一个指引，二来希望能帮助到看到的人。如果有什么错误和纰漏，欢迎批评指正。</p><p>							</p>','分享','新员工拓展训练营总结','毫不夸张，这是一次足以让人受益终身的分享。虽说这次训练营是为新员工而发起，但是我觉得，这次分享对任何人都是极受用的。','生活',0,336,1),(41,1480424788,1480424907,1480424788,'<p>								</p><h3>题记</h3><p>原理的话在前面5节已经讲到，看demo吧。</p><h3>demo</h3><p><a href=\"/demo.php/Move/yingyong\" target=\"_blank\">js运动框架应用实例</a></p><p>							</p>','js运动','js运动基础（六）','js运动框架一个比较复杂的实例','js',0,251,1),(42,1480554236,1480556769,1480554236,'<p>								</p><p>《釜山行》的观后感就是：不要等到快要或者已经失去才知道珍惜。</p><p>							</p>','亲情','要重视对家人的陪伴与关注','《釜山行》看了两遍。一遍是自己一个人看的，一遍是和老婆一起看的。我们两个人看了都很感动。也是奇葩了，一部让人感动到不要不要的丧尸片。','说说',0,205,1),(43,1480555484,1480555972,1480555484,'<p>								</p><h3>题记<br/></h3><p>前面几节我们已经让startMove这个运动框架能够支持多物体、任意值的运动。现在我们对它进一步扩展，让它能够支持多属性。</p><h3>原理</h3><p>原理跟单属性类似，只是在开启定时器之后，需要遍历所有属性，当所有属性都运动“到位”后，我们才停止定时器。这里我们引入bStop这个变量作为“开关”,只有这个开关“说YES”了，我们就停止定时器。这个代码并不多，我就贴一下。不喜欢在这里看代码的，下面还有demo演示。</p><h3>代码</h3><pre class=\"brush:js;toolbar:false\">&lt;script&gt;\r\n//完美运动框架，支持多物体，任意值，多属性，链条式（回调）\r\nwindow.onload&nbsp;=&nbsp;function(){\r\n	function&nbsp;startMove(obj,&nbsp;json,&nbsp;fn){\r\n		clearInterval(obj.timer);\r\n		obj.timer&nbsp;=&nbsp;setInterval(function(){\r\n			var&nbsp;bStop&nbsp;=&nbsp;true;\r\n			for(var&nbsp;attr&nbsp;in&nbsp;json){\r\n				var&nbsp;cur;\r\n				if(attr&nbsp;==&nbsp;&quot;opacity&quot;){\r\n					cur&nbsp;=&nbsp;Math.round(parseFloat(getStyle(obj,attr))*100);\r\n				}else{\r\n					cur&nbsp;=&nbsp;parseInt(getStyle(obj,&nbsp;attr));\r\n				}\r\n				if(attr&nbsp;==&nbsp;&quot;opacity&quot;){\r\n					console.log(cur);\r\n				}\r\n				var&nbsp;speed&nbsp;=&nbsp;(json[attr]&nbsp;-&nbsp;cur)/10;\r\n				speed&nbsp;=&nbsp;speed&nbsp;&gt;&nbsp;0&nbsp;?&nbsp;Math.ceil(speed)&nbsp;:&nbsp;Math.floor(speed);\r\n				\r\n				if(cur&nbsp;!=&nbsp;json[attr]){\r\n					bStop&nbsp;=&nbsp;false;\r\n				}\r\n				\r\n				if(bStop){\r\n					clearInterval(obj.timer);\r\n					if(fn){\r\n						fn();\r\n					}\r\n				}else{\r\n					if(attr&nbsp;==&nbsp;&quot;opacity&quot;){\r\n						obj.style.opacity&nbsp;=&nbsp;(cur+speed)/100;\r\n						obj.style.filter&nbsp;=&nbsp;&quot;alpha(opacity:&quot;+(cur+speed)+&quot;)&quot;;\r\n					}else{\r\n						obj.style[attr]&nbsp;=&nbsp;cur&nbsp;+&nbsp;speed&nbsp;+&nbsp;&quot;px&quot;;\r\n					}\r\n				}\r\n			}\r\n		});\r\n	}\r\n	\r\n	//获取元素属性大小\r\n	function&nbsp;getStyle(obj,&nbsp;attr){\r\n		if(obj.currentStyle){\r\n			return&nbsp;obj.currentStyle[attr];\r\n		}else{\r\n			return&nbsp;getComputedStyle(obj,false)[attr];\r\n		}\r\n	}\r\n	\r\n	var&nbsp;oDiv&nbsp;=&nbsp;document.getElementById(&quot;j&quot;);\r\n	oDiv.onmouseover&nbsp;=&nbsp;function(){//添加鼠标移入事件\r\n		startMove(this,{width:30,height:400,opacity:80},function(){\r\n			alert(&quot;运动结束了，我出来了^_^&quot;);\r\n		});\r\n	}\r\n}\r\n&lt;/script&gt;</pre><h3>demo</h3><p>看例子猛戳我：<a href=\"/demo.php/Move/perfect\" target=\"_blank\">js完美运动框架demo</a></p>','js运动','js运动基础（七）','这一节我们进一步完善我们的运动框架，也就是startMove函数。','js',0,273,1),(44,1480688650,1480688720,1480688650,'<p>								</p><p><img src=\"/ueditor/php/upload/image/20161202/1480688711285550.png\" title=\"1480688711285550.png\" alt=\"blob.png\"/></p><p>							</p>','亲情','给宝贝画了一幅画','我跟她妈妈分别给她画了一幅画像。画工简直惨不忍睹，记下来做个纪念。','说说',2,307,1),(45,1480844902,1481363551,1480844902,'<p>								</p><h3>题记<br/></h3><p>拖拽也是js的应用中比较有趣的一个部分。</p><h3>原理</h3><p>鼠标移动时，让元素跟随鼠标进行“改变坐标”的操作。</p><h3>代码</h3><pre class=\"brush:js;toolbar:false\">&lt;script&gt;\r\n	window.onload&nbsp;=&nbsp;function(){\r\n		var&nbsp;oDiv&nbsp;=&nbsp;document.getElementById(&quot;div1&quot;);\r\n		oDiv.onmousedown&nbsp;=&nbsp;function(){\r\n			var&nbsp;pos&nbsp;=&nbsp;getPos();\r\n			console.log(pos);\r\n			var&nbsp;diffX&nbsp;=&nbsp;pos.x&nbsp;-&nbsp;this.offsetLeft;&nbsp;&nbsp;&nbsp;&nbsp;//求出鼠标点距离元素的边距\r\n			var&nbsp;diffY&nbsp;=&nbsp;pos.y&nbsp;-&nbsp;this.offsetTop;\r\n			console.log(diffX+&quot;,&quot;+diffY);\r\n			document.onmousemove&nbsp;=&nbsp;function(){\r\n				var&nbsp;pos&nbsp;=&nbsp;getPos();\r\n				oDiv.style.left&nbsp;=&nbsp;pos.x&nbsp;-&nbsp;diffX&nbsp;+&nbsp;&quot;px&quot;;\r\n				oDiv.style.top&nbsp;&nbsp;=&nbsp;pos.y&nbsp;-&nbsp;diffY&nbsp;+&nbsp;&quot;px&quot;;\r\n			}\r\n			\r\n			document.onmouseup&nbsp;=&nbsp;function(){\r\n				//oDiv.onmousedown&nbsp;=&nbsp;null;\r\n				document.onmousemove&nbsp;=&nbsp;null;\r\n				document.onmouseup&nbsp;=&nbsp;null;\r\n			}\r\n		}\r\n	}\r\n	\r\n	//获取鼠标在屏幕中的位置\r\n	function&nbsp;getPos(){\r\n		var&nbsp;oTop&nbsp;&nbsp;=&nbsp;document.documentElement.scrollTop&nbsp;||&nbsp;document.body.scrollTop;\r\n		var&nbsp;oLeft&nbsp;=&nbsp;document.documentElement.scrollLeft&nbsp;||&nbsp;document.body.scrollLeft;\r\n		var&nbsp;e&nbsp;=&nbsp;arguments.callee.caller.arguments[0]&nbsp;||&nbsp;event;\r\n		var&nbsp;y&nbsp;=&nbsp;oTop&nbsp;+&nbsp;e.clientY;\r\n		var&nbsp;x&nbsp;=&nbsp;oLeft&nbsp;+&nbsp;e.clientX;\r\n		return&nbsp;{x:x,y:y};\r\n	}\r\n&lt;/script&gt;</pre><h3>demo</h3><p>猛戳我，看效果：<a href=\"/demo.php/Event/dragbasic\" target=\"_blank\">js拖拽基础demo</a></p><p>							</p>','js事件','js事件应用基础之拖拽（一）','拖拽的核心原理是鼠标跟随。','js',0,196,1),(47,1480904680,1481079125,1480904680,'<p>								</p><h3>题记<br/></h3><p>上一节中说的拖拽在ie7下有个bug。就是在拖拽的过程中会选中文字。这一节展示的是一个兼容的版本。</p><p><br/></p><p>使用的是setCapture和releaseCapture这对东西。这对东西的作用是事件捕获,释放事件捕获。通俗点来说，就是一旦某个元素开始调用捕获方法（setCapture），页面中所有的事件都会跑到这个元素上来。所以相应的，当我们使用完毕这个属性后要用releaseCapture（释放捕获）</p><h3>demo</h3><p>最好的说明就是看demo:<a href=\"/demo.php/Event/perfectdrag\" target=\"_blank\">猛戳这里</a></p><p><br/></p><h3>补充（重要）</h3><p>在调试的过程中发现一个问题。就是在ff和chrome下window.event都是undefined，传入参数获取event对象的方法不是在所有函数里都通用，而是必须在事件处理的匿名函数中才可以。有兴趣的可以运行一下这个小代码：</p><pre class=\"brush:html;toolbar:false\">&lt;!doctype&nbsp;html&gt;\r\n&lt;html&gt;\r\n	&lt;input&nbsp;type=&quot;button&quot;&nbsp;value=&quot;click&quot;&nbsp;id=&quot;btn1&quot;&nbsp;/&gt;\r\n	&lt;script&gt;\r\n		console.log(window.event);	\r\n		var&nbsp;oBtn&nbsp;=&nbsp;document.getElementById(&quot;btn1&quot;);\r\n		oBtn.onclick&nbsp;=&nbsp;function(e){\r\n			console.log(e);\r\n		}\r\n		\r\n		function&nbsp;noEvent(e){\r\n			console.log(&quot;---&quot;+e);\r\n		}\r\n		noEvent();\r\n	&lt;/script&gt;\r\n&lt;/html&gt;</pre><p>运行的结果如图所示（火狐和chrome下面的显示结果一样）：</p><p><img src=\"http://ruanwenwu.cn/Public/plugin/ueditor/themes/default/images/spacer.gif\"/></p><p><img src=\"/ueditor/php/upload/image/20161207/1481078314150715.png\" title=\"1481078314150715.png\" alt=\"8BRIZ8IW[})6J{`~[(AJIKO.png\"/></p><p>最后，我是通过这样的方法解决的：</p><pre class=\"brush:html;toolbar:false\">function&nbsp;getPos(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;sTop&nbsp;&nbsp;=&nbsp;document.documentElement.scrollTop&nbsp;||&nbsp;document.body.scrollTop;\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;sLeft&nbsp;=&nbsp;document.documentElement.scrollLeft&nbsp;||&nbsp;document.body.scrollLeft;\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;e=arguments.callee.caller.arguments[0]&nbsp;||&nbsp;window.event;&nbsp;//关键在这里\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{x&nbsp;:&nbsp;sLeft&nbsp;+&nbsp;e.clientX,&nbsp;y&nbsp;:&nbsp;sTop&nbsp;+&nbsp;e.clientY};\r\n}</pre><p>原理就是通过arguments.callee.caller.arguments[0]解决的。这句代码的意思是获得arguments的callee，也就是getPos。然后获得getPos的caller，也就是事件匿名函数了。而匿名函数的第一个参数就是event对象。这样问题就解决了。<span style=\"color: rgb(255, 0, 0);\">至于后面为什么还要加上window.event这个东西，是因为ie7下不支持arguments。</span></p>','js事件','js事件应用基础之拖拽（二）','上一节中说的拖拽在ie7下有个bug。就是在拖拽的过程中会选中文字。这一节展示的是一个兼容的版本。','js',0,492,1),(48,1481460540,1481460540,1481460540,'<h3>1.题记</h3><p>下拉刷新的核心原理很简单。主要可以分解成3个部分。1.开始拉动。2.拉动。3.拉动结束。</p><h3>2.原理</h3><p>2.1.开始拉动</p><p>记录触摸点Y轴坐标。使用的是touchstart事件。</p><p>2.2.拉动</p><p>使用touchmove事件，每次事件触发时记录触摸点Y坐标。根据拉动的方向与距离判断在拉动过程中“提示部分”的状态变化。</p><p>2.3.拉动结束</p><p>使用touchend事件，判断最终运动的位置，判断是否需要刷新页面。</p><h3>3.demo</h3><p>猛戳这里：<a href=\"/demo.php/event/pullrefresh\" target=\"_blank\">js下拉刷新实例</a></p><h3>4.说明</h3><p>这个例子还远弹不上完美，需要使用的盆友，请斟酌再使用。</p><p><br/></p>','css3','原生js下拉刷新','下拉刷新的核心原理很简单。主要可以分解成3个部分。1.开始拉动。2.拉动。3.拉动结束。','js',0,184,1),(49,1481461619,1481461653,1481461619,'<p>								</p><h3>什么是设计模式</h3><p>什么是设计模式？如果把某种变成语言比作一本武功秘籍，那么设计模式就是具体的一招一式。所以，想成为武林高手的你，不妨跟我来一起探索一下设计模式的奥秘吧。</p><p><br/></p><p>							</p>','php设计模式','php设计模式（一）','什么是设计模式？如果把某种编程语言比作一本武功秘籍，那么设计模式就是具体的一招一式。所以，想成为武林高手的你，不妨跟我来一起探索一下设计模式的奥秘吧。','php',0,182,1),(50,1481502944,1481506594,1481502944,'<p>								</p><h3>题记</h3><p>这一节我们讲php的spl标准库。</p><h3>栈结构</h3><p>splStack代码示例：</p><pre class=\"brush:php;toolbar:false\">&nbsp;&nbsp;&nbsp;&nbsp;//栈结构，后进先出，就像步枪压子弹。\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;splstack(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stack&nbsp;=&nbsp;new&nbsp;\\SplStack();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stack-&gt;push(3);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stack-&gt;push(&quot;jack&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_dump($stack-&gt;pop());\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;&lt;br/&gt;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($stack&nbsp;as&nbsp;$k&nbsp;=&gt;&nbsp;$v){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;$k.&#39;-&#39;.$v.&#39;&lt;br/&gt;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p>运行结果:<a href=\"/demo.php/spl/splstack\" target=\"_blank\">猛戳这里</a><br/></p><p><img src=\"/ueditor/php/upload/image/20161212/1481501436981213.png\" title=\"1481501436981213.png\" alt=\"blob.png\"/></p><h3>队列</h3><pre class=\"brush:php;toolbar:false\">&nbsp;&nbsp;&nbsp;&nbsp;//队列，像排队一样，先进先出\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;splqueue(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$queue&nbsp;=&nbsp;new&nbsp;\\SplQueue();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$queue&nbsp;-&gt;&nbsp;enqueue(3);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$queue&nbsp;-&gt;&nbsp;enqueue(&quot;jack&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$queue&nbsp;-&gt;&nbsp;enqueue(&quot;lucy&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$queue&nbsp;-&gt;&nbsp;shift();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($queue&nbsp;as&nbsp;$k&nbsp;=&gt;&nbsp;$v){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;$k.&#39;-&#39;.$v.&#39;&lt;br/&gt;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p>运行结果：<a href=\"/demo.php/spl/splqueue\" target=\"_blank\">猛戳这里</a></p><p><img src=\"/ueditor/php/upload/image/20161212/1481501985474659.png\" title=\"1481501985474659.png\" alt=\"blob.png\"/></p><h3>堆和固定尺寸数组</h3><p>SplMinHeap</p><p>固定尺寸数组</p><p>SplFixedArray(n)</p><h3>后记<br/></h3><p>数据结构的内容很多，后面我们专门来讲。<br/></p><p>							</p>','php设计模式','php设计模式（二）','这一节我们讲php的spl标准库。','php',0,183,1),(51,1481509457,1481509565,1481509457,'<p>								</p><p><img src=\"/ueditor/php/upload/image/20161212/1481509437209386.png\" title=\"1481509437209386.png\" alt=\"C~B83V@0]50S`WDX5D{{YQ1.png\"/></p><p>							</p>','温暖','秀一把恩爱，添加点动力','前方高能，\"单身汪\"请做好心理准备^_^。','说说',0,266,1),(52,1481592171,1481595960,1481592171,'<p>								</p><p>三毛的字字句句里都闪耀着人性的光辉。因为三毛，再一次，我觉得到了文字的美好。<br/></p><p><br/></p><p><br/></p><p>							</p>','温暖','有一种感动叫做三毛','三毛的字字句句里都闪耀着人性的光辉。因为三毛，再一次，我觉得到了文字的美好。','说说',0,185,1),(53,1481625157,1481625157,1481625157,'<p>题记</p><p>计划任务多到一定程度，如果我们不对crontab做规划，那么我们的crontab将会老长老长。于是出现了这种布置：</p><p><img src=\"/ueditor/php/upload/image/20161213/1481624702218904.png\" title=\"1481624702218904.png\" alt=\"blob.png\"/></p><p>可以发现，这样一定程度上缓解了一些crontab的臃肿。一个文件，比如auto_run_1hour.php里可以运行4个计划任务了。这样做，把需要每小时执行一次的文件归纳到了一起，但是这样做有个致命的问题，当这4个中任何一个脚本终止，会导致整个下面的代码停止执行。为了解决这个问题，我们尊敬的徐闯先生想出了这样一个办法：</p><p><img src=\"/ueditor/php/upload/image/20161213/1481624988566114.png\" title=\"1481624988566114.png\" alt=\"blob.png\"/></p><p>仍然是把每小时执行一次的脚本放到一起，只是这个auto_run_1day.php发生了改变，不是简单的include需要自动运行的php脚本，而是遍历需要跑的文件，将他们丢到系统后台去跑，而且还做了进程监控，避免重复的运行开销以及错误。是在是太棒了。</p>','小技巧','更灵活的计划任务布置','感谢我的领导徐闯先生发明了这么好的方法。我在此进行记录，希望帮到更多的人。','php',0,202,1),(54,1481642441,1481642566,1481642441,'<p>								</p><p>三毛，我亲爱的女儿：　</p><p>　　自你决定去撒哈拉大漠后，我们的心就没有一天安静过，怕你吃苦，怕你寂寞，更担心你难以适应沙漠的日常生活。但每次接你来信好像都在天堂，心情愉快，对生活充满信心。物质上的缺乏，气候的骤变，并没有影响你的情绪。我想可能是沙漠美丽的景色深深地迷惑了你，夕阳中的蜃楼，一望无垠的黄沙，一向是你所神住。一旦投入其中，谁能体会？谁能领略？<br/><br/>　　所以，这次你去撒哈拉，我和你父亲都没有阻止。明知道这是何等崎岖艰苦的道路，但是为了你的志趣和新生活的尝试，我们忍住了眼泪，答应下来。孩子，你可知道父母的心里是如何的矛盾，如何的心酸！这一时期，我差不多常常跑邮局，恨不得把你喜爱的食物或点缀布置的小玩意儿，统统寄上，借着那些小小的礼物，也寄上我们无限的爱和想念。有一天，你告诉我们，已拥有了梦中的白马王子，我们万分喜悦接纳了我们淳厚的半子——荷西。你孤单的生活将告一段落，从此有人陪伴你，携手共度人生漫漫的岁月。重重的叮咛，深深的祝福，难表父母的心声。我的女儿，愿你幸福快乐，直到永永远远。<br/><br/>　　在你完全适应荒凉单调的沙漠婚姻生活后，你很想动动久已搁起的笔杆，希望哪一位副刊的主编先生能慧眼识英雄（小猫也），提拔一下，让你乐一乐，以后才有信心再写。我每晚都祈祷求神拭一拭那位主编的眼睛，能使他看中我们三毛的文章，真的，那天早晨在联副上看到你第一篇文章《中国饭店》（《沙漠中的饭店》），我把家中所有的人都叫起来，争阅你的故事，大家都非常高兴。家中没有香槟，只好买豆浆代替庆祝，心中十分感激那位主编先生。（后来才知道是平鑫涛先生，大概是受了上帝的催眠。）从此你打开了写作之门，一篇比一篇精彩，一篇比一篇生动。你把我们每一个读者都引进了你的生活，你的故事好像就发生在我们的身边左右，有笑也有泪。自读完了你的《白手成家》后，我泪流满面，心如绞痛，孩子，你从来都没有告诉父母，你所受的苦难和物质上的缺乏，体力上的透支，影响你的健康，你时时都在病中。你把这个僻远荒凉、简陋的小屋，布置成你们的王国（都是废物利用），我十分相信，你确有此能耐。那时，许多爱护你的前辈，关怀你的友好，最可爱的是一些年轻的热爱你的读者朋友们，电话、信件纷纷而来，使人十分感动。在《白手成家》刊出后，进入最高潮，任何地方都能听到谈论三毛何许人也，我们以你为荣，也分享了你的快乐，这是你给父母一生中最大的安慰。（是你牺牲多少夜晚及日常生活中的辛酸换取的代价。虽然你在写作上刚刚起步，但在给我们父母的感受上却是永恒。）<br/><br/>　　我的女儿，在逝去的岁月中，虽然有太多的坎坷，但我们已用尽爱的金线，一针一针经纬地织补起来，希望父母的巧手神工能织得像当初上帝赐给你的一样，天衣无缝，重度你快乐健康的人生。孩子，请接受父母的祝福和祈祷，愿主赐恩。<br/><br/>　　你车祸的消息，一直等你出院后，你姐姐才告诉我们（瞒得好紧）。当时我脑中一片茫然，整个世界仿佛都在旋转，泪含满眶，默默无语，心碎片片，千水万山，无法亲临照顾。孩子，你怕我们伤心难受，教姐姐慢慢再讲，这是你的孝心，但你可想到，我们知道了一样地神伤，担忧焦急，一直到收到你的录音带与照片后，仍未能释然。看到你消瘦无力的样子，更耿耿于怀；每次午夜梦回，你可曾听到母亲依依的呼唤？天涯海角，不论离我们多么遥远，我们的心灵总是彼此相通。尤其是你父亲，是你一生中最大的凭依。前一阵他患眼疾，视力衰退，你每信都殷殷问候，思亲之情，隐于字间，读后常使我们泫然泪下，思念更深。最近虽然你没有提及任何不妥，但在家信中常感觉到你又在病中。<br/><br/>　　撒哈拉的一段生活，使你亏损太多，等荷西找到了新的工作，安顿好家，快快地回来吧，让我们好好地看看久别的女儿，是否依旧神采飘逸。<br/><br/>　　夜已很深，春天的夜晚仍有寒意，请为父母多披上一件外衣，珍重复珍重。千言万言，难诉尽母亲的心语。我的女儿，愿你快乐健康！顺祝平安！<br/><br/>　　母示<br/><br/>　　一九七六年四月一日午夜</p><p><br/></p><p>							</p>','撒哈拉沙漠的故事','妈妈的一封信','静静地听三毛说就好。','转载',0,181,1),(55,1481642879,1481642879,1481642879,'<p>各位朋友：<br/><br/>　　回到台北已经二十多天，在这短短的时间里，我收到无数过去与我通信的读者、我教过的学生、以及许许多多新朋友的来信与电话，我也在台北街头看见自己的新书挤在一大堆花花绿绿的书刊里向我扮着顽皮的鬼脸。<br/><br/>　　每当我收到由各方面转来的你们的来信时，我在这一封封诚意的信里，才看出了我自己的形象，才知道三毛有这么多不相识的朋友在鼓励着她。<br/><br/>　　我多么希望每一封信都细细的回答你们，因为我知道，每一个写信给我的人，在提笔时，也费了番心思和时间来表示对我的关怀。<br/><br/>　　我怎么能够看见你们诚意的来信，知道你们一定在等着我的回音，而那一封封的信都如石沉大海，没有回声。<br/><br/>　　请无数写信给我的朋友了解我，三毛不是一个没有感情也没有礼貌的人。<br/><br/>　　离开家国那么久了，台北的亲情友情，整整的占据了我，我尽力愿意把我自己的时间，分给每一个关怀我的朋友，可惜的是，我一天也只能捉住二十四小时。<br/><br/>　　生活突然的忙碌热闹，使我精神上兴奋而紧张，体力上透支再透支，而内心的宁静却已因为这些感人的真情流露起了很大的波澜。<br/><br/>　　虽然我努力在告诉自己，我要完完全全享受我在祖国的假期，游山玩水，与父母亲闲话家常。事实上，我每日的生活，已成了时间的奴隶，我日日夜夜的追赶着它，而仿佛永远不能在这件事上得到释放。<br/><br/>　　过去长久的沙漠生活，已使我成了一个极度享受孤独的悠闲乡下人，而今赶场似的吃饭和约会，对我来说，就如同刘姥姥进了大观园，昏头转向，意乱情迷。<br/><br/>　　每日对着山珍海味，食不下咽，一个吃惯了白薯饼的三毛，对着亲友感情的无数大菜，感动之余，恨不能拿一个大盒子装回北非去，也好在下半年不再开伙。我多么遗憾这些美味的东西要我在短短的时间里全部吃下去啊！<br/><br/>　　在这种走马灯的日子里，我一方面极感动朋友对我的爱护；另一方面，我却不能一一答应来信及电话中要求与我单独见面的朋友的盛意。<br/><br/>　　我恨不能将我的时间，分成每一个如稿纸似的小格子，像写稿一样，在每一格里填上一个朋友的名字、时间、和见面的地点。在我，写两三千字是易，而要分别见到那么多朋友，却是力不从心的憾事啊！<br/><br/>　　我真愿意爱护我的朋友，了解我现在的情况，请不要认为我们不能见面就是一件可惜的事，因为文学的本身，对每一个读者，在看的时候，已经成了每一个人再创造出来的东西，实体的三毛，不过是一个如她一再强调的小人物，看了她你们不但要失望，连她自己看了她的故事，再去照顾镜子，一样也感到不真实。<br/><br/>　　因此我很愿意对我的朋友们说，我的文章刊出来时，我们就是在默默的交谈了。<br/><br/>　　在台北亲友聚会里，常常会遇到许多我过去不认识的人，他们对我刚出的书——《撒哈拉的故事》里的每一篇，每一个细节，每一件小事，甚而每一句话，都好似背通过了似的熟悉。<br/><br/>　　这种情形，令一个远方归来的游子惊讶、木讷，再而更觉得惭愧而不知所措。<br/><br/>　　我所能说的，也许只是一句普通的谢谢，但是这份关怀，却成了我日后努力写作下去的力量。<br/><br/>　　我一向没有耐性，尤其讨厌把自己钉在书桌前爬格子，但是当我回国的第一天，我听到居然有许多学校的同学，整班整班的在预约我的新书时，我的心一样受到了感动。许多人对我谈起《撒哈拉的故事》，更令我惊讶的是，我过去只期待着大人看我的书，没想到，竟也有小学生，托了我的侄儿和外甥们，要请他们带着，来拜望这个沙漠里的姑姑。<br/><br/>　　我多么为这一个发现而骄傲欢喜，我真愿意我也做一个小朋友的三毛，因为《圣经》上一再的说——“你们要像小孩子，才能进天国，因为天堂是他们的。”<br/><br/>　　亲爱的小读者，我是多么的看重你们，但愿三毛的书，能够在沉重的课业之外，带给你们片刻轻松的时光。<br/><br/>　　如果朋友们还没有厌倦了这个如我一样的小人物三毛，我愿意不断的做一个说故事的人。我不会讲什么大道理，因为我没有学问，但是，我愿意在将来的日子里，仍做不断的努力，以我的手，写我的口，以我的口，表达我的心声。<br/><br/>　　也许有时候我会沉寂一阵，不再出稿，请不要以为我是懒散了，更不要以为三毛已经鸿飞无痕，不计东西。如果我突然停顿了，那只表示我在培养自己、沉淀自己；在告诉自己：写，是重要，而有时搁笔不写，却是更重要。<br/><br/>　　目前我仍有写作的兴趣和材料，我因此仍要继续我过去已经开始了的长跑，但愿在不久的将来，当三毛一本一本的新书出版时，使爱护我的读者看见我默默的努力。<br/><br/>　　我的书在短短的一个半月之内，已经出了第四版了，我要感谢读者对我的支持和鼓励。在我，写作的本身，并不是为了第三者，更不是为了成名。但是，因为读者热烈的反应，使我一个平凡而简单的家庭主妇，认知了今后要再努力去奔跑的路，这是我一生里要感谢你们的啊！<br/><br/>　　下个月，我为了对家庭及对丈夫的责任，不得不再度告别我的家，我的国，回到千山万水外的北非去。我是多么的不舍，也多么的不安，不能给每一个爱护我的朋友充足的时间，来聚一聚，谈一谈。<br/><br/>　　我的朋友，我们原来并不相识，而今也不会相逢，但是人生相识何必相逢，而相逢又何必相识。<br/><br/>　　在台北，我不觉得离你们近，在非洲我也不觉得离你们远，只要彼此相知欣赏，天涯真是如比邻啊！<br/><br/>　　我再谢谢你们的关爱，请不要忘记，三毛虽然是个小人物，却有一颗宽阔的心，在她的心里，安得下世界上每一个她所爱的人。<br/><br/>　　给我生命，养我长大，不变的爱护着我的双亲，他们给了我一个永远欢迎我的家，在这个避风港里，我完全的释放自己，尽情的享受我在外得不着的温暖和情爱。<br/><br/>　　感谢上帝，给了我永恒的信仰，她迎我平安的归来，又要带着我一路飞到北非我丈夫的身边去。我何其有幸，在亲情、友情和爱情上，一样都不缺乏。<br/><br/>　　我虽然常握着我生命小船的舵，但是在黑暗里，替我挂上了那颗在静静闪烁的指路星，却是我的神。他叫我去哪里，我就去哪里，在我心的深处，没有惧怕，没有悲哀，有的只是一丝别离的怅然。<br/><br/>　　因为上帝恒久不变的大爱，我就能学习着去爱每一个人，每一个世上的一草一木一沙。<br/><br/>　　谢谢你们，没有见过面的朋友。但愿人长久，千里共婵娟。<br/><br/>　　祝<br/><br/>　　平安喜乐<br/><br/>　　三毛上</p>','撒哈拉沙漠的故事','回乡小笺','静静地听三毛说就好了。','转载',0,903,1),(56,1482809305,1482816790,1482809305,'<p>								</p><h3>题记：<br/></h3><p>一般我自己生成XML文件习惯使用字符串拼接的方式。其实php中的DOMDocument已经帮我们准备好了生成一个标准的XML文件的一切方法。</p><pre>&lt;?php\r\n\r\n//&nbsp;Set&nbsp;the&nbsp;content&nbsp;type&nbsp;to&nbsp;be&nbsp;XML,&nbsp;so&nbsp;that&nbsp;the&nbsp;browser&nbsp;will&nbsp;&nbsp;&nbsp;recognise&nbsp;it&nbsp;as&nbsp;XML.\r\nheader(&nbsp;&quot;content-type:&nbsp;application/xml;&nbsp;charset=utf-8&quot;&nbsp;);\r\n\r\n//&nbsp;实例化DOMDocument.\r\n$xml&nbsp;=&nbsp;new&nbsp;DOMDocument(&nbsp;&quot;1.0&quot;,&nbsp;&quot;utf-8&quot;&nbsp;);\r\n\r\n//&nbsp;创建Album元素和其子元素Track.\r\n$xml_album&nbsp;=&nbsp;$xml-&gt;createElement(&nbsp;&quot;Album&quot;&nbsp;);\r\n$xml_track&nbsp;=&nbsp;$xml-&gt;createElement(&nbsp;&quot;Track&quot;,&nbsp;&quot;The&nbsp;ninth&nbsp;symphony&quot;&nbsp;);\r\n\r\n//&nbsp;为元素设置属性\r\n$xml_track-&gt;setAttribute(&nbsp;&quot;length&quot;,&nbsp;&quot;0:01:15&quot;&nbsp;);\r\n$xml_track-&gt;setAttribute(&nbsp;&quot;bitrate&quot;,&nbsp;&quot;64kb/s&quot;&nbsp;);\r\n$xml_track-&gt;setAttribute(&nbsp;&quot;channels&quot;,&nbsp;&quot;2&quot;&nbsp;);\r\n\r\n//&nbsp;创建Note子元素\r\n$xml_note&nbsp;=&nbsp;$xml-&gt;createElement(&nbsp;&quot;Note&quot;,&nbsp;&quot;The&nbsp;last&nbsp;symphony&nbsp;composed&nbsp;by&nbsp;Ludwig&nbsp;van&nbsp;Beethoven.&quot;&nbsp;);\r\n\r\n//&nbsp;将各子元素添加到父元素内\r\n$xml_track-&gt;appendChild(&nbsp;$xml_note&nbsp;);\r\n$xml_album-&gt;appendChild(&nbsp;$xml_track&nbsp;);\r\n\r\n//&nbsp;重复..\r\n$xml_track&nbsp;=&nbsp;$xml-&gt;createElement(&nbsp;&quot;Track&quot;,&nbsp;&quot;Highway&nbsp;Blues&quot;&nbsp;);\r\n\r\n$xml_track-&gt;setAttribute(&nbsp;&quot;length&quot;,&nbsp;&quot;0:01:33&quot;&nbsp;);\r\n$xml_track-&gt;setAttribute(&nbsp;&quot;bitrate&quot;,&nbsp;&quot;64kb/s&quot;&nbsp;);\r\n$xml_track-&gt;setAttribute(&nbsp;&quot;channels&quot;,&nbsp;&quot;2&quot;&nbsp;);\r\n$xml_album-&gt;appendChild(&nbsp;$xml_track&nbsp;);\r\n\r\n$xml-&gt;appendChild(&nbsp;$xml_album&nbsp;);\r\n\r\n//&nbsp;输出XML.\r\nprint&nbsp;$xml-&gt;saveXML();//如果要保存xml文件，只需要把saveXML()方法换成save(path)方法就可以。save方法里放文件存储路径。\r\n\r\n/*输出内容:\r\n&lt;Album&gt;\r\n&nbsp;&nbsp;&lt;Track&nbsp;length=&quot;0:01:15&quot;&nbsp;bitrate=&quot;64kb/s&quot;&nbsp;channels=&quot;2&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;ninth&nbsp;symphony\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;Note&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;last&nbsp;symphony&nbsp;composed&nbsp;by&nbsp;Ludwig&nbsp;van&nbsp;Beethoven.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Note&gt;\r\n&nbsp;&nbsp;&lt;/Track&gt;\r\n&nbsp;&nbsp;&lt;Track&nbsp;length=&quot;0:01:33&quot;&nbsp;bitrate=&quot;64kb/s&quot;&nbsp;channels=&quot;2&quot;&gt;Highway&nbsp;Blues&lt;/Track&gt;\r\n&lt;/Album&gt;*/</pre><p>官方对DOMDocument的解释是：Represents an entire HTML or XML document; serves as the root of the document tree.意思就是说它代表整个HTML或者XML文件，作为文档数的根来使用。简而言之，就是操作整个文档的用它就对了。比如文档的输出，保存，添加节点等都可以用到这个实例。</p><p>上面这个例子的解释：新建一个XML文档，根元素是&lt;Album&gt;，根里面放了两首“单曲”，每首单曲有各自的属性。</p><p>这样看来用DOMDocument来创建一个xml文件还是比较方便的。</p><h3>获取DOM元素常用的方法：</h3><p>public&nbsp;<a href=\"http://php.net/manual/en/class.domnodelist.php\">DOMNodeList</a>&nbsp;DOMElement::getElementsByTagName&nbsp;(&nbsp;string&nbsp;$name&nbsp;)</p><p>This function returns a new instance of the class&nbsp;<a href=\"http://php.net/manual/en/class.domnodelist.php\">DOMNodeList</a>&nbsp;of all descendant elements with a given tag&nbsp;name, in the order in which they are encountered in a preorder traversal of this element tree.</p><p>可以观察到，返回值是一个DOMNodeList的实例。方法所属的实例是DOMElement。这个方法传入一个元素标签名，返回DOMNodeList集合。</p><p>以我们在题记中生成这个xml文件为例（啰嗦一句：保存xml文件使用的是save()方法。我在题记中的代码注释里标注出来了。我用这个方法将文件保存为album.xml了，方便在下面演示）：</p><p><img src=\"/ueditor/php/upload/image/20161227/1482810167344877.png\" title=\"1482810167344877.png\" alt=\"blob.png\"/></p><p>现在我们获取Track元素：</p><pre>&lt;?php\r\n$xml&nbsp;=&nbsp;new&nbsp;DOMDocument();\r\n$xml-&gt;load(&quot;album.xml&quot;);\r\n$tracks&nbsp;=&nbsp;$xml-&gt;getElementsByTagName(&quot;Track&quot;);\r\nforeach($tracks&nbsp;as&nbsp;$track){\r\n	echo&nbsp;$track-&gt;nodeValue.&#39;&lt;br/&gt;&#39;;\r\n}</pre><p>输出结果：<br/></p><p><img src=\"/ueditor/php/upload/image/20161227/1482810596115910.png\" title=\"1482810596115910.png\" alt=\"blob.png\"/></p><p>结果说明，我们成功获取到了这两个Track标签。在上面的代码中，我们还使用了一个load方法。load方法的作用就是从文件中读取xml数据。</p><p><br/></p><p>public&nbsp;<a href=\"http://php.net/manual/en/class.domelement.php\">DOMElement</a>&nbsp;DOMDocument::getElementById&nbsp;(&nbsp;string&nbsp;$elementId&nbsp;)</p><p>这个方法通过元素的id去获取元素，但是有一点要注意：需要有xml前缀才能获取到。</p><pre>&lt;child&nbsp;xml:id=&quot;id_xxxxxx&quot;&nbsp;status=&quot;partial&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;sub_child&gt;Some&nbsp;Data&lt;/sub_child&gt;\r\n&lt;/child&gt;</pre><h3>其他：</h3><p>还有很多的类和方法，具体用到再去看吧。</p><p>http://php.net/manual/en/domdocument.getelementbyid.php</p><p><br/></p><p>							</p>','DOMDocument','使用dom的方式处理xml文件','使用DOM的方式处理xml的优势是：灵活，高效。在需要对xml文件进行修改（新增或者修改）时，用起来特别方便。','php',0,174,1),(57,1482818817,1482818817,1482818817,'<p>原理：</p><p>在分页类中生成url时携带onclick事件触发js函数，js函数中传递当前请求页码。在js函数中ajax请求数据，php接口中返回对应的数据<span style=\"color: rgb(255, 0, 0);\">连同分页信息。<span style=\"color: rgb(0, 0, 0);\">这样就实现了ajax分页。</span></span></p>','分页','ajax分页的简单实现','有很多关于ajax分页的开源项目。这项项目大多是“大而全”的东西，自定义起来也不方便。这篇文章介绍一种简单的方式来实现ajax分页。','php',0,167,1),(58,1482822028,1482822101,1482822028,'<p>								</p><p>题记：</p><p>一起来走一遍OOP吧。</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>什么是面向对象编程。</p><p>使用类和对象编程；每个对象负责一件事；对象之间能互相通信，传输数据，并构成系统；符合人们对客观世界的普遍认识；oop编程的三大特性：重用性，灵活性，可扩展性。</p></li></ol><p>							</p>','oop','面向对象基础梳理','只有以面向对象的思想编程，才能写出高质量的应用。','php',0,247,1),(59,1485152715,1485152715,1485152715,'','','相信是一些美好的事情正在发生','','',0,326,1),(60,1486435526,1486435526,1486435526,'<pre class=\"brush:html;toolbar:false\">&lt;?php\r\n$excel&nbsp;=&nbsp;&quot;&lt;html&gt;\r\n			&lt;head&gt;\r\n				&lt;meta&nbsp;charset=&#39;utf-8&#39;&nbsp;/&gt;\r\n				&lt;style&gt;\r\n					table{font-size:12px;font-weight:normal;}\r\n				&lt;/style&gt;\r\n			&lt;/head&gt;\r\n			&lt;body&gt;\r\n				&lt;table&gt;\r\n					&lt;thead&gt;\r\n						&lt;tr&gt;\r\n							&lt;th&gt;职业&lt;/th&gt;\r\n							&lt;th&gt;年龄&lt;/th&gt;\r\n							&lt;th&gt;性别&lt;/th&gt;\r\n						&lt;/tr&gt;\r\n					&lt;/thead&gt;\r\n					&lt;tbody&gt;\r\n						&lt;tr&gt;\r\n							&lt;td&gt;php工程师&lt;/td&gt;\r\n							&lt;td&gt;20&lt;/td&gt;\r\n							&lt;td&gt;男&lt;/td&gt;\r\n						&lt;/tr&gt;\r\n						&lt;tr&gt;\r\n							&lt;td&gt;php工程师&lt;/td&gt;\r\n							&lt;td&gt;20&lt;/td&gt;\r\n							&lt;td&gt;男&lt;/td&gt;\r\n						&lt;/tr&gt;\r\n						&lt;tr&gt;\r\n							&lt;td&gt;php工程师&lt;/td&gt;\r\n							&lt;td&gt;20&lt;/td&gt;\r\n							&lt;td&gt;男&lt;/td&gt;\r\n						&lt;/tr&gt;\r\n						&lt;tr&gt;\r\n							&lt;td&gt;php工程师&lt;/td&gt;\r\n							&lt;td&gt;20&lt;/td&gt;\r\n							&lt;td&gt;男&lt;/td&gt;\r\n						&lt;/tr&gt;\r\n					&lt;/tbody&gt;\r\n				&lt;/table&gt;&quot;;\r\nheader(&#39;Cache-Control:&nbsp;no-cache,&nbsp;must-revalidate&#39;);\r\nheader(&#39;Content-type:&nbsp;application/vnd.ms-excel;&#39;);\r\nheader(&#39;Content-Disposition:&nbsp;filename=&#39;.&nbsp;date(&quot;Y年m月d日&quot;)&nbsp;.&nbsp;&#39;.xls&#39;);\r\ndie($excel);</pre><p>很简单吧。可以用style便签来设置样式。Content-Disposition可以用来命名。</p>','','一种简单的生成excel的方式','一种简单生成excel的方式。','php',1,329,1),(61,1486517925,1486517966,1486517925,'<p>								</p><h3>权限管理要实现的目标</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>添加管理员</p></li><li><p>分配角色</p></li><li><p>为角色分配权限（控制页面的可见性与可访问性）</p></li></ol><h3>具体实现</h3><h4>设计5个表。</h4><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>admin表，用来添加管理员。</p></li><li><p>role表用管理角色种类，比如管理员，开发者，编辑，seo等等。管理员</p></li><li><p>管理员和角色关系表，用来记录每个管理员有什么角色。</p></li><li><p>角色权限表，用来记录每个角色有哪些权限（也就是那些页面能访问）。</p></li><li><p>最后是权限表，也可叫节点表，一般按照程序总的控制器和方法来分成主节点和分节点，便于在前台操作时的批量勾选。</p></li></ol><h4>菜单显示</h4><p>根据用户角色找对应的节点进行显示即可。</p><h4>可访问性</h4><p>判断用户角色是否具有该节点权限。</p><h4>代码</h4><p>不做赘述。</p><p>							</p>','权限管理','一种写后台权限管理的方式','后台权限管理是大部分应用管理后台都需要的一个功能。本文提供一个简单好用的方式。','php',0,186,1),(62,1486519388,1486565254,1486519388,'<p>								</p><p>1.7:30-8:00 复习了60个单词。读了两节英文版的哈利波特。<br/></p><p>2.8:00-8:30 了解了一下《权利的游戏》的历史背景——中世纪的封建制度，骑士，领主，农民，自由城市，教会，城堡，婚姻。</p><p>3.8:30-9:00 复习了设计模式中的单例模式，广场模式和注册树模式。</p><p>4.9:30-9:40 整理了php后台项目中权限管理的方法。&nbsp;</p><p>5.10:00-10:55 修复项目中两个bug。</p><p>6.11:00-12:00,13:30-18:30 新项目后台。</p><p>7.18:30-19:30 锻炼身体</p><p>8.19:50-21:00 聚餐</p><p>9. 21-22:30 下班坐地铁</p><p>							</p>','工作','2017年2月8日工作日志','并非要记录今天做了哪些工作，只是想看看这一天到底是不是虚度光阴了。','工作',0,835,1),(63,1487226745,1487226745,1487226745,'<p>&lt;?php</p><p>class Algos</p><p>{</p><p>&nbsp; &nbsp; &nbsp;/**</p><p>&nbsp; &nbsp; &nbsp;* 获得用户唯一码 (用户信息+进程信息+时间戳+随机数)</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function getUniqueCode(){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #获得唯一的用户信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $cookieArr = &nbsp;$_COOKIE;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $userId &nbsp; &nbsp;= isset($cookieArr[&quot;zol_userid&quot;]) ? $cookieArr[&quot;zol_userid&quot;]</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: isset($cookieArr[&quot;ip_ck&quot;]) ? $cookieArr[&quot;ip_ck&quot;] : $_SERVER[&#39;REMOTE_ADDR&#39;];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $userIp &nbsp; &nbsp;= $_SERVER[&#39;REMOTE_ADDR&#39;];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #时间信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $time &nbsp; &nbsp; &nbsp;= microtime(true);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #服务器信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $server = $_SERVER[&#39;SERVER_ADDR&#39;];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #进程信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $pid = &#39;&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (function_exists(&#39;getmypid&#39;)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$pid = getmypid();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $rand = rand(0, 1000);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return md5($userId . $userIp .$time. $pid . $server .$rand );</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp;/**</p><p>&nbsp; &nbsp; &nbsp;* URL的签名算法，返回一个token字符串</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function urlSign($paramArr){</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;queryParam&#39; &nbsp;=&gt; &#39;&#39;, &nbsp;#请求参数，可以传入参数数组（一维） 也可以传入name=a&amp;age=12的参数</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; &#39;&#39;, &nbsp;#签名的密钥</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;timeInfo&#39; &nbsp; &nbsp;=&gt; 0, &nbsp; #添加时间信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; if(!$queryParam)return &#39;&#39;;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; if(is_string($queryParam)) parse_str($queryParam,$queryParam);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #对参数数组进行排序，保证参数传入的顺序不同，同样能得到结果</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ksort($queryParam);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $queryString = array();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; foreach ($queryParam as $key =&gt; $val){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($queryString, $key . &#39;=&#39; . $val);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $queryString = join(&#39;&amp;&#39;, $queryString);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if($timeInfo){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $queryString .= &quot;#&quot; .time(); #将时间戳并入</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sign = &nbsp;self::fastEncode(array(&#39;value&#39;=&gt;$queryString,&#39;cryptkey&#39;=&gt;$cryptkey));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }else{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sign = hash_hmac(&quot;sha1&quot;,$queryString,$cryptkey);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return $sign;</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp;/**</p><p>&nbsp; &nbsp; &nbsp;* 获得URL的签名的时间戳</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function getUrlSignTm($paramArr){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;signStr&#39; &nbsp; &nbsp; =&gt; &#39;&#39;, &nbsp;#请求参数，可以传入参数数组（一维） 也可以传入name=a&amp;age=12的参数</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; &#39;&#39;, &nbsp;#签名的密钥</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $sign = &nbsp;self::fastDecode(array(&#39;value&#39;=&gt;$signStr,&#39;cryptkey&#39;=&gt;$cryptkey));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #时间戳部分</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $tm &nbsp; = (int)substr($sign, strpos($sign, &quot;#&quot;)+1);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #签名部分</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $data = substr($sign, 0,strpos($sign, &quot;#&quot;));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if($data)parse_str($data,$data);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;data&#39; =&gt; $data,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;tm&#39; &nbsp; =&gt; $tm,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 3DES 加密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>public static function des3Encrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$td = mcrypt_module_open(MCRYPT_3DES, &#39;&#39;, MCRYPT_MODE_ECB, &#39;&#39;);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_enc_get_iv_size($td), MCRYPT_DEV_URANDOM);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$key = substr($cryptkey, 0, mcrypt_enc_get_key_size($td));</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_init($td, $key, $iv);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$ret = self::base64UrlEncode(mcrypt_generic($td, $value));</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_deinit($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_module_close($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>return $ret;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>}</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 3DES 解密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>public static function des3Dencrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$td = mcrypt_module_open(MCRYPT_3DES, &#39;&#39;, MCRYPT_MODE_ECB, &#39;&#39;);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_enc_get_iv_size($td), MCRYPT_DEV_URANDOM);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$key = substr($cryptkey, 0, mcrypt_enc_get_key_size($td));</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_init($td, $key, $iv);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$ret = trim(mdecrypt_generic($td, self::base64UrlDecode($value))) ;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_deinit($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_module_close($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>return $ret;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>}</p><p>&nbsp; &nbsp;&nbsp;</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 快速的加密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function fastEncode($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; return self::_fastCode($value,&#39;ENCODE&#39;,$cryptkey);</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 快速的解密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function fastDecode($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; return self::_fastCode($value,&#39;DECODE&#39;,$cryptkey);</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; private static function _fastCode($string, $operation = &#39;DECODE&#39;, $key = &#39;&#39;, $expiry = 0) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $auth_key = &#39;%&amp;zol_zwt!Q@W#$6y8i&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $ckey_length = 4;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $key &nbsp;= md5($key ? $key : $auth_key);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $keya = md5(substr($key, 0, 16));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $keyb = md5(substr($key, 16, 16));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $keyc = $ckey_length ? ($operation == &#39;DECODE&#39; ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : &#39;&#39;;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $cryptkey = $keya.md5($keya.$keyc);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $key_length = strlen($cryptkey);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $string = $operation == &#39;DECODE&#39; ? self::base64UrlDecode(substr($string, $ckey_length)) : sprintf(&#39;%010d&#39;, $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $string_length = strlen($string);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $result = &#39;&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $box = range(0, 255);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $rndkey = array();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; for($i = 0; $i &lt;= 255; $i++) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rndkey[$i] = ord($cryptkey[$i % $key_length]);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; for($j = $i = 0; $i &lt; 256; $i++) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $j = ($j + $box[$i] + $rndkey[$i]) % 256;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp = $box[$i];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$i] = $box[$j];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$j] = $tmp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; for($a = $j = $i = 0; $i &lt; $string_length; $i++) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $a = ($a + 1) % 256;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $j = ($j + $box[$a]) % 256;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp = $box[$a];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$a] = $box[$j];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$j] = $tmp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; if($operation == &#39;DECODE&#39;) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() &gt; 0) &amp;&amp; substr($result, 10, 16) == substr(md5(substr($result, 26).$keyb), 0, 16)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return substr($result, 26);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return &#39;&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; } else {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $keyc.str_replace(&#39;=&#39;, &#39;&#39;, self::base64UrlEncode($result));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 简单的加密形式</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function simpleEncrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $mcrypt_cipher_alg &nbsp;= MCRYPT_RIJNDAEL_128;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_get_iv_size($mcrypt_cipher_alg,MCRYPT_MODE_ECB));</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $newString = mcrypt_encrypt($mcrypt_cipher_alg, $cryptkey, $value, MCRYPT_MODE_ECB, $iv);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return bin2hex($newString);</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 简单的解密形式</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function simpleDecrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $mcrypt_cipher_alg &nbsp;= MCRYPT_RIJNDAEL_128;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_get_iv_size($mcrypt_cipher_alg,MCRYPT_MODE_ECB));</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $string &nbsp; &nbsp;= pack(&quot;H*&quot;,$value);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return trim(mcrypt_decrypt($mcrypt_cipher_alg, $cryptkey, $string, MCRYPT_MODE_ECB, $iv));</p><p><br/></p><p>&nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 适合url传输的base64编码</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; private static function base64UrlEncode($value){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return rtrim(strtr(base64_encode($value), &#39;+/&#39;, &#39;-_&#39;), &#39;=&#39;);</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 适合url传输的base64解码</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; private static function base64UrlDecode($value){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return base64_decode(strtr($value, &#39;-_&#39;, &#39;+/&#39;));</p><p>&nbsp; &nbsp; }</p><p><br/></p><p>}</p><p><br/></p>','加密','数据加密和解密','几种常用的，好用的加解密的方法','php',0,689,1),(64,1487396405,1487396405,1487396405,'<p>孝敬长辈，爱护弱小，珍惜爱人，团结同事，做好工作，坚持学习，不放弃理想~</p>','做人','坚持做对的事','孝敬长辈，爱护弱小，珍惜爱人，团结同事，做好工作，坚持学习，不放弃理想','说说',0,181,1),(65,1487417044,1487417044,1487417044,'<pre class=\"brush:java;toolbar:false\">&lt;?php\r\n$a&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;8,1,3,2,6,7,9,5,21,12,30,10\r\n);\r\n$length&nbsp;=&nbsp;count($a);\r\nfor&nbsp;($i&nbsp;=&nbsp;1;&nbsp;$i&nbsp;&lt;&nbsp;$length;&nbsp;$i++)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;($j&nbsp;=&nbsp;$i;&nbsp;$j&nbsp;&gt;&nbsp;0;&nbsp;$j--)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($a[$j]&nbsp;&lt;&nbsp;$a[$j-1])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$temp&nbsp;=&nbsp;$a[$j];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$a[$j]&nbsp;=&nbsp;$a[$j-1];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$a[$j-1]&nbsp;=&nbsp;$temp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}\r\nvar_dump($a);</pre><p>原理：以8为基准，其后的每一个数都要跟前面的数进行一一比对。所以外层循环从1开始，到$elngth - 1减一结束。这样保证每一个数都会进行比较，当然，除了第一个数之外。然后是内层循环。定然是从$i开始，一直比较到第一个数，所以一直到1就结束了。最后进行比较，如果当前这个数比前一个数小，那么就交换他们的位置就好了。</p>','算法','插入排序法','从最简单的这个排序算法开始，体验算法的乐趣。','算法',0,363,1),(66,1487661321,1487661321,1487661321,'<p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">今天搭建了oauth2.0服务端与客户端。把搭建的过程记录一下。具体实现的功能是：client.ruanwenwu.cn的用户能够通过 server.ruanwenwu.cn的用户名和密码登陆client.ruanwenwu.cn。并且登陆 后，client.ruanwenwu.cn的用户能获取server.ruanwenwu.cn哪里的一些资源。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">我的个人博客原文地址：</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">一、oauth2.0的作用</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;1、搭建第三方登录平台（就像你用很多网站支持qq登录。其实是qq提供的oauth2.0服务端支持。网站作为第三方，只要用oauth2.0标准请求服务端，求能得到用户信息，并实现登录）。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;2、公共资源管理。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;就 像你（Y）想通过一个打印照片的网站（A)来打印你存放在google(B)的照片。你就要通过这个A来获取B的照片。B肯定要验证是否是他的用户Y的请 求，验证通过才把照片传递给A实现打印。问题是Y不想把账号密码直接给A。用oauth2.0就是来解决这个问题的：</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A先 把Y导向B的站点进行授权。授权通过，B向A发送oauth_code。A拿到这个oauth_code，连同A的client_id和 oauth_secrete发送给B，如果数据正确，B就会给A发送oauth_token。有了这个token,A就可以获取B的相关资源的。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;基本的流程是这样。下面是具体的实现过程。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">二、oauth2.0服务端的搭建。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oauth2.0的服务端分为验证服务器和资源服务器。这两个服务器也可以是同一个服务器（只不过把这两个功能用一个 服务器来完成罢了）。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;说明：我的实现都在Thinkphp3.2.3框架下实现。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1、下载thinkphp3.2.3。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2、配置虚拟机server.ruanwenwu.cn</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3、在Thinkphp的Home应用下修改配置文件（server.ruanwenwu.cn/Application/Home/Conf/config.php）如下所示：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?phpreturn&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;//&#39;配置项&#39;=&gt;&#39;配置值&#39;&nbsp;&nbsp;&nbsp;&nbsp;//数据库设置&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DB_TYPE&#39;&nbsp;=&gt;&nbsp;&#39;mysql&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DB_HOST&#39;&nbsp;=&gt;&nbsp;&#39;127.0.0.1&#39;,//localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DB_NAME&#39;&nbsp;=&gt;&nbsp;&#39;oauth&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DB_USER&#39;&nbsp;=&gt;&nbsp;&#39;root&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DB_PWD&#39;&nbsp;&nbsp;=&gt;&nbsp;&#39;root&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DB_PORT&#39;&nbsp;=&gt;&nbsp;&#39;3306&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;SCOPE_INFO&#39;&nbsp;&nbsp;=&gt;&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;//这是授权选项。根据你自己的项目来&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;&nbsp;=&gt;&nbsp;&#39;个人信息&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;&nbsp;=&gt;&nbsp;&#39;basicinfo&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;&nbsp;=&gt;&nbsp;&#39;论坛发帖回帖&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;&nbsp;=&gt;&nbsp;&#39;bbsinfo&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),&nbsp;&nbsp;&nbsp;&nbsp;),&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;OAUTH2_CODES_TABLE&#39;&nbsp;&nbsp;&nbsp;=&gt;&#39;oauth_code&#39;,&nbsp;&nbsp;&nbsp;&nbsp;//这里是oauth项目需要用的三个基础表&nbsp;&nbsp;&nbsp;&nbsp;&#39;OAUTH2_CLIENTS_TABLE&#39;&nbsp;=&gt;&#39;oauth_client&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&#39;OAUTH2_TOKEN_TABLE&#39;&nbsp;&nbsp;&nbsp;=&gt;&#39;oauth_token&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;SECRETKYE&#39;&nbsp;=&gt;&nbsp;&#39;Mumayi!@#&#39;,&nbsp;&nbsp;&nbsp;&nbsp;//下面是一些网站自定义的项目。可以根据自己的情况来写或者不写&nbsp;&nbsp;&nbsp;&nbsp;//session&nbsp;有效期&nbsp;&nbsp;&nbsp;&nbsp;&#39;SESSION_EXPIRES&#39;&nbsp;=&gt;&nbsp;1200,&nbsp;&nbsp;&nbsp;&nbsp;//key&nbsp;有效期&nbsp;&nbsp;&nbsp;&nbsp;&#39;PASS_KEY_EXPIRES&#39;&nbsp;=&gt;&nbsp;86400,&nbsp;&nbsp;&nbsp;&nbsp;//key&nbsp;有效期&nbsp;&nbsp;&nbsp;&nbsp;&#39;PHONE_KEY_EXPIRES&#39;&nbsp;=&gt;&nbsp;300,&nbsp;&nbsp;&nbsp;&nbsp;//key&nbsp;加密&nbsp;整型&nbsp;数字&nbsp;必须为&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&#39;PASS_KEY_CALC&#39;&nbsp;=&gt;&nbsp;1314,);</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4、建oauth表。</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">SET&nbsp;FOREIGN_KEY_CHECKS=0;--&nbsp;------------------------------&nbsp;Table&nbsp;structure&nbsp;for&nbsp;oauth_client--&nbsp;----------------------------DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;`oauth_client`;CREATE&nbsp;TABLE&nbsp;`oauth_client`&nbsp;(\r\n&nbsp;&nbsp;`id`&nbsp;bigint(20)&nbsp;NOT&nbsp;NULL&nbsp;AUTO_INCREMENT,\r\n&nbsp;&nbsp;`client_id`&nbsp;varchar(32)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`client_secret`&nbsp;varchar(32)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`redirect_uri`&nbsp;varchar(200)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`create_time`&nbsp;int(11)&nbsp;NOT&nbsp;NULL,&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;(`id`))&nbsp;ENGINE=MyISAM&nbsp;AUTO_INCREMENT=3&nbsp;DEFAULT&nbsp;CHARSET=utf8;--&nbsp;------------------------------&nbsp;Table&nbsp;structure&nbsp;for&nbsp;oauth_code--&nbsp;----------------------------DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;`oauth_code`;CREATE&nbsp;TABLE&nbsp;`oauth_code`&nbsp;(\r\n&nbsp;&nbsp;`id`&nbsp;bigint(20)&nbsp;NOT&nbsp;NULL&nbsp;AUTO_INCREMENT,\r\n&nbsp;&nbsp;`client_id`&nbsp;varchar(32)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`user_id`&nbsp;int(11)&nbsp;NOT&nbsp;NULL&nbsp;DEFAULT&nbsp;&#39;1&#39;,\r\n&nbsp;&nbsp;`code`&nbsp;varchar(40)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`redirect_uri`&nbsp;varchar(200)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`expires`&nbsp;int(11)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`scope`&nbsp;varchar(250)&nbsp;DEFAULT&nbsp;NULL,&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;(`id`))&nbsp;ENGINE=MyISAM&nbsp;AUTO_INCREMENT=57&nbsp;DEFAULT&nbsp;CHARSET=utf8;\r\n\r\n--&nbsp;----------------------------\r\n--&nbsp;Table&nbsp;structure&nbsp;for&nbsp;oauth_token\r\n--&nbsp;----------------------------\r\nDROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;`oauth_token`;\r\nCREATE&nbsp;TABLE&nbsp;`oauth_token`&nbsp;(\r\n&nbsp;&nbsp;`id`&nbsp;bigint(20)&nbsp;NOT&nbsp;NULL&nbsp;AUTO_INCREMENT,\r\n&nbsp;&nbsp;`client_id`&nbsp;varchar(32)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`user_id`&nbsp;int(11)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`access_token`&nbsp;varchar(40)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`refresh_token`&nbsp;varchar(40)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`expires_in`&nbsp;int(11)&nbsp;NOT&nbsp;NULL,\r\n&nbsp;&nbsp;`scope`&nbsp;varchar(200)&nbsp;DEFAULT&nbsp;NULL,\r\n&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;(`id`)\r\n)&nbsp;ENGINE=MyISAM&nbsp;AUTO_INCREMENT=26&nbsp;DEFAULT&nbsp;CHARSET=utf8;</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5、引入oauth2.0服务端类文件。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-1、在\\server.ruanwenwu.cn\\ThinkPHP\\Library\\Vendor\\目录下建立oauth目录。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-2、引入oauth2.0服务端PHP脚本。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在刚建立的oauth目录下引入OAuth2.class.php这个文件基本不用做修改。我们的操作都在继承这个类的子类上完成。类的代码如下：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?php/**&nbsp;*&nbsp;@mainpage&nbsp;*&nbsp;OAuth&nbsp;2.0&nbsp;server&nbsp;in&nbsp;PHP,&nbsp;originally&nbsp;written&nbsp;for&nbsp;*&nbsp;&lt;a&nbsp;href=&quot;http://www.opendining.net/&quot;&gt;&nbsp;Open&nbsp;Dining&lt;/a&gt;.&nbsp;Supports&nbsp;*&nbsp;&lt;a&nbsp;href=&quot;http://tools.ietf.org/html/draft-ietf-oauth-v2-10&quot;&gt;IETF&nbsp;draft&nbsp;v10&lt;/a&gt;.&nbsp;*&nbsp;*&nbsp;Source&nbsp;repo&nbsp;has&nbsp;sample&nbsp;servers&nbsp;implementations&nbsp;for&nbsp;*&nbsp;&lt;a&nbsp;href=&quot;http://php.net/manual/en/book.pdo.php&quot;&gt;&nbsp;PHP&nbsp;Data&nbsp;Objects&lt;/a&gt;&nbsp;and&nbsp;*&nbsp;&lt;a&nbsp;href=&quot;http://www.mongodb.org/&quot;&gt;MongoDB&lt;/a&gt;.&nbsp;Easily&nbsp;adaptable&nbsp;to&nbsp;other&nbsp;*&nbsp;storage&nbsp;engines.&nbsp;*&nbsp;*&nbsp;PHP&nbsp;Data&nbsp;Objects&nbsp;supports&nbsp;a&nbsp;variety&nbsp;of&nbsp;databases,&nbsp;including&nbsp;MySQL,&nbsp;*&nbsp;Microsoft&nbsp;SQL&nbsp;Server,&nbsp;SQLite,&nbsp;and&nbsp;Oracle,&nbsp;so&nbsp;you&nbsp;can&nbsp;try&nbsp;out&nbsp;the&nbsp;sample&nbsp;*&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;all&nbsp;works.&nbsp;*&nbsp;*&nbsp;We&#39;re&nbsp;expanding&nbsp;the&nbsp;wiki&nbsp;to&nbsp;include&nbsp;more&nbsp;helpful&nbsp;documentation,&nbsp;but&nbsp;for&nbsp;*&nbsp;now,&nbsp;your&nbsp;best&nbsp;bet&nbsp;is&nbsp;to&nbsp;view&nbsp;the&nbsp;oauth.php&nbsp;source&nbsp;-&nbsp;it&nbsp;has&nbsp;lots&nbsp;of&nbsp;*&nbsp;comments.&nbsp;*&nbsp;*&nbsp;@author&nbsp;Tim&nbsp;Ridgely&nbsp;&lt;tim.ridgely@gmail.com&gt;&nbsp;*&nbsp;@author&nbsp;Aaron&nbsp;Parecki&nbsp;&lt;aaron@parecki.com&gt;&nbsp;*&nbsp;@author&nbsp;Edison&nbsp;Wong&nbsp;&lt;hswong3i@pantarei-design.com&gt;&nbsp;*&nbsp;*&nbsp;@see&nbsp;http://code.google.com/p/oauth2-php/&nbsp;*//**\r\n&nbsp;*&nbsp;The&nbsp;default&nbsp;duration&nbsp;in&nbsp;seconds&nbsp;of&nbsp;the&nbsp;access&nbsp;token&nbsp;lifetime.\r\n&nbsp;*/define(&quot;OAUTH2_DEFAULT_ACCESS_TOKEN_LIFETIME&quot;,&nbsp;3600);/**\r\n&nbsp;*&nbsp;The&nbsp;default&nbsp;duration&nbsp;in&nbsp;seconds&nbsp;of&nbsp;the&nbsp;authorization&nbsp;code&nbsp;lifetime.\r\n&nbsp;*/define(&quot;OAUTH2_DEFAULT_AUTH_CODE_LIFETIME&quot;,&nbsp;30);/**\r\n&nbsp;*&nbsp;The&nbsp;default&nbsp;duration&nbsp;in&nbsp;seconds&nbsp;of&nbsp;the&nbsp;refresh&nbsp;token&nbsp;lifetime.\r\n&nbsp;*/define(&quot;OAUTH2_DEFAULT_REFRESH_TOKEN_LIFETIME&quot;,&nbsp;1209600);/**\r\n&nbsp;*&nbsp;@defgroup&nbsp;oauth2_section_2&nbsp;Client&nbsp;Credentials\r\n&nbsp;*&nbsp;@{\r\n&nbsp;*\r\n&nbsp;*&nbsp;When&nbsp;interacting&nbsp;with&nbsp;the&nbsp;authorization&nbsp;server,&nbsp;the&nbsp;client&nbsp;identifies\r\n&nbsp;*&nbsp;itself&nbsp;using&nbsp;a&nbsp;client&nbsp;identifier&nbsp;and&nbsp;authenticates&nbsp;using&nbsp;a&nbsp;set&nbsp;of\r\n&nbsp;*&nbsp;client&nbsp;credentials.&nbsp;This&nbsp;specification&nbsp;provides&nbsp;one&nbsp;mechanism&nbsp;for\r\n&nbsp;*&nbsp;authenticating&nbsp;the&nbsp;client&nbsp;using&nbsp;password&nbsp;credentials.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-2\r\n&nbsp;*//**\r\n&nbsp;*&nbsp;Regex&nbsp;to&nbsp;filter&nbsp;out&nbsp;the&nbsp;client&nbsp;identifier&nbsp;(described&nbsp;in&nbsp;Section&nbsp;2&nbsp;of&nbsp;IETF&nbsp;draft).\r\n&nbsp;*\r\n&nbsp;*&nbsp;IETF&nbsp;draft&nbsp;does&nbsp;not&nbsp;prescribe&nbsp;a&nbsp;format&nbsp;for&nbsp;these,&nbsp;however&nbsp;I&#39;ve&nbsp;arbitrarily\r\n&nbsp;*&nbsp;chosen&nbsp;alphanumeric&nbsp;strings&nbsp;with&nbsp;hyphens&nbsp;and&nbsp;underscores,&nbsp;3-32&nbsp;characters\r\n&nbsp;*&nbsp;long.\r\n&nbsp;*\r\n&nbsp;*&nbsp;Feel&nbsp;free&nbsp;to&nbsp;change.\r\n&nbsp;*/define(&quot;OAUTH2_CLIENT_ID_REGEXP&quot;,&nbsp;&quot;/^[a-z0-9-_]{3,32}$/i&quot;);/**\r\n&nbsp;*&nbsp;@}\r\n&nbsp;*//**\r\n&nbsp;*&nbsp;@defgroup&nbsp;oauth2_section_3&nbsp;Obtaining&nbsp;End-User&nbsp;Authorization\r\n&nbsp;*&nbsp;@{\r\n&nbsp;*\r\n&nbsp;*&nbsp;When&nbsp;the&nbsp;client&nbsp;interacts&nbsp;with&nbsp;an&nbsp;end-user,&nbsp;the&nbsp;end-user&nbsp;MUST&nbsp;first\r\n&nbsp;*&nbsp;grant&nbsp;the&nbsp;client&nbsp;authorization&nbsp;to&nbsp;access&nbsp;its&nbsp;protected&nbsp;resources.\r\n&nbsp;*&nbsp;Once&nbsp;obtained,&nbsp;the&nbsp;end-user&nbsp;access&nbsp;grant&nbsp;is&nbsp;expressed&nbsp;as&nbsp;an\r\n&nbsp;*&nbsp;authorization&nbsp;code&nbsp;which&nbsp;the&nbsp;client&nbsp;uses&nbsp;to&nbsp;obtain&nbsp;an&nbsp;access&nbsp;token.\r\n&nbsp;*&nbsp;To&nbsp;obtain&nbsp;an&nbsp;end-user&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;end-user&nbsp;to\r\n&nbsp;*&nbsp;the&nbsp;end-user&nbsp;authorization&nbsp;endpoint.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3\r\n&nbsp;*//**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;token&quot;&nbsp;authorization&nbsp;response&nbsp;type.\r\n&nbsp;*/define(&quot;OAUTH2_AUTH_RESPONSE_TYPE_ACCESS_TOKEN&quot;,&nbsp;&quot;token&quot;);/**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;code&quot;&nbsp;authorization&nbsp;response&nbsp;type.\r\n&nbsp;*/define(&quot;OAUTH2_AUTH_RESPONSE_TYPE_AUTH_CODE&quot;,&nbsp;&quot;code&quot;);/**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;code-and-token&quot;&nbsp;authorization&nbsp;response&nbsp;type.\r\n&nbsp;*/define(&quot;OAUTH2_AUTH_RESPONSE_TYPE_CODE_AND_TOKEN&quot;,&nbsp;&quot;code-and-token&quot;);/**\r\n&nbsp;*&nbsp;Regex&nbsp;to&nbsp;filter&nbsp;out&nbsp;the&nbsp;authorization&nbsp;response&nbsp;type.\r\n&nbsp;*/define(&quot;OAUTH2_AUTH_RESPONSE_TYPE_REGEXP&quot;,&nbsp;&quot;/^(token|code|code-and-token)$/&quot;);/**\r\n&nbsp;*&nbsp;@}\r\n&nbsp;*//**\r\n&nbsp;*&nbsp;@defgroup&nbsp;oauth2_section_4&nbsp;Obtaining&nbsp;an&nbsp;Access&nbsp;Token\r\n&nbsp;*&nbsp;@{\r\n&nbsp;*\r\n&nbsp;*&nbsp;The&nbsp;client&nbsp;obtains&nbsp;an&nbsp;access&nbsp;token&nbsp;by&nbsp;authenticating&nbsp;with&nbsp;the\r\n&nbsp;*&nbsp;authorization&nbsp;server&nbsp;and&nbsp;presenting&nbsp;its&nbsp;access&nbsp;grant&nbsp;(in&nbsp;the&nbsp;form&nbsp;of\r\n&nbsp;*&nbsp;an&nbsp;authorization&nbsp;code,&nbsp;resource&nbsp;owner&nbsp;credentials,&nbsp;an&nbsp;assertion,&nbsp;or&nbsp;a\r\n&nbsp;*&nbsp;refresh&nbsp;token).\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4\r\n&nbsp;*//**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;authorization_code&quot;&nbsp;grant&nbsp;types&nbsp;(for&nbsp;token&nbsp;obtaining).\r\n&nbsp;*/define(&quot;OAUTH2_GRANT_TYPE_AUTH_CODE&quot;,&nbsp;&quot;authorization_code&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;password&quot;&nbsp;grant&nbsp;types&nbsp;(for&nbsp;token&nbsp;obtaining).\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_GRANT_TYPE_USER_CREDENTIALS&quot;,&nbsp;&quot;password&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;assertion&quot;&nbsp;grant&nbsp;types&nbsp;(for&nbsp;token&nbsp;obtaining).\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_GRANT_TYPE_ASSERTION&quot;,&nbsp;&quot;assertion&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;refresh_token&quot;&nbsp;grant&nbsp;types&nbsp;(for&nbsp;token&nbsp;obtaining).\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_GRANT_TYPE_REFRESH_TOKEN&quot;,&nbsp;&quot;refresh_token&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;Denotes&nbsp;&quot;none&quot;&nbsp;grant&nbsp;types&nbsp;(for&nbsp;token&nbsp;obtaining).\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_GRANT_TYPE_NONE&quot;,&nbsp;&quot;none&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;Regex&nbsp;to&nbsp;filter&nbsp;out&nbsp;the&nbsp;grant&nbsp;type.\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_GRANT_TYPE_REGEXP&quot;,&nbsp;&quot;/^(authorization_code|password|assertion|refresh_token|none)$/&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;@}\r\n&nbsp;*/\r\n\r\n\r\n/**\r\n&nbsp;*&nbsp;@defgroup&nbsp;oauth2_section_5&nbsp;Accessing&nbsp;a&nbsp;Protected&nbsp;Resource\r\n&nbsp;*&nbsp;@{\r\n&nbsp;*\r\n&nbsp;*&nbsp;Clients&nbsp;access&nbsp;protected&nbsp;resources&nbsp;by&nbsp;presenting&nbsp;an&nbsp;access&nbsp;token&nbsp;to\r\n&nbsp;*&nbsp;the&nbsp;resource&nbsp;server.&nbsp;Access&nbsp;tokens&nbsp;act&nbsp;as&nbsp;bearer&nbsp;tokens,&nbsp;where&nbsp;the\r\n&nbsp;*&nbsp;token&nbsp;string&nbsp;acts&nbsp;as&nbsp;a&nbsp;shared&nbsp;symmetric&nbsp;secret.&nbsp;This&nbsp;requires\r\n&nbsp;*&nbsp;treating&nbsp;the&nbsp;access&nbsp;token&nbsp;with&nbsp;the&nbsp;same&nbsp;care&nbsp;as&nbsp;other&nbsp;secrets&nbsp;(e.g.\r\n&nbsp;*&nbsp;end-user&nbsp;passwords).&nbsp;Access&nbsp;tokens&nbsp;SHOULD&nbsp;NOT&nbsp;be&nbsp;sent&nbsp;in&nbsp;the&nbsp;clear\r\n&nbsp;*&nbsp;over&nbsp;an&nbsp;insecure&nbsp;channel.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5\r\n&nbsp;*/\r\n\r\n/**\r\n&nbsp;*&nbsp;Used&nbsp;to&nbsp;define&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;OAuth&nbsp;access&nbsp;token&nbsp;parameter&nbsp;(POST/GET/etc.).\r\n&nbsp;*\r\n&nbsp;*&nbsp;IETF&nbsp;Draft&nbsp;sections&nbsp;5.1.2&nbsp;and&nbsp;5.1.3&nbsp;specify&nbsp;that&nbsp;it&nbsp;should&nbsp;be&nbsp;called\r\n&nbsp;*&nbsp;&quot;oauth_token&quot;&nbsp;but&nbsp;other&nbsp;implementations&nbsp;use&nbsp;things&nbsp;like&nbsp;&quot;access_token&quot;.\r\n&nbsp;*\r\n&nbsp;*&nbsp;I&nbsp;won&#39;t&nbsp;be&nbsp;heartbroken&nbsp;if&nbsp;you&nbsp;change&nbsp;it,&nbsp;but&nbsp;it&nbsp;might&nbsp;be&nbsp;better&nbsp;to&nbsp;adhere\r\n&nbsp;*&nbsp;to&nbsp;the&nbsp;spec.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1.2\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1.3\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_TOKEN_PARAM_NAME&quot;,&nbsp;&quot;oauth_token&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;@}\r\n&nbsp;*/\r\n\r\n\r\n/**\r\n&nbsp;*&nbsp;@defgroup&nbsp;oauth2_http_status&nbsp;HTTP&nbsp;status&nbsp;code\r\n&nbsp;*&nbsp;@{\r\n&nbsp;*/\r\n\r\n/**\r\n&nbsp;*&nbsp;&quot;Found&quot;&nbsp;HTTP&nbsp;status&nbsp;code.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_HTTP_FOUND&quot;,&nbsp;&quot;302&nbsp;Found&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;&quot;Bad&nbsp;Request&quot;&nbsp;HTTP&nbsp;status&nbsp;code.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_HTTP_BAD_REQUEST&quot;,&nbsp;&quot;400&nbsp;Bad&nbsp;Request&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;&quot;Unauthorized&quot;&nbsp;HTTP&nbsp;status&nbsp;code.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_HTTP_UNAUTHORIZED&quot;,&nbsp;&quot;401&nbsp;Unauthorized&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;&quot;Forbidden&quot;&nbsp;HTTP&nbsp;status&nbsp;code.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_HTTP_FORBIDDEN&quot;,&nbsp;&quot;403&nbsp;Forbidden&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;@}\r\n&nbsp;*/\r\n\r\n\r\n/**\r\n&nbsp;*&nbsp;@defgroup&nbsp;oauth2_error&nbsp;Error&nbsp;handling\r\n&nbsp;*&nbsp;@{\r\n&nbsp;*\r\n&nbsp;*&nbsp;@todo&nbsp;Extend&nbsp;for&nbsp;i18n.\r\n&nbsp;*/\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;request&nbsp;is&nbsp;missing&nbsp;a&nbsp;required&nbsp;parameter,&nbsp;includes&nbsp;an&nbsp;unsupported\r\n&nbsp;*&nbsp;parameter&nbsp;or&nbsp;parameter&nbsp;value,&nbsp;or&nbsp;is&nbsp;otherwise&nbsp;malformed.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3.1\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_INVALID_REQUEST&quot;,&nbsp;&quot;invalid_request&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;client&nbsp;identifier&nbsp;provided&nbsp;is&nbsp;invalid.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_INVALID_CLIENT&quot;,&nbsp;&quot;invalid_client&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;client&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;use&nbsp;the&nbsp;requested&nbsp;response&nbsp;type.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_UNAUTHORIZED_CLIENT&quot;,&nbsp;&quot;unauthorized_client&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;redirection&nbsp;URI&nbsp;provided&nbsp;does&nbsp;not&nbsp;match&nbsp;a&nbsp;pre-registered&nbsp;value.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_REDIRECT_URI_MISMATCH&quot;,&nbsp;&quot;redirect_uri_mismatch&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;end-user&nbsp;or&nbsp;authorization&nbsp;server&nbsp;denied&nbsp;the&nbsp;request.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_USER_DENIED&quot;,&nbsp;&quot;access_denied&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;requested&nbsp;response&nbsp;type&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;the&nbsp;authorization&nbsp;server.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_UNSUPPORTED_RESPONSE_TYPE&quot;,&nbsp;&quot;unsupported_response_type&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;requested&nbsp;scope&nbsp;is&nbsp;invalid,&nbsp;unknown,&nbsp;or&nbsp;malformed.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2.1\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_INVALID_SCOPE&quot;,&nbsp;&quot;invalid_scope&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;provided&nbsp;access&nbsp;grant&nbsp;is&nbsp;invalid,&nbsp;expired,&nbsp;or&nbsp;revoked&nbsp;(e.g.&nbsp;invalid\r\n&nbsp;*&nbsp;assertion,&nbsp;expired&nbsp;authorization&nbsp;token,&nbsp;bad&nbsp;end-user&nbsp;password&nbsp;credentials,\r\n&nbsp;*&nbsp;or&nbsp;mismatching&nbsp;authorization&nbsp;code&nbsp;and&nbsp;redirection&nbsp;URI).\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_INVALID_GRANT&quot;,&nbsp;&quot;invalid_grant&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;access&nbsp;grant&nbsp;included&nbsp;-&nbsp;its&nbsp;type&nbsp;or&nbsp;another&nbsp;attribute&nbsp;-&nbsp;is&nbsp;not\r\n&nbsp;*&nbsp;supported&nbsp;by&nbsp;the&nbsp;authorization&nbsp;server.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_UNSUPPORTED_GRANT_TYPE&quot;,&nbsp;&quot;unsupported_grant_type&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;access&nbsp;token&nbsp;provided&nbsp;is&nbsp;invalid.&nbsp;Resource&nbsp;servers&nbsp;SHOULD&nbsp;use&nbsp;this\r\n&nbsp;*&nbsp;error&nbsp;code&nbsp;when&nbsp;receiving&nbsp;an&nbsp;expired&nbsp;token&nbsp;which&nbsp;cannot&nbsp;be&nbsp;refreshed&nbsp;to\r\n&nbsp;*&nbsp;indicate&nbsp;to&nbsp;the&nbsp;client&nbsp;that&nbsp;a&nbsp;new&nbsp;authorization&nbsp;is&nbsp;necessary.&nbsp;The&nbsp;resource\r\n&nbsp;*&nbsp;server&nbsp;MUST&nbsp;respond&nbsp;with&nbsp;the&nbsp;HTTP&nbsp;401&nbsp;(Unauthorized)&nbsp;status&nbsp;code.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_INVALID_TOKEN&quot;,&nbsp;&quot;invalid_token&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;access&nbsp;token&nbsp;provided&nbsp;has&nbsp;expired.&nbsp;Resource&nbsp;servers&nbsp;SHOULD&nbsp;only&nbsp;use\r\n&nbsp;*&nbsp;this&nbsp;error&nbsp;code&nbsp;when&nbsp;the&nbsp;client&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;handle&nbsp;the\r\n&nbsp;*&nbsp;response&nbsp;and&nbsp;request&nbsp;a&nbsp;new&nbsp;access&nbsp;token&nbsp;using&nbsp;the&nbsp;refresh&nbsp;token&nbsp;issued\r\n&nbsp;*&nbsp;with&nbsp;the&nbsp;expired&nbsp;access&nbsp;token.&nbsp;The&nbsp;resource&nbsp;server&nbsp;MUST&nbsp;respond&nbsp;with&nbsp;the\r\n&nbsp;*&nbsp;HTTP&nbsp;401&nbsp;(Unauthorized)&nbsp;status&nbsp;code.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_EXPIRED_TOKEN&quot;,&nbsp;&quot;expired_token&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;The&nbsp;request&nbsp;requires&nbsp;higher&nbsp;privileges&nbsp;than&nbsp;provided&nbsp;by&nbsp;the&nbsp;access&nbsp;token.\r\n&nbsp;*&nbsp;The&nbsp;resource&nbsp;server&nbsp;SHOULD&nbsp;respond&nbsp;with&nbsp;the&nbsp;HTTP&nbsp;403&nbsp;(Forbidden)&nbsp;status\r\n&nbsp;*&nbsp;code&nbsp;and&nbsp;MAY&nbsp;include&nbsp;the&nbsp;&quot;scope&quot;&nbsp;attribute&nbsp;with&nbsp;the&nbsp;scope&nbsp;necessary&nbsp;to\r\n&nbsp;*&nbsp;access&nbsp;the&nbsp;protected&nbsp;resource.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2.1\r\n&nbsp;*/\r\ndefine(&quot;OAUTH2_ERROR_INSUFFICIENT_SCOPE&quot;,&nbsp;&quot;insufficient_scope&quot;);\r\n\r\n/**\r\n&nbsp;*&nbsp;@}\r\n&nbsp;*/\r\n\r\n/**\r\n&nbsp;*&nbsp;OAuth2.0&nbsp;draft&nbsp;v10&nbsp;server-side&nbsp;implementation.\r\n&nbsp;*\r\n&nbsp;*&nbsp;@author&nbsp;Originally&nbsp;written&nbsp;by&nbsp;Tim&nbsp;Ridgely&nbsp;&lt;tim.ridgely@gmail.com&gt;.\r\n&nbsp;*&nbsp;@author&nbsp;Updated&nbsp;to&nbsp;draft&nbsp;v10&nbsp;by&nbsp;Aaron&nbsp;Parecki&nbsp;&lt;aaron@parecki.com&gt;.\r\n&nbsp;*&nbsp;@author&nbsp;Debug,&nbsp;coding&nbsp;style&nbsp;clean&nbsp;up&nbsp;and&nbsp;documented&nbsp;by&nbsp;Edison&nbsp;Wong&nbsp;&lt;hswong3i@pantarei-design.com&gt;.\r\n&nbsp;*/\r\nabstract&nbsp;class&nbsp;OAuth2&nbsp;{\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Array&nbsp;of&nbsp;persistent&nbsp;variables&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;$conf&nbsp;=&nbsp;array();\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;persistent&nbsp;variable.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;To&nbsp;avoid&nbsp;problems,&nbsp;always&nbsp;use&nbsp;lower&nbsp;case&nbsp;for&nbsp;persistent&nbsp;variable&nbsp;names.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$name\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;variable&nbsp;to&nbsp;return.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$default\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;default&nbsp;value&nbsp;to&nbsp;use&nbsp;if&nbsp;this&nbsp;variable&nbsp;has&nbsp;never&nbsp;been&nbsp;set.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;value&nbsp;of&nbsp;the&nbsp;variable.\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;getVariable($name,&nbsp;$default&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isset($this-&gt;conf[$name])&nbsp;?&nbsp;$this-&gt;conf[$name]&nbsp;:&nbsp;$default;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;a&nbsp;persistent&nbsp;variable.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;To&nbsp;avoid&nbsp;problems,&nbsp;always&nbsp;use&nbsp;lower&nbsp;case&nbsp;for&nbsp;persistent&nbsp;variable&nbsp;names.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$name\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;variable&nbsp;to&nbsp;set.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$value\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;value&nbsp;to&nbsp;set.\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;setVariable($name,&nbsp;$value)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;conf[$name]&nbsp;=&nbsp;$value;\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;Subclasses&nbsp;must&nbsp;implement&nbsp;the&nbsp;following&nbsp;functions.\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Make&nbsp;sure&nbsp;that&nbsp;the&nbsp;client&nbsp;credentials&nbsp;is&nbsp;valid.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_secret\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;If&nbsp;a&nbsp;secret&nbsp;is&nbsp;required,&nbsp;check&nbsp;that&nbsp;they&#39;ve&nbsp;given&nbsp;the&nbsp;right&nbsp;one.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;if&nbsp;client&nbsp;credentials&nbsp;are&nbsp;valid,&nbsp;and&nbsp;MUST&nbsp;return&nbsp;FALSE&nbsp;if&nbsp;invalid.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-2.1\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_2\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;abstract&nbsp;protected&nbsp;function&nbsp;checkClientCredentials($client_id,&nbsp;$client_secret&nbsp;=&nbsp;NULL);\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;the&nbsp;registered&nbsp;redirect&nbsp;URI&nbsp;of&nbsp;corresponding&nbsp;client_id.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;OAuth&nbsp;says&nbsp;we&nbsp;should&nbsp;store&nbsp;request&nbsp;URIs&nbsp;for&nbsp;each&nbsp;registered&nbsp;client.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Implement&nbsp;this&nbsp;function&nbsp;to&nbsp;grab&nbsp;the&nbsp;stored&nbsp;URI&nbsp;for&nbsp;a&nbsp;given&nbsp;client&nbsp;id.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Registered&nbsp;redirect&nbsp;URI&nbsp;of&nbsp;corresponding&nbsp;client&nbsp;identifier,&nbsp;and&nbsp;MUST\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;return&nbsp;FALSE&nbsp;if&nbsp;the&nbsp;given&nbsp;client&nbsp;does&nbsp;not&nbsp;exist&nbsp;or&nbsp;is&nbsp;invalid.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;abstract&nbsp;protected&nbsp;function&nbsp;getRedirectUri($client_id);\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Look&nbsp;up&nbsp;the&nbsp;supplied&nbsp;oauth_token&nbsp;from&nbsp;storage.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;We&nbsp;need&nbsp;to&nbsp;retrieve&nbsp;access&nbsp;token&nbsp;data&nbsp;as&nbsp;we&nbsp;create&nbsp;and&nbsp;verify&nbsp;tokens.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$oauth_token\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;oauth_token&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;associative&nbsp;array&nbsp;as&nbsp;below,&nbsp;and&nbsp;return&nbsp;NULL&nbsp;if&nbsp;the&nbsp;supplied&nbsp;oauth_token\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;is&nbsp;invalid:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;client_id:&nbsp;Stored&nbsp;client&nbsp;identifier.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;expires:&nbsp;Stored&nbsp;expiration&nbsp;in&nbsp;unix&nbsp;timestamp.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;scope:&nbsp;(optional)&nbsp;Stored&nbsp;scope&nbsp;values&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_5\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;abstract&nbsp;protected&nbsp;function&nbsp;getAccessToken($oauth_token);\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Store&nbsp;the&nbsp;supplied&nbsp;access&nbsp;token&nbsp;values&nbsp;to&nbsp;storage.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;We&nbsp;need&nbsp;to&nbsp;store&nbsp;access&nbsp;token&nbsp;data&nbsp;as&nbsp;we&nbsp;create&nbsp;and&nbsp;verify&nbsp;tokens.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$oauth_token\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;oauth_token&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$expires\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Expiration&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$user_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;User&nbsp;ID\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;Scopes&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;abstract&nbsp;protected&nbsp;function&nbsp;setAccessToken($oauth_token,&nbsp;$client_id,&nbsp;$expires,&nbsp;$user_id,&nbsp;$scope=NULL,&nbsp;$refresh_token=&#39;&#39;);\r\n\r\n&nbsp;&nbsp;//&nbsp;Stuff&nbsp;that&nbsp;should&nbsp;get&nbsp;overridden&nbsp;by&nbsp;subclasses.\r\n&nbsp;&nbsp;//\r\n&nbsp;&nbsp;//&nbsp;I&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;make&nbsp;these&nbsp;abstract,&nbsp;because&nbsp;then&nbsp;subclasses&nbsp;would&nbsp;have\r\n&nbsp;&nbsp;//&nbsp;to&nbsp;implement&nbsp;all&nbsp;of&nbsp;them,&nbsp;which&nbsp;is&nbsp;too&nbsp;much&nbsp;work.\r\n&nbsp;&nbsp;//\r\n&nbsp;&nbsp;//&nbsp;So&nbsp;they&#39;re&nbsp;just&nbsp;stubs.&nbsp;Override&nbsp;the&nbsp;ones&nbsp;you&nbsp;need.\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Return&nbsp;supported&nbsp;grant&nbsp;types.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;You&nbsp;should&nbsp;override&nbsp;this&nbsp;function&nbsp;with&nbsp;something,&nbsp;or&nbsp;else&nbsp;your&nbsp;OAuth\r\n&nbsp;&nbsp;&nbsp;*&nbsp;provider&nbsp;won&#39;t&nbsp;support&nbsp;any&nbsp;grant&nbsp;types!\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;list&nbsp;as&nbsp;below.&nbsp;If&nbsp;you&nbsp;support&nbsp;all&nbsp;grant&nbsp;types,&nbsp;then&nbsp;you&#39;d&nbsp;do:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_AUTH_CODE,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_USER_CREDENTIALS,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_ASSERTION,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_REFRESH_TOKEN,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_NONE,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;);\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@endcode\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getSupportedGrantTypes()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array();\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Return&nbsp;supported&nbsp;authorization&nbsp;response&nbsp;types.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;You&nbsp;should&nbsp;override&nbsp;this&nbsp;function&nbsp;with&nbsp;your&nbsp;supported&nbsp;response&nbsp;types.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;list&nbsp;as&nbsp;below.&nbsp;If&nbsp;you&nbsp;support&nbsp;all&nbsp;authorization&nbsp;response&nbsp;types,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;then&nbsp;you&#39;d&nbsp;do:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_AUTH_CODE,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_ACCESS_TOKEN,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_CODE_AND_TOKEN,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;);\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@endcode\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getSupportedAuthResponseTypes()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_AUTH_CODE,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_ACCESS_TOKEN,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_CODE_AND_TOKEN\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Return&nbsp;supported&nbsp;scopes.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;support&nbsp;scope&nbsp;use,&nbsp;then&nbsp;have&nbsp;this&nbsp;function&nbsp;return&nbsp;a&nbsp;list\r\n&nbsp;&nbsp;&nbsp;*&nbsp;of&nbsp;all&nbsp;acceptable&nbsp;scopes&nbsp;(used&nbsp;to&nbsp;throw&nbsp;the&nbsp;invalid-scope&nbsp;error).\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;list&nbsp;as&nbsp;below,&nbsp;for&nbsp;example:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&#39;my-friends&#39;,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&#39;photos&#39;,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&#39;whatever-else&#39;,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;);\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@endcode\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getSupportedScopes()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array();\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;restricted&nbsp;authorization&nbsp;response&nbsp;types&nbsp;of&nbsp;corresponding&nbsp;Client\r\n&nbsp;&nbsp;&nbsp;*&nbsp;identifier.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;restrict&nbsp;clients&nbsp;to&nbsp;certain&nbsp;authorization&nbsp;response&nbsp;types,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;override&nbsp;this&nbsp;function.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$response_type\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Authorization&nbsp;response&nbsp;type&nbsp;to&nbsp;be&nbsp;check&nbsp;with,&nbsp;would&nbsp;be&nbsp;one&nbsp;of&nbsp;the\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;values&nbsp;contained&nbsp;in&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_REGEXP.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;authorization&nbsp;response&nbsp;type&nbsp;is&nbsp;supported&nbsp;by&nbsp;this\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;client&nbsp;identifier,&nbsp;and&nbsp;FALSE&nbsp;if&nbsp;it&nbsp;isn&#39;t.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;checkRestrictedAuthResponseType($client_id,&nbsp;$response_type)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;restricted&nbsp;grant&nbsp;types&nbsp;of&nbsp;corresponding&nbsp;client&nbsp;identifier.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;restrict&nbsp;clients&nbsp;to&nbsp;certain&nbsp;grant&nbsp;types,&nbsp;override&nbsp;this\r\n&nbsp;&nbsp;&nbsp;*&nbsp;function.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$grant_type\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Grant&nbsp;type&nbsp;to&nbsp;be&nbsp;check&nbsp;with,&nbsp;would&nbsp;be&nbsp;one&nbsp;of&nbsp;the&nbsp;values&nbsp;contained&nbsp;in\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_REGEXP.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;grant&nbsp;type&nbsp;is&nbsp;supported&nbsp;by&nbsp;this&nbsp;client&nbsp;identifier,&nbsp;and\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;FALSE&nbsp;if&nbsp;it&nbsp;isn&#39;t.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;checkRestrictedGrantType($client_id,&nbsp;$grant_type)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;Functions&nbsp;that&nbsp;help&nbsp;grant&nbsp;access&nbsp;tokens&nbsp;for&nbsp;various&nbsp;grant&nbsp;types.\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Fetch&nbsp;authorization&nbsp;code&nbsp;data&nbsp;(probably&nbsp;the&nbsp;most&nbsp;common&nbsp;grant&nbsp;type).\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Retrieve&nbsp;the&nbsp;stored&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;authorization&nbsp;code.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_AUTH_CODE.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Authorization&nbsp;code&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;associative&nbsp;array&nbsp;as&nbsp;below,&nbsp;and&nbsp;NULL&nbsp;if&nbsp;the&nbsp;code&nbsp;is&nbsp;invalid:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;client_id:&nbsp;Stored&nbsp;client&nbsp;identifier.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;redirect_uri:&nbsp;Stored&nbsp;redirect&nbsp;URI.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;expires:&nbsp;Stored&nbsp;expiration&nbsp;in&nbsp;unix&nbsp;timestamp.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;scope:&nbsp;(optional)&nbsp;Stored&nbsp;scope&nbsp;values&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.1.1\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getAuthCode($code)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Take&nbsp;the&nbsp;provided&nbsp;authorization&nbsp;code&nbsp;values&nbsp;and&nbsp;store&nbsp;them&nbsp;somewhere.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;function&nbsp;should&nbsp;be&nbsp;the&nbsp;storage&nbsp;counterpart&nbsp;to&nbsp;getAuthCode().\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;storage&nbsp;fails&nbsp;for&nbsp;some&nbsp;reason,&nbsp;we&#39;re&nbsp;not&nbsp;currently&nbsp;checking&nbsp;for\r\n&nbsp;&nbsp;&nbsp;*&nbsp;any&nbsp;sort&nbsp;of&nbsp;success/failure,&nbsp;so&nbsp;you&nbsp;should&nbsp;bail&nbsp;out&nbsp;of&nbsp;the&nbsp;script\r\n&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;provide&nbsp;a&nbsp;descriptive&nbsp;fail&nbsp;message.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_AUTH_CODE.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Authorization&nbsp;code&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$redirect_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Redirect&nbsp;URI&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$expires\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Expiration&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;Scopes&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;setAuthCode($code,&nbsp;$client_id,&nbsp;$redirect_uri,&nbsp;$expires,&nbsp;$userId,&nbsp;$scope&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Grant&nbsp;access&nbsp;tokens&nbsp;for&nbsp;basic&nbsp;user&nbsp;credentials.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;the&nbsp;supplied&nbsp;username&nbsp;and&nbsp;password&nbsp;for&nbsp;validity.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;You&nbsp;can&nbsp;also&nbsp;use&nbsp;the&nbsp;$client_id&nbsp;param&nbsp;to&nbsp;do&nbsp;any&nbsp;checks&nbsp;required&nbsp;based\r\n&nbsp;&nbsp;&nbsp;*&nbsp;on&nbsp;a&nbsp;client,&nbsp;if&nbsp;you&nbsp;need&nbsp;that.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_USER_CREDENTIALS.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$username\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Username&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$password\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Password&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;are&nbsp;valid,&nbsp;and&nbsp;FALSE&nbsp;if&nbsp;it&nbsp;isn&#39;t.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Moreover,&nbsp;if&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;are&nbsp;valid,&nbsp;and&nbsp;you&nbsp;want&nbsp;to\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;verify&nbsp;the&nbsp;scope&nbsp;of&nbsp;a&nbsp;user&#39;s&nbsp;access,&nbsp;return&nbsp;an&nbsp;associative&nbsp;array\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;with&nbsp;the&nbsp;scope&nbsp;values&nbsp;as&nbsp;below.&nbsp;We&#39;ll&nbsp;check&nbsp;the&nbsp;scope&nbsp;you&nbsp;provide\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;against&nbsp;the&nbsp;requested&nbsp;scope&nbsp;before&nbsp;providing&nbsp;an&nbsp;access&nbsp;token:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&#39;scope&#39;&nbsp;=&gt;&nbsp;&lt;stored&nbsp;scope&nbsp;values&nbsp;(space-separated&nbsp;string)&gt;,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;);\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@endcode\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.1.2\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;checkUserCredentials($client_id,&nbsp;$username,&nbsp;$password)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Grant&nbsp;access&nbsp;tokens&nbsp;for&nbsp;assertions.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;the&nbsp;supplied&nbsp;assertion&nbsp;for&nbsp;validity.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;You&nbsp;can&nbsp;also&nbsp;use&nbsp;the&nbsp;$client_id&nbsp;param&nbsp;to&nbsp;do&nbsp;any&nbsp;checks&nbsp;required&nbsp;based\r\n&nbsp;&nbsp;&nbsp;*&nbsp;on&nbsp;a&nbsp;client,&nbsp;if&nbsp;you&nbsp;need&nbsp;that.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_ASSERTION.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$assertion_type\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;format&nbsp;of&nbsp;the&nbsp;assertion&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;authorization&nbsp;server.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$assertion\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;assertion.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;assertion&nbsp;is&nbsp;valid,&nbsp;and&nbsp;FALSE&nbsp;if&nbsp;it&nbsp;isn&#39;t.&nbsp;Moreover,&nbsp;if\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;the&nbsp;assertion&nbsp;is&nbsp;valid,&nbsp;and&nbsp;you&nbsp;want&nbsp;to&nbsp;verify&nbsp;the&nbsp;scope&nbsp;of&nbsp;an&nbsp;access\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;request,&nbsp;return&nbsp;an&nbsp;associative&nbsp;array&nbsp;with&nbsp;the&nbsp;scope&nbsp;values&nbsp;as&nbsp;below.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;We&#39;ll&nbsp;check&nbsp;the&nbsp;scope&nbsp;you&nbsp;provide&nbsp;against&nbsp;the&nbsp;requested&nbsp;scope&nbsp;before\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;providing&nbsp;an&nbsp;access&nbsp;token:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&#39;scope&#39;&nbsp;=&gt;&nbsp;&lt;stored&nbsp;scope&nbsp;values&nbsp;(space-separated&nbsp;string)&gt;,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;);\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@endcode\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.1.3\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;checkAssertion($client_id,&nbsp;$assertion_type,&nbsp;$assertion)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Grant&nbsp;refresh&nbsp;access&nbsp;tokens.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Retrieve&nbsp;the&nbsp;stored&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;refresh&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_REFRESH_TOKEN.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$refresh_token\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Refresh&nbsp;token&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;associative&nbsp;array&nbsp;as&nbsp;below,&nbsp;and&nbsp;NULL&nbsp;if&nbsp;the&nbsp;refresh_token&nbsp;is\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;invalid:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;client_id:&nbsp;Stored&nbsp;client&nbsp;identifier.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;expires:&nbsp;Stored&nbsp;expiration&nbsp;unix&nbsp;timestamp.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;scope:&nbsp;(optional)&nbsp;Stored&nbsp;scope&nbsp;values&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.1.4\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getRefreshToken($refresh_token)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Take&nbsp;the&nbsp;provided&nbsp;refresh&nbsp;token&nbsp;values&nbsp;and&nbsp;store&nbsp;them&nbsp;somewhere.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;function&nbsp;should&nbsp;be&nbsp;the&nbsp;storage&nbsp;counterpart&nbsp;to&nbsp;getRefreshToken().\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;storage&nbsp;fails&nbsp;for&nbsp;some&nbsp;reason,&nbsp;we&#39;re&nbsp;not&nbsp;currently&nbsp;checking&nbsp;for\r\n&nbsp;&nbsp;&nbsp;*&nbsp;any&nbsp;sort&nbsp;of&nbsp;success/failure,&nbsp;so&nbsp;you&nbsp;should&nbsp;bail&nbsp;out&nbsp;of&nbsp;the&nbsp;script\r\n&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;provide&nbsp;a&nbsp;descriptive&nbsp;fail&nbsp;message.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_REFRESH_TOKEN.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$refresh_token\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Refresh&nbsp;token&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$expires\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;expires&nbsp;to&nbsp;be&nbsp;stored.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;Scopes&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;setRefreshToken($refresh_token,&nbsp;$client_id,&nbsp;$expires,&nbsp;$scope&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Expire&nbsp;a&nbsp;used&nbsp;refresh&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;is&nbsp;not&nbsp;explicitly&nbsp;required&nbsp;in&nbsp;the&nbsp;spec,&nbsp;but&nbsp;is&nbsp;almost&nbsp;implied.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;After&nbsp;granting&nbsp;a&nbsp;new&nbsp;refresh&nbsp;token,&nbsp;the&nbsp;old&nbsp;one&nbsp;is&nbsp;no&nbsp;longer&nbsp;useful&nbsp;and\r\n&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;should&nbsp;be&nbsp;forcibly&nbsp;expired&nbsp;in&nbsp;the&nbsp;data&nbsp;store&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;used&nbsp;again.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;storage&nbsp;fails&nbsp;for&nbsp;some&nbsp;reason,&nbsp;we&#39;re&nbsp;not&nbsp;currently&nbsp;checking&nbsp;for\r\n&nbsp;&nbsp;&nbsp;*&nbsp;any&nbsp;sort&nbsp;of&nbsp;success/failure,&nbsp;so&nbsp;you&nbsp;should&nbsp;bail&nbsp;out&nbsp;of&nbsp;the&nbsp;script\r\n&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;provide&nbsp;a&nbsp;descriptive&nbsp;fail&nbsp;message.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$refresh_token\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Refresh&nbsp;token&nbsp;to&nbsp;be&nbsp;expirse.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;unsetRefreshToken($refresh_token)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Grant&nbsp;access&nbsp;tokens&nbsp;for&nbsp;the&nbsp;&quot;none&quot;&nbsp;grant&nbsp;type.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Not&nbsp;really&nbsp;described&nbsp;in&nbsp;the&nbsp;IETF&nbsp;Draft,&nbsp;so&nbsp;I&nbsp;just&nbsp;left&nbsp;a&nbsp;method\r\n&nbsp;&nbsp;&nbsp;*&nbsp;stub...&nbsp;Do&nbsp;whatever&nbsp;you&nbsp;want!\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;for&nbsp;OAUTH2_GRANT_TYPE_NONE.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;checkNoneAccess($client_id)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;default&nbsp;authentication&nbsp;realm&nbsp;for&nbsp;WWW-Authenticate&nbsp;header.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Change&nbsp;this&nbsp;to&nbsp;whatever&nbsp;authentication&nbsp;realm&nbsp;you&nbsp;want&nbsp;to&nbsp;send&nbsp;in&nbsp;a\r\n&nbsp;&nbsp;&nbsp;*&nbsp;WWW-Authenticate&nbsp;header.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;string&nbsp;that&nbsp;you&nbsp;want&nbsp;to&nbsp;send&nbsp;in&nbsp;a&nbsp;WWW-Authenticate&nbsp;header.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_error\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getDefaultAuthenticationRealm()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;Service&quot;;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;End&nbsp;stuff&nbsp;that&nbsp;should&nbsp;get&nbsp;overridden.\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;an&nbsp;OAuth2.0&nbsp;server-side&nbsp;instance.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$config\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;associative&nbsp;array&nbsp;as&nbsp;below:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;access_token_lifetime:&nbsp;(optional)&nbsp;The&nbsp;lifetime&nbsp;of&nbsp;access&nbsp;token&nbsp;in\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seconds.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;auth_code_lifetime:&nbsp;(optional)&nbsp;The&nbsp;lifetime&nbsp;of&nbsp;authorization&nbsp;code&nbsp;in\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seconds.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;refresh_token_lifetime:&nbsp;(optional)&nbsp;The&nbsp;lifetime&nbsp;of&nbsp;refresh&nbsp;token&nbsp;in\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seconds.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;display_error:&nbsp;(optional)&nbsp;Whether&nbsp;to&nbsp;show&nbsp;verbose&nbsp;error&nbsp;messages&nbsp;in\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;response.\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;__construct($config&nbsp;=&nbsp;array())&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($config&nbsp;as&nbsp;$name&nbsp;=&gt;&nbsp;$value)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;setVariable($name,&nbsp;$value);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;Resource&nbsp;protecting&nbsp;(Section&nbsp;5).\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;that&nbsp;a&nbsp;valid&nbsp;access&nbsp;token&nbsp;has&nbsp;been&nbsp;provided.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;scope&nbsp;parameter&nbsp;defines&nbsp;any&nbsp;required&nbsp;scope&nbsp;that&nbsp;the&nbsp;token&nbsp;must&nbsp;have.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;a&nbsp;scope&nbsp;param&nbsp;is&nbsp;provided&nbsp;and&nbsp;the&nbsp;token&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;required\r\n&nbsp;&nbsp;&nbsp;*&nbsp;scope,&nbsp;we&nbsp;bounce&nbsp;the&nbsp;request.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Some&nbsp;implementations&nbsp;may&nbsp;choose&nbsp;to&nbsp;return&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;protected\r\n&nbsp;&nbsp;&nbsp;*&nbsp;resource&nbsp;(i.e.&nbsp;&quot;public&quot;&nbsp;data)&nbsp;if&nbsp;the&nbsp;user&nbsp;has&nbsp;not&nbsp;provided&nbsp;an&nbsp;access\r\n&nbsp;&nbsp;&nbsp;*&nbsp;token&nbsp;or&nbsp;if&nbsp;the&nbsp;access&nbsp;token&nbsp;is&nbsp;invalid&nbsp;or&nbsp;expired.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;IETF&nbsp;spec&nbsp;says&nbsp;that&nbsp;we&nbsp;should&nbsp;send&nbsp;a&nbsp;401&nbsp;Unauthorized&nbsp;header&nbsp;and\r\n&nbsp;&nbsp;&nbsp;*&nbsp;bail&nbsp;immediately&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;the&nbsp;defaults&nbsp;are&nbsp;set&nbsp;to.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;space-separated&nbsp;string&nbsp;of&nbsp;required&nbsp;scope(s),&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;check\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;for&nbsp;scope.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$exit_not_present\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;If&nbsp;TRUE&nbsp;and&nbsp;no&nbsp;access&nbsp;token&nbsp;is&nbsp;provided,&nbsp;send&nbsp;a&nbsp;401&nbsp;header&nbsp;and&nbsp;exit,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;otherwise&nbsp;return&nbsp;FALSE.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$exit_invalid\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;If&nbsp;TRUE&nbsp;and&nbsp;the&nbsp;implementation&nbsp;of&nbsp;getAccessToken()&nbsp;returns&nbsp;NULL,&nbsp;exit,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;otherwise&nbsp;return&nbsp;FALSE.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$exit_expired\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;If&nbsp;TRUE&nbsp;and&nbsp;the&nbsp;access&nbsp;token&nbsp;has&nbsp;expired,&nbsp;exit,&nbsp;otherwise&nbsp;return&nbsp;FALSE.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$exit_scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;If&nbsp;TRUE&nbsp;the&nbsp;access&nbsp;token&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;required&nbsp;scope(s),&nbsp;exit,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;otherwise&nbsp;return&nbsp;FALSE.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$realm\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;specify&nbsp;a&nbsp;particular&nbsp;realm&nbsp;for&nbsp;the&nbsp;WWW-Authenticate\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;header,&nbsp;supply&nbsp;it&nbsp;here.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_5\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;verifyAccessToken($scope&nbsp;=&nbsp;NULL,&nbsp;$exit_not_present&nbsp;=&nbsp;TRUE,&nbsp;$exit_invalid&nbsp;=&nbsp;TRUE,&nbsp;$exit_expired&nbsp;=&nbsp;TRUE,&nbsp;$exit_scope&nbsp;=&nbsp;TRUE,&nbsp;$realm&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$token_param&nbsp;=&nbsp;$this-&gt;getAccessTokenParams();\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($token_param&nbsp;===&nbsp;FALSE)&nbsp;//&nbsp;Access&nbsp;token&nbsp;was&nbsp;not&nbsp;provided\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$exit_not_present&nbsp;?&nbsp;$this-&gt;errorWWWAuthenticateResponseHeader(OAUTH2_HTTP_BAD_REQUEST,&nbsp;$realm,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;The&nbsp;request&nbsp;is&nbsp;missing&nbsp;a&nbsp;required&nbsp;parameter,&nbsp;includes&nbsp;an&nbsp;unsupported&nbsp;parameter&nbsp;or&nbsp;parameter&nbsp;value,&nbsp;repeats&nbsp;the&nbsp;same&nbsp;parameter,&nbsp;uses&nbsp;more&nbsp;than&nbsp;one&nbsp;method&nbsp;for&nbsp;including&nbsp;an&nbsp;access&nbsp;token,&nbsp;or&nbsp;is&nbsp;otherwise&nbsp;malformed.&#39;,&nbsp;NULL,&nbsp;$scope)&nbsp;:&nbsp;FALSE;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Get&nbsp;the&nbsp;stored&nbsp;token&nbsp;data&nbsp;(from&nbsp;the&nbsp;implementing&nbsp;subclass)\r\n&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;$this-&gt;getAccessToken($token_param);\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($token&nbsp;===&nbsp;NULL)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$exit_invalid&nbsp;?&nbsp;$this-&gt;errorWWWAuthenticateResponseHeader(OAUTH2_HTTP_UNAUTHORIZED,&nbsp;$realm,&nbsp;OAUTH2_ERROR_INVALID_TOKEN,&nbsp;&#39;The&nbsp;access&nbsp;token&nbsp;provided&nbsp;is&nbsp;invalid.&#39;,&nbsp;NULL,&nbsp;$scope)&nbsp;:&nbsp;FALSE;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;token&nbsp;expiration&nbsp;(I&#39;m&nbsp;leaving&nbsp;this&nbsp;check&nbsp;separated,&nbsp;later&nbsp;we&#39;ll&nbsp;fill&nbsp;in&nbsp;better&nbsp;error&nbsp;messages)\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($token[&quot;expires&quot;])&nbsp;&amp;&amp;&nbsp;time()&nbsp;&gt;&nbsp;$token[&quot;expires&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$exit_expired&nbsp;?&nbsp;$this-&gt;errorWWWAuthenticateResponseHeader(OAUTH2_HTTP_UNAUTHORIZED,&nbsp;$realm,&nbsp;OAUTH2_ERROR_EXPIRED_TOKEN,&nbsp;&#39;The&nbsp;access&nbsp;token&nbsp;provided&nbsp;has&nbsp;expired.&#39;,&nbsp;NULL,&nbsp;$scope)&nbsp;:&nbsp;FALSE;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;scope,&nbsp;if&nbsp;provided\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;If&nbsp;token&nbsp;doesn&#39;t&nbsp;have&nbsp;a&nbsp;scope,&nbsp;it&#39;s&nbsp;NULL/empty,&nbsp;or&nbsp;it&#39;s&nbsp;insufficient,&nbsp;then&nbsp;throw&nbsp;an&nbsp;error\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($scope&nbsp;&amp;&amp;&nbsp;(!isset($token[&quot;scope&quot;])&nbsp;||&nbsp;!$token[&quot;scope&quot;]&nbsp;||&nbsp;!$this-&gt;checkScope($scope,&nbsp;$token[&quot;scope&quot;])))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$exit_scope&nbsp;?&nbsp;$this-&gt;errorWWWAuthenticateResponseHeader(OAUTH2_HTTP_FORBIDDEN,&nbsp;$realm,&nbsp;OAUTH2_ERROR_INSUFFICIENT_SCOPE,&nbsp;&#39;The&nbsp;request&nbsp;requires&nbsp;higher&nbsp;privileges&nbsp;than&nbsp;provided&nbsp;by&nbsp;the&nbsp;access&nbsp;token.&#39;,&nbsp;NULL,&nbsp;$scope)&nbsp;:&nbsp;FALSE;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;if&nbsp;everything&nbsp;in&nbsp;required&nbsp;scope&nbsp;is&nbsp;contained&nbsp;in&nbsp;available&nbsp;scope.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$required_scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Required&nbsp;scope&nbsp;to&nbsp;be&nbsp;check&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$available_scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Available&nbsp;scope&nbsp;to&nbsp;be&nbsp;compare&nbsp;with.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;if&nbsp;everything&nbsp;in&nbsp;required&nbsp;scope&nbsp;is&nbsp;contained&nbsp;in&nbsp;available&nbsp;scope,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;and&nbsp;False&nbsp;if&nbsp;it&nbsp;isn&#39;t.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_5\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;checkScope($required_scope,&nbsp;$available_scope)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;required&nbsp;scope&nbsp;should&nbsp;match&nbsp;or&nbsp;be&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;available&nbsp;scope\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!is_array($required_scope))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$required_scope&nbsp;=&nbsp;explode(&quot;&nbsp;&quot;,&nbsp;$required_scope);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!is_array($available_scope))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$available_scope&nbsp;=&nbsp;explode(&quot;&nbsp;&quot;,&nbsp;$available_scope);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(count(array_diff($required_scope,&nbsp;$available_scope))&nbsp;==&nbsp;0);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Pulls&nbsp;the&nbsp;access&nbsp;token&nbsp;out&nbsp;of&nbsp;the&nbsp;HTTP&nbsp;request.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Either&nbsp;from&nbsp;the&nbsp;Authorization&nbsp;header&nbsp;or&nbsp;GET/POST/etc.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Access&nbsp;token&nbsp;value&nbsp;if&nbsp;present,&nbsp;and&nbsp;FALSE&nbsp;if&nbsp;it&nbsp;isn&#39;t.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@todo&nbsp;Support&nbsp;PUT&nbsp;or&nbsp;DELETE.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_5\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;getAccessTokenParams()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$auth_header&nbsp;=&nbsp;$this-&gt;getAuthorizationHeader();\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($auth_header&nbsp;!==&nbsp;FALSE)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Make&nbsp;sure&nbsp;only&nbsp;the&nbsp;auth&nbsp;header&nbsp;is&nbsp;set\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_GET[OAUTH2_TOKEN_PARAM_NAME])&nbsp;||&nbsp;isset($_POST[OAUTH2_TOKEN_PARAM_NAME]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Auth&nbsp;token&nbsp;found&nbsp;in&nbsp;GET&nbsp;or&nbsp;POST&nbsp;when&nbsp;token&nbsp;present&nbsp;in&nbsp;header&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$auth_header&nbsp;=&nbsp;trim($auth_header);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Make&nbsp;sure&nbsp;it&#39;s&nbsp;Token&nbsp;authorization\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strcmp(substr($auth_header,&nbsp;0,&nbsp;5),&nbsp;&quot;OAuth&nbsp;&quot;)&nbsp;!==&nbsp;0)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Auth&nbsp;header&nbsp;found&nbsp;that&nbsp;doesn\\&#39;t&nbsp;start&nbsp;with&nbsp;&quot;OAuth&quot;&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Parse&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;header\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(preg_match(&#39;/\\s*OAuth\\s*=&quot;(.+)&quot;/&#39;,&nbsp;substr($auth_header,&nbsp;5),&nbsp;$matches)&nbsp;==&nbsp;0&nbsp;||&nbsp;count($matches)&nbsp;&lt;&nbsp;2)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Malformed&nbsp;auth&nbsp;header&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$matches[1];\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_GET[OAUTH2_TOKEN_PARAM_NAME]))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_POST[OAUTH2_TOKEN_PARAM_NAME]))&nbsp;//&nbsp;Both&nbsp;GET&nbsp;and&nbsp;POST&nbsp;are&nbsp;not&nbsp;allowed\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Only&nbsp;send&nbsp;the&nbsp;token&nbsp;in&nbsp;GET&nbsp;or&nbsp;POST,&nbsp;not&nbsp;both&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$_GET[OAUTH2_TOKEN_PARAM_NAME];\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_POST[OAUTH2_TOKEN_PARAM_NAME]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$_POST[OAUTH2_TOKEN_PARAM_NAME];\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;Access&nbsp;token&nbsp;granting&nbsp;(Section&nbsp;4).\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Grant&nbsp;or&nbsp;deny&nbsp;a&nbsp;requested&nbsp;access&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;would&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;&quot;/token&quot;&nbsp;endpoint&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;spec.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Obviously,&nbsp;you&nbsp;can&nbsp;call&nbsp;your&nbsp;endpoint&nbsp;whatever&nbsp;you&nbsp;want.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;grantAccessToken()&nbsp;{\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;$filters&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;grant_type&quot;&nbsp;=&gt;&nbsp;array(&quot;filter&quot;&nbsp;=&gt;&nbsp;FILTER_VALIDATE_REGEXP,&nbsp;&quot;options&quot;&nbsp;=&gt;&nbsp;array(&quot;regexp&quot;&nbsp;=&gt;&nbsp;OAUTH2_GRANT_TYPE_REGEXP),&nbsp;&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;scope&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;code&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;redirect_uri&quot;&nbsp;=&gt;&nbsp;array(&quot;filter&quot;&nbsp;=&gt;&nbsp;FILTER_SANITIZE_URL),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;username&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;password&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;assertion_type&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;assertion&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;refresh_token&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;filter_input_array(INPUT_POST,&nbsp;$filters);\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Grant&nbsp;Type&nbsp;must&nbsp;be&nbsp;specified.\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;grant_type&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Invalid&nbsp;grant_type&nbsp;parameter&nbsp;or&nbsp;parameter&nbsp;missing&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Make&nbsp;sure&nbsp;we&#39;ve&nbsp;implemented&nbsp;the&nbsp;requested&nbsp;grant&nbsp;type\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!in_array($input[&quot;grant_type&quot;],&nbsp;$this-&gt;getSupportedGrantTypes()))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_UNSUPPORTED_GRANT_TYPE);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Authorize&nbsp;the&nbsp;client\r\n&nbsp;&nbsp;&nbsp;&nbsp;$client&nbsp;=&nbsp;$this-&gt;getClientCredentials();\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;checkClientCredentials($client[0],&nbsp;$client[1])&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_CLIENT);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$this-&gt;checkRestrictedGrantType($client[0],&nbsp;$input[&quot;grant_type&quot;]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_UNAUTHORIZED_CLIENT);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Do&nbsp;the&nbsp;granting\r\n&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;($input[&quot;grant_type&quot;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OAUTH2_GRANT_TYPE_AUTH_CODE:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;code&quot;]&nbsp;||&nbsp;!$input[&quot;redirect_uri&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stored&nbsp;=&nbsp;$this-&gt;getAuthCode($input[&quot;code&quot;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;that&nbsp;the&nbsp;input&nbsp;uri&nbsp;starts&nbsp;with&nbsp;the&nbsp;stored&nbsp;uri\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored&nbsp;===&nbsp;NULL&nbsp;||&nbsp;(strcasecmp(substr($input[&quot;redirect_uri&quot;],&nbsp;0,&nbsp;strlen($stored[&quot;redirect_uri&quot;])),&nbsp;$stored[&quot;redirect_uri&quot;])&nbsp;!==&nbsp;0)&nbsp;||&nbsp;$client[0]&nbsp;!=&nbsp;$stored[&quot;client_id&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_GRANT);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored[&quot;expires&quot;]&nbsp;&lt;&nbsp;time())\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_EXPIRED_TOKEN);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OAUTH2_GRANT_TYPE_USER_CREDENTIALS:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;username&quot;]&nbsp;||&nbsp;!$input[&quot;password&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Missing&nbsp;parameters.&nbsp;&quot;username&quot;&nbsp;and&nbsp;&quot;password&quot;&nbsp;required&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stored&nbsp;=&nbsp;$this-&gt;checkUserCredentials($client[0],&nbsp;$input[&quot;username&quot;],&nbsp;$input[&quot;password&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_GRANT);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OAUTH2_GRANT_TYPE_ASSERTION:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;assertion_type&quot;]&nbsp;||&nbsp;!$input[&quot;assertion&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stored&nbsp;=&nbsp;$this-&gt;checkAssertion($client[0],&nbsp;$input[&quot;assertion_type&quot;],&nbsp;$input[&quot;assertion&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_GRANT);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OAUTH2_GRANT_TYPE_REFRESH_TOKEN:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;refresh_token&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;No&nbsp;&quot;refresh_token&quot;&nbsp;parameter&nbsp;found&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stored&nbsp;=&nbsp;$this-&gt;getRefreshToken($input[&quot;refresh_token&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored&nbsp;===&nbsp;NULL&nbsp;||&nbsp;$client[0]&nbsp;!=&nbsp;$stored[&quot;client_id&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_GRANT);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored[&quot;expires&quot;]&nbsp;&lt;&nbsp;time())\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_EXPIRED_TOKEN);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;store&nbsp;the&nbsp;refresh&nbsp;token&nbsp;locally&nbsp;so&nbsp;we&nbsp;can&nbsp;delete&nbsp;it&nbsp;when&nbsp;a&nbsp;new&nbsp;refresh&nbsp;token&nbsp;is&nbsp;generated\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;setVariable(&#39;_old_refresh_token&#39;,&nbsp;$stored[&quot;token&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OAUTH2_GRANT_TYPE_NONE:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stored&nbsp;=&nbsp;$this-&gt;checkNoneAccess($client[0]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($stored&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_REQUEST);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;scope,&nbsp;if&nbsp;provided\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($input[&quot;scope&quot;]&nbsp;&amp;&amp;&nbsp;(!is_array($stored)&nbsp;||&nbsp;!isset($stored[&quot;scope&quot;])&nbsp;||&nbsp;!$this-&gt;checkScope($input[&quot;scope&quot;],&nbsp;$stored[&quot;scope&quot;])))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_SCOPE);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;scope&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$input[&quot;scope&quot;]&nbsp;=&nbsp;NULL;\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;$this-&gt;createAccessToken($client[0],&nbsp;$input[&quot;scope&quot;],&nbsp;$stored[&quot;user_id&quot;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//TOKEN&nbsp;为&nbsp;数组&nbsp;(包括&nbsp;TOKEN&nbsp;值，&nbsp;有效时间，&nbsp;权限)\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$this-&gt;sendJsonHeaders();\r\n&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;json_encode($token);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Internal&nbsp;function&nbsp;used&nbsp;to&nbsp;get&nbsp;the&nbsp;client&nbsp;credentials&nbsp;from&nbsp;HTTP&nbsp;basic\r\n&nbsp;&nbsp;&nbsp;*&nbsp;auth&nbsp;or&nbsp;POST&nbsp;data.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;list&nbsp;containing&nbsp;the&nbsp;client&nbsp;identifier&nbsp;and&nbsp;password,&nbsp;for&nbsp;example\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;$_POST[&quot;client_id&quot;],\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;$_POST[&quot;client_secret&quot;],\r\n&nbsp;&nbsp;&nbsp;*&nbsp;);\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@endcode\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-2\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_2\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;getClientCredentials()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_SERVER[&quot;PHP_AUTH_USER&quot;])&nbsp;&amp;&amp;&nbsp;$_POST&nbsp;&amp;&amp;&nbsp;isset($_POST[&quot;client_id&quot;]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_CLIENT);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Try&nbsp;basic&nbsp;auth\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_SERVER[&quot;PHP_AUTH_USER&quot;]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array($_SERVER[&quot;PHP_AUTH_USER&quot;],&nbsp;$_SERVER[&quot;PHP_AUTH_PW&quot;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Try&nbsp;POST\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($_POST&nbsp;&amp;&amp;&nbsp;isset($_POST[&quot;client_id&quot;]))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_POST[&quot;client_secret&quot;]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array($_POST[&quot;client_id&quot;],&nbsp;$_POST[&quot;client_secret&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array($_POST[&quot;client_id&quot;],&nbsp;NULL);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;No&nbsp;credentials&nbsp;were&nbsp;specified\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_BAD_REQUEST,&nbsp;OAUTH2_ERROR_INVALID_CLIENT);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;End-user/client&nbsp;Authorization&nbsp;(Section&nbsp;3&nbsp;of&nbsp;IETF&nbsp;Draft).\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Pull&nbsp;the&nbsp;authorization&nbsp;request&nbsp;data&nbsp;out&nbsp;of&nbsp;the&nbsp;HTTP&nbsp;request.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;authorization&nbsp;parameters&nbsp;so&nbsp;the&nbsp;authorization&nbsp;server&nbsp;can&nbsp;prompt\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;the&nbsp;user&nbsp;for&nbsp;approval&nbsp;if&nbsp;valid.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;getAuthorizeParams()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$filters&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;client_id&quot;&nbsp;=&gt;&nbsp;array(&quot;filter&quot;&nbsp;=&gt;&nbsp;FILTER_VALIDATE_REGEXP,&nbsp;&quot;options&quot;&nbsp;=&gt;&nbsp;array(&quot;regexp&quot;&nbsp;=&gt;&nbsp;OAUTH2_CLIENT_ID_REGEXP),&nbsp;&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;response_type&quot;&nbsp;=&gt;&nbsp;array(&quot;filter&quot;&nbsp;=&gt;&nbsp;FILTER_VALIDATE_REGEXP,&nbsp;&quot;options&quot;&nbsp;=&gt;&nbsp;array(&quot;regexp&quot;&nbsp;=&gt;&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_REGEXP),&nbsp;&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;redirect_uri&quot;&nbsp;=&gt;&nbsp;array(&quot;filter&quot;&nbsp;=&gt;&nbsp;FILTER_SANITIZE_URL),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;state&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;scope&quot;&nbsp;=&gt;&nbsp;array(&quot;flags&quot;&nbsp;=&gt;&nbsp;FILTER_REQUIRE_SCALAR),\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;$input&nbsp;=&nbsp;filter_input_array(INPUT_GET,&nbsp;$filters);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Make&nbsp;sure&nbsp;a&nbsp;valid&nbsp;client&nbsp;id&nbsp;was&nbsp;supplied\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;client_id&quot;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($input[&quot;redirect_uri&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_INVALID_CLIENT,&nbsp;NULL,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_FOUND,&nbsp;OAUTH2_ERROR_INVALID_CLIENT);&nbsp;//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;good&nbsp;URI&nbsp;to&nbsp;use\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;redirect_uri&nbsp;is&nbsp;not&nbsp;required&nbsp;if&nbsp;already&nbsp;established&nbsp;via&nbsp;other&nbsp;channels\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;an&nbsp;existing&nbsp;redirect&nbsp;URI&nbsp;against&nbsp;the&nbsp;one&nbsp;supplied\r\n&nbsp;&nbsp;&nbsp;&nbsp;$redirect_uri&nbsp;=&nbsp;$this-&gt;getRedirectUri($input[&quot;client_id&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;At&nbsp;least&nbsp;one&nbsp;of:&nbsp;existing&nbsp;redirect&nbsp;URI&nbsp;or&nbsp;input&nbsp;redirect&nbsp;URI&nbsp;must&nbsp;be&nbsp;specified\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$redirect_uri&nbsp;&amp;&amp;&nbsp;!$input[&quot;redirect_uri&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorJsonResponse(OAUTH2_HTTP_FOUND,&nbsp;OAUTH2_ERROR_INVALID_REQUEST);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;getRedirectUri()&nbsp;should&nbsp;return&nbsp;FALSE&nbsp;if&nbsp;the&nbsp;given&nbsp;client&nbsp;ID&nbsp;is&nbsp;invalid\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;this&nbsp;probably&nbsp;saves&nbsp;us&nbsp;from&nbsp;making&nbsp;a&nbsp;separate&nbsp;db&nbsp;call,&nbsp;and&nbsp;simplifies&nbsp;the&nbsp;method&nbsp;set\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($redirect_uri&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_INVALID_CLIENT,&nbsp;NULL,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;If&nbsp;there&#39;s&nbsp;an&nbsp;existing&nbsp;uri&nbsp;and&nbsp;one&nbsp;from&nbsp;input,&nbsp;verify&nbsp;that&nbsp;they&nbsp;match\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($redirect_uri&nbsp;&amp;&amp;&nbsp;$input[&quot;redirect_uri&quot;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;that&nbsp;the&nbsp;input&nbsp;uri&nbsp;starts&nbsp;with&nbsp;the&nbsp;stored&nbsp;uri\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strcasecmp(substr($input[&quot;redirect_uri&quot;],&nbsp;0,&nbsp;strlen($redirect_uri)),&nbsp;$redirect_uri)&nbsp;!==&nbsp;0)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_REDIRECT_URI_MISMATCH,&nbsp;NULL,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;elseif&nbsp;($redirect_uri)&nbsp;{&nbsp;//&nbsp;They&nbsp;did&nbsp;not&nbsp;provide&nbsp;a&nbsp;uri&nbsp;from&nbsp;input,&nbsp;so&nbsp;use&nbsp;the&nbsp;stored&nbsp;one\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$input[&quot;redirect_uri&quot;]&nbsp;=&nbsp;$redirect_uri;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;type&nbsp;and&nbsp;client_id&nbsp;are&nbsp;required\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$input[&quot;response_type&quot;])\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_INVALID_REQUEST,&nbsp;&#39;Invalid&nbsp;response&nbsp;type.&#39;,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;requested&nbsp;auth&nbsp;response&nbsp;type&nbsp;against&nbsp;the&nbsp;list&nbsp;of&nbsp;supported&nbsp;types\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(array_search($input[&quot;response_type&quot;],&nbsp;$this-&gt;getSupportedAuthResponseTypes())&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_UNSUPPORTED_RESPONSE_TYPE,&nbsp;NULL,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Restrict&nbsp;clients&nbsp;to&nbsp;certain&nbsp;authorization&nbsp;response&nbsp;types\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;checkRestrictedAuthResponseType($input[&quot;client_id&quot;],&nbsp;$input[&quot;response_type&quot;])&nbsp;===&nbsp;FALSE)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_UNAUTHORIZED_CLIENT,&nbsp;NULL,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Validate&nbsp;that&nbsp;the&nbsp;requested&nbsp;scope&nbsp;is&nbsp;supported\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($input[&quot;scope&quot;]&nbsp;&amp;&amp;&nbsp;!$this-&gt;checkScope($input[&quot;scope&quot;],&nbsp;$this-&gt;getSupportedScopes()))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorDoRedirectUriCallback($input[&quot;redirect_uri&quot;],&nbsp;OAUTH2_ERROR_INVALID_SCOPE,&nbsp;NULL,&nbsp;NULL,&nbsp;$input[&quot;state&quot;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Redirect&nbsp;the&nbsp;user&nbsp;appropriately&nbsp;after&nbsp;approval.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;After&nbsp;the&nbsp;user&nbsp;has&nbsp;approved&nbsp;or&nbsp;denied&nbsp;the&nbsp;access&nbsp;request&nbsp;the\r\n&nbsp;&nbsp;&nbsp;*&nbsp;authorization&nbsp;server&nbsp;should&nbsp;call&nbsp;this&nbsp;function&nbsp;to&nbsp;redirect&nbsp;the&nbsp;user\r\n&nbsp;&nbsp;&nbsp;*&nbsp;appropriately.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$is_authorized\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;TRUE&nbsp;or&nbsp;FALSE&nbsp;depending&nbsp;on&nbsp;whether&nbsp;the&nbsp;user&nbsp;authorized&nbsp;the&nbsp;access.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$params\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;associative&nbsp;array&nbsp;as&nbsp;below:\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;response_type:&nbsp;The&nbsp;requested&nbsp;response:&nbsp;an&nbsp;access&nbsp;token,&nbsp;an\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authorization&nbsp;code,&nbsp;or&nbsp;both.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;client_id:&nbsp;The&nbsp;client&nbsp;identifier&nbsp;as&nbsp;described&nbsp;in&nbsp;Section&nbsp;2.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;redirect_uri:&nbsp;An&nbsp;absolute&nbsp;URI&nbsp;to&nbsp;which&nbsp;the&nbsp;authorization&nbsp;server\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;redirect&nbsp;the&nbsp;user-agent&nbsp;to&nbsp;when&nbsp;the&nbsp;end-user&nbsp;authorization\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;step&nbsp;is&nbsp;completed.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;scope:&nbsp;(optional)&nbsp;The&nbsp;scope&nbsp;of&nbsp;the&nbsp;access&nbsp;request&nbsp;expressed&nbsp;as&nbsp;a\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&nbsp;of&nbsp;space-delimited&nbsp;strings.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;state:&nbsp;(optional)&nbsp;An&nbsp;opaque&nbsp;value&nbsp;used&nbsp;by&nbsp;the&nbsp;client&nbsp;to&nbsp;maintain\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;between&nbsp;the&nbsp;request&nbsp;and&nbsp;callback.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;public&nbsp;function&nbsp;finishClientAuthorization($is_authorized,&nbsp;$params&nbsp;=&nbsp;array())&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;+=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&#39;scope&#39;&nbsp;=&gt;&nbsp;NULL,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;state&#39;&nbsp;=&gt;&nbsp;NULL,\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;extract($params);\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($state&nbsp;!==&nbsp;NULL)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;state&quot;]&nbsp;=&nbsp;$state;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($is_authorized&nbsp;===&nbsp;FALSE)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;error&quot;]&nbsp;=&nbsp;OAUTH2_ERROR_USER_DENIED;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($response_type&nbsp;==&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_AUTH_CODE&nbsp;||&nbsp;$response_type&nbsp;==&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_CODE_AND_TOKEN)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;code&quot;]&nbsp;=&nbsp;$this-&gt;createAuthCode($client_id,&nbsp;$redirect_uri,&nbsp;$user_id,&nbsp;$scope);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($response_type&nbsp;==&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_ACCESS_TOKEN&nbsp;||&nbsp;$response_type&nbsp;==&nbsp;OAUTH2_AUTH_RESPONSE_TYPE_CODE_AND_TOKEN)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;fragment&quot;]&nbsp;=&nbsp;$this-&gt;createAccessToken($client_id,&nbsp;$scope,&nbsp;$user_id);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$result[&#39;display&#39;]&nbsp;=&nbsp;!empty($display)&nbsp;?&nbsp;$display&nbsp;:&nbsp;&#39;&#39;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;doRedirectUriCallback($redirect_uri,&nbsp;$result);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;Other/utility&nbsp;functions.\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Redirect&nbsp;the&nbsp;user&nbsp;agent.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Handle&nbsp;both&nbsp;redirect&nbsp;for&nbsp;success&nbsp;or&nbsp;error&nbsp;response.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$redirect_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;absolute&nbsp;URI&nbsp;to&nbsp;which&nbsp;the&nbsp;authorization&nbsp;server&nbsp;will&nbsp;redirect\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;the&nbsp;user-agent&nbsp;to&nbsp;when&nbsp;the&nbsp;end-user&nbsp;authorization&nbsp;step&nbsp;is&nbsp;completed.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$params\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Parameters&nbsp;to&nbsp;be&nbsp;pass&nbsp;though&nbsp;buildUri().\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;doRedirectUriCallback($redirect_uri,&nbsp;$params)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;HTTP/1.1&nbsp;&quot;.&nbsp;OAUTH2_HTTP_FOUND);\r\n&nbsp;&nbsp;&nbsp;&nbsp;if($params[&#39;display&#39;]&nbsp;==&nbsp;&#39;frame&#39;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;&lt;script&gt;window.top.location.href=&quot;&#39;.$this-&gt;buildUri($redirect_uri,&nbsp;$params).&#39;&quot;;&lt;/script&gt;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Location:&nbsp;&quot;&nbsp;.&nbsp;$this-&gt;buildUri($redirect_uri,&nbsp;$params));\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;exit;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Build&nbsp;the&nbsp;absolute&nbsp;URI&nbsp;based&nbsp;on&nbsp;supplied&nbsp;URI&nbsp;and&nbsp;parameters.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;absolute&nbsp;URI.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$params\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Parameters&nbsp;to&nbsp;be&nbsp;append&nbsp;as&nbsp;GET.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;absolute&nbsp;URI&nbsp;with&nbsp;supplied&nbsp;parameters.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;buildUri($uri,&nbsp;$params)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;session_start();\r\n&nbsp;&nbsp;&nbsp;&nbsp;$parse_url&nbsp;=&nbsp;parse_url($uri);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Add&nbsp;our&nbsp;params&nbsp;to&nbsp;the&nbsp;parsed&nbsp;uri\r\n&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($params&nbsp;as&nbsp;$k&nbsp;=&gt;&nbsp;$v)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($parse_url[$k]))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parse_url[$k]&nbsp;.=&nbsp;&quot;&amp;&quot;&nbsp;.&nbsp;http_build_query($v);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parse_url[$k]&nbsp;=&nbsp;http_build_query($v);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Put&nbsp;humpty&nbsp;dumpty&nbsp;back&nbsp;together\r\n&nbsp;&nbsp;&nbsp;&nbsp;$return&nbsp;=\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((isset($parse_url[&quot;scheme&quot;]))&nbsp;?&nbsp;$parse_url[&quot;scheme&quot;]&nbsp;.&nbsp;&quot;://&quot;&nbsp;:&nbsp;&quot;&quot;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;((isset($parse_url[&quot;user&quot;]))&nbsp;?&nbsp;$parse_url[&quot;user&quot;]&nbsp;.&nbsp;((isset($parse_url[&quot;pass&quot;]))&nbsp;?&nbsp;&quot;:&quot;&nbsp;.&nbsp;$parse_url[&quot;pass&quot;]&nbsp;:&nbsp;&quot;&quot;)&nbsp;.&nbsp;&quot;@&quot;&nbsp;:&nbsp;&quot;&quot;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;((isset($parse_url[&quot;host&quot;]))&nbsp;?&nbsp;$parse_url[&quot;host&quot;]&nbsp;:&nbsp;&quot;&quot;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;((isset($parse_url[&quot;port&quot;]))&nbsp;?&nbsp;&quot;:&quot;&nbsp;.&nbsp;$parse_url[&quot;port&quot;]&nbsp;:&nbsp;&quot;&quot;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;((isset($parse_url[&quot;path&quot;]))&nbsp;?&nbsp;$parse_url[&quot;path&quot;]&nbsp;:&nbsp;&quot;&quot;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;((isset($parse_url[&quot;query&quot;]))&nbsp;?&nbsp;&quot;?&quot;&nbsp;.&nbsp;$parse_url[&quot;query&quot;]&nbsp;:&nbsp;&quot;&quot;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;((isset($parse_url[&quot;fragment&quot;]))&nbsp;?&nbsp;&quot;#&quot;&nbsp;.&nbsp;$parse_url[&quot;fragment&quot;]&nbsp;:&nbsp;&quot;&quot;)&nbsp;.&nbsp;&quot;&amp;ssid=&quot;.base64_encode(&#39;2egc83&#39;.session_id());\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$return;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Handle&nbsp;the&nbsp;creation&nbsp;of&nbsp;access&nbsp;token,&nbsp;also&nbsp;issue&nbsp;refresh&nbsp;token&nbsp;if&nbsp;support.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;belongs&nbsp;in&nbsp;a&nbsp;separate&nbsp;factory,&nbsp;but&nbsp;to&nbsp;keep&nbsp;it&nbsp;simple,&nbsp;I&#39;m&nbsp;just\r\n&nbsp;&nbsp;&nbsp;*&nbsp;keeping&nbsp;it&nbsp;here.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;related&nbsp;to&nbsp;the&nbsp;access&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;Scopes&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;createAccessToken($client_id,&nbsp;$scope&nbsp;=&nbsp;NULL,&nbsp;$user_id&nbsp;=&nbsp;10)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;access_token&quot;&nbsp;=&gt;&nbsp;$this-&gt;genAccessToken(),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;expires_in&quot;&nbsp;=&gt;&nbsp;$this-&gt;getVariable(&#39;access_token_lifetime&#39;,&nbsp;OAUTH2_DEFAULT_ACCESS_TOKEN_LIFETIME),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;user_id&quot;&nbsp;=&gt;&nbsp;$user_id,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;scope&quot;&nbsp;=&gt;&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;$refresh_token&nbsp;=&nbsp;&#39;&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Issue&nbsp;a&nbsp;refresh&nbsp;token&nbsp;also,&nbsp;if&nbsp;we&nbsp;support&nbsp;them\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(in_array(OAUTH2_GRANT_TYPE_REFRESH_TOKEN,&nbsp;$this-&gt;getSupportedGrantTypes()))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$refresh_token&nbsp;=&nbsp;$this-&gt;genAccessToken();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$this-&gt;setRefreshToken($token[&quot;refresh_token&quot;],&nbsp;$client_id,&nbsp;time()&nbsp;+&nbsp;$this-&gt;getVariable(&#39;refresh_token_lifetime&#39;,&nbsp;OAUTH2_DEFAULT_REFRESH_TOKEN_LIFETIME),&nbsp;$user_id,&nbsp;$scope);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token[&quot;refresh_token&quot;]&nbsp;=&nbsp;$refresh_token;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;If&nbsp;we&#39;ve&nbsp;granted&nbsp;a&nbsp;new&nbsp;refresh&nbsp;token,&nbsp;expire&nbsp;the&nbsp;old&nbsp;one\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;_old_refresh_token&#39;))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;unsetRefreshToken($this-&gt;getVariable(&#39;_old_refresh_token&#39;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;$access_token&nbsp;=&nbsp;$token[&#39;access_token&#39;];\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;setAccessToken($access_token,&nbsp;$client_id,&nbsp;time()&nbsp;+&nbsp;$this-&gt;getVariable(&#39;access_token_lifetime&#39;,&nbsp;OAUTH2_DEFAULT_ACCESS_TOKEN_LIFETIME),&nbsp;$token[&#39;user_id&#39;],&nbsp;$scope,&nbsp;$refresh_token);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$token;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Handle&nbsp;the&nbsp;creation&nbsp;of&nbsp;auth&nbsp;code.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;belongs&nbsp;in&nbsp;a&nbsp;separate&nbsp;factory,&nbsp;but&nbsp;to&nbsp;keep&nbsp;it&nbsp;simple,&nbsp;I&#39;m&nbsp;just\r\n&nbsp;&nbsp;&nbsp;*&nbsp;keeping&nbsp;it&nbsp;here.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Client&nbsp;identifier&nbsp;related&nbsp;to&nbsp;the&nbsp;access&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$redirect_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;absolute&nbsp;URI&nbsp;to&nbsp;which&nbsp;the&nbsp;authorization&nbsp;server&nbsp;will&nbsp;redirect&nbsp;the\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;user-agent&nbsp;to&nbsp;when&nbsp;the&nbsp;end-user&nbsp;authorization&nbsp;step&nbsp;is&nbsp;completed.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;Scopes&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;space-separated&nbsp;string.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;createAuthCode($client_id,&nbsp;$redirect_uri,&nbsp;$userId,&nbsp;$scope&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$code&nbsp;=&nbsp;$this-&gt;genAuthCode();\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;setAuthCode($code,&nbsp;$client_id,&nbsp;$redirect_uri,&nbsp;time()&nbsp;+&nbsp;$this-&gt;getVariable(&#39;auth_code_lifetime&#39;,&nbsp;OAUTH2_DEFAULT_AUTH_CODE_LIFETIME),&nbsp;$userId,&nbsp;$scope);\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$code;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Generate&nbsp;unique&nbsp;access&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Implementing&nbsp;classes&nbsp;may&nbsp;want&nbsp;to&nbsp;override&nbsp;these&nbsp;function&nbsp;to&nbsp;implement\r\n&nbsp;&nbsp;&nbsp;*&nbsp;other&nbsp;access&nbsp;token&nbsp;or&nbsp;auth&nbsp;code&nbsp;generation&nbsp;schemes.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;unique&nbsp;access&nbsp;token.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;genAccessToken()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;md5(base64_encode(pack(&#39;N6&#39;,&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;uniqid())));\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Generate&nbsp;unique&nbsp;auth&nbsp;code.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Implementing&nbsp;classes&nbsp;may&nbsp;want&nbsp;to&nbsp;override&nbsp;these&nbsp;function&nbsp;to&nbsp;implement\r\n&nbsp;&nbsp;&nbsp;*&nbsp;other&nbsp;access&nbsp;token&nbsp;or&nbsp;auth&nbsp;code&nbsp;generation&nbsp;schemes.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;unique&nbsp;auth&nbsp;code.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_3\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;genAuthCode()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;md5(base64_encode(pack(&#39;N6&#39;,&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;mt_rand(),&nbsp;uniqid())));\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Pull&nbsp;out&nbsp;the&nbsp;Authorization&nbsp;HTTP&nbsp;header&nbsp;and&nbsp;return&nbsp;it.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Implementing&nbsp;classes&nbsp;may&nbsp;need&nbsp;to&nbsp;override&nbsp;this&nbsp;function&nbsp;for&nbsp;use&nbsp;on\r\n&nbsp;&nbsp;&nbsp;*&nbsp;non-Apache&nbsp;web&nbsp;servers.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@return\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;Authorization&nbsp;HTTP&nbsp;header,&nbsp;and&nbsp;FALSE&nbsp;if&nbsp;does&nbsp;not&nbsp;exist.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@todo&nbsp;Handle&nbsp;Authorization&nbsp;HTTP&nbsp;header&nbsp;for&nbsp;non-Apache&nbsp;web&nbsp;servers.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_5\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;getAuthorizationHeader()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(array_key_exists(&quot;HTTP_AUTHORIZATION&quot;,&nbsp;$_SERVER))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$_SERVER[&quot;HTTP_AUTHORIZATION&quot;];\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(function_exists(&quot;apache_request_headers&quot;))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;=&nbsp;apache_request_headers();\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(array_key_exists(&quot;Authorization&quot;,&nbsp;$headers))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$headers[&quot;Authorization&quot;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Send&nbsp;out&nbsp;HTTP&nbsp;headers&nbsp;for&nbsp;JSON.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.2\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_section_4\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;sendJsonHeaders()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Content-Type:&nbsp;application/json&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Cache-Control:&nbsp;no-store&quot;);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Redirect&nbsp;the&nbsp;end-user&#39;s&nbsp;user&nbsp;agent&nbsp;with&nbsp;error&nbsp;message.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$redirect_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;An&nbsp;absolute&nbsp;URI&nbsp;to&nbsp;which&nbsp;the&nbsp;authorization&nbsp;server&nbsp;will&nbsp;redirect&nbsp;the\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;user-agent&nbsp;to&nbsp;when&nbsp;the&nbsp;end-user&nbsp;authorization&nbsp;step&nbsp;is&nbsp;completed.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;single&nbsp;error&nbsp;code&nbsp;as&nbsp;described&nbsp;in&nbsp;Section&nbsp;3.2.1.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error_description\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;A&nbsp;human-readable&nbsp;text&nbsp;providing&nbsp;additional&nbsp;information,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;used&nbsp;to&nbsp;assist&nbsp;in&nbsp;the&nbsp;understanding&nbsp;and&nbsp;resolution&nbsp;of&nbsp;the&nbsp;error\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;occurred.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;A&nbsp;URI&nbsp;identifying&nbsp;a&nbsp;human-readable&nbsp;web&nbsp;page&nbsp;with\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;information&nbsp;about&nbsp;the&nbsp;error,&nbsp;used&nbsp;to&nbsp;provide&nbsp;the&nbsp;end-user&nbsp;with\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;additional&nbsp;information&nbsp;about&nbsp;the&nbsp;error.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$state\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;REQUIRED&nbsp;if&nbsp;the&nbsp;&quot;state&quot;&nbsp;parameter&nbsp;was&nbsp;present&nbsp;in&nbsp;the&nbsp;client\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;authorization&nbsp;request.&nbsp;Set&nbsp;to&nbsp;the&nbsp;exact&nbsp;value&nbsp;received&nbsp;from&nbsp;the&nbsp;client.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-3.2\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_error\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;errorDoRedirectUriCallback($redirect_uri,&nbsp;$error,&nbsp;$error_description&nbsp;=&nbsp;NULL,&nbsp;$error_uri&nbsp;=&nbsp;NULL,&nbsp;$state&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;error&quot;]&nbsp;=&nbsp;$error;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($state)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;state&quot;]&nbsp;=&nbsp;$state;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;display_error&#39;)&nbsp;&amp;&amp;&nbsp;$error_description)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;error_description&quot;]&nbsp;=&nbsp;$error_description;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;display_error&#39;)&nbsp;&amp;&amp;&nbsp;$error_uri)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;query&quot;][&quot;error_uri&quot;]&nbsp;=&nbsp;$error_uri;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;doRedirectUriCallback($redirect_uri,&nbsp;$result);\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Send&nbsp;out&nbsp;error&nbsp;message&nbsp;in&nbsp;JSON.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$http_status_code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;message&nbsp;as&nbsp;predefined.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;single&nbsp;error&nbsp;code.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error_description\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;A&nbsp;human-readable&nbsp;text&nbsp;providing&nbsp;additional&nbsp;information,\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;used&nbsp;to&nbsp;assist&nbsp;in&nbsp;the&nbsp;understanding&nbsp;and&nbsp;resolution&nbsp;of&nbsp;the&nbsp;error\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;occurred.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;A&nbsp;URI&nbsp;identifying&nbsp;a&nbsp;human-readable&nbsp;web&nbsp;page&nbsp;with\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;information&nbsp;about&nbsp;the&nbsp;error,&nbsp;used&nbsp;to&nbsp;provide&nbsp;the&nbsp;end-user&nbsp;with\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;additional&nbsp;information&nbsp;about&nbsp;the&nbsp;error.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-4.3\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_error\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;errorJsonResponse($http_status_code,&nbsp;$error,&nbsp;$error_description&nbsp;=&nbsp;NULL,&nbsp;$error_uri&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;$result[&#39;error&#39;]&nbsp;=&nbsp;$error;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;display_error&#39;)&nbsp;&amp;&amp;&nbsp;$error_description)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;error_description&quot;]&nbsp;=&nbsp;$error_description;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;display_error&#39;)&nbsp;&amp;&amp;&nbsp;$error_uri)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result[&quot;error_uri&quot;]&nbsp;=&nbsp;$error_uri;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;HTTP/1.1&nbsp;&quot;&nbsp;.&nbsp;$http_status_code);\r\n&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;sendJsonHeaders();\r\n&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;json_encode($result);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;exit;\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Send&nbsp;a&nbsp;401&nbsp;unauthorized&nbsp;header&nbsp;with&nbsp;the&nbsp;given&nbsp;realm&nbsp;and&nbsp;an&nbsp;error,&nbsp;if\r\n&nbsp;&nbsp;&nbsp;*&nbsp;provided.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$http_status_code\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;message&nbsp;as&nbsp;predefined.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$realm\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;&quot;realm&quot;&nbsp;attribute&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;the&nbsp;protected&nbsp;resources\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;partition&nbsp;as&nbsp;defined&nbsp;by&nbsp;[RFC2617].\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;A&nbsp;space-delimited&nbsp;list&nbsp;of&nbsp;scope&nbsp;values&nbsp;indicating&nbsp;the&nbsp;required&nbsp;scope\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;access&nbsp;token&nbsp;for&nbsp;accessing&nbsp;the&nbsp;requested&nbsp;resource.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;The&nbsp;&quot;error&quot;&nbsp;attribute&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;the&nbsp;client&nbsp;with&nbsp;the&nbsp;reason\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;why&nbsp;the&nbsp;access&nbsp;request&nbsp;was&nbsp;declined.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error_description\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;The&nbsp;&quot;error_description&quot;&nbsp;attribute&nbsp;provides&nbsp;a&nbsp;human-readable&nbsp;text\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;containing&nbsp;additional&nbsp;information,&nbsp;used&nbsp;to&nbsp;assist&nbsp;in&nbsp;the&nbsp;understanding\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;and&nbsp;resolution&nbsp;of&nbsp;the&nbsp;error&nbsp;occurred.\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$error_uri\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;(optional)&nbsp;The&nbsp;&quot;error_uri&quot;&nbsp;attribute&nbsp;provides&nbsp;a&nbsp;URI&nbsp;identifying&nbsp;a&nbsp;human-readable\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;web&nbsp;page&nbsp;with&nbsp;information&nbsp;about&nbsp;the&nbsp;error,&nbsp;used&nbsp;to&nbsp;offer&nbsp;the&nbsp;end-user\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;with&nbsp;additional&nbsp;information&nbsp;about&nbsp;the&nbsp;error.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;an\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;absolute&nbsp;URI,&nbsp;it&nbsp;is&nbsp;relative&nbsp;to&nbsp;the&nbsp;URI&nbsp;of&nbsp;the&nbsp;requested&nbsp;protected\r\n&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;resource.\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.2\r\n&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@ingroup&nbsp;oauth2_error\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;private&nbsp;function&nbsp;errorWWWAuthenticateResponseHeader($http_status_code,&nbsp;$realm,&nbsp;$error,&nbsp;$error_description&nbsp;=&nbsp;NULL,&nbsp;$error_uri&nbsp;=&nbsp;NULL,&nbsp;$scope&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$realm&nbsp;=&nbsp;$realm&nbsp;===&nbsp;NULL&nbsp;?&nbsp;$this-&gt;getDefaultAuthenticationRealm()&nbsp;:&nbsp;$realm;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;&quot;WWW-Authenticate:&nbsp;OAuth&nbsp;realm=&#39;&quot;&nbsp;.&nbsp;$realm&nbsp;.&nbsp;&quot;&#39;&quot;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($error)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;.=&nbsp;&quot;,&nbsp;error=&#39;&quot;&nbsp;.&nbsp;$error&nbsp;.&nbsp;&quot;&#39;&quot;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;display_error&#39;)&nbsp;&amp;&amp;&nbsp;$error_description)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;.=&nbsp;&quot;,&nbsp;error_description=&#39;&quot;&nbsp;.&nbsp;$error_description&nbsp;.&nbsp;&quot;&#39;&quot;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;getVariable(&#39;display_error&#39;)&nbsp;&amp;&amp;&nbsp;$error_uri)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;.=&nbsp;&quot;,&nbsp;error_uri=&#39;&quot;&nbsp;.&nbsp;$error_uri&nbsp;.&nbsp;&quot;&#39;&quot;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($scope)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;.=&nbsp;&quot;,&nbsp;scope=&#39;&quot;&nbsp;.&nbsp;$scope&nbsp;.&nbsp;&quot;&#39;&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;HTTP/1.1&nbsp;&quot;.&nbsp;$http_status_code);\r\n&nbsp;&nbsp;&nbsp;&nbsp;header($result);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;exit;\r\n&nbsp;&nbsp;}\r\n}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;代码比较多。有兴趣的可以细看。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于采用Vendor方法引入，所以这里的文件都没有采用命名空间。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-3、在同目录下，建ThinkOAuth2.php文件，这个文件里的类继承上面那个基类：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?phprequire&nbsp;&quot;oauth2.class.php&quot;;class&nbsp;ThinkOAuth2&nbsp;extends&nbsp;OAuth2{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;$db;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;$table;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;构造\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;__construct()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent::__construct();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;=&nbsp;M();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;table&nbsp;=&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;auth_codes&#39;=&gt;C(&#39;OAUTH2_CODES_TABLE&#39;),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;clients&#39;=&gt;C(&#39;OAUTH2_CLIENTS_TABLE&#39;),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tokens&#39;=&gt;C(&#39;OAUTH2_TOKEN_TABLE&#39;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;析构\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;__destruct()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;db&nbsp;=&nbsp;NULL;&nbsp;//&nbsp;Release&nbsp;db&nbsp;connection&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;handleException($e)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;Database&nbsp;error:&nbsp;&quot;&nbsp;.&nbsp;$e-&gt;getMessage();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;增加client\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$client_id\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$client_secret\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$redirect_uri\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;addClient($client_id,&nbsp;$client_secret,&nbsp;$redirect_uri)&nbsp;{&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$time&nbsp;=&nbsp;time();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;clients&#39;]}&nbsp;(client_id,&nbsp;client_secret,&nbsp;redirect_uri,create_time)&nbsp;VALUES&nbsp;(&#39;{$client_id}&#39;,&nbsp;&#39;{$client_secret}&#39;,&nbsp;&#39;{$redirect_uri}&#39;,&#39;{$time}&#39;)&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;execute($sql);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;res;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Implements&nbsp;OAuth2::checkClientCredentials()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::checkClientCredentials()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;checkClientCredentials($client_id,&nbsp;$client_secret&nbsp;=&nbsp;NULL)&nbsp;{&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;SELECT&nbsp;client_secret&nbsp;FROM&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;clients&#39;]}&nbsp;WHERE&nbsp;client_id&nbsp;=&nbsp;{$client_id}&quot;;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;query($sql);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($client_secret&nbsp;===&nbsp;NULL)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result&nbsp;!==&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;checkClientCredentials&nbsp;:&nbsp;&quot;.$result);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;checkClientCredentials&nbsp;:&nbsp;&quot;.$result[0]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;checkClientCredentials&nbsp;:&nbsp;&quot;.$result[0][&quot;client_secret&quot;]);&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result[0][&quot;client_secret&quot;]&nbsp;==&nbsp;$client_secret;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Implements&nbsp;OAuth2::getRedirectUri().\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::getRedirectUri()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;getRedirectUri($client_id)&nbsp;{\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;SELECT&nbsp;redirect_uri&nbsp;FROM&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;clients&#39;]}&nbsp;WHERE&nbsp;client_id&nbsp;=&nbsp;{$client_id}&quot;;\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;query($sql);\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($result&nbsp;===&nbsp;FALSE)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getRedirectUri&nbsp;:&nbsp;&quot;.$result);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getRedirectUri&nbsp;:&nbsp;&quot;.$result[0]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getRedirectUri&nbsp;:&nbsp;&quot;.$result[0][&quot;redirect_uri&quot;]);\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isset($result[0][&quot;redirect_uri&quot;])&nbsp;&amp;&amp;&nbsp;$result[0][&quot;redirect_uri&quot;]&nbsp;?&nbsp;$result[0][&quot;redirect_uri&quot;]&nbsp;:&nbsp;NULL;\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Implements&nbsp;OAuth2::getAccessToken().\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::getAccessToken()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;getAccessToken($access_token)&nbsp;{\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;SELECT&nbsp;client_id,&nbsp;expires_in,&nbsp;scope&nbsp;FROM&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;tokens&#39;]}&nbsp;WHERE&nbsp;access_token&nbsp;=&nbsp;&#39;{$access_token}&#39;&quot;;\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;query($sql);\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getAccessToken&nbsp;:&nbsp;&quot;.$result);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getAccessToken&nbsp;:&nbsp;&quot;.$result[0]);\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result&nbsp;!==&nbsp;FALSE&nbsp;?&nbsp;$result&nbsp;:&nbsp;NULL;\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Implements&nbsp;OAuth2::setAccessToken().\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::setAccessToken()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;setAccessToken($access_token,&nbsp;$client_id,&nbsp;$expires,&nbsp;$user_id,&nbsp;$scope=NULL,&nbsp;$refresh_token=&#39;&#39;)&nbsp;{\r\n&nbsp;\r\n$sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;tokens&#39;]}&nbsp;(access_token,&nbsp;client_id,&nbsp;expires_in,&nbsp;scope,user_id,refresh_token)&nbsp;VALUES&nbsp;(&#39;{$access_token}&#39;,&nbsp;&#39;{$client_id}&#39;,&nbsp;&#39;{$expires}&#39;,&nbsp;&#39;{$scope}&#39;,{$user_id},&#39;{$refresh_token}&#39;)&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;execute($sql);\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Overrides&nbsp;OAuth2::getSupportedGrantTypes().\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::getSupportedGrantTypes()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;getSupportedGrantTypes()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OAUTH2_GRANT_TYPE_AUTH_CODE\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Overrides&nbsp;OAuth2::getAuthCode().\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::getAuthCode()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;getAuthCode($code)&nbsp;{\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;SELECT&nbsp;user_id,&nbsp;code,&nbsp;client_id,&nbsp;redirect_uri,&nbsp;expires,&nbsp;scope&nbsp;FROM&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;auth_codes&#39;]}&nbsp;WHERE&nbsp;code&nbsp;=&nbsp;&#39;{$code}&#39;&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;query($sql);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getAuthcode&nbsp;:&nbsp;&quot;.$result);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getAuthcode&nbsp;:&nbsp;&quot;.$result[0]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Log::write(&quot;getAuthcode&nbsp;:&nbsp;&quot;.$result[0][&quot;code&quot;]);\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$result&nbsp;!==&nbsp;FALSE&nbsp;?&nbsp;$result[0]&nbsp;:&nbsp;NULL;\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Overrides&nbsp;OAuth2::setAuthCode().\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::setAuthCode()\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;setAuthCode($code,&nbsp;$client_id,&nbsp;$redirect_uri,&nbsp;$expires,&nbsp;$scope&nbsp;=&nbsp;NULL)&nbsp;{\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$time&nbsp;=&nbsp;time();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;{$this&nbsp;-&gt;&nbsp;table[&#39;auth_codes&#39;]}&nbsp;(code,&nbsp;client_id,&nbsp;redirect_uri,&nbsp;expires,&nbsp;scope)&nbsp;VALUES&nbsp;(&#39;{$code}&#39;,&nbsp;&#39;{$client_id}&#39;,&nbsp;&#39;{$redirect_uri}&#39;,&nbsp;&#39;{$expires}&#39;,&nbsp;&#39;{$scope}&#39;)&quot;;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;db&nbsp;-&gt;&nbsp;execute($sql);\r\n&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;*&nbsp;Overrides&nbsp;OAuth2::checkUserCredentials().\r\n&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;OAuth2::checkUserCredentials()\r\n&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;protected&nbsp;function&nbsp;checkUserCredentials($client_id,&nbsp;$username,&nbsp;$password){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;\r\n&nbsp;&nbsp;}\r\n&nbsp;&nbsp;\r\n\r\n}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">这里涉及到一些数据库的操作。继承出来操作，还是比较一目了然的。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-4、准备好类了。我们就可以实现控制器里的功能代码。动手之前先搞清楚我们的意图。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;首先，我们需要分配一个oauth_client和一个oauth_secrete给第三方网站（也就是client.ruanwenwu.cn)来获取oauth服务。 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其次，client.ruanwenwu.cn会把用户导入到server.ruanwenwu.cn来进行授权。所以我们我们还需要准备授权页面。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为涉及到服务端和客户端的数据交互，所以可能服务端和客户端的相关介绍我会交叉进行。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-4-1、创建oauth_client。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-4-2、获取oauth_cliest列表。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-4-3、准备获取用户授权的页面和逻辑。（授权服务器）</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-4-4、准备提供用户数据的逻辑。（资源服务器）</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这些逻辑我都写在一个控制器OauthController.class.php里。代码如下：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?phpnamespace&nbsp;Home\\Controller;use&nbsp;Think\\Controller;class&nbsp;OauthController&nbsp;extends&nbsp;Controller{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;$oauth&nbsp;=&nbsp;NULL;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;_initialize(){&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Content-Type:&nbsp;application/json&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vendor(&quot;oauth.ThinkOAuth2&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;=&nbsp;new&nbsp;\\ThinkOAuth2();&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;index(){&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Content-Type:application/json;&nbsp;charset=utf-8&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;ajaxReturn(null,&nbsp;&#39;oauth-server-start&#39;,&nbsp;1,&nbsp;&#39;json&#39;);&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;access_token()&nbsp;{&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;grantAccessToken();&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//权限验证&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;authorize()&nbsp;{&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(IS_POST)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(true){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//这个地方验证成功后要把用户的uid加进来&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_POST[&#39;user_id&#39;]&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;finishClientAuthorization(true,&nbsp;$_POST);&nbsp;&nbsp;&nbsp;&nbsp;//第一个参数很重要，是用户是否授权&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;///表单准备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$auth_params&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;getAuthorizeParams();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assign(&quot;auth_params&quot;,$auth_params);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;display();&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;addclient()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;jack&#39;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(IS_POST)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;pd&#39;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;addClient($_POST[&quot;client_id&quot;],&nbsp;$_POST[&quot;client_secret&quot;],&nbsp;$_POST[&quot;redirect_uri&quot;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($res){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;redirect(&quot;/home/Oauth/clientlist&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;display();\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;clientlist(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res&nbsp;=&nbsp;M()-&gt;table(&quot;oauth_client&quot;)-&gt;select();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assign(&quot;clients&quot;,$res);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_dump($res);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;display();\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">顺便我将用到的模板文件（server.ruanwenwu.cn\\Application\\Home\\View\\oauth目录下）也贴出来给大家参考一下：</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">addclient.html</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;!doctype&nbsp;html&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset=&quot;utf-8&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;这里是添加客户端界面&lt;/title&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;添加客户端&lt;/h1&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;action=&quot;&quot;&nbsp;method=&quot;post&quot;&nbsp;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientId:&lt;input&nbsp;type=&quot;text&quot;&nbsp;name=&quot;client_id&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;/&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client_secrete:&lt;input&nbsp;type=&quot;text&quot;&nbsp;name=&quot;client_secret&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;/&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackUrl:&lt;input&nbsp;type=&quot;text&quot;&nbsp;name=&quot;redirect_uri&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;submit&quot;&nbsp;value=&quot;submit&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;&lt;/html&gt;</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">authorize.html</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;!doctype&nbsp;html&gt;&lt;html&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;action=&quot;&quot;&nbsp;method=&quot;post&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用户名：&lt;input&nbsp;type=&quot;text&quot;&nbsp;name=&quot;username&quot;&nbsp;/&gt;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;/&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;密码：&lt;input&nbsp;type=&quot;text&quot;&nbsp;name=&quot;pwd&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;response_type&quot;&nbsp;value=&quot;code&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;client_id&quot;&nbsp;value=&quot;{$auth_params[&#39;client_id&#39;]}&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;redirect_uri&quot;&nbsp;value=&quot;{$auth_params[&#39;redirect_uri&#39;]}&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;submit&quot;&nbsp;value=&quot;submit&quot;&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;&lt;/html&gt;</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">注意：我这里用到了几个隐藏域。这个是必须的，在post提交验证时会用到。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-4-5、创建oauth2.0用户。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;打 开server.ruanwenwu.cn/index.php/home/oauth/addcient,输入client_id和 client_secrete还有redirect_uri创建一个oauth2.0用户。其中redirect_uri是用户授权后需要跳转的地方。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">到这里服务端的部署就差不多结束了。现在开始部署客户端。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\"><strong>三、oauth2.0客户端搭建。</strong></p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;1、同服务端一样搭建client.ruanwenwu.cn。（也是用thinkphp)。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;2、能正常访问后。在类库中加入oauth2.0客户端类。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在\\client.ruanwenwu.cn\\ThinkPHP\\Library\\Org\\Util目录下建立Oauth2.class.php，代码如下：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?phpnamespace&nbsp;Org\\Util;/**\r\n&nbsp;*&nbsp;与&nbsp;OAuth2&nbsp;服务器&nbsp;通讯验证&nbsp;核心类&nbsp;(PHP版)\r\n&nbsp;*&nbsp;\r\n&nbsp;*&nbsp;@description&nbsp;OAuth2&nbsp;说明请大家参考&nbsp;木蚂蚁接口文档\r\n&nbsp;*\r\n&nbsp;*\r\n&nbsp;*&nbsp;@author&nbsp;&nbsp;&nbsp;Mumayi-Team&nbsp;(zhaopan赵攀)\r\n&nbsp;*&nbsp;@version&nbsp;&nbsp;1.0\r\n&nbsp;*&nbsp;@datetime&nbsp;2013-12-31\r\n&nbsp;*/class&nbsp;Oauth2{&nbsp;&nbsp;&nbsp;&nbsp;/*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;以下几个参数&nbsp;具体作用和用法&nbsp;详见&nbsp;木蚂蚁接口文档\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//分配的客户端&nbsp;ID&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$client_id;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//分配的客户端&nbsp;密匙&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$client_secret;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//获得的&nbsp;用户授权&nbsp;访问令牌&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$access_token;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//刷新&nbsp;访问令牌&nbsp;(过期时使用)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$refresh_token;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;最后一个收到的HTTP代码&nbsp;(用于调试，忽略)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$http_code;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//预留字段&nbsp;(忽略)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$url;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//设置&nbsp;基础链接&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$host&nbsp;=&nbsp;&quot;http://server.ruanwenwu.cn/index.php/home/oauth/&quot;;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//请求超时时间&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$timeout&nbsp;=&nbsp;30;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//链接超时时间&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$connecttimeout&nbsp;=&nbsp;30;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//是否验证&nbsp;SSL&nbsp;证书&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$ssl_verifypeer&nbsp;=&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//请求结果处理格式&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$format&nbsp;=&nbsp;&#39;json&#39;;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//以&nbsp;JSON_DECODE&nbsp;方式解析&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$decode_json&nbsp;=&nbsp;TRUE;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//预留字段&nbsp;(忽略)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$http_info;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//CURL&nbsp;函数使用&nbsp;(验证使用，&nbsp;忽略)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$useragent&nbsp;=&nbsp;&#39;Mumayi&nbsp;Team&nbsp;OAuth2&nbsp;v1.0&#39;;&nbsp;&nbsp;&nbsp;&nbsp;//是否&nbsp;开启&nbsp;请求调试&nbsp;(开启时&nbsp;将输出&nbsp;详细的请求结果)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;$debug&nbsp;=&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;//边界&nbsp;(CURL使用&nbsp;写入在Header的分界线,&nbsp;忽略)&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;$boundary&nbsp;=&nbsp;&#39;&#39;;&nbsp;&nbsp;&nbsp;&nbsp;//返回&nbsp;OAuth&nbsp;令牌&nbsp;请求地址&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;accessTokenURL()&nbsp;&nbsp;{&nbsp;return&nbsp;$this-&gt;host.&#39;access_token&#39;;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;//返回&nbsp;OAuth&nbsp;自动授权&nbsp;请求地址&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;authorizeURL()&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;return&nbsp;$this-&gt;host.&#39;authorize&#39;;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;//构造函数&nbsp;赋值&nbsp;一些必要参数&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;__construct($client_id,&nbsp;$client_secret,&nbsp;$access_token&nbsp;=&nbsp;NULL,&nbsp;$refresh_token&nbsp;=&nbsp;NULL)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;client_id&nbsp;=&nbsp;$client_id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;client_secret&nbsp;=&nbsp;$client_secret;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;access_token&nbsp;=&nbsp;$access_token;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;refresh_token&nbsp;=&nbsp;$refresh_token;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$this-&gt;debug&nbsp;=&nbsp;true;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;authorize接口\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;对应API：{@link&nbsp;http://u.mumayi.com/oauth/authorize&nbsp;Oauth2/authorize}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$url&nbsp;授权后的回调地址,站外应用需与回调地址一致,站内应用需要填写canvas&nbsp;page的地址\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$response_type&nbsp;支持的值包括&nbsp;code&nbsp;和token&nbsp;默认值为code\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$state&nbsp;用于保持请求和回调的状态。在回调时,会在Query&nbsp;Parameter中回传该参数\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$display&nbsp;授权页面类型&nbsp;可选范围:&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;default&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;默认授权页面\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;mobile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;支持html5的手机\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;popup&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;弹窗授权页\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;wap1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wap1.2页面\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;wap2.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wap2.0页面\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js-sdk&nbsp;专用&nbsp;授权页面是弹窗，返回结果为js-sdk回掉函数\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;apponweibo&nbsp;&nbsp;&nbsp;&nbsp;站内应用专用,站内应用不传display参数,并且response_type为token时,默认使用改display.授权后不会返回access_token，只是输出js刷新站内应用父框架\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;getAuthorizeURL(&nbsp;$url,&nbsp;$response_type&nbsp;=&nbsp;&#39;code&#39;,&nbsp;$state&nbsp;=&nbsp;NULL,&nbsp;$display&nbsp;=&nbsp;NULL&nbsp;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;array();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;client_id&#39;]&nbsp;=&nbsp;$this-&gt;client_id;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;redirect_uri&#39;]&nbsp;=&nbsp;$url;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;response_type&#39;]&nbsp;=&nbsp;$response_type;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;state&#39;]&nbsp;=&nbsp;$state;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;display&#39;]&nbsp;=&nbsp;$display;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;authorizeURL()&nbsp;.&nbsp;&quot;&amp;&quot;&nbsp;.&nbsp;http_build_query($params);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;access_token接口\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;对应API：{@link&nbsp;http://open.weibo.com/wiki/OAuth2/access_token&nbsp;OAuth2/access_token}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$type&nbsp;请求的类型,可以为:code,&nbsp;password,&nbsp;token\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;$keys&nbsp;其他参数：\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;当$type为code时：&nbsp;array(&#39;code&#39;=&gt;...,&nbsp;&#39;redirect_uri&#39;=&gt;...)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;当$type为password时：&nbsp;array(&#39;username&#39;=&gt;...,&nbsp;&#39;password&#39;=&gt;...)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;-&nbsp;当$type为token时：&nbsp;array(&#39;refresh_token&#39;=&gt;...)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;getAccessToken(&nbsp;$type&nbsp;=&nbsp;&#39;code&#39;,&nbsp;$keys&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;array();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;client_id&#39;]&nbsp;=&nbsp;$this-&gt;client_id;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;client_secret&#39;]&nbsp;=&nbsp;$this-&gt;client_secret;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$type&nbsp;===&nbsp;&#39;token&#39;&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;grant_type&#39;]&nbsp;=&nbsp;&#39;refresh_token&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;refresh_token&#39;]&nbsp;=&nbsp;$keys[&#39;refresh_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(&nbsp;$type&nbsp;===&nbsp;&#39;code&#39;&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;grant_type&#39;]&nbsp;=&nbsp;&#39;authorization_code&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;code&#39;]&nbsp;=&nbsp;$keys[&#39;code&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;redirect_uri&#39;]&nbsp;=&nbsp;$keys[&#39;redirect_uri&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(&nbsp;$type&nbsp;===&nbsp;&#39;password&#39;&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;grant_type&#39;]&nbsp;=&nbsp;&#39;password&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;username&#39;]&nbsp;=&nbsp;$keys[&#39;username&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params[&#39;password&#39;]&nbsp;=&nbsp;$keys[&#39;password&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;json_encode(array(&#39;error&#39;&nbsp;=&gt;&nbsp;&#39;错误的授权类型[&#39;.$type.&#39;(token,&nbsp;code)]&#39;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;$this-&gt;oAuthRequest($this-&gt;accessTokenURL(),&nbsp;&#39;POST&#39;,&nbsp;$params);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//var_dump($response);die;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;json_decode($response,&nbsp;true);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;is_array($token)&nbsp;&amp;&amp;&nbsp;!isset($token[&#39;error&#39;])&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;access_token&nbsp;=&nbsp;$token[&#39;access_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$this-&gt;refresh_token&nbsp;=&nbsp;$token[&#39;refresh_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;json_encode(array(&#39;error&#39;&nbsp;=&gt;&nbsp;&#39;获取访问令牌失败。[&#39;.$token[&#39;error&#39;].&#39;]&#39;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$token;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;解析&nbsp;signed_request\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$signed_request&nbsp;应用框架在加载iframe时会通过向Canvas&nbsp;URL&nbsp;post的参数signed_request\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;parseSignedRequest($signed_request)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list($encoded_sig,&nbsp;$payload)&nbsp;=&nbsp;explode(&#39;.&#39;,&nbsp;$signed_request,&nbsp;2);&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sig&nbsp;=&nbsp;self::base64decode($encoded_sig)&nbsp;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;json_decode(self::base64decode($payload),&nbsp;true);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strtoupper($data[&#39;algorithm&#39;])&nbsp;!==&nbsp;&#39;HMAC-SHA256&#39;)&nbsp;return&nbsp;&#39;-1&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$expected_sig&nbsp;=&nbsp;hash_hmac(&#39;sha256&#39;,&nbsp;$payload,&nbsp;$this-&gt;client_secret,&nbsp;true);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;($sig&nbsp;!==&nbsp;$expected_sig)?&nbsp;&#39;-2&#39;:$data;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ignore\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;base64decode($str)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64_decode(strtr($str.str_repeat(&#39;=&#39;,&nbsp;(4&nbsp;-&nbsp;strlen($str)&nbsp;%&nbsp;4)),&nbsp;&#39;-_&#39;,&nbsp;&#39;+/&#39;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;读取jssdk授权信息，用于和jssdk的同步登录\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array&nbsp;成功返回array(&#39;access_token&#39;=&gt;&#39;value&#39;,&nbsp;&#39;refresh_token&#39;=&gt;&#39;value&#39;);&nbsp;失败返回false\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;getTokenFromJSSDK()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key&nbsp;=&nbsp;&quot;mumayijs_&quot;&nbsp;.&nbsp;$this-&gt;client_id;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;isset($_COOKIE[$key])&nbsp;&amp;&amp;&nbsp;$cookie&nbsp;=&nbsp;$_COOKIE[$key]&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parse_str($cookie,&nbsp;$token);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;isset($token[&#39;access_token&#39;])&nbsp;&amp;&amp;&nbsp;isset($token[&#39;refresh_token&#39;])&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;access_token&nbsp;=&nbsp;$token[&#39;access_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;refresh_token&nbsp;=&nbsp;$token[&#39;refresh_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$token;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;从数组中读取access_token和refresh_token\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;常用于从Session或Cookie中读取token，或通过Session/Cookie中是否存有token判断登录状态。\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;$arr&nbsp;存有access_token和secret_token的数组\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array&nbsp;成功返回array(&#39;access_token&#39;=&gt;&#39;value&#39;,&nbsp;&#39;refresh_token&#39;=&gt;&#39;value&#39;);&nbsp;失败返回false\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;getTokenFromArray(&nbsp;$arr&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($arr[&#39;access_token&#39;])&nbsp;&amp;&amp;&nbsp;$arr[&#39;access_token&#39;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;array();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;access_token&nbsp;=&nbsp;$token[&#39;access_token&#39;]&nbsp;=&nbsp;$arr[&#39;access_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset($arr[&#39;refresh_token&#39;])&nbsp;&amp;&amp;&nbsp;$arr[&#39;refresh_token&#39;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;refresh_token&nbsp;=&nbsp;$token[&#39;refresh_token&#39;]&nbsp;=&nbsp;$arr[&#39;refresh_token&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$token;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;以&nbsp;GET&nbsp;请求方式&nbsp;请求&nbsp;OAuth&nbsp;验证服务器\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;get($url,&nbsp;$parameters&nbsp;=&nbsp;array())&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;$this-&gt;oAuthRequest($url,&nbsp;&#39;GET&#39;,&nbsp;$parameters);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;format&nbsp;===&nbsp;&#39;json&#39;&nbsp;&amp;&amp;&nbsp;$this-&gt;decode_json)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json_decode($response,&nbsp;true);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;以&nbsp;POST&nbsp;请求方式&nbsp;请求&nbsp;OAuth&nbsp;验证服务器\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;post($url,&nbsp;$parameters&nbsp;=&nbsp;array(),&nbsp;$multi&nbsp;=&nbsp;false)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;$this-&gt;oAuthRequest($url,&nbsp;&#39;POST&#39;,&nbsp;$parameters,&nbsp;$multi&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;format&nbsp;===&nbsp;&#39;json&#39;&nbsp;&amp;&amp;&nbsp;$this-&gt;decode_json)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json_decode($response,&nbsp;true);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;请求&nbsp;OAuth&nbsp;验证服务器&nbsp;进行验证\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;oAuthRequest($url,&nbsp;$method,&nbsp;$parameters,&nbsp;$multi&nbsp;=&nbsp;false)&nbsp;{\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strrpos($url,&nbsp;&#39;http://&#39;)&nbsp;!==&nbsp;0&nbsp;&amp;&amp;&nbsp;strrpos($url,&nbsp;&#39;https://&#39;)&nbsp;!==&nbsp;0)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;&quot;{$this-&gt;host}{$url}.{$this-&gt;format}&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;($method)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&#39;GET&#39;:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!empty($parameters))\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;$url&nbsp;.&nbsp;&#39;&amp;&#39;&nbsp;.&nbsp;http_build_query($parameters);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;http($url,&nbsp;&#39;GET&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;=&nbsp;array();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$multi&nbsp;&amp;&amp;&nbsp;(is_array($parameters)&nbsp;||&nbsp;is_object($parameters))&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;=&nbsp;http_build_query($parameters);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body&nbsp;=&nbsp;self::build_http_query_multi($parameters);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers[]&nbsp;=&nbsp;&quot;Content-Type:&nbsp;multipart/form-data;&nbsp;boundary=&quot;&nbsp;.&nbsp;self::$boundary;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//return&nbsp;$this-&gt;http($url,&nbsp;$method,&nbsp;$body,&nbsp;$headers);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;http($url,&nbsp;$method,&nbsp;$body,&nbsp;$headers);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;使用&nbsp;CURL&nbsp;模拟一个&nbsp;HTTP&nbsp;请求&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@description&nbsp;(需要开启&nbsp;CURL&nbsp;扩展)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;API&nbsp;results\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;http($url,&nbsp;$method,&nbsp;$postfields&nbsp;=&nbsp;NULL,&nbsp;$headers&nbsp;=&nbsp;array())&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;http_info&nbsp;=&nbsp;array();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ci&nbsp;=&nbsp;curl_init();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Curl&nbsp;settings&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_HTTP_VERSION,&nbsp;CURL_HTTP_VERSION_1_0);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_USERAGENT,&nbsp;$this-&gt;useragent);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_CONNECTTIMEOUT,&nbsp;$this-&gt;connecttimeout);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_TIMEOUT,&nbsp;$this-&gt;timeout);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_RETURNTRANSFER,&nbsp;TRUE);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_ENCODING,&nbsp;&quot;&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_SSL_VERIFYPEER,&nbsp;$this-&gt;ssl_verifypeer);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_SSL_VERIFYHOST,&nbsp;1);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_HEADERFUNCTION,&nbsp;array($this,&nbsp;&#39;getHeader&#39;));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_HEADER,&nbsp;FALSE);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;($method)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&#39;POST&#39;:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_POST,&nbsp;TRUE);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty($postfields))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_POSTFIELDS,&nbsp;$postfields);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;postdata&nbsp;=&nbsp;$postfields;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&#39;DELETE&#39;:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_CUSTOMREQUEST,&nbsp;&#39;DELETE&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty($postfields))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;&quot;{$url}?{$postfields}&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;isset($this-&gt;access_token)&nbsp;&amp;&amp;&nbsp;$this-&gt;access_token&nbsp;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers[]&nbsp;=&nbsp;&quot;Authorization:&nbsp;OAuth2&nbsp;&quot;.$this-&gt;access_token;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;!empty($this-&gt;remote_ip)&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;defined(&#39;SAE_ACCESSKEY&#39;)&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers[]&nbsp;=&nbsp;&quot;SaeRemoteIP:&nbsp;&quot;&nbsp;.&nbsp;$this-&gt;remote_ip;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers[]&nbsp;=&nbsp;&quot;API-RemoteIP:&nbsp;&quot;&nbsp;.&nbsp;$this-&gt;remote_ip;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;!defined(&#39;SAE_ACCESSKEY&#39;)&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers[]&nbsp;=&nbsp;&quot;API-RemoteIP:&nbsp;&quot;&nbsp;.&nbsp;$_SERVER[&#39;REMOTE_ADDR&#39;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_URL,&nbsp;$url&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLOPT_HTTPHEADER,&nbsp;$headers&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ci,&nbsp;CURLINFO_HEADER_OUT,&nbsp;TRUE&nbsp;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;curl_exec($ci);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;http_code&nbsp;=&nbsp;curl_getinfo($ci,&nbsp;CURLINFO_HTTP_CODE);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;http_info&nbsp;=&nbsp;array_merge($this-&gt;http_info,&nbsp;curl_getinfo($ci));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;url&nbsp;=&nbsp;$url;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;debug)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;=====post&nbsp;data======\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_dump($postfields);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;=====headers======\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_r($headers);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;=====request&nbsp;info=====&#39;.&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_r(&nbsp;curl_getinfo($ci)&nbsp;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;=====response=====&#39;.&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_r(&nbsp;$response&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_close&nbsp;($ci);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$response;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;从结果中&nbsp;获取&nbsp;header&nbsp;参数&nbsp;(CURL&nbsp;使用)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;int\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ignore&nbsp;(忽略)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;getHeader($ch,&nbsp;$header)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i&nbsp;=&nbsp;strpos($header,&nbsp;&#39;:&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty($i))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key&nbsp;=&nbsp;str_replace(&#39;-&#39;,&nbsp;&#39;_&#39;,&nbsp;strtolower(substr($header,&nbsp;0,&nbsp;$i)));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value&nbsp;=&nbsp;trim(substr($header,&nbsp;$i&nbsp;+&nbsp;2));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;http_header[$key]&nbsp;=&nbsp;$value;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;strlen($header);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;把要传递的参数&nbsp;重新构造一下&nbsp;(多维数组)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ignore&nbsp;(忽略)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;build_http_query_multi($params)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$params)&nbsp;return&nbsp;&#39;&#39;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uksort($params,&nbsp;&#39;strcmp&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$pairs&nbsp;=&nbsp;array();\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self::$boundary&nbsp;=&nbsp;$boundary&nbsp;=&nbsp;uniqid(&#39;------------------&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$MPboundary&nbsp;=&nbsp;&#39;--&#39;.$boundary;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$endMPboundary&nbsp;=&nbsp;$MPboundary.&nbsp;&#39;--&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;=&nbsp;&#39;&#39;;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($params&nbsp;as&nbsp;$parameter&nbsp;=&gt;&nbsp;$value)&nbsp;{\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;in_array($parameter,&nbsp;array(&#39;pic&#39;,&nbsp;&#39;image&#39;))&nbsp;&amp;&amp;&nbsp;$value{0}&nbsp;==&nbsp;&#39;@&#39;&nbsp;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;ltrim(&nbsp;$value,&nbsp;&#39;@&#39;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content&nbsp;=&nbsp;file_get_contents(&nbsp;$url&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$array&nbsp;=&nbsp;explode(&nbsp;&#39;?&#39;,&nbsp;basename(&nbsp;$url&nbsp;)&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filename&nbsp;=&nbsp;$array[0];\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;$MPboundary&nbsp;.&nbsp;&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;&#39;Content-Disposition:&nbsp;form-data;&nbsp;name=&quot;&#39;&nbsp;.&nbsp;$parameter&nbsp;.&nbsp;&#39;&quot;;&nbsp;filename=&quot;&#39;&nbsp;.&nbsp;$filename&nbsp;.&nbsp;&#39;&quot;&#39;.&nbsp;&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;&quot;Content-Type:&nbsp;image/unknown\\r\\n\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;$content.&nbsp;&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;$MPboundary&nbsp;.&nbsp;&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;&#39;content-disposition:&nbsp;form-data;&nbsp;name=&quot;&#39;&nbsp;.&nbsp;$parameter&nbsp;.&nbsp;&quot;\\&quot;\\r\\n\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;$value.&quot;\\r\\n&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$multipartbody&nbsp;.=&nbsp;$endMPboundary;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$multipartbody;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;get_uid()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$hostUrl&nbsp;=&nbsp;&#39;http://server.ruanwenwu.cn/index.php/home/resource/userinfo?type=mumayi&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;access_token&#39;&nbsp;=&gt;&nbsp;$this-&gt;access_token,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;get(&nbsp;$hostUrl,&nbsp;$params&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">注意：这个类的加载跟服务端采用的不同的方式。这里用了命名空间。服务端用的vendor。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3、准备访问链接。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们通过这个url将用户导向server.ruanwenwu.cn进行授权，发送accesss_code操作。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我在client.ruanwenwu.cn的index控制器中实现的这个url。控制器里没有逻辑，我只贴index.html了：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;!doctype&nbsp;html&gt;&lt;html&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;&lt;/head&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://server.ruanwenwu.cn/index.php/home/oauth/authorize?redirect_uri=http://client.ruanwenwu.cn/index.php/home/login&amp;response_type=code&amp;client_id=10009174&amp;type=123456&quot;&gt;登陆&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;&lt;/html&gt;</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注 意：这个url中redirect_uri,response_type为必选参数。而且这个redirect_uri必须包含我们在服务端添加 oauth服务时写的那个redirect_uri。否则不能通过验证。（也就是说：在我们这个例子里，这个redirect_uri必须包含：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">http://client.ruanwenwu.cn/index.php/home/login</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4、点击链接，跳转到服务端对应的url。实际上就是server.ruanwenwu.cn的authorize操作。在这里会对用户进行验证，并判断是否授权。</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&nbsp;&nbsp;&nbsp;&nbsp;//权限验证&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;authorize()&nbsp;{&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(IS_POST)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(true){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//这个地方验证成功后要把用户的uid加进来&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_POST[&#39;user_id&#39;]&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;//这里是写死的，实际上是从数据库读出来&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;finishClientAuthorization(true,&nbsp;$_POST);&nbsp;&nbsp;&nbsp;&nbsp;//第一个参数很重要，是用户是否授权&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;///表单准备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$auth_params&nbsp;=&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;getAuthorizeParams();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assign(&quot;auth_params&quot;,$auth_params);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;display();&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注意看我在这个操作里写的注释。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;验证成功后，页面又跳回到我们之前写的redirect_uri，并带上了code参数，这就是验证服务器向客户端发送的access_code。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5、客户端拿到access_code，向验证服务器请求access_token。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在我的client.ruanwenwu.cn的loginController.class.php中进行：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?phpnamespace&nbsp;Home\\Controller;use&nbsp;Think\\Controller;use&nbsp;Org\\Util\\Oauth2;class&nbsp;LoginController&nbsp;extends&nbsp;Controller{&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;_initialize(){&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;index(){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;oauth&nbsp;=&nbsp;new&nbsp;Oauth2(&#39;10009174&#39;,&#39;123456&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keys&nbsp;=&nbsp;array();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//keys&nbsp;数组&nbsp;赋值&nbsp;code&nbsp;值&nbsp;(换取token,&nbsp;必须参数)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keys[&#39;code&#39;]&nbsp;=&nbsp;$_GET[&#39;code&#39;];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//keys&nbsp;数组&nbsp;赋值&nbsp;回调地址信息&nbsp;(换取token,&nbsp;必须参数)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keys[&#39;redirect_uri&#39;]&nbsp;=&nbsp;&#39;http://client.ruanwenwu.cn/index.php/home/login?type=mumayidev&#39;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//根据&nbsp;code&nbsp;获取&nbsp;token&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//var_dump(&nbsp;$token&nbsp;=&nbsp;$this-&gt;oauth-&gt;getAccessToken(&nbsp;&#39;code&#39;,&nbsp;$keys&nbsp;))&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;$this-&gt;oauth-&gt;getAccessToken(&nbsp;&#39;code&#39;,&nbsp;$keys&nbsp;)&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//现在已经得到token，并且将access_token写到对象里了。就可以请求资源了&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_dump(&nbsp;$this-&gt;oauth-&gt;get_uid());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;&nbsp;&nbsp;&nbsp;&nbsp;}}</pre><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&nbsp;&nbsp;&nbsp;$token&nbsp;=&nbsp;$this-&gt;oauth-&gt;getAccessToken(&nbsp;&#39;code&#39;,&nbsp;$keys&nbsp;)&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;//这就是请求代码。code是验证方式。$keys数组里要code和redirect_uri。在服务器端需要验证</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">服务端的响应是这样的：</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">验证client.ruanwenwu.cn的client_id和secrete是否合法，还要判读access_code是否过期</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;access_token()&nbsp;{&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&nbsp;-&gt;&nbsp;oauth&nbsp;-&gt;&nbsp;grantAccessToken();&nbsp;&nbsp;&nbsp;&nbsp;//这个方法里有所有的验证及生成access_token的操作。（会有数据库的写入）&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">服务端生成access_token之后，会返回给客户端。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">客户端拿到access_token之后，向资源服务器请求用户资源：</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">在这里我的验证服务器和资源服务器都是server.ruanwenwu.cn。我用resourceController.class.php来做资源控制：</p><pre class=\"brush:php;toolbar:false language-php\" style=\"font-family: &quot;Courier New&quot;; font-size: 12px; margin: 5px 8px; padding: 5px;\">&lt;?phpnamespace&nbsp;Home\\Controller;use&nbsp;Think\\Controller;class&nbsp;ResourceController&nbsp;extends&nbsp;Controller{&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;$db;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;_initialize(){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;db&nbsp;=&nbsp;M();&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;userinfo(){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$arr&nbsp;=&nbsp;array(&quot;username&quot;=&gt;&quot;阮文武&quot;,&quot;sex&quot;=&gt;1,&quot;img&quot;=&gt;&quot;http://weewrerfdf&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;echo&nbsp;json_encode($arr);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;die;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($_GET[&#39;access_token&#39;])&nbsp;&amp;&amp;&nbsp;$_GET[&#39;access_token&#39;]){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res&nbsp;=&nbsp;$this-&gt;db-&gt;table(&quot;oauth_token&quot;)-&gt;where(&quot;access_token&nbsp;=&nbsp;&#39;&quot;.$_GET[&#39;access_token&#39;].&quot;&#39;&quot;)-&gt;find();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($res&nbsp;&amp;&amp;&nbsp;count($res)&nbsp;&gt;&nbsp;0){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($res[&#39;expires_in&#39;]&nbsp;&gt;&nbsp;time()){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$arr&nbsp;=&nbsp;array(&quot;username&quot;=&gt;&quot;阮文武d&quot;,&quot;sex&quot;=&gt;1,&quot;img&quot;=&gt;&quot;http://weewrerfdf&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;json_encode($arr);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;}}</pre><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">如果access_token有效，就查到用户id，取出用户的信息。我这里只是做测试，所以就直接自己返回了数据。<br/>原本写的很详细，后来因为内容字段是text，没保存完整，这会时间比较赶，就写的简单一点。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">再抽时间补充吧。</p><p style=\"margin: 10px auto; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal;\">欢迎大家与我讨论哦。</p><p><br/></p>','框架','php搭建oatuth2.0服务端和客户端','oauth2.0搭建服务端和客户端的一个记录','php',0,351,1),(67,1487671848,1487671848,1487671848,'<p style=\"margin-top: 0px; margin-bottom: 1.5rem; color: rgb(51, 51, 51); font-family: &quot;Fira Sans&quot;, &quot;Source Sans Pro&quot;, Helvetica, Arial, sans-serif; white-space: normal; background-color: rgb(242, 242, 242);\"><span style=\"text-rendering: optimizeLegibility;\">对数据库结果（当然可以对自定义结果集）进行排序，其实usort也可以实现。除此之外usort还可以对对象进行排序。</span></p><p style=\"margin-top: 0px; margin-bottom: 1.5rem;\">本例中&nbsp;data&nbsp;数组中的每个单元表示一个表中的一行。这是典型的数据库记录的数据集合。</p><p style=\"margin-top: 0px; margin-bottom: 1.5rem;\">例子中的数据如下：</p><pre style=\"white-space: pre-wrap; margin-top: 0px; margin-bottom: 0px;\">volume&nbsp;|&nbsp;edition\r\n-------+--------\r\n&nbsp;&nbsp;&nbsp;&nbsp;67&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2\r\n&nbsp;&nbsp;&nbsp;&nbsp;86&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1\r\n&nbsp;&nbsp;&nbsp;&nbsp;85&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6\r\n&nbsp;&nbsp;&nbsp;&nbsp;98&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2\r\n&nbsp;&nbsp;&nbsp;&nbsp;86&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6\r\n&nbsp;&nbsp;&nbsp;&nbsp;67&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7</pre><p style=\"margin-top: 0px; margin-bottom: 1.5rem;\">数据全都存放在名为&nbsp;data&nbsp;的数组中。这通常是通过循环从数据库取得的结果，例如&nbsp;<span class=\"function\"><a href=\"http://php.net/manual/zh/function.mysql-fetch-assoc.php\" class=\"function\" style=\"border-bottom: 1px solid; text-decoration: none; color: rgb(51, 102, 153);\">mysql_fetch_assoc()</a></span>。</p><p><code style=\"font-stretch: normal; font-size: 0.875rem; line-height: 1.5rem; font-family: &quot;Fira Mono&quot;, &quot;Source Code Pro&quot;, monospace; word-wrap: break-word; display: block;\"><span style=\"color: rgb(0, 0, 0);\"><span style=\"color: rgb(0, 0, 187);\">&lt;?php<br/>$data</span><span style=\"color: rgb(0, 119, 0);\">[]&nbsp;=&nbsp;array(</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">67</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">2</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">$data</span><span style=\"color: rgb(0, 119, 0);\">[]&nbsp;=&nbsp;array(</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">86</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">1</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">$data</span><span style=\"color: rgb(0, 119, 0);\">[]&nbsp;=&nbsp;array(</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">85</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">6</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">$data</span><span style=\"color: rgb(0, 119, 0);\">[]&nbsp;=&nbsp;array(</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">98</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">2</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">$data</span><span style=\"color: rgb(0, 119, 0);\">[]&nbsp;=&nbsp;array(</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">86</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">6</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">$data</span><span style=\"color: rgb(0, 119, 0);\">[]&nbsp;=&nbsp;array(</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">67</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">7</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">?&gt;</span></span></code></p><p style=\"margin-top: 0px; margin-bottom: 1.5rem;\">本例中将把&nbsp;volume&nbsp;降序排列，把&nbsp;edition&nbsp;升序排列。</p><p style=\"margin-top: 0px; margin-bottom: 1.5rem;\">现在有了包含有行的数组，但是&nbsp;<span class=\"function\"><span style=\"text-rendering: optimizeLegibility;\">array_multisort()</span></span>&nbsp;需要一个包含列的数组，因此用以下代码来取得列，然后排序。</p><p><code style=\"font-stretch: normal; font-size: 0.875rem; line-height: 1.5rem; font-family: &quot;Fira Mono&quot;, &quot;Source Code Pro&quot;, monospace; word-wrap: break-word; display: block;\"><span style=\"color: rgb(0, 0, 0);\"><span style=\"color: rgb(0, 0, 187);\">&lt;?php<br/></span><span style=\"color: rgb(255, 128, 0);\">//&nbsp;取得列的列表<br/></span><span style=\"color: rgb(0, 119, 0);\">foreach&nbsp;(</span><span style=\"color: rgb(0, 0, 187);\">$data&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">as&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$key&nbsp;</span><span style=\"color: rgb(0, 119, 0);\">=&gt;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$row</span><span style=\"color: rgb(0, 119, 0);\">)&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$volume</span><span style=\"color: rgb(0, 119, 0);\">[</span><span style=\"color: rgb(0, 0, 187);\">$key</span><span style=\"color: rgb(0, 119, 0);\">]&nbsp;&nbsp;=&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$row</span><span style=\"color: rgb(0, 119, 0);\">[</span><span style=\"color: rgb(221, 0, 0);\">&#39;volume&#39;</span><span style=\"color: rgb(0, 119, 0);\">];<br/>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$edition</span><span style=\"color: rgb(0, 119, 0);\">[</span><span style=\"color: rgb(0, 0, 187);\">$key</span><span style=\"color: rgb(0, 119, 0);\">]&nbsp;=&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$row</span><span style=\"color: rgb(0, 119, 0);\">[</span><span style=\"color: rgb(221, 0, 0);\">&#39;edition&#39;</span><span style=\"color: rgb(0, 119, 0);\">];<br/>}<br/><br/></span><span style=\"color: rgb(255, 128, 0);\">//&nbsp;将数据根据&nbsp;volume&nbsp;降序排列，根据&nbsp;edition&nbsp;升序排列<br/>//&nbsp;把&nbsp;$data&nbsp;作为最后一个参数，以通用键排序<br/></span><span style=\"color: rgb(0, 0, 187);\">array_multisort</span><span style=\"color: rgb(0, 119, 0);\">(</span><span style=\"color: rgb(0, 0, 187);\">$volume</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">SORT_DESC</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$edition</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">SORT_ASC</span><span style=\"color: rgb(0, 119, 0);\">,&nbsp;</span><span style=\"color: rgb(0, 0, 187);\">$data</span><span style=\"color: rgb(0, 119, 0);\">);<br/></span><span style=\"color: rgb(0, 0, 187);\">?&gt;</span></span></code></p><p style=\"margin-top: 0px; margin-bottom: 1.5rem;\">数据集合现在排好序了，结果如下：</p><pre style=\"white-space: pre-wrap; margin-top: 0px; margin-bottom: 0px;\">volume&nbsp;|&nbsp;edition\r\n-------+--------\r\n&nbsp;&nbsp;&nbsp;&nbsp;98&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2\r\n&nbsp;&nbsp;&nbsp;&nbsp;86&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1\r\n&nbsp;&nbsp;&nbsp;&nbsp;86&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6\r\n&nbsp;&nbsp;&nbsp;&nbsp;85&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6\r\n&nbsp;&nbsp;&nbsp;&nbsp;67&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2\r\n&nbsp;&nbsp;&nbsp;&nbsp;67&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7</pre><p><br/></p>','','array_multisort','本文摘自php手册，仅作为日常工作参考','php',0,446,1),(68,1487983604,1487983604,1487983604,'<pre class=\"brush:js;toolbar:false\">/**\r\n&nbsp;*&nbsp;该脚本用于加载更多数据\r\n&nbsp;*&nbsp;@author&nbsp;rww\r\n&nbsp;*&nbsp;@date&nbsp;2017/02/24\r\n&nbsp;*/\r\nwindow.onload&nbsp;=&nbsp;function(){\r\n	/*\r\n	&nbsp;{\r\n		page&nbsp;:&nbsp;1,	//&nbsp;请求页\r\n	&nbsp;	functionSwitch&nbsp;:&nbsp;1,	//整体功能开关\r\n	&nbsp;	ajaxUrl&nbsp;:&nbsp;&quot;&quot;,	//请求数据地址\r\n	&nbsp;	loadStatusEleId&nbsp;:&nbsp;&quot;loadPrompt&quot;&nbsp;//加载状态显示元素类名\r\n	&nbsp;	targetElementId&nbsp;:&nbsp;&quot;targetUl&quot;,&nbsp;//返回数据填充元素id\r\n	&nbsp;	loadSwitch&nbsp;:&nbsp;1,	//是否允许加载数据\r\n	&nbsp;}\r\n	&nbsp;*/\r\n	function&nbsp;loadMore(param){\r\n		for&nbsp;(var&nbsp;i&nbsp;in&nbsp;param)&nbsp;{\r\n			this[i]&nbsp;=&nbsp;param[i];\r\n			if&nbsp;(i&nbsp;!=&nbsp;&quot;functionSwitch&quot;&nbsp;&amp;&amp;&nbsp;!param[i])&nbsp;{\r\n				console.log(&quot;参数配置：&quot;+i+&quot;不能为空&quot;);\r\n			}\r\n		}\r\n\r\n		this.statusDiv&nbsp;=&nbsp;document.querySelector(&quot;#&quot;+this.loadStatusEleId);	//供全部方法使用\r\n	}\r\n	\r\n	//通过原型增加方法\r\n	loadMore.prototype&nbsp;=&nbsp;{\r\n			constructor&nbsp;:&nbsp;loadMore,\r\n\r\n			//初始化\r\n			init&nbsp;:&nbsp;function(){	//初始化插件\r\n				if&nbsp;(!this.functionSwitch)&nbsp;{	//如果整体功能关闭，不在继续执行\r\n					return&nbsp;false;\r\n				}\r\n				\r\n				this.listenScroll();\r\n				\r\n			},\r\n\r\n			//监听滚动\r\n			listenScroll&nbsp;:&nbsp;function(){\r\n				var&nbsp;self&nbsp;=&nbsp;this;\r\n				window.addEventListener(&quot;scroll&quot;,function(){\r\n					if&nbsp;(self.functionSwitch&nbsp;&amp;&amp;&nbsp;self.loadSwitch&nbsp;&amp;&amp;&nbsp;self.checkIfToLoad())&nbsp;{	//如果已经滚动到位\r\n							self.loadData();\r\n					}&nbsp;\r\n				});\r\n			},\r\n			\r\n			//检查是否能够加载\r\n			checkIfToLoad&nbsp;:&nbsp;function()&nbsp;{\r\n				&nbsp;var&nbsp;scrollTop&nbsp;=&nbsp;document.documentElement.scrollTop&nbsp;||&nbsp;document.body.scrollTop;\r\n				&nbsp;var&nbsp;windowHeight&nbsp;=&nbsp;document.documentElement.clientHeight;\r\n				&nbsp;var&nbsp;scrollHeight&nbsp;=&nbsp;document.documentElement.scrollHeight;\r\n				&nbsp;if&nbsp;(scrollTop&nbsp;+&nbsp;windowHeight&nbsp;&gt;&nbsp;scrollHeight&nbsp;-&nbsp;300)&nbsp;{\r\n					&nbsp;return&nbsp;true;\r\n				&nbsp;}&nbsp;else&nbsp;{\r\n					&nbsp;return&nbsp;false;\r\n				&nbsp;}\r\n			},\r\n			\r\n			//加载数据\r\n			loadData&nbsp;:&nbsp;function(){\r\n				var&nbsp;self&nbsp;=&nbsp;this;\r\n				self.loadSwitch&nbsp;=&nbsp;false;	//加载数据时将该参数关闭\r\n				var&nbsp;xmlhttp=null;\r\n				\r\n				if&nbsp;(window.XMLHttpRequest)&nbsp;{\r\n					xmlhttp=new&nbsp;XMLHttpRequest();\r\n				}&nbsp;\r\n				\r\n				if&nbsp;(xmlhttp&nbsp;!=&nbsp;null)&nbsp;{\r\n					xmlhttp.onreadystatechange&nbsp;=&nbsp;function(e){\r\n						self.statusDiv.classList.add(&quot;loading&quot;);\r\n						if&nbsp;(this.readyState==4)&nbsp;{//&nbsp;4&nbsp;=&nbsp;&quot;loaded&quot;\r\n							if&nbsp;(this.status==200)&nbsp;{\r\n								for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;3000;&nbsp;i++){\r\n									console.log(1);\r\n								}\r\n								self.loadSwitch&nbsp;=&nbsp;true;&nbsp;//请求成功将开关再次开启\r\n								self.statusDiv.classList.remove(&quot;loading&quot;);\r\n								if&nbsp;(this.response&nbsp;!=&nbsp;&quot;false&quot;)&nbsp;{\r\n									self.appendHtml(this.response);\r\n								}&nbsp;else&nbsp;{\r\n									self.functionSwitch&nbsp;=&nbsp;false;\r\n									self.statusDiv.classList.add(&quot;loaded&quot;);\r\n								}\r\n								self.page++;\r\n							}else&nbsp;{\r\n								alert(&quot;Problem&nbsp;retrieving&nbsp;XML&nbsp;data&quot;);\r\n							}\r\n						}\r\n				&nbsp;&nbsp;&nbsp;&nbsp;}\r\n					//POST方式发送数据\r\n				&nbsp;&nbsp;&nbsp;&nbsp;xmlhttp.open(&quot;POST&quot;,self.ajaxUrl,true);\r\n				&nbsp;&nbsp;&nbsp;&nbsp;xmlhttp.responseType&nbsp;=&nbsp;&quot;text&quot;;\r\n					xmlhttp.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);\r\n				&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;formData&nbsp;=&nbsp;&#39;page=&#39;+self.page;\r\n				&nbsp;&nbsp;&nbsp;&nbsp;xmlhttp.send(formData);\r\n				}&nbsp;else&nbsp;{\r\n					alert(&quot;Your&nbsp;browser&nbsp;does&nbsp;not&nbsp;support&nbsp;XMLHTTP.&quot;);\r\n				}\r\n				\r\n			},\r\n\r\n			//追加html到页面中。文档片段，一次性append，提高性能\r\n			appendHtml&nbsp;:&nbsp;function(html){\r\n				var&nbsp;divTemp&nbsp;=&nbsp;document.createElement(&quot;div&quot;),&nbsp;\r\n					nodes&nbsp;=&nbsp;null,\r\n					fragment&nbsp;=&nbsp;document.createDocumentFragment();\r\n				divTemp.innerHTML&nbsp;=&nbsp;html;\r\n				nodes&nbsp;=&nbsp;divTemp.childNodes;\r\n				var&nbsp;nlength&nbsp;=&nbsp;nodes.length;\r\n\r\n				for&nbsp;(var&nbsp;i=0,&nbsp;i&lt;nlength;&nbsp;i+=1)&nbsp;{\r\n				&nbsp;&nbsp;&nbsp;fragment.appendChild(nodes[i].cloneNode(true));\r\n				}\r\n\r\n				document.getElementById(this.targetElementId).appendChild(fragment);\r\n				nodes&nbsp;=&nbsp;null;\r\n				fragment&nbsp;=&nbsp;null;&nbsp;\r\n			}\r\n			\r\n	}\r\n	\r\n	//实例化对象\r\n	var&nbsp;loadInstance&nbsp;=&nbsp;new&nbsp;loadMore(\r\n			{\r\n				page&nbsp;:&nbsp;2,	//&nbsp;请求页\r\n			&nbsp;	functionSwitch&nbsp;:&nbsp;1,	//整体功能开关\r\n			&nbsp;	ajaxUrl&nbsp;:&nbsp;&quot;/index.php?c=Ajax_My_Main&amp;a=MyQuestion&quot;,	//请求数据地址\r\n			&nbsp;	loadStatusEleId&nbsp;:&nbsp;&quot;loadPrompt&quot;,&nbsp;//加载状态显示元素类名\r\n			&nbsp;	targetElementId&nbsp;:&nbsp;&quot;targetUl&quot;,&nbsp;//返回数据填充元素id\r\n			&nbsp;	loadSwitch&nbsp;:&nbsp;1,\r\n			}\r\n	);\r\n	loadInstance.init();\r\n}</pre><p>先把代码放在这里，有兴趣的可以读一下。具体说明我以上再详细。<br/></p>','上拉加载','移动端上拉加载','适用于移动端上拉加载的插件','',0,332,1),(69,1488267424,1488267464,1488267424,'','亲情','在地铁上看到一个小伙子在发一个66.66元微信红包，随红包的祝福语是：妈妈生日快乐！','你有没有被这个举动触动呢？','生活',1,249,1),(70,1488422208,1488422208,1488422208,'<p>出现这个问题之后，我“一鼓作气”把好几个虚拟机全部删了！打算重装。可是杯具的是：重装也不行。百度一下找到答案：把这些服务都开启来就好了。</p><p><img src=\"/ueditor/php/upload/image/20170302/1488422155491250.png\" title=\"1488422155491250.png\" alt=\"blob.png\"/></p><p>就是这几个鬼，都开启来就好了。大家千万不要冲动，像我一样删掉了，重装，浪费不少时间。</p>','linux','vmware出现“内部错误”的解决办法','原来是window的vmware相关服务没有开启，开启之后就正常了。','linux',0,161,1),(71,1488460457,1488460457,1488460457,'<p>rsync 报错 Failed to exec ssh: No such file or directory (2)</p><p>安装openssh-clients就可以了：yum -y install openssh-clients。</p><p><img src=\"/ueditor/php/upload/image/20170302/1488460444393360.png\" title=\"1488460444393360.png\" alt=\"blob.png\"/></p><p>安装完，再运行就好了。</p><p><br/></p>','openssh-clients','rsync 报错 Failed to exec ssh: No such file or directory (2)','实验rsync的ssh通道传输时执行命令遇到这个错误，记录一下解决办法。','linux',0,651,1),(72,1489247933,1490273933,1489247933,'<p>								</p><p>原本是想改/etc/hosts文件的内容，可是所有者是root，登录用户名是ruanwenwu,改不了。所以想切换到root用户：su root,可是忘了密码。</p><p><br/></p><p>网上的解决办法试了不少，最终这个最好用：</p><p>sudo bash</p><p>输入自己当前用户的密码</p><p>passwd root</p><p>重新输入新的面就好了。</p><p><img src=\"/ueditor/php/upload/image/20170323/1490273929139647.png\" title=\"1490273929139647.png\" alt=\"blob.png\"/></p><p>							</p>','mac','mac下重置root管理员密码','记录一下过程','mac',0,166,1),(73,1489249192,1489249192,1489249192,'<p>在apache的默认配置中，有这么一段：</p><p><img src=\"webkit-fake-url://b9b96e53-9c00-437a-ad18-0457309b390d/image.tiff\"/></p><p>它的意思是，根目录不允许任何人访问。所以如果你在创建虚拟主机的时候，项目目录一定要指定一下权限，否则就一直会是403了。</p><p>下面是一个可行的配置：</p><p><img src=\"webkit-fake-url://59e6939d-040c-4efe-b90c-e700a03a90b7/image.tiff\"/></p>','跨过的坑','apache的目录权限管理的坑一个','跨过的linux的坑一个','linux',0,448,1),(74,1489741758,1489745193,1489741758,'<p>								</p><p>我要从下面这段html中匹配出图片的src地址：</p><p><img src=\"/ueditor/php/upload/image/20170317/1489741196734911.png\" title=\"1489741196734911.png\" alt=\"blob.png\"/></p><p>用的正则是：</p><pre class=\"brush:cpp;toolbar:false\">$pattern&nbsp;=&nbsp;&quot;/\\&lt;img.*src=(\\&#39;|\\&quot;)(.*)\\\\1.*&gt;/U&quot;;;</pre><p>这个的优点是不管src在img标签的什么地方都能匹配到。这个正则中的\\\\1，表示反向选择前面的第一个括号里的内容（也叫子模式）。</p><p>最后的效果：</p><p><img src=\"/ueditor/php/upload/image/20170317/1489741646623339.png\" title=\"1489741646623339.png\" alt=\"blob.png\"/></p><p>注意，$pattern如果用单引号的话，\\\\1这个地方就必须要改成\\1，双引号必须是\\\\1,因为\\\\转义后就是\\的意思。</p><p>注意：/U方法和.*?不能同时用，否则会出问题。上面的正则如果不用/U模式修正符，用.*?的话是这样：</p><p>/\\&lt;img.*?src=(\\&#39;|\\&quot;).*?\\\\1.*?&gt;/&quot;</p><p>补充：.*?的意思取消贪婪。.代表任意字符（除了换行），*代表任意数量如果.*src代表一致匹配到src为止。</p><p>比如字符串：sfdsfsrcdfsdfsrc,用/.*src/就一直会匹配到最后的src，也就是匹配全部内容了。</p><p><img src=\"/ueditor/php/upload/image/20170317/1489745022795551.png\" title=\"1489745022795551.png\" alt=\"blob.png\"/></p><p>如果用.*?src的话，则匹配的是</p><table><tbody><tr class=\"firstRow\"><td class=\"line-number\"><br/></td><td class=\"line-content\">array(1) {</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">[0]=&gt;</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">array(2) {</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">[0]=&gt;</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">string(8) &quot;sfdsfsrc&quot;</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">[1]=&gt;</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">string(8) &quot;dfsdfsrc&quot;</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">}</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-content\">}</td></tr><tr><td class=\"line-number\"><br/></td><td class=\"line-number\"><br/></td></tr></tbody></table><p>发现匹配到了两次。而且都是到第一个src结尾。</p><p>如果.*?和/U连用：$pattern = &quot;/.*?src/U&quot;，结果如下：</p><p><img src=\"/ueditor/php/upload/image/20170317/1489745167213540.png\" title=\"1489745167213540.png\" alt=\"blob.png\"/></p><p>							</p>','','php正则匹配图片地址','一个常碰到的正则匹配图片或者链接地址的经验','php',0,221,1),(75,1489844693,1489844693,1489844693,'','搜索','网站添加了搜索功能，赶紧试试吧','网站添加了搜索，立马高大上了，哈哈。','说说',0,222,1),(76,1489859006,1489859006,1489859006,'<p>难度不大，主要用到了我自己封装的这个函数：<br/></p><pre class=\"brush:css;toolbar:false\">&nbsp;private&nbsp;function&nbsp;curlrequest($param){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$option&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;request_type&quot;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&quot;post&quot;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;array(),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;header&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;array(),\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;show_header_info&quot;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;0,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;url&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&quot;&quot;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($param&nbsp;&amp;&amp;&nbsp;is_array($param))&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$option&nbsp;=&nbsp;array_merge($option,&nbsp;$param);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extract($option);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$url)&nbsp;return&nbsp;false;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ch&nbsp;=&nbsp;curl_init();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_URL,&nbsp;$url);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_RETURNTRANSFER,&nbsp;1);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_HEADER,&nbsp;$show_header_info);&nbsp;&nbsp;&nbsp;&nbsp;//是否显示头信息\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_HTTPHEADER,&nbsp;$header);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($request_type&nbsp;==&nbsp;&quot;post&quot;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_POST,&nbsp;1);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt($ch,&nbsp;CURLOPT_POSTFIELDS,&nbsp;$data);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res&nbsp;=&nbsp;curl_exec($ch);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl_close($ch);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$res;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p>curl在发送请求时还是比较强大的。各种头信息。<br/></p><p>注意，最后一步，通过accesstoken获得用户信息的接口最好这样来写，即是在后信息里进行验证：</p><p><img src=\"/ueditor/php/upload/image/20170319/1489858977441576.png\" title=\"1489858977441576.png\" alt=\"blob.png\"/></p>','oauth登陆','使用github登陆上线了，不得了','现在我的博客必须使用github登陆才能发表评论，朋友们，快来试试吧','php',4,265,1),(77,1489977538,1489977694,1489977538,'<p>								</p><pre class=\"brush:bash;toolbar:false\">function&nbsp;writeCookie($userid){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$expire&nbsp;=&nbsp;time()+86400;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$check&nbsp;=&nbsp;rand();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setcookie(&quot;userid&quot;,&nbsp;$userid,&nbsp;$expire,&nbsp;&quot;/&quot;,&nbsp;&quot;.ruanwenwu.cn&quot;,false,true);&nbsp;&nbsp;&nbsp;&nbsp;//最后一个参数设置成true,意思是指允许http传输，禁止js获取cookie，这样更安全\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setcookie(&quot;check&quot;,&nbsp;$check,&nbsp;$expire,&nbsp;&quot;/&quot;,&nbsp;&quot;.ruanwenwu.cn&quot;,&nbsp;false,&nbsp;true);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key&nbsp;=&nbsp;&quot;sa^2fa*%mdpyw$@4&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cipher=&nbsp;md5(md5($key&nbsp;.&nbsp;$check)&nbsp;.&nbsp;$userid&nbsp;.&nbsp;$key);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setcookie(&quot;cipher&quot;,&nbsp;$cipher,&nbsp;$expire,&nbsp;&quot;/&quot;,&nbsp;&quot;.ruanwenwu.cn&quot;,&nbsp;false,&nbsp;true);\r\n}</pre><p>这样基本上就能够防止被伪造了。</p><p>							</p>','安全','设置更安全的cookie','登录后都需要设置cookie,怎样的cookie设置比较安全呢，能防止被伪造呢？','php',2,270,1),(78,1490025005,1490025005,1490025005,'<h3>题记</h3><p>参考文档：<a href=\"http://blog.csdn.net/lanwu628/article/details/17714885\">http://blog.csdn.net/lanwu628/article/details/17714885</a></p><p>以下文档基于Centos 6.5，本人亲测ok，如有问题可以评论，我看到了会回复哦。</p><p>什么是RPMForge</p><p>RPMForge是CentOS系统下的软件仓库，拥有10000多种的软件包，被CentOS社区认为是最安全也是最稳定的一个软件仓库。默认的CentOS源，软件太少了，可以添加额外的RpmForge。这里系统为CentOS5.7。</p><h3>步骤</h3><p>1、安装yum-priorities插件<br/>因为要添加第三方源，先确认系统是否安装了yum-priorities这个插件，这个插件用来保证安装软件时候软件仓库先后次序（priority优先权），一般是默认先从官方base或者镜像安装，然后从社区用户contribute的软件中安装，再从第三方软件仓库中安装。当然这个次序可以自己更改，为了安全和稳定还是依照这个次序吧。<br/></p><pre class=\"brush:html;toolbar:false\">yum&nbsp;install&nbsp;yum-priorities</pre><p>2、查看/etc/yum/pluginconf.d/priorities.conf文件<br/></p><pre class=\"brush:groovy;toolbar:false\">vim&nbsp;/etc/yum/pluginconf.d/priorities.conf</pre><p>确认文件中有以下内容：<br/></p><pre class=\"brush:diff;toolbar:false\">[main]\r\nenabled=1</pre><p>3、设置/etc/yum.repos.d/CentOS-Base.repo文件<br/>添加顺序指令priority=N（N 从 1 至 99，1 优先级最高）。<br/></p><pre class=\"brush:html;toolbar:false\">vim&nbsp;/etc/yum.repos.d/CentOS-Base.repo</pre><p>[base]、[updates]、[addons]、[extras]最后分别设置priority=1，[centosplus]、[contrib]最后分别设置priority=2，其他第三的软件源设置priority=N（推荐N&gt;10）。<br/></p><p><img src=\"/ueditor/php/upload/image/20170320/1490024718253754.png\" title=\"1490024718253754.png\" alt=\"blob.png\"/></p><p>（像上图这样加就行了）</p><p>4、安装rpmforge的软件仓库<br/>查看系统<a title=\"大型网站架构知识库\" href=\"http://lib.csdn.net/base/architecture\" target=\"_blank\">架构</a>：<br/></p><pre class=\"brush:css;toolbar:false\">uname&nbsp;-i</pre><p>i386系统执行：<br/><a href=\"http://repository.it4i.cz/mirrors/repoforge/redhat/el5/en/i386/rpmforge/RPMS/rpmforge-release-0.5.3-1.el5.rf.i386.rpm\"></a><br/></p><pre class=\"brush:java;toolbar:false\">rpm&nbsp;-ivh&nbsp;\r\nhttp://repository.it4i.cz/mirrors/repoforge/redhat/el5/en/i386/rpmforge/RPMS/rpmforge-release-0.5.3-1.el5.rf.i386.rpm</pre><p>x86_64系统执行：<br/><a href=\"http://repository.it4i.cz/mirrors/repoforge/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm\"></a></p><pre class=\"brush:html;toolbar:false\">rpm&nbsp;-ivh&nbsp;\r\nhttp://repository.it4i.cz/mirrors/repoforge/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm</pre><p>5、设置/etc/yum.repos.d/rpmforge.repo文件<br/></p><pre class=\"brush:html;toolbar:false\">vim&nbsp;/etc/yum.repos.d/rpmforge.repo</pre><p>[rpmforge]、[rpmforge-extras]、[rpmforge-testing]最后分别设置priority=11。<br/></p><p>9、验证是否设置成功<br/>执行：</p><pre class=\"brush:html;toolbar:false\">yum&nbsp;check-update</pre><p>查看是否有：Loaded plugins: fastestmirror, priorities<br/>如果看到上述信息，表明RPMforge安装源和优先级配置已经起作用了。<br/></p><p><br/></p>','RPMForge','RPMForge安装详细记录-亲测可用','第一遍安装真是蛋疼，第二遍有文档麻溜的不要不要的。把文档奉献出来，希望可以帮到有需要的朋友哦~','linux',0,151,1),(79,1490027733,1490027733,1490027733,'<h3>下载地址</h3><p><a href=\"http://php.net/get/php-5.5.38.tar.gz/from/a/mirror\">http://php.net/get/php-5.5.38.tar.gz/from/a/mirror</a></p><h3>解压，移动到/usr/local/src目录下</h3><pre class=\"brush:as3;toolbar:false\">tar&nbsp;zxvf&nbsp;php-5.5.38.tar.gz\r\nmv&nbsp;php-5.5.38&nbsp;/usr/local/src</pre><h3>加上编译参数</h3><pre class=\"brush:as3;toolbar:false\">./configure&nbsp;--prefix=/usr/local/php&nbsp;--with-config-file-path=/usr/local/php/etc&nbsp;--enable-fpm&nbsp;--with-fpm-user=php-fpm&nbsp;--with-fpm-group=php-fpm&nbsp;--with-mysql=/usr/local/mysql&nbsp;--with-mysql-sock=/tmp/mysql.sock&nbsp;--with-libxml-dir&nbsp;--with-gd&nbsp;--with-jpeg-dir&nbsp;--with-png-dir&nbsp;--with-freetype-dir&nbsp;--with-iconv-dir&nbsp;--with-zlib-dir&nbsp;--with-mcrypt&nbsp;--enable-soap&nbsp;--enable-gd-native-ttf&nbsp;--enable-ftp&nbsp;--enable-mbstring&nbsp;--enable-exif&nbsp;--disable-ipv6&nbsp;--with-pear&nbsp;--with-curl&nbsp;--with-openssl</pre><p>注释：</p><p>--enable-fpm 是包含php-fpm模块</p><p>--with-mysql 前提是要已经安装了mysql了</p><h3>错误解决</h3><p>第一次configure出现这样的错误：</p><p><img src=\"/ueditor/php/upload/image/20170320/1490022611192688.png\" title=\"1490022611192688.png\" alt=\"blob.png\"/></p><p>安装gcc解决问题：<br/></p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;install&nbsp;-y&nbsp;gcc*</pre><p>安装完gcc重新编译，报这样的错误：</p><p><span style=\"color: rgb(255, 0, 0);\">configure error xml2-config not found. please check your libxml2 installation 错误</span></p><p>安装libxml2和libxml2-devel解决问题：<br/></p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;install&nbsp;-y&nbsp;libxml2\r\nyum&nbsp;install&nbsp;-y&nbsp;libxml2-devel</pre><p>安装libxml2和libxml2-devel完再次重新编译，报这样的错误：</p><p><span style=\"color: rgb(69, 69, 69); font-family: Tahoma, Helvetica, Arial, STHeiti; font-size: 14px; background-color: rgb(253, 253, 253);\"></span></p><p><span style=\"color: rgb(255, 0, 0);\">configure: error: Cannot find OpenSSL&#39;s &lt;evp.h&gt;</span></p><p><span style=\"color: rgb(69, 69, 69); font-family: Tahoma, Helvetica, Arial, STHeiti; font-size: 14px; background-color: rgb(253, 253, 253);\"></span><img src=\"/ueditor/php/upload/image/20170320/1490023145310471.png\" title=\"1490023145310471.png\" alt=\"blob.png\"/></p><p>安装openssl和openssl-devel后，这一步算是过去了。</p><p><br/></p><p>再次重新编译，又出现新的错误，太蛋疼了^_^</p><p><span style=\"color: rgb(255, 0, 0);\">configure: error: Please reinstall the libcurl distribution -</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; easy.h should be in &lt;curl-dir&gt;/include/curl/</span></p><p>安装curl-devel:</p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;-y&nbsp;install&nbsp;curl-devel</pre><p>过了curl,再来编译，又报错了，是不是快崩溃了，哈哈</p><p><span style=\"color: rgb(255, 0, 0);\">configure: error: jpeglib.h not found.</span></p><p>安装libjpeg-devl</p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;-y&nbsp;install&nbsp;libjpeg-devel</pre><p>最好接着安装,要不然马上要报libpng的错误<br/></p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;-y&nbsp;install&nbsp;libpng-devel</pre><p>过了libjpeg和libpng，重新编译，又报错：</p><p><span style=\"color: rgb(255, 0, 0);\">configure: error: freetype-config not found.</span></p><p>安装freetype和freetype-devel<br/></p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;install&nbsp;-y&nbsp;freetype&nbsp;freetype-devel</pre><p><span style=\"color: rgb(255, 0, 0);\">过了freetype又来：</span></p><p><span style=\"color: rgb(255, 0, 0);\">configure: error: mcrypt.h not found. Please reinstall libmcrypt.</span></p><p>yum搜索这两个包，没有，尴尬了吧。</p><p><img src=\"/ueditor/php/upload/image/20170320/1490023923922856.png\" title=\"1490023923922856.png\" alt=\"blob.png\"/></p><p>这个时候，就要配另外一个yum源<span style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);\">rpmforge</span>，两个yum源一起搞看有没有。</p><p>配置rmpforge的步骤：</p><p><a href=\"http://ruanwenwu.cn/blog/78.html(亲测可用哦）\">http://ruanwenwu.cn/blog/78.html(亲测可用哦）</a> </p><p>配置完再来搞：妥妥的行了。</p><p><img src=\"/ueditor/php/upload/image/20170320/1490025277324497.png\" title=\"1490025277324497.png\" alt=\"blob.png\"/></p><p>别忘了：<br/></p><pre class=\"brush:as3;toolbar:false\">make&nbsp;&amp;&amp;&nbsp;make&nbsp;install</pre><p>经过几个世纪的等待，终于安装完——这一步^_^</p><p><img src=\"/ueditor/php/upload/image/20170321/1490026235488440.png\" title=\"1490026235488440.png\" alt=\"blob.png\"/></p><h3>配置</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p><strong>将php.ini挪到安装目录</strong><br/></p></li></ol><pre class=\"brush:as3;toolbar:false\">cp&nbsp;php.ini-production&nbsp;/usr/local/php/etc/php.in</pre><p><strong>&nbsp; &nbsp;2.将启动程序挪到/etc/init.d下</strong></p><p><img src=\"/ueditor/php/upload/image/20170321/1490026605183581.png\" title=\"1490026605183581.png\" alt=\"blob.png\"/></p><p>上面这些命令的意思分别是：将启动文件挪到/etc/init.d,给php-fpm可执行权限，将php-fpm加入自启动，并且加入开机启动。</p><p><strong>&nbsp; 3.建立php-fpm用户和用户组，因为我们在编译的时候就是指定的这个用户：</strong></p><pre class=\"brush:as3;toolbar:false\">useradd&nbsp;-s&nbsp;/sbin/nologin&nbsp;php-fpm&nbsp;-M</pre><p>&nbsp; 4<strong>.准备配置文件：</strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;在/usr/local/php/etc/下面有一个php-fpm.conf.default</p><p><img src=\"/ueditor/php/upload/image/20170321/1490026913590273.png\" title=\"1490026913590273.png\" alt=\"blob.png\"/></p><p>&nbsp; &nbsp; 我们直接改成php-fpm.conf就好了。<br/></p><p><strong>&nbsp; &nbsp;5.启动</strong><br/></p><p>&nbsp;<img src=\"/ueditor/php/upload/image/20170321/1490026984144100.png\" title=\"1490026984144100.png\" alt=\"blob.png\"/></p><p>&nbsp;<strong>&nbsp;&nbsp;&nbsp;6.查看启动情况（一个主进程，两个子进程）</strong><img src=\"/ueditor/php/upload/image/20170321/1490027034113284.png\" title=\"1490027034113284.png\" alt=\"blob.png\"/></p><p>&nbsp;<strong>&nbsp;&nbsp;&nbsp;7.查看监听端口(9000端口起来了）</strong><br/></p><p><img src=\"/ueditor/php/upload/image/20170321/1490027131753690.png\" title=\"1490027131753690.png\" alt=\"blob.png\"/></p><p>到这里就算完了。终于^_^</p><h3>总结</h3><p>搞了这么久，要是提前把这些依赖全部安装好再来搞就快多了。</p>','php编译安装','编译安装php5.5.38','谁装谁知道……','',0,137,1),(80,1490029157,1490029477,1490029157,'<p>								</p><h3>下载</h3><pre class=\"brush:as3;toolbar:false\">wget&nbsp;http://nginx.org/download/nginx-1.10.3.tar.gz</pre><p>nginx的官网是：www.nginx.org</p><h3>解压，移动到/usr/local/src目录</h3><pre class=\"brush:as3;toolbar:false\">tar&nbsp;zxvf&nbsp;nginx-1.10.3.tar.gz\r\ncp&nbsp;nginx-1.10.3&nbsp;/usr/local/src</pre><h3>编译安装</h3><pre class=\"brush:as3;toolbar:false\">cd&nbsp;nginx-1.10.3\r\n./configure&nbsp;--prefix=/usr/local/nginx&nbsp;--with-pcre</pre><p>安装完报错：</p><p><span style=\"color: rgb(255, 0, 0);\">./configure: error: the HTTP rewrite module requires the PCRE library.</span></p><p><span style=\"color: rgb(255, 0, 0);\">You can either disable the module by using --without-http_rewrite_module</span></p><p><span style=\"color: rgb(255, 0, 0);\">option, or install the PCRE library into the system, or build the PCRE library</span></p><p><span style=\"color: rgb(255, 0, 0);\">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span></p><p>安装pcre-devel解决问题：</p><pre class=\"brush:as3;toolbar:false\">yum&nbsp;install&nbsp;-y&nbsp;pcre-devel</pre><h3>完成安装</h3><pre class=\"brush:css;toolbar:false\">make&nbsp;&amp;&amp;&nbsp;make&nbsp;install</pre><p><img src=\"/ueditor/php/upload/image/20170321/1490029130858130.png\" title=\"1490029130858130.png\" alt=\"blob.png\"/></p><p><br/></p><p>启动与查看</p><p>nginx的启动命令就是/usr/local/nginx/sbin/nginx,比较奇葩啊，哈哈</p><p><img src=\"/ueditor/php/upload/image/20170321/1490029436893731.png\" title=\"1490029436893731.png\" alt=\"blob.png\"/></p><p>成功了，监听到80端口了。</p><p>nginx的安装的包比较小，安装起来还是很快滴~</p><p>							</p>','nginx','nginx1.10.3编译安装','编译nginx的一个过程，记录一下。','linux',0,159,1),(81,1490029271,1490029271,1490029271,'','听音乐','Bose入手，安静我有，哈哈哈~','掐死你的温柔。。。','说说',0,127,1),(82,1490030583,1490030583,1490030583,'<h3>先上一张配好的图片</h3><p><img src=\"/ueditor/php/upload/image/20170321/1490030267575216.png\" title=\"1490030267575216.png\" alt=\"blob.png\"/></p><h3><strong>步骤</strong></h3><p><strong>修改nginx.conf配置文件</strong></p><pre class=\"brush:as3;toolbar:false\">location&nbsp;~&nbsp;\\.php$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html;&nbsp;&nbsp;&nbsp;#这个就是网站的根目录\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass&nbsp;&nbsp;&nbsp;127.0.0.1:9000;&nbsp;&nbsp;#这个是你的php-fpm监听的端口\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_index&nbsp;&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param&nbsp;&nbsp;SCRIPT_FILENAME&nbsp;&nbsp;/usr/local/nginx/html$fastcgi_script_name;&nbsp;&nbsp;&nbsp;#注意/usr/local/nginx/html是你的网站的根目录\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><strong>修改配置文件后需要重新加载配置文件</strong></p><pre class=\"brush:as3;toolbar:false\">/usr/local/nginx/sbin/nginx&nbsp;-s&nbsp;reload</pre><p><strong>在html目录下建一个php文件</strong></p><pre class=\"brush:as3;toolbar:false\">&lt;?php\r\nphpinfo();</pre><p>通过浏览器访问以下吧，看到上面的图片里的内容，你就成功了。</p>','nginx','nginx支持php的配置','nginx支持php的最简配置','linux',0,152,1),(83,1490057149,1490057449,1490057149,'<p>								</p><h3>题记</h3><p>这一块的配置，就是虚拟机的配置。一个是默认虚拟主机，一个是我们正常需要提供服务的。</p><p>环境:</p><p>linux:CentOS release 6.5 (Final) (more /etc/issue查看）</p><p>nginx:nginx/1.10.3 &nbsp; (nginx -v查看,需要加环境变量)</p><p>php:PHP 5.5.38 (php -v查看，需要加环境变量</p><h3>步骤</h3><p><strong>在vhosts目录下（这个目录开始是需要自己创建的），创建default.conf。</strong></p><p>vim default.conf:</p><pre class=\"brush:as3;toolbar:false\">server\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80&nbsp;default_server;&nbsp;#default_server，这样这个虚拟主机就是默认虚拟主机\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;localhost;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/tmp/1233;\r\n&nbsp;&nbsp;&nbsp;&nbsp;deny&nbsp;all;&nbsp;#拒绝所有访问\r\n}</pre><p><strong>配置完重新载入nginx配置文件：（最好先-t测试一下有没有语法错误）</strong></p><pre class=\"brush:as3;toolbar:false\">/etc/init.d/nginx&nbsp;reload</pre><p><strong>检测是否成功：</strong></p><pre class=\"brush:as3;toolbar:false\">curl&nbsp;-x127.0.0.1:80&nbsp;localhost&nbsp;&nbsp;#别忘了加端口号，否则不会成功</pre><p>如果发现403就对了：</p><p><img src=\"/ueditor/php/upload/image/20170321/1490056996290812.png\" title=\"1490056996290812.png\" alt=\"blob.png\"/></p><p><strong>然后再建立一个我们真实项目需要的配置文件，比如ruanwenwu.conf</strong></p><p>vim ruanwenwu.conf</p><pre class=\"brush:as3;toolbar:false\">server\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;ruanwenwu.com;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/data/www;&nbsp;&nbsp;&nbsp;&nbsp;#这是你的项目根目录,如果没有需要创建，我创建了这个目录，还在里面写了个index.php\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;\\.php$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;fastcgi_params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass&nbsp;127.0.0.1:9000;&nbsp;&nbsp;&nbsp;&nbsp;#注意这里fastcgi_pass，看你启动的fpm是端口+ip模式还是socket模式,如果是端口+ip,选这种，如果是sock模式选下面。\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#fastcgi_pass&nbsp;unix:/tmp/php-fcgi.sock;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_index&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param&nbsp;SCRIPT_FILENAME&nbsp;/data/www$fastcgi_script_name;&nbsp;#前面的部分改成你的项目根目录\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p><strong>检查配置文件</strong></p><pre class=\"brush:as3;toolbar:false\">/etc/init.d/nginx&nbsp;-t</pre><p><strong>如果没有语法错误，重新载入</strong></p><pre class=\"brush:as3;toolbar:false\">/etc/inti.d/nginx&nbsp;reload</pre><p><strong>看成功没有</strong></p><pre class=\"brush:as3;toolbar:false\">curl&nbsp;-x127.0.0.1&nbsp;ruanwenwu.com</pre><p><img src=\"http://ruanwenwu.cn/Public/plugin/ueditor/themes/default/images/spacer.gif\"/><img src=\"/ueditor/php/upload/image/20170321/1490057118783258.png\" title=\"1490057118783258.png\" alt=\"blob.png\"/></p><p><br/></p><p>							</p>','nginx','简单的nginx虚拟主机配置','常用的nginx的虚拟主机配置，最基本的哦','linux',0,143,1),(84,1490065620,1490065620,1490065620,'','心情','三毛说，偶尔有那么一丝小喜悦就是极好的了','人生不如意的事太多，偶尔有这样的体验就知足吧~','说说',0,136,1),(85,1490099956,1490186986,1490099956,'<p>								</p><h3>将原先的配置文件清空，用以下的替换：<br/></h3><p>vim /usr/local/php/etc/php-fpm.conf</p><pre class=\"brush:as3;toolbar:false\">[global]&nbsp;&nbsp;#全局配置&nbsp;\r\npid&nbsp;=&nbsp;/usr/local/php/var/run/php-fpm.pid&nbsp;\r\nerror_log&nbsp;=&nbsp;/usr/local/php/var/log/php-fpm.log\r\n[www]&nbsp;&nbsp;&nbsp;#池子名称，一个网站可用一个自己的池子名称，池子可以指定自己的用户和用户组，这样更加安全，能够避免一个网站的用户被窃取了，连带的别的网站也受影响。再就是如果一个池子挂了，不至于影响别的池子。&nbsp;\r\nlisten&nbsp;=&nbsp;/tmp/php-fcgi.sock#监听的socket，可以自定义比如：/tmp/www.sock&nbsp;\r\nuser&nbsp;=&nbsp;php-fpm&nbsp;#池子的用户&nbsp;\r\ngroup&nbsp;=&nbsp;php-fpm&nbsp;#池子的用户组&nbsp;\r\npm&nbsp;=&nbsp;dynamic&nbsp;#进程是动态还是静态。如果是static,那么pm.start_servers，pm.min_spare_servers,pm.max_spare_servers都将失效。只有pm.max_children生效。而且数量不会变。&nbsp;\r\npm.max_children&nbsp;=&nbsp;50&nbsp;\r\npm.start_servers&nbsp;=&nbsp;20&nbsp;\r\npm.min_spare_servers&nbsp;=&nbsp;5&nbsp;\r\npm.max_spare_servers&nbsp;=&nbsp;35&nbsp;\r\npm.max_requests&nbsp;=&nbsp;500&nbsp;\r\nrlimit_files&nbsp;=&nbsp;1024#这个可以适当提高\r\nslowlog&nbsp;=&nbsp;/tmp/www-slow.log#慢日志\r\nrequest_slowlog_timeout&nbsp;=&nbsp;1\r\nphp-admin-value[open_basedir]&nbsp;=&nbsp;/data/www/&nbsp;#注意，这个要以/结尾，如果值为/data/www，那么实际上限定的是data目录，用户仍然可以在data目录活动。</pre><p>这个slowlog很好用，配置了该项后，执行时间超过1秒的都会被记录到/tmp/www-slow.log中。这对排查问题特别好用。</p><p>b.php</p><h3><img src=\"/ueditor/php/upload/image/20170322/1490186893122948.png\" title=\"1490186893122948.png\" alt=\"blob.png\"/></h3><p>执行后，/tmp/www-slow.log就记录下来了（确实很强大啊）：<br/></p><p><img src=\"/ueditor/php/upload/image/20170322/1490186935131706.png\" title=\"1490186935131706.png\" alt=\"blob.png\"/></p><h3>下面附一个多个进程池子的配置的例子：<br/></h3><pre class=\"brush:as3;toolbar:false\">[global]\r\npid&nbsp;=&nbsp;/usr/local/php/var/run/php-fpm.pid\r\nerror_log&nbsp;=&nbsp;/usr/local/php/var/log/php-fpm.log\r\n[www]\r\nlisten&nbsp;=&nbsp;/tmp/www.sock\r\nuser&nbsp;=&nbsp;php-fpm\r\ngroup&nbsp;=&nbsp;php-fpm\r\npm&nbsp;=&nbsp;dynamic\r\npm.max_children&nbsp;=&nbsp;50\r\npm.start_servers&nbsp;=&nbsp;20\r\npm.min_spare_servers&nbsp;=&nbsp;5\r\npm.max_spare_servers&nbsp;=&nbsp;35\r\npm.max_requests&nbsp;=&nbsp;500\r\nrlimit_files&nbsp;=&nbsp;1024\r\n[www1]\r\nlisten&nbsp;=&nbsp;/tmp/www1.sock\r\nuser&nbsp;=&nbsp;php-fpm\r\ngroup&nbsp;=&nbsp;php-fpm\r\npm&nbsp;=&nbsp;dynamic\r\npm.max_children&nbsp;=&nbsp;50\r\npm.start_servers&nbsp;=&nbsp;20\r\npm.min_spare_servers&nbsp;=&nbsp;5\r\npm.max_spare_servers&nbsp;=&nbsp;35\r\npm.max_requests&nbsp;=&nbsp;500\r\nrlimit_files&nbsp;=&nbsp;1024</pre><p><img src=\"/ueditor/php/upload/image/20170321/1490099261493853.png\" title=\"1490099261493853.png\" alt=\"blob.png\"/></p><p>（www1的池子起来了）<br/></p><p><img src=\"/ueditor/php/upload/image/20170321/1490099286925169.png\" title=\"1490099286925169.png\" alt=\"blob.png\"/></p><p>(www的池子起来了）</p><h3>php-fpm的池子怎么跟nginx联合起来呢？</h3><p>只需要修改虚拟机的配置如下：</p><pre class=\"brush:as3;toolbar:false\">server\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;111.com;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/data/www;\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;\\.php$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;fastcgi_params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#fastcgi_pass&nbsp;127.0.0.1:9000;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass&nbsp;unix:/tmp/www.sock;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_index&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param&nbsp;SCRIPT_FILENAME&nbsp;/data/www$fastcgi_script_name;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>重启nginx服务，访问网站，发现502了。为什么呢？</p><p>是因为nginx进程的执行用户是nobody，所以必须配置php-fpm配置文件，让php-fpm进程能够允许nobody用户。</p><p>修改php-fpm.conf文件：</p><p><img src=\"/ueditor/php/upload/image/20170321/1490103999566195.png\" title=\"1490103999566195.png\" alt=\"blob.png\"/></p><p>加上这两行，再访问就好了。</p><p>另外，项目的权限要给pool里的用户和用户组权限，在www这个池子里，就是php-fpm。</p><p><img src=\"/ueditor/php/upload/image/20170321/1490104456471097.png\" title=\"1490104456471097.png\" alt=\"blob.png\"/></p><p>有些项目把nginx的执行用户和组配成www,把所有的池子都配成www。</p><p>							</p>','php-fpm','php-fpm配置详解','简单又详细的php-fpm配置，一目了然','linux',0,154,1),(86,1490161849,1490165684,1490161849,'<p>								</p><h3>$_POST<br/></h3><p>只有Coentent-Type的值为application/x-<a href=\"http://www.form-urlencoded和multipart/form-data两种类型时，$_POST才能获取到数据。\">www.form-urlencoded和multipart/form-data两种类型时，$_POST才能获取到数据。</a></p><h3>$GLOBALS[&#39;HTTP_RAW_POST_DATA&#39;] 或者$HTTP_RAW_POST_DATA</h3><p>如果<a href=\"http://lib.csdn.net/base/php\" title=\"PHP知识库\" target=\"_blank\">PHP</a>无法识别Coentent-Type类型，也就无法获取请求数据，这个时候，可以用$GLOBALS[&#39;HTTP_RAW_POST_DATA&#39;]来获取。</p><h3>php://input</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>&nbsp;从使用结果看，php://input与$GLOBALS[&#39;HTTP_RAW_POST_DATA&#39;]的功能是一样的，但是，php://input需要的内存比较小，并且它不受 php.ini 配置文件的限制。</p></li><li><p>如果Coentent-Type的类型为multipart/form-data，使用php://input和$GLOBALS[&#39;HTTP_RAW_POST_DATA&#39;]是获取不到数据的，除此之外，php://input都能获取到数据。</p></li><li><p>&nbsp;仅当Coentent-Type的类型为application/x-www.form-urlencoded时，使用php://input和$_POST获取到的数据才是一致的。</p></li><li><p>&nbsp;使用方式：使用file_get_contents(&#39;php://input&#39;)获取请求数据。</p></li></ol><p>一段通过curl发送json数据的代码</p><p>请求页面：<br/></p><pre class=\"brush:as3;toolbar:false\">&lt;?php\r\nurl&nbsp;=&nbsp;&quot;http://test.ruanwenwu.cn/test2.php&quot;;\r\n$data&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;id&quot;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;3,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;photo&quot;&nbsp;=&gt;&nbsp;&nbsp;array(&quot;pic1&quot;,&quot;pic2&quot;,&quot;pic3&quot;),\r\n);\r\n$data&nbsp;=&nbsp;json_encode($data);\r\n$ch&nbsp;=&nbsp;curl_init();\r\ncurl_setopt($ch,&nbsp;CURLOPT_POST,&nbsp;1);\r\ncurl_setopt($ch,&nbsp;CURLOPT_URL,&nbsp;$url);\r\ncurl_setopt($ch,&nbsp;CURLOPT_POSTFIELDS,&nbsp;$data);\r\ncurl_setopt(&nbsp;$ch,&nbsp;CURLOPT_SSL_VERIFYPEER,&nbsp;false&nbsp;);\r\ncurl_setopt(&nbsp;$ch,&nbsp;CURLOPT_SSL_VERIFYHOST,&nbsp;false&nbsp;);\r\ncurl_setopt($ch,&nbsp;CURLOPT_HTTPHEADER,&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;Content-Type:&nbsp;application/json;&nbsp;charset=gbk&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;Content-Length:&nbsp;&#39;.strlen($data))\r\n);\r\n$result&nbsp;=&nbsp;curl_exec($ch);\r\n?&gt;</pre><p>接收页面：</p><pre class=\"brush:as3;toolbar:false\">&lt;?php\r\n$data&nbsp;=&nbsp;file_get_contents(&#39;php://input&#39;);\r\nfile_put_contents(&quot;ruanwenwue.txt&quot;,&nbsp;$data);die;\r\n$data&nbsp;=&nbsp;json_decode($HTTP_RAW_POST_DATA);\r\n//file_put_contents(&quot;ruanwenwu.txt&quot;,&nbsp;$data-&gt;id);\r\nfile_put_contents(&quot;ruanwenwud.txt&quot;,$HTTP_RAW_POST_DATA);</pre><p>因为请求的无法打印，我就直接写入文件了。接收到的json数据需要json_decode之后使用。</p><h3 style=\"white-space: normal;\">补充：什么是x-<a href=\"http://www.form-urlencode/?\">www.form-urlencode?</a></h3><p style=\"white-space: normal;\">看这个表单：</p><pre class=\"brush:as3;toolbar:false\">&lt;?php\r\n&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Content-type:text/html;charset=gbk&quot;);&nbsp;\r\n?&gt;\r\n&lt;form&nbsp;action&nbsp;=&quot;/test.php&quot;&nbsp;method=&quot;post&quot;&gt;\r\n用户名：&lt;input&nbsp;type=&quot;text&quot;&nbsp;name=&quot;username&quot;&nbsp;/&gt;&lt;br/&gt;\r\n密码：&lt;input&nbsp;type=&quot;password&quot;&nbsp;name=&quot;password&quot;&nbsp;/&gt;&lt;br/&gt;\r\n&lt;input&nbsp;type=&quot;submit&quot;&nbsp;value=&quot;提交&quot;&nbsp;/&gt;\r\n&lt;/form&gt;</pre><p style=\"white-space: normal;\"><img src=\"http://ruanwenwu.cn/ueditor/php/upload/image/20170322/1490165477395726.png\" title=\"1490165477395726.png\" alt=\"blob.png\"/></p><p style=\"white-space: normal;\">通过post请求过去，没有发送图片的情况下，就是application/x-www-form-urlencoded</p><p><br/></p><p>							</p>','php://input','$_POST,$GLOBALS[\'HTTP_RAW_POST_DATA\']和php://input的区别','接受数据时常会用到的几个东西，做了几个小实验，记录一下。','php',0,205,1),(87,1490188020,1490310638,1490188020,'<p>								</p><h3>客户端设计图</h3><p><img src=\"/ueditor/php/upload/image/20170322/1490187120560655.png\" title=\"1490187120560655.png\" alt=\"blob.png\"/></p><h3>php需要捕获这些数据，包括图片，入库。</h3><p>客户端最终传输的数据格式：</p><p><img src=\"/ueditor/php/upload/image/20170322/1490187208572030.png\" title=\"1490187208572030.png\" alt=\"blob.png\"/></p><p>注意：photo是去掉了图片类型和base64标志的base64数据格式：</p><p><img src=\"/ueditor/php/upload/image/20170322/1490187266302922.png\" title=\"1490187266302922.png\" alt=\"blob.png\"/>（完整格式）</p><p>客户端怎么传的我不懂，如果用Php模拟提交这部分数据的话是这样：</p><pre class=\"brush:as3;toolbar:false\">$url&nbsp;=&nbsp;&quot;http://ask.rww.com.cn/test2.php&quot;;\r\n$data&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;id&quot;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;3,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;photo&quot;&nbsp;=&gt;&nbsp;&nbsp;array(&quot;pic1&quot;,&quot;pic2&quot;,&quot;pic3&quot;),\r\n);\r\n$data&nbsp;=&nbsp;json_encode($data);#注意，这里转换成json格式了。\r\n$ch&nbsp;=&nbsp;curl_init();\r\ncurl_setopt($ch,&nbsp;CURLOPT_POST,&nbsp;1);\r\ncurl_setopt($ch,&nbsp;CURLOPT_URL,&nbsp;$url);\r\ncurl_setopt($ch,&nbsp;CURLOPT_POSTFIELDS,&nbsp;$data);\r\ncurl_setopt(&nbsp;$ch,&nbsp;CURLOPT_SSL_VERIFYPEER,&nbsp;false&nbsp;);\r\ncurl_setopt(&nbsp;$ch,&nbsp;CURLOPT_SSL_VERIFYHOST,&nbsp;false&nbsp;);\r\ncurl_setopt($ch,&nbsp;CURLOPT_HTTPHEADER,&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;Content-Type:&nbsp;application/json;&nbsp;charset=gbk&#39;,#头上指定了格式\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;Content-Length:&nbsp;&#39;.strlen($data))\r\n);\r\n$result&nbsp;=&nbsp;curl_exec($ch);</pre><h3>php收到数据后的处理：</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>通过php://input或者$HTTP_RAW_POST_DATA接收原始数据。json_decode成对象以供使用。伪代码：</p><p>$data = json_decode($HTTP_RAW_POST_DATA)；</p></li><li><p>下载图片。</p></li></ol><pre class=\"brush:as3;toolbar:false\">$img&nbsp;=&nbsp;array();\r\nforeach&nbsp;($data-&gt;photo&nbsp;as&nbsp;$key=&gt;$val){\r\n	$str&nbsp;&nbsp;&nbsp;=&nbsp;&quot;data:image/png;base64,&quot;;&nbsp;&nbsp;&nbsp;&nbsp;//加上头信息，如果有就不需要了\r\n	$str&nbsp;&nbsp;.=&nbsp;$val;\r\n	$img1&nbsp;=&nbsp;down(array(\r\n		&#39;base64Str&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;$str,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#base64的字符串\r\n	));\r\n	$img[]&nbsp;=&nbsp;$img1;\r\n}\r\n\r\nfunction&nbsp;down($paramArr){\r\n&nbsp;&nbsp;&nbsp;&nbsp;$options&nbsp;=&nbsp;array(\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;base64Str&#39;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;false,&nbsp;#base64的字符串&nbsp;格式为data:image/png;base64,\r\n&nbsp;&nbsp;&nbsp;&nbsp;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(is_array($paramArr))$options&nbsp;=&nbsp;array_merge($options,&nbsp;$paramArr);\r\n&nbsp;&nbsp;&nbsp;&nbsp;extract($options);\r\n&nbsp;&nbsp;&nbsp;&nbsp;if(!$base64Str)return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$pos&nbsp;=&nbsp;strpos($base64Str,&nbsp;&#39;;base64,&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;if(!$pos)return&nbsp;false;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;base64_decode(substr($base64Str,&nbsp;$pos+8));\r\n&nbsp;&nbsp;&nbsp;&nbsp;$ext&nbsp;&nbsp;=&nbsp;trim(str_replace(&quot;data:image/&quot;,&nbsp;&quot;&quot;,substr($base64Str,&nbsp;0,$pos)));\r\n&nbsp;&nbsp;&nbsp;&nbsp;$tmpFile&nbsp;=&nbsp;&quot;/tmp/&quot;.SYSTEM_TIME&nbsp;.&nbsp;rand(0,&nbsp;1000)&nbsp;.&nbsp;&quot;.&quot;.$ext;\r\n&nbsp;&nbsp;&nbsp;&nbsp;file_put_contents($tmpFile,&nbsp;$data);\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$tmpFile;&nbsp;\r\n}</pre><p><br/></p><p>							</p>','base64','与客户端配合做数据写入（包括图片处理）','客户端传输json数据到php，php入库操作。','php',0,150,1),(88,1490192202,1490273082,1490192202,'<p>								</p><h3>最后的效果：</h3><p><img src=\"/ueditor/php/upload/image/20170322/1490191768608433.png\" title=\"1490191768608433.png\" alt=\"blob.png\"/></p><h3>配置：</h3><p>cat /usr/local/nginx/conf/vhosts/111.conf</p><p>server</p><p>{</p><p>&nbsp; &nbsp; listen 80;</p><p>&nbsp; &nbsp; server_name www.111.com;</p><p>&nbsp; &nbsp; index index.html index.htm index.php;</p><p>&nbsp; &nbsp; root /data/www/upload;</p><p><br/></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; location ~ .*admin\\.php$ {</span></p><p><span style=\"color: rgb(255, 0, 0);\"><span class=\"Apple-tab-span\" style=\"color: rgb(255, 0, 0); white-space: pre;\"></span>auth_basic &quot;ruanwenwu auth&quot;;</span></p><p><span style=\"color: rgb(255, 0, 0);\"><span class=\"Apple-tab-span\" style=\"color: rgb(255, 0, 0); white-space: pre;\"></span>auth_basic_user_file /usr/local/nginx/conf/.htpasswd;</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; }</span></p><p><span style=\"white-space: pre; color: rgb(255, 0, 0);\"></span></p><p><br/></p><p>&nbsp; &nbsp; location ~ \\.php$ {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; include fastcgi_params;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #fastcgi_pass 127.0.0.1:9000; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass unix:/tmp/www.sock;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_index index.php;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param SCRIPT_FILENAME /data/www/upload$fastcgi_script_name;</p><p>&nbsp; &nbsp; }</p><p><br/></p><p>}</p><h3>就是红色的部分起的作用。其中/usr/local/ngin/conf/.htpasswd是这样生成的：</h3><p><img src=\"/ueditor/php/upload/image/20170323/1490272994744213.png\" title=\"1490272994744213.png\" alt=\"blob.png\"/></p><p>简单说明：先找到htpasswd文件。如果没有的话，有两种方式生成，一种是编译安装apache,一种是yum install -y httpd。找到htpasswd后，运行生成密码文件的命令。这个过程需要重复输入密码。最后cat查看的结果是最后一行。</p><h3>但是这样有个问题，就是授权后（登陆），admin.php会被下载，这简直太可怕了。这是因为这个规则不能解析php.</h3><p><img src=\"/ueditor/php/upload/image/20170322/1490191958876201.png\" title=\"1490191958876201.png\" alt=\"blob.png\"/>(下载了）</p><p>怎么办?答案是让这部分配置支持php解析就好了，将配置文件修改如下：</p><p>server</p><p>{</p><p>&nbsp; &nbsp; listen 80;</p><p>&nbsp; &nbsp; server_name www.111.com;</p><p>&nbsp; &nbsp; index index.html index.htm index.php;</p><p>&nbsp; &nbsp; root /data/www/upload;</p><p><br/></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; location ~ .*admin\\.php$ {</span></p><p><span style=\"color: rgb(255, 0, 0);\"><span class=\"Apple-tab-span\" style=\"color: rgb(255, 0, 0); white-space: pre;\"></span>auth_basic &quot;ruanwenwu auth&quot;;</span></p><p><span style=\"color: rgb(255, 0, 0);\"><span class=\"Apple-tab-span\" style=\"color: rgb(255, 0, 0); white-space: pre;\"></span>auth_basic_user_file /usr/local/nginx/conf/.htpasswd;</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; &nbsp; &nbsp; include fastcgi_params;</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass unix:/tmp/www.sock;</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_index index.php;</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param SCRIPT_FILENAME /data/www/upload$fastcgi_script_name;</span></p><p><span style=\"color: rgb(255, 0, 0);\">&nbsp; &nbsp; }</span></p><p><span style=\"white-space: pre; color: rgb(255, 0, 0);\"></span></p><p><br/></p><p>&nbsp; &nbsp; location ~ \\.php$ {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; include fastcgi_params;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #fastcgi_pass 127.0.0.1:9000; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass unix:/tmp/www.sock;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_index index.php;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param SCRIPT_FILENAME /data/www/upload$fastcgi_script_name;</p><p>&nbsp; &nbsp; }</p><p><br/></p><p>}</p><p>这样就正常了，不会再下载了。</p><p>							</p>','安全','nginx用户认证','反正就是更安全了，看看就知道。','linux',0,180,1),(89,1490238898,1490238898,1490238898,'<h3>一、问题：</h3><p>安装wordpress时，跟着安装操作指引，到数据库配置时，一直出错。</p><h3>二、解决办法</h3><p>在数据库里创建名为wordpress的数据库，然后再继续安装，果断成功了。</p><h3>三、评论</h3><p>这个安装程序不太智能，数据库不能自动创建啊。</p><h3>四、上线地址</h3><p><a href=\"http://wss.ruanwenwu.cn\" target=\"_blank\" title=\"王珊珊的网络日志\">王珊珊的网络日志</a></p>','wordpress','安装wordpress时遇到的一个坑','安装wordpress时，跟着安装操作指引，到数据库配置时，一直出错。','php',0,126,1),(90,1490247582,1490318917,1490247582,'<p>								</p><h3>一、问题<br/></h3><p>这两天写的文章有点多。搜索服务没有做增量索引，也没有做每天的计划任务跑全部索引，新写的文章搜不到，所以中午抽一点时间把搜索功能完善一下。</p><h3>二、几个概念</h3><p>索引（一般是所有数据的索引）：就是你的数据源的所有的数据源（source）的集合。</p><p>增量索引：索引生成后，文章还在继续增加中。这时候就用到增量索引了。php查询的时候，可以用到这一部分，这就保证新加入的数据能够被搜索到。</p><p>主索引：就是数据量多的那个。</p><h3>三、解决步骤</h3><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p><strong>原来的索引记录到id为76的文章了。原本可以重新索引一下，但是这样每次重新索引的话，1来数据量大的话是很慢的，2来不及时。</strong></p><p>原来的main source的索引sql为：</p><p>SELECT id,title,summary,content,ctime,mtime,category from z_post</p><p>上面这个sql是生成全部数据的索引，如果考虑到增量索引就需要修改成这样：</p><p>SELECT id,title,summary,content,ctime,mtime,category from z_post WHERE id&lt;=( SELECT max_doc_id FROM sph_counter WHERE counter_id=1 )</p><p>对应的delta source（增量索引源）的sql需要进行配置（这是在没有增量索引的基础上增加的部分）：</p></li></ol><pre class=\"brush:as3;toolbar:false\">source&nbsp;delta&nbsp;:&nbsp;main\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_pre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SET&nbsp;NAMES&nbsp;utf8\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;z_post&nbsp;WHERE&nbsp;id&gt;(&nbsp;SELECT&nbsp;max_doc_id&nbsp;FROM&nbsp;sph_counter&nbsp;WHERE&nbsp;counter_id=1&nbsp;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;#sql_query_post_index&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;REPLACE&nbsp;INTO&nbsp;sph_counter&nbsp;SELECT&nbsp;1,MAX(id)&nbsp;FROM&nbsp;z_post&nbsp;&nbsp;#这个貌似注释才行\r\n}</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;除了配置数据源之外，delta源的index配置也需要增加：<br/></p><pre class=\"brush:as3;toolbar:false\">index&nbsp;delta&nbsp;:&nbsp;main\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;delta\r\n&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;/usr/local/coreseek/var/data/delta/delta\r\n}</pre><p>最终的配置文件：<br/></p><pre class=\"brush:as3;toolbar:false\">#MySQL数据源配置，详情请查看：http://www.coreseek.cn/products-install/mysql/\r\n#请先将var/test/documents.sql导入数据库，并配置好以下的MySQL用户密码数据库\r\n#源定义\r\nsource&nbsp;main\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;mysql\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;localhost\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;root\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_pass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7DMKne22\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;blog\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3306\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_pre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SET&nbsp;NAMES&nbsp;utf8\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_pre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;REPLACE&nbsp;INTO&nbsp;sph_counter&nbsp;SELECT&nbsp;1,MAX(id)&nbsp;FROM&nbsp;z_post&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SELECT&nbsp;id,title,summary,content,ctime,mtime,category&nbsp;from&nbsp;z_post&nbsp;WHERE&nbsp;id&lt;=(&nbsp;SELECT&nbsp;max_doc_id&nbsp;FROM&nbsp;sph_counter&nbsp;WHERE&nbsp;counter_id=1&nbsp;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#sql_query第一列id需为整数\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#title、content作为字符串/文本字段，被全文索引\r\n&nbsp;&nbsp;&nbsp;&nbsp;#sql_attr_uint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;group_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#从SQL读取到的值必须为整数\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_attr_timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ctime&nbsp;#从SQL读取到的值必须为整数，作为时间属性\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_attr_timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;mtime&nbsp;#从SQL读取到的值必须为整数，作为时间属性\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_info_pre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SET&nbsp;NAMES&nbsp;utf8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#命令行查询时，设置正确的字符集\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_info&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SELECT&nbsp;*&nbsp;from&nbsp;z_post&nbsp;WHERE&nbsp;id=$id&nbsp;#命令行查询时，从数据库读取原始数据信息\r\n}\r\nsource&nbsp;delta&nbsp;:&nbsp;main&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_pre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SET&nbsp;NAMES&nbsp;utf8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SELECT&nbsp;id,title,summary,content,ctime,mtime,category&nbsp;FROM&nbsp;z_post&nbsp;WHERE&nbsp;id&gt;(&nbsp;SELECT&nbsp;max_doc_id&nbsp;FROM&nbsp;sph_counter&nbsp;WHERE&nbsp;counter_id=1&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;sql_query_post_index&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;REPLACE&nbsp;INTO&nbsp;sph_counter&nbsp;SELECT&nbsp;1,MAX(id)&nbsp;FROM&nbsp;z_post&nbsp;\r\n}&nbsp;\r\n#index定义\r\nindex&nbsp;main\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;main&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#对应的source名称\r\n&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;/usr/local/coreseek/var/data/mysql/mysql&nbsp;#请修改为实际使用的绝对路径，例如：/usr/local/coreseek/var/...\r\n&nbsp;&nbsp;&nbsp;&nbsp;docinfo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;extern\r\n&nbsp;&nbsp;&nbsp;&nbsp;mlock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;morphology&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;none\r\n&nbsp;&nbsp;&nbsp;&nbsp;min_word_len&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1\r\n&nbsp;&nbsp;&nbsp;&nbsp;html_strip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;#中文分词配置，详情请查看：http://www.coreseek.cn/products-install/coreseek_mmseg/\r\n&nbsp;&nbsp;&nbsp;&nbsp;charset_dictpath&nbsp;=&nbsp;/usr/local/mmseg/etc/&nbsp;#BSD、Linux环境下设置，/符号结尾\r\n&nbsp;&nbsp;&nbsp;&nbsp;#charset_dictpath&nbsp;=&nbsp;etc/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Windows环境下设置，/符号结尾，最好给出绝对路径，例如：C:/usr/local/coreseek/etc/...\r\n&nbsp;&nbsp;&nbsp;&nbsp;charset_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;zh_cn.utf-8\r\n}\r\nindex&nbsp;delta&nbsp;:&nbsp;main&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;delta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;/usr/local/coreseek/var/data/delta/delta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n}&nbsp;&nbsp;&nbsp;&nbsp;\r\n#全局index定义\r\nindexer\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;mem_limit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;128M\r\n}\r\n#searchd服务定义\r\nsearchd\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;9312\r\n&nbsp;&nbsp;&nbsp;&nbsp;read_timeout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5\r\n&nbsp;&nbsp;&nbsp;&nbsp;max_children&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;30\r\n&nbsp;&nbsp;&nbsp;&nbsp;max_matches&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1000\r\n&nbsp;&nbsp;&nbsp;&nbsp;seamless_rotate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;preopen_indexes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;unlink_old&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1\r\n&nbsp;&nbsp;&nbsp;&nbsp;pid_file&nbsp;=&nbsp;/usr/local/coreseek/var/log/searchd_mysql.pid&nbsp;&nbsp;#请修改为实际使用的绝对路径，例如：/usr/local/coreseek/var/...\r\n&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;=&nbsp;/usr/local/coreseek/var/log/searchd_mysql.log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#请修改为实际使用的绝对路径，例如：/usr/local/coreseek/var/...\r\n&nbsp;&nbsp;&nbsp;&nbsp;query_log&nbsp;=&nbsp;/usr/local/coreseek/var/log/query_mysql.log&nbsp;#请修改为实际使用的绝对路径，例如：/usr/local/coreseek/var/...\r\n}</pre><p><strong>2.建计数表：sph_counter,就两个字段，值分别为1和当前索引到的位置</strong><br/></p><p>&nbsp; &nbsp;&nbsp;<img src=\"/ueditor/php/upload/image/20170323/1490247115156226.png\" title=\"1490247115156226.png\" alt=\"blob.png\"/></p><p><strong>3.生成delta索引：</strong></p><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">/usr/local/coreseek/bin/indexer&nbsp;-c&nbsp;/usr/local/coreseek/etc/csft_mysql.conf&nbsp;delta&nbsp;--rotate &nbsp;</span></span></p><p><strong><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">4.关掉当前正在运行的搜索服务</span></span></strong></p><p><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">/usr/local/coreseek/bin/searchd&nbsp;-c&nbsp;/usr/local/coreseek/etc/csft_mysql.conf&nbsp;--stop</span></p><p><strong><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">5.重新开启（开启前我新建了delta数据源的目录/usr/local/coreseek/var/data/delta/）</span></strong></p><p><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;/usr/local/coreseek/bin/searchd&nbsp;-c&nbsp;/usr/local/coreseek/etc/csft_mysql.conf</span></p><p><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">开启后，php部分在查询的时候，带上delta源发现已经有数据了，而且max_doc_id从75变成了89,这说明增量索引生成成功，并且服务正常。</span></p><p><strong><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">6.将下面这些加入到计划任务</span></strong></p><p><br/></p><ol style=\"padding: 0px; border: none; list-style-position: initial; list-style-image: initial; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; white-space: normal; margin-bottom: 1px !important; margin-left: 45px !important;\" class=\" list-paddingleft-2\"><li><p><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">*/1&nbsp;*&nbsp;*&nbsp;*&nbsp;* &nbsp;/usr/local/coreseek/bin/indexer&nbsp;-c&nbsp;/usr/local/coreseek/etc/csft_mysql.conf&nbsp;delta&nbsp;--rotate&nbsp;&nbsp;&nbsp;&nbsp;</span></p></li><li><p><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">*/5&nbsp;*&nbsp;*&nbsp;*&nbsp;* &nbsp;/usr/local/coreseek/bin/indexer&nbsp;-c&nbsp;/usr/local/coreseek/etc/csft_mysql.conf&nbsp;--merge&nbsp;main&nbsp;delta&nbsp;--rotate&nbsp;--merge-dst-range&nbsp;deleted&nbsp;0&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp; #这个开启了有问题，后台注释掉了<br/></span></p></li><li><p><span style=\"color: black; margin: 0px; padding: 0px; border: none; background-color: inherit;\">30&nbsp;1&nbsp;*&nbsp;*&nbsp;* &nbsp; /usr/local/coreseek/bin/indexer&nbsp;-c&nbsp;/usr/local/coreseek/etc/csft_mysql.conf&nbsp;--all&nbsp;--rotate &nbsp;</span></p></li></ol><p>它们代表，每分钟执行一次增量索引，每五分钟合并一次索引，每天1点30分执行一次全部索引。</p><p><br/></p><p><br/></p><p>							</p>','coreseek','搜索服务安装了增量索引，索引合并，和重新索引','这两天写的文章有点多。搜索服务没有做增量索引，也没有做每天的计划任务跑全部索引，新写的文章搜不到，所以中午抽一点时间把搜索功能完善一下。','php',0,108,1),(94,1490277857,1490277857,1490277857,'<h3>先看一张配置成功的图片：</h3><p><img src=\"/ueditor/php/upload/image/20170323/1490276314949841.png\" title=\"1490276314949841.png\" alt=\"blob.png\"/></p><p>（浏览器中输入<a href=\"http://www.test.com,发现马上跳到www.111.com了。而跳到www.111.com/forum.php是程序在index.php里做了跳转）。\">www.test.com,发现马上跳到www.111.com了。而跳到www.111.com/forum.php是程序在index.php里做了跳转）。</a> </p><h3>配置（写在server里）</h3><pre class=\"brush:as3;toolbar:false\">if&nbsp;($host&nbsp;!=&nbsp;&#39;www.111.com&#39;)\r\n{\r\n&nbsp;&nbsp;&nbsp;rewrite&nbsp;^/(.*)$&nbsp;http://www.111.com/$1&nbsp;permanent;\r\n}</pre><p>实际上用的是nginx的rewrite模块。<span style=\"color: rgb(255, 0, 0);\">rewrite可以用在if里，server里，location里。</span>nginx的rewrite模块分成四个部分：</p><p>最左侧：rewrite关键词。</p><p>其次：匹配的规则如：^/(.*)$。</p><p>接着是：匹配的url要跳转的地方，$1代表上一部分的匹配规则中的第一个括号的内容。</p><p>第四部分：flag。常用的flag有：</p><p>&nbsp;&nbsp;&nbsp;&nbsp;permanent 永久重定向301 &nbsp;<span style=\"color: rgb(255, 0, 0);\">浏览器地址跳转</span><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;redirect 临时重定向302 &nbsp;<span style=\"color: rgb(255, 0, 0);\">浏览器地址跳转</span><br/></p><p>&nbsp;&nbsp;&nbsp;&nbsp;last/break 都表示结束匹配 &nbsp;<span style=\"color: rgb(255, 0, 0);\">浏览器地址不跳转</span><br/></p><h3>几个rewrite的实例</h3><pre class=\"brush:as3;toolbar:false\">if&nbsp;($http_user_agent&nbsp;~&nbsp;MSIE)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;^(.*)$&nbsp;/nginx-ie/$1&nbsp;break;\r\n}</pre><p>这个rewrite的意思是，如果user_agent里包含MSIE就跳到nginx-ie这个目录下。</p><h3>补充知识点：</h3><pre class=\"brush:as3;toolbar:false\">~&nbsp;为区分大小写匹配\r\n~*&nbsp;为不区分大小写匹配\r\n!~和!~*分别为区分大小写不匹配及不区分大小写不匹\r\n-f和!-f用来判断是否存在文件\r\n-d和!-d用来判断是否存在目录\r\n-e和!-e用来判断是否存在文件或目录\r\n-x和!-x用来判断文件是否可执行</pre><p>上面这几条知识点好像挺难记，但是还是有规律的。~表示匹配 ！~表示不匹配，*表示不区分大小写。这样前面3条就都记住了。f表示文件，d表示目录，e代表exist，x表示chmod里的x，！表示否，这样后面的也就都记住 了。现在回头来看$http_user_agent ~MSIE,意思就是如果user_agent区分大小写匹配MSIE成立的话。</p><p><br/></p>','重定向','nginx实现重定向','使用nginx实现301,302重定向的方法','linux',0,140,1),(95,1490311246,1490311246,1490311246,'<h3>一、在nginx全局配置的http部分增加如下配置：</h3><p>vim /usr/local/nginx/conf/nginx.conf<br/></p><pre class=\"brush:as3;toolbar:false\">&nbsp;log_format&nbsp;ruanwenwu&nbsp;&#39;$remote_addr&nbsp;$http_x_forwarded_for&nbsp;[$time_local]&#39;\r\n&nbsp;&#39;&nbsp;$host&nbsp;&quot;$request_uri&quot;&nbsp;$status&nbsp;&#39;\r\n&nbsp;&#39;&quot;$http_referer&quot;&nbsp;&quot;$http_user_agent&quot;&#39;;</pre><p>注意，上面这三行连起来是一句，结尾用分号别忘了。简单解释：log_format是定义日志格式，ruanwenwu相当于是日志格式的变量名，后面的一长串代表记录的日志的内容。</p><p>$remote_addr 真实ip</p><p>$http_x_forwarded_for 代理ip</p><p>$time_local 时间 ,注意这两个[]只是格式化显示的作用，没有语法意义。这中间的双引号也是，只是为了显示的时候带上，下面是这条规则捉到的日志。没有代理ip好像用-（横杠）来代替了。</p><pre class=\"brush:as3;toolbar:false\">45.117.156.124&nbsp;-&nbsp;[23/Mar/2017:23:26:18&nbsp;+0800]www.ruanwenwu.cn&nbsp;&quot;/&quot;&nbsp;200&quot;http://www.ruanwenwu.cn&quot;&nbsp;&quot;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;6.1;&nbsp;WOW64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/39.0.2171.95&nbsp;Safari/537.36&quot;</pre><h3>二、然后在虚拟主机的server上增加配置</h3><p>vim /usr/local/nginx/conv/vhosts/111.conf</p><pre class=\"brush:as3;toolbar:false\">access_log&nbsp;/data/wwwlogs/access_log.ruanwenwu.cn.log&nbsp;ruanwenwu;#结尾的这个ruanwenwu就是我们在全局http配置中设置的日志变量。</pre><p>其实加上这一行，再重新加载我们的配置文件就好了。但是这样有一个问题，css和js或者图片的访问日志都会记录下来，这不是我们想要的。所以需要配置，让这些文件不作记录。配置部分如下：</p><pre class=\"brush:as3;toolbar:false\">&nbsp;location&nbsp;~&nbsp;.*\\.(gif|jpg|jpeg|png|bmp|swf|flv|ico)$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires&nbsp;30d;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;off;\r\n&nbsp;}\r\n&nbsp;location&nbsp;~&nbsp;.*\\.(js|css)$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires&nbsp;7d;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;off;\r\n&nbsp;}</pre><p>注：~表示区分大小写匹配，这个我在上一篇文章<a href=\"/blog/94.html\" target=\"_self\">nginx实现重定向</a>里总结过了。</p><p>上面这两句的意思是，如果访问地址匹配到图片（任意格式）或者css或者js,一律不记录日志。一句access_log off;就搞定了。expires 30d;代表30天过期的缓存。</p><p>最后附上相关配置：</p><p>虚拟主机（不包含php解析部分）：</p><pre class=\"brush:as3;toolbar:false\">server&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;ruanwenwu.cn&nbsp;www.ruanwenwu.cn;\r\n&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;/xxx/xxx/access_log.ruanwenwu.cn.log&nbsp;ruanwenwu;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/data/xxx/blog;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;.*\\.(gif|jpg|jpeg|png|bmp|swf|flv|ico)$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires&nbsp;30d;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;off;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;.*\\.(js|css)?$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires&nbsp;7d;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;off;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p><br/></p>','日志','nginx访问日志（与不记录指定类型日志）','访问日志对于我们监听网站流量来自什么地方特别有用。','linux',0,117,1),(96,1490314449,1490318321,1490314449,'<p>								</p><h3>一、不是废话的废话</h3><p>nginx不像apache一样自带切割日志的方法——此刻有没有觉得apache高大上？^_^——。说到apache，顺便贴一下apache切割日志的方法：</p><pre class=\"brush:as3;toolbar:false\">&lt;VirtualHost&nbsp;*:80&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;CustomLog&nbsp;&quot;|/usr/local/apache2/bin/rotatelogs&nbsp;-l&nbsp;/usr/local/apache2/logs/mydiscuz.com-access.com-access_%Y%m%d_log&nbsp;86400&quot;&nbsp;combined\r\n&lt;/VirtualHost&gt;</pre><p>意思是86400(每天）生成一份。/bin/rotatelogs -l 是命令，/usr/local/apache2/logs/mydiscuz.com-access_%Y%m%d_log是文件路径。combined跟nginx里的log_format规定的变量名称是一个意思。</p><p>言归正传。nginx的日志切割，必须要自己写个脚本来完成。思路是：每天0点跑个计划任务，把前一天的日志移到指定的目录，然后重新载入配置文件，最好是压缩一下就完美了。</p><h3>二、shell代码实现</h3><pre class=\"brush:as3;toolbar:false\">#!/bin/bash\r\nd=`date&nbsp;-d&nbsp;&quot;-1&nbsp;day&quot;&nbsp;+%F`\r\n[&nbsp;-d&nbsp;/data/wwwlogs/cutedlogs&nbsp;]&nbsp;||&nbsp;mkdir&nbsp;/data/wwwlogs/cutedlogs\r\nmv&nbsp;/data/wwwlogs/access_log.ruanwenwu.cn.log&nbsp;/data/wwwlogs/cutedlogs/$d.log\r\n/etc/init.d/nginx&nbsp;reload&nbsp;&gt;&nbsp;/dev/null\r\ncd&nbsp;/data/wwwlogs/cutedlogs\r\ngzip&nbsp;-f&nbsp;$d.log</pre><p>第一行建立d这个变量。第二行判断如果cutedlogs不存在就创建。第三行将现在的日志移到cutedlogs。第四行重载配置文件。第五行进入cuted目录。第六行进行压缩。</p><p>小知识：shell -x xx.sh是让直行过程可见。</p><p>实现截图：</p><p><img src=\"/ueditor/php/upload/image/20170324/1490314072745981.png\" title=\"1490314072745981.png\" alt=\"图片.png\"/></p><h3>三、添加计划任务，让每天0点执行</h3><p>crontab -e,添加：</p><p>#每天切割日志<br/></p><pre class=\"brush:as3;toolbar:false\">0&nbsp;0&nbsp;*&nbsp;*&nbsp;*&nbsp;/bin/sh&nbsp;/root/shellscripts/cutaccesslog.sh</pre><p>							</p>','日志','nginx日志切割','但凡是有点流量的网站访问日志都会比较大。不做切割的话，时间久了就没法看了。跟我一起来看看nginx切割日志的方法吧。','linux',0,134,1),(97,1490316920,1490318289,1490316920,'<p>								</p><p>一、配置</p><pre class=\"brush:as3;toolbar:false\">&nbsp;location&nbsp;~&nbsp;.*\\.(gif|jpg|jpeg|png|bmp|swf|flv|ico)$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires&nbsp;30d;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;off;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid_referers&nbsp;none&nbsp;blocked&nbsp;*.ruanwenwu.cn;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($invalid_referer)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;403;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p>二、测试</p><ol style=\"list-style-type: decimal;\" class=\" list-paddingleft-2\"><li><p>用curl测试，发现当指定referer为百度时，返回403<br/></p><p><img src=\"/ueditor/php/upload/image/20170324/1490316692959324.png\" title=\"1490316692959324.png\" alt=\"图片.png\"/></p></li><li><p>用网站测试，将该图片发到网站www.111.com上：</p><p><img src=\"/ueditor/php/upload/image/20170324/1490316766254919.png\" title=\"1490316766254919.png\" alt=\"图片.png\"/>（不显示）。</p></li><li><p>将防盗链代码去掉再看：</p><p><img src=\"/ueditor/php/upload/image/20170324/1490316829284345.png\" title=\"1490316829284345.png\" alt=\"图片.png\"/></p></li></ol><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111.com能看ruanwenwu.cn的图片了。说明防盗链失效了。<br/></p><p>							</p>','安全','简单实用的Nginx防盗链配置','nginx防盗链配置,简单粗暴，有图有真相。','linux',0,147,1),(99,1490373681,1490373681,1490373681,'<p>I will not quit,never.</p>','干劲','Let\'s go on and on...','I will not quit,never.','说说',0,130,1),(100,1490424686,1491355578,1490424686,'<p>								</p><p>这是我父亲日记里的文字~这是我父亲日记里的文字~这是我父亲日记里的文字~这是他的青春，他的青春留下来的散文诗~</p><p>							</p>','心情','父亲写的散文诗','《父亲写的散文诗》——徐飞。这是我父亲日记里的文字，这是他的青春留下来的散文诗...... 这首歌真不错，强烈推荐！','说说',0,147,1),(101,1490427857,1490428740,1490427857,'<p>								</p><h3>题记：<br/></h3><p>之前我们已经讲过用户访问控制的实现。这是我的博客上实现的“<a href=\"/admin.php\" target=\"_blank\">用户访问控制</a>”,忘了的话，方法参考这里：<a href=\"/blog/88.html\" target=\"_blank\">戳这里</a>。</p><p>这一节我们讲几种别的访问控制。比如我们的后台admin.php只允许某个ip或者某些ip。又比如我们查看网站的访问日志，发现某些Ip存在恶意攻击的行为，我们需要将这些ip禁用掉。</p><p>只允许某些ip访问某个文件，配置如下：</p><pre class=\"brush:as3;toolbar:false\">&nbsp;location&nbsp;~&nbsp;.*admin\\.php$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#auth_basic&nbsp;&quot;ruanwenwu&nbsp;auth&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#auth_basic_user_file&nbsp;/usr/local/nginx/conf/.htpasswd;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow&nbsp;127.0.0.1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow&nbsp;10.21.95.251;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deny&nbsp;all;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;fastcgi_params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass&nbsp;unix:/tmp/www.sock;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_index&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param&nbsp;SCRIPT_FILENAME&nbsp;/data/www/upload$fastcgi_script_name;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><img src=\"/ueditor/php/upload/image/20170325/1490427454305818.png\" title=\"1490427454305818.png\" alt=\"blob.png\"/>（被允许的ip可以访问）</p><p><br/></p><p><img src=\"http://ruanwenwu.cn/ueditor/php/upload/image/20170325/1490427751548703.png\" title=\"1490427751548703.png\" alt=\"blob.png\"/>（没被允许的访问403了）</p><h3>上面这个例子只是限制admin.php，因为限制规则都写在location里面。如果写在server下就是全局限制，就像这样：</h3><pre class=\"brush:as3;toolbar:false\">server\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;www.111.com&nbsp;www.test.com;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/data/www/upload;\r\n&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;/usr/local/nginx/logs/111.com.access.log;\r\n&nbsp;&nbsp;&nbsp;&nbsp;deny&nbsp;127.0.0.1;\r\n}</pre><p><img src=\"/ueditor/php/upload/image/20170325/1490428471308849.png\" title=\"1490428471308849.png\" alt=\"blob.png\"/>（非127.0.0.1的ip访问正常）</p><p><img src=\"/ueditor/php/upload/image/20170325/1490428553990828.png\" title=\"1490428553990828.png\" alt=\"blob.png\"/></p><p>（127.0.0.1访问被禁止）</p><p>备注：deny就是黑名单，allow就是白名单。</p><p><br/></p><p>							</p>','安全','nginx访问控制','之前我们已经讲过nginx的用户认证，这种方式可以增加某些页面一定的安全性。这一节我们讲几种别的控制访问的方式。','linux',0,162,1),(102,1490435701,1490435701,1490435701,'<h3>题记</h3><p>最常用的应该就是限制一般的curl抓取，蜘蛛的爬取。</p><p>配置很简单，可以加在location里，也可以加在server里，看具体情况而定</p><pre class=\"brush:as3;toolbar:false\">&nbsp;if&nbsp;($http_user_agent&nbsp;~&nbsp;baidu|sougou|360|curl)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;403;\r\n&nbsp;}</pre><p>发现curl访问被禁掉了。</p><p><img src=\"/ueditor/php/upload/image/20170325/1490429999648551.png\" title=\"1490429999648551.png\" alt=\"blob.png\"/></p><h3>干掉curl，看看百度有没有被禁掉，修改配置文件如下：</h3><pre class=\"brush:as3;toolbar:false\">&nbsp;if&nbsp;($http_user_agent&nbsp;~&nbsp;baidu|sougou|360)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;403;\r\n&nbsp;}</pre><p>可以发现：</p><p><img src=\"/ueditor/php/upload/image/20170325/1490430191239638.png\" title=\"1490430191239638.png\" alt=\"blob.png\"/></p><p>curl已经能够正常访问，而含有百度的user_agent已经被限制了。</p><h3>补充：</h3><p>我自己是做php的，有时候业务需要爬取一些网站。我有时候用file_get_contents，有时候也用curl。刚才做了测试，发现这两个函数直接用（不做复杂的参数配置），nginx捕获的日志显示的useragent是空，referer也是空。</p><p>所以我在vhost里加了一条规则来过滤这些请求：</p><pre class=\"brush:as3;toolbar:false\">&nbsp;if&nbsp;($http_user_agent&nbsp;~&nbsp;^$)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;403;\r\n&nbsp;&nbsp;}</pre><p>处理过后，再看日志：</p><p><img src=\"http://ruanwenwu.cn/ueditor/php/upload/image/20170325/1490435581709370.png\" title=\"1490435581709370.png\" alt=\"blob.png\"/></p><p>对于比较老练的“爬手”这样根本是防不住的，最好的还是通过程序判断ip访问频次，比如每份钟100次的，丢到黑名单里。</p>','nginx','nginx禁止指定user_agent','对于搞开发的，特别是前端开发的，useragent这个东西非常常见，因为他们的代码要调浏览器兼容性，而每一个浏览器都对应一个useragent。事实上，每一个http请求里都含有useragent这个东西，当然也有不含有的，那是通过程序发出的请求。nginx作为网站的第一道防线，肯定不能没有对useragent的限制啦。','linux',0,167,1),(104,1490459833,1490459833,1490459833,'<h3>一、模块化开发的意义</h3><p><strong>1.解决命名冲突。</strong></p><p>从一个故事说起。</p><p>有一天开发人员小王发现自己负责的业务突然出故障了。经过好一番排查发现是他们项目中公用的utile.js里（这是个超大的utile，简直就像百宝箱一样，这样的工具箱太可怕了），不知道被哪个&quot;坑货&quot;加了一个函数，把他之前用的那个函数覆盖了。</p><p>为了避免像这样的命名冲突的问题再发生，小组决定使用命名空间，于是函数名称变成了这样：orl.utile.changeStatus。</p><p>这样，虽然解决了冲突的问题，但是仍然存在很明显的弊端。一是文件名太长（还有比上面更长的），加重了开发人员的记忆负担；二是这样的用json格式的封装，里面的变量是可被操作的，这不符合封装的要求，容易被污染；三是这样一坨的东西放在一起，根本是不好用，也是不合理的。为什么工具需要分类呢？是为了更好的使用。而模块化正是实现了工具分类。</p><p><strong>2.解决依赖。</strong></p><p>我们在用jquery的插件的时候都知道要先引入jquery文件然后再引入jquery插件，是因为我们知道有这样的依赖关系，这没有问题。但是如果某个功能是项目中的一个成员A开发的，而这个功能又依赖那个功能，这下就有问题了。不论A告知大家这样的依赖关系，但总有人会忘记或者有新人来根部不知道，这样的问题会一直纠缠着A，永远永远，最后A疯了，放弃了程序员这个伟大的职业，转行卖煎饼去了。</p><p><br/></p><p>为了解决依赖的问题，雅虎就采用配置的方法，将这些依赖做声明，结果代码编程这样：</p><pre class=\"brush:as3;toolbar:false\">YUI.add(&#39;my-module&#39;,&nbsp;function&nbsp;(Y)&nbsp;{&nbsp;&nbsp;//&nbsp;...},&nbsp;&#39;0.0.1&#39;,&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;requires:&nbsp;[&#39;node&#39;,&nbsp;&#39;event&#39;]\r\n});</pre><p>这都是些什么鬼，可读性差，配置太复杂了，要疯掉的啦~~</p><p>终于，后来有个叫玉伯的男人开发了一款叫sea.js的工具，完美了解决了上面两个问题，将无数的程序员从痛苦与绝望中拯救了出来。</p><h3>二、模块化的超简单步骤（先看看情况，再了解细节啊）</h3><p><strong>废话说在前面</strong></p><p>让所谓的AMD和CMD见鬼去吧，这些伤脑筋的玩意。不管你用require.js还是sea.js，明白模块的结构，会用模块化的方法去解决项目中的问题才是关键。这里我们只介绍sea.js的使用方法。</p><p>暂且不看单个模块怎么写，我们先看看模块是怎么关联部署的。</p><p>官方的例子已经比较简单了，但是刚开起来还是费劲。我总结了一下，也写了两个例子，其中一个超级简单的我删掉了，留了一个稍微有点意义的例子。总结起来就是3步走到位。</p><pre class=\"brush:as3;toolbar:false\">1.引入sea.js\r\n2.给你的模块找个窝，然后把你写好的模块放到窝里。（就是放模块的目录^_^）\r\n2.配置sea.js</pre><p>就是这么简单。</p><p>木有图，木有代码，木有链接，就木有真相，贴贴贴，都贴上：</p><p><strong>链接：</strong><a href=\"http://ruanwenwu.cn/index.php/Demo/Index/seajs\" target=\"_self\">http://ruanwenwu.cn/index.php/Demo/Index/seajs</a></p><p><strong>代码：</strong></p><pre class=\"brush:as3;toolbar:false\">&lt;extend&nbsp;name=&quot;Public:base&quot;&nbsp;/&gt;\r\n&lt;block&nbsp;name=&quot;css&quot;&gt;\r\n	&lt;style&gt;\r\n		#div1{width:200px;height:200px;background:red;position:absolute;top:30;left:0;}\r\n	&lt;/style&gt;\r\n&lt;/block&gt;\r\n\r\n&lt;block&nbsp;name=&quot;content&quot;&gt;\r\n&lt;h1&gt;sea.js的实例&lt;/h1&gt;\r\n&lt;div&nbsp;id=&quot;div1&quot;&gt;\r\n&lt;/div&gt;\r\n&lt;/block&gt;\r\n\r\n&lt;block&nbsp;name=&quot;script&quot;&gt;\r\n	&lt;script&nbsp;src=&quot;/Public/sea/sea.js&quot;&gt;&lt;/script&gt;\r\n	&lt;script&gt;\r\n	&nbsp;//&nbsp;Set&nbsp;configuration\r\n		&nbsp;&nbsp;seajs.config({\r\n			base:&nbsp;&quot;/Public/sea/modules/&quot;,\r\n			alias:&nbsp;{\r\n			&nbsp;&nbsp;&quot;jquery&quot;:&nbsp;&quot;jquery/jquery/1.10.1/jquery.js&quot;\r\n			}\r\n		&nbsp;&nbsp;});\r\n\r\n		&nbsp;&nbsp;seajs.use(&quot;/Public/sea/app/demo_index_sea_main&quot;);\r\n	&nbsp;&lt;/script&gt;\r\n&lt;/block&gt;</pre><p>太xx的简洁了，(请自动忽略模板语言里的这些block,和extend)，简直符合洁癖强迫症患者的口味？有没有？</p><p><strong>我给大家看看我的模块的窝放的地方：/Public/sea/modules/</strong></p><p><img src=\"http://ruanwenwu.cn/Public/plugin/ueditor/themes/default/images/spacer.gif\"/><img src=\"/ueditor/php/upload/image/20170326/1490459239948024.png\" title=\"1490459239948024.png\" alt=\"blob.png\"/></p><p>这个窝放哪里都行，服务器能找到就可以。这里为什么会有一个app目录呢？这个app也是用来放模块的，只不是它只放业务模块，没有特定的功能，一般一个页面有一个。这个app目录是我自己设计的，不用它也是可以的。</p><p><strong>说明：</strong>流程就是sea.js调demo_index_sea_main.js这个模块，然后就没有然后了。后面的事就交给demo_index_sea_main.js这个模块去处理了，它可能找别的模块帮忙，那就是它的事了。</p><h3>三、现在知道Sea.js(CMD)模块部署的流程了，我们再回头来看一下单个模块是如何写的。</h3><p>简单粗暴就是贴代码。我将这个例子的两个模块贴一下：</p><p>demo_index_sea_main:</p><pre class=\"brush:as3;toolbar:false\">define(function(require){\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;alertModule&nbsp;=&nbsp;require(&quot;../modules/alertmodule&quot;);//引入alert模块\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;drag&nbsp;=&nbsp;require(&quot;../modules/perfectdrag&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;drag(&quot;div1&quot;);\r\n});\r\nperfectdrag.js</pre><p>perfectdrag.js:</p><pre class=\"brush:as3;toolbar:false\">define(function(require,exports,module){	\r\n	function&nbsp;perfectDrag(ele){	\r\n		var&nbsp;oDiv&nbsp;=&nbsp;document.getElementById(ele);			\r\n		oDiv.onmousedown&nbsp;=&nbsp;function(){\r\n			var&nbsp;pos&nbsp;=&nbsp;getPos();\r\n			var&nbsp;diffX&nbsp;=&nbsp;pos.x&nbsp;-&nbsp;this.offsetLeft;\r\n			var&nbsp;diffY&nbsp;=&nbsp;pos.y&nbsp;-&nbsp;this.offsetTop;\r\n			var&nbsp;moveObj;\r\n			\r\n			if(oDiv.setCapture){\r\n				moveObj&nbsp;=&nbsp;oDiv;\r\n			}else{\r\n				moveObj&nbsp;=&nbsp;document;\r\n			}\r\n			\r\n			moveObj.onmousemove&nbsp;=&nbsp;mousemove;\r\n			\r\n			moveObj.onmouseup&nbsp;=&nbsp;function(){\r\n				this.onmousemove&nbsp;=&nbsp;null;\r\n				this.onmouseup&nbsp;&nbsp;&nbsp;=&nbsp;null;\r\n				if(this.releaseCapture){\r\n					this.releaseCapture();\r\n				}\r\n			}\r\n			\r\n			if(this.setCapture){\r\n				this.setCapture();\r\n			}\r\n			\r\n			return&nbsp;false;\r\n			\r\n			function&nbsp;mousemove(){\r\n				var&nbsp;pos&nbsp;=&nbsp;getPos();\r\n				oDiv.style.left&nbsp;=&nbsp;pos.x&nbsp;-&nbsp;diffX&nbsp;+&nbsp;&#39;px&#39;;\r\n				oDiv.style.top&nbsp;&nbsp;=&nbsp;pos.y&nbsp;-&nbsp;diffY&nbsp;+&nbsp;&#39;px&#39;;\r\n			}\r\n		}\r\n	\r\n	}\r\n	\r\n	module.exports&nbsp;=&nbsp;perfectDrag;	#输出模块的功能。这就是那些所谓的API,整这些术语真是让人费解~~\r\n\r\n	function&nbsp;getPos(){\r\n		var&nbsp;sTop&nbsp;&nbsp;=&nbsp;document.documentElement.scrollTop&nbsp;||&nbsp;document.body.scrollTop;\r\n		var&nbsp;sLeft&nbsp;=&nbsp;document.documentElement.scrollLeft&nbsp;||&nbsp;document.body.scrollLeft;\r\n		var&nbsp;e=arguments.callee.caller.arguments[0]&nbsp;||&nbsp;window.event;&nbsp;\r\n		return&nbsp;{x&nbsp;:&nbsp;sLeft&nbsp;+&nbsp;e.clientX,&nbsp;y&nbsp;:&nbsp;sTop&nbsp;+&nbsp;e.clientY};\r\n	}\r\n});</pre><p>解释一下上面的模块：</p><pre class=\"brush:as3;toolbar:false\">1.一般一个模块放一个文件，不用担心文件太多，影响加载速度，这个我们最后会有压缩工具&nbsp;来压缩和合并。\r\n2.模块书写固定格式：\r\ndefine(function(require,exports,module){\r\n//code&nbsp;&nbsp;这里原来怎么写现在还怎么写\r\n});\r\n接受一个工厂方法，方法里的这三个变量分别是：加载模块的方法的引用，模块的exports变量（APID输出）的引用，模块信息的对象。这三个名称建议不要更改。不要问我为什么，感兴趣可以读一下源码。\r\n3.引入模块的方法：\r\nvar&nbsp;a&nbsp;=&nbsp;require(&quot;b&quot;);//引入b模块，将模块的输出返回给变量a。说到模块的输出，那么什么是模块的输出呢？像这样：\r\ndefine(function(require,exports,module){\r\nfunction&nbsp;person(name){\r\nthis.name&nbsp;=&nbsp;name;\r\n}\r\nmodule.exports&nbsp;=&nbsp;person;\r\n});\r\n或者这样:\r\ndefine(function(require,exports,module){\r\nfunction&nbsp;add(a,b){\r\nreturn&nbsp;a+b;\r\n}\r\nexports.add&nbsp;=&nbsp;add;\r\n});</pre><p>最常用的就是这两种的，记太多也没意义了。exports是module.exports的引用，不能直接给exports赋值，这是错误的：exports = add;</p><h3>模块标志：（啥模块标志，就是怎么引模块）</h3><p>好啦，模块化的东西基本上就完了。如果有人还有疑问，可能是想问模块怎么引入的？这个引入的方法特别多。我建议只记住我下面说的就好了。</p><p>相对路径：永远相对于当前跑的这个文件。</p><p>绝对路径：这个就是完整路径，没什么好说的。</p><p>默认路径：就是不是以/或者.或者..开头的目录，相对于我们配置的base目录，如果没有配就相对于sea.js的文件目录。</p><p>压缩的先不说，还没做试验。其实不做影响也不大。现在的带宽不是问题，而且浏览器本身支持多任务，多个文件一起下，说不定更快哦。</p><p><br/></p>','js模块化开发','sea.js快速入门','js模块化开发棒棒哒，解决好多问题呢','js',0,178,1),(105,1490507756,1490507756,1490507756,'<h3>废话说在前头</h3><p>我是源码安装的。特别坑。make了差不多半个小时。还是建议使用二进制包。解压开就能直接用了。</p><h3>node.js安装（源码包安装）</h3><p><strong>下载</strong></p><p>我是在官网下的源码包</p><p>wget&nbsp;<a href=\"https://nodejs.org/dist/v6.10.1/node-v6.10.1.tar.gz\">https://nodejs.org/dist/v6.10.1/node-v6.10.1.tar.gz</a> </p><p><strong>解压,安装（等吧，make完好像经过了几个世纪）</strong></p><pre class=\"brush:as3;toolbar:false\">tar&nbsp;zxvf&nbsp;node-v6.10.1.tar.gz\r\ncd&nbsp;node-v6.10.1\r\n./configure&nbsp;--prefix=/usr/local/node\r\nmake&nbsp;&amp;&amp;&nbsp;make&nbsp;install</pre><p><strong>安装完后</strong></p><pre class=\"brush:as3;toolbar:false\">cd&nbsp;/usr/local/node/bin\r\nnode&nbsp;-v</pre><p>看看版本号。如果正常，接着装npm。</p><p><span style=\"color: rgb(255, 0, 0);\">注意，这儿要先把node命令安装到全局$PATH变量，否则安装npm会出错。</span></p><h3><span style=\"color: rgb(0, 0, 0);\">npm安装</span></h3><p><span style=\"color: rgb(0, 0, 0);\">node安装好，npm的源码包也包括在里面了，路径是：</span></p><p><img src=\"/ueditor/php/upload/image/20170326/1490507605495465.png\" title=\"1490507605495465.png\" alt=\"blob.png\"/></p><p>看到configure文件没？</p><pre class=\"brush:as3;toolbar:false\">./configure\r\nmake&nbsp;&amp;&amp;&nbsp;make&nbsp;isntall</pre><p>完工。</p>','js模块化开发','linux环境下安装node.js和npm','没想到装个Node花了这么长时间，记录一下过程，希望能帮助到一些人。','node',0,159,1),(106,1490511414,1490511414,1490511414,'<h3>简单的代理</h3><p>这个代理实现通过代理服务器来访问ruanwenwu.cn的效果。</p><p><strong>首先修改代理服务器的hosts，让ruanwenwu.cn指向127.0.0.1</strong><br/></p><p>vim /etc/hosts</p><p><img src=\"/ueditor/php/upload/image/20170326/1490508279456387.png\" title=\"1490508279456387.png\" alt=\"图片.png\"/></p><p><strong>在/usr/local/nginx/conf/vhosts目录下建立proxy_test_single.conf文件：</strong></p><pre class=\"brush:as3;toolbar:false\">server{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;ruanwenwu.cn;\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;/&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass&nbsp;http://101.200.168.135/;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#proxy_set_header&nbsp;Host&nbsp;$host;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}\r\n这个配置的意思是，通过这台代理服务器访问ruanwenwu.cn的时候，将目的指向\r\n这里有个问题，就是如果要成功的话，ruanwenwu.cn的网站的默认server是开放的才行，如果默认server是deny&nbsp;all，像下面这样，这个实验就该返回403了\r\n&nbsp;\r\nserver\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80&nbsp;default_server;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;localhost;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/tmp/1233;\r\n&nbsp;&nbsp;&nbsp;&nbsp;deny&nbsp;all;\r\n}</pre><p>有人也叫上面这种default_server空主机头。好处就是你的网站不能通过ip访问，其他的子域名也不会都指向别的地方。配置好，检查一下nginx配置的语法，没问题就可以重新加载配置文件了。</p><p><strong>测试</strong></p><p>curl -x127.0.0.1:80 <a href=\"http://www.ruanwenwu.cn\">www.ruanwenwu.cn</a> -I 返回200说明成功了。 <br/></p><h3>通过nginx的upstream实现负载均衡</h3><p>现在我手上有3台服务器：10.21.93.208,10.21.93.205,10.21.93.204。205和204这两台都部署了网站111.com的程序。现在我想让10.21.93.208做为负载均衡服务器，让请求能够分发到205和204上面。</p><p>首先，我配置好了204和205的网站环境，让他们能够通过10.21.93.205:80和10.21.93.204:80都能够访问到。这一步只要去掉空主机头，让接受111.com访问的虚拟主机成功默认虚拟主机。贴上204和205其中一台的虚拟机配置：</p><pre class=\"brush:as3;toolbar:false\">server\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80&nbsp;default_server;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;www.111.com&nbsp;www.test.com;\r\n&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;index.html&nbsp;index.htm&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;/data/www/upload;\r\n&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;/usr/local/nginx/logs/111.com.access.log;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($http_user_agent&nbsp;~&nbsp;baidu|sougou|360)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;403;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($host&nbsp;!=&nbsp;&#39;www.111.com&#39;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;^/(.*)$&nbsp;http://www.111.com/$1&nbsp;permanent;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;.*admin\\.php$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;#auth_basic&nbsp;&quot;ruanwenwu&nbsp;auth&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;#auth_basic_user_file&nbsp;/usr/local/nginx/conf/.htpasswd;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#allow&nbsp;127.0.0.1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#allow&nbsp;10.21.95.251;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#deny&nbsp;all;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;fastcgi_params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass&nbsp;unix:/tmp/www.sock;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_index&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param&nbsp;SCRIPT_FILENAME&nbsp;/data/www/upload$fastcgi_script_name;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;\\.php$&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;fastcgi_params;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#fastcgi_pass&nbsp;127.0.0.1:9000;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass&nbsp;unix:/tmp/www.sock;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_index&nbsp;index.php;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param&nbsp;SCRIPT_FILENAME&nbsp;/data/www/upload$fastcgi_script_name;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n}</pre><p>现在，我们配置208上的负载均衡的配置：</p><p>vim 111.conf</p><pre class=\"brush:as3;toolbar:false\">upstream&nbsp;ruanwenwu&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;10.21.93.205:80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;10.21.93.204:80;\r\n}\r\nserver\r\n{\r\n&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;80;\r\n&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;www.111.com&nbsp;www.test.com;\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;/&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass&nbsp;http://ruanwenwu;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header&nbsp;HOST&nbsp;$host;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>注意upstream后面的名称一定要拼写正确，而且upstream reuanwenwu后最好跟一个空格，就像上面代码贴的这样，否则就会一致报下面的错误：<br/></p><p>nginx: [emerg] host not found in upstream &quot;<span style=\"color: rgb(255, 0, 0);\">ruanewnwu</span>&quot; in /usr/local/nginx/conf/vhosts/111.conf:11<br/>最后的效果:</p><p><img src=\"/ueditor/php/upload/image/20170326/1490511196540142.png\" title=\"1490511196540142.png\" alt=\"图片.png\"/></p><p><img src=\"/ueditor/php/upload/image/20170326/1490511212562850.png\" title=\"1490511212562850.png\" alt=\"图片.png\"/></p><p>说明已经成功了，oh y!<br/></p>','nginx','nginx做代理和负载均衡','nginx做代理就是，举个栗子，你让张三帮你去买个水果，那么张三就是代理。那么什么是负载均衡呢？再举个栗子，负载均衡就好像银行办理业务，客户拿到流水单号后，会被随机分配到不同的柜台，这些柜台一起办理业务，加快了业务的办理速度，减少了用户的等待时间，这就是负载均衡。','linux',0,147,1),(107,1490525243,1490615414,1490525243,'<p>								</p><h3>首先在github上创建一个新的repo。</h3><p>这个入口很多，随便都能找到，就不细说了。</p><h3>配置自己的云服务器，把服务器的公私贴给git服务器。</h3><pre class=\"brush:as3;toolbar:false\">[root@iZ25lzba47vZ&nbsp;~]#&nbsp;cd&nbsp;~\r\n[root@iZ25lzba47vZ&nbsp;~]#&nbsp;ls&nbsp;-la|grep&nbsp;.ssh\r\ndrwx------&nbsp;&nbsp;&nbsp;2&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4096&nbsp;Mar&nbsp;26&nbsp;17:28&nbsp;.ssh\r\n[root@iZ25lzba47vZ&nbsp;~]#&nbsp;ls&nbsp;.ssh\r\nid_rsa&nbsp;&nbsp;id_rsa.pub&nbsp;&nbsp;known_hosts</pre><p>如果发现你连.ssh目录都没有，就需要创建了，创建方法。详细请看<a href=\"https://help.github.com/articles/generating-an-ssh-key/\" target=\"_self\">官方文档</a></p><pre class=\"command-line\">ssh-keygen&nbsp;-t&nbsp;rsa&nbsp;-b&nbsp;4096&nbsp;-C&nbsp;&quot;your_email@example.com&quot;</pre><p>创建完成后，就可以打开id_rsa.pub文件，并复制里面的内容了。复制好，贴到这里：</p><p><img src=\"/ueditor/php/upload/image/20170326/1490524838296332.png\" title=\"1490524838296332.png\" alt=\"图片.png\"/></p><h3>贴完就可以开始同步你的代码到git仓库了</h3><p>我假设你已经有自己的项目了。进入你的项目运行下面几个命令：</p><pre class=\"f5 js-zeroclipboard-target\">git&nbsp;remote&nbsp;add&nbsp;origin&nbsp;git@github.com:ruanwenwu/ruanwenwu.cn.git\r\ngit&nbsp;push&nbsp;-u&nbsp;origin&nbsp;master</pre><p>这样就把你的项目给推到git了。好了，现在可以做计划任务定时备份数据并且传到git了。</p><h3>我写了这样一个脚本：</h3><pre class=\"brush:as3;toolbar:false\">#!/bin/bash\r\n#备份配置文件\r\n\\cp&nbsp;/usr/local/nginx/conf/nginx.conf&nbsp;/data/wwwroot/blog/confbak/\r\n\\cp&nbsp;/usr/local/php/etc/php-fpm.conf&nbsp;/data/wwwroot/blog/confbak/\r\n\\cp&nbsp;/etc/my.cnf&nbsp;/data/wwwroot/blog/confbak/\r\n\\cp&nbsp;-r&nbsp;/usr/local/nginx/conf/vhost&nbsp;/data/wwwroot/blog/confbak/vhost\r\n#备份数据库\r\n/usr/local/mysql/bin/mysqldump&nbsp;-uroot&nbsp;-p****&nbsp;blog&nbsp;&gt;&nbsp;/data/wwwroot/blog/data.sql\r\n#提交到git\r\ncd&nbsp;/data/wwwroot/blog/\r\n/usr/bin/git&nbsp;add&nbsp;-A&nbsp;.\r\n/usr/bin/git&nbsp;commit&nbsp;-m&nbsp;&#39;autoupload&#39;\r\n/usr/bin/git&nbsp;push&nbsp;-u&nbsp;origin&nbsp;master</pre><h3>计划任务每天凌晨2点跑一次就好了。</h3><pre class=\"brush:as3;toolbar:false\">#每天备份sql并同步到git\r\n*&nbsp;2&nbsp;*&nbsp;*&nbsp;*&nbsp;/usr/bin/sh&nbsp;/root/syncwithgit.sh</pre><h3>效果：</h3><p><img src=\"/ueditor/php/upload/image/20170326/1490525143506834.png\" title=\"1490525143506834.png\" alt=\"图片.png\"/></p><p>（测试的时候，计划任务做的每分钟一次，非常好用）<br/></p><p>							</p>','安全','使用git和linux实现自动备份功能','博客用的阿里云的服务器，要是哪天云服务一抽风或者忘缴费，辛辛苦苦弄的东西全没了，就疯掉了。所以抽了点时间将这些东西做了个自动备份。','linux',0,209,1),(108,1490794564,1490794564,1490794564,'<h3>题记</h3><p><strong>在说明配置方法之前，我们先看一下一台挂在了NFS服务的主机的硬盘情况：</strong></p><pre class=\"brush:as3;toolbar:false\">[root@localhost&nbsp;~]#&nbsp;df&nbsp;-h\r\nFilesystem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;&nbsp;Used&nbsp;Avail&nbsp;Use%&nbsp;Mounted&nbsp;on\r\n/dev/sda3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18G&nbsp;&nbsp;6.1G&nbsp;&nbsp;&nbsp;11G&nbsp;&nbsp;37%&nbsp;/\r\ntmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;495M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;495M&nbsp;&nbsp;&nbsp;0%&nbsp;/dev/shm\r\n/dev/sda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;194M&nbsp;&nbsp;&nbsp;27M&nbsp;&nbsp;158M&nbsp;&nbsp;15%&nbsp;/boot\r\n10.21.93.208:/home/&nbsp;&nbsp;&nbsp;18G&nbsp;&nbsp;6.1G&nbsp;&nbsp;&nbsp;11G&nbsp;&nbsp;37%&nbsp;/mnt</pre><p>我们发现磁盘列表里有一块10.21.93.208:/home/。这就是通过我们的NFS服务，挂过来的。它挂在/mnt目录下面。只要有权限，我们可以，像使用本地磁盘一样使用挂在/mnt目录下的10.21.93.208:/home/这个目录。</p><p>我所在的上一家公司就使用了这种技术。公司把所有的程序代码放在一个NFS服务器上。所有的web服务器都挂在了NFS上的代码目录，这样规避了很多同步代码的问题，还有写入同步的问题。但是这样有个风险，如果NFS服务挂了，所有WEB服务器都读不到程序了。这种情况下，可以做NFS主备。</p><p><strong>NFS服务器上的配置</strong></p><p>安装<span style=\"font-family: Verdana, Arial, sans-serif; font-size: medium; text-align: justify; background-color: rgb(255, 255, 255);\">nfs-utils和rpcbind</span></p><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; text-align: justify;\">yum&nbsp;install&nbsp;-y&nbsp;nfs-utils\r\nyum&nbsp;install&nbsp;-y&nbsp;rpcbind</pre><p>安装好之后，编辑配置文件</p><p>vim /etc/exports</p><pre class=\"brush:as3;toolbar:false\">/home/&nbsp;10.21.93.205(rw,sync,all_squash,anonuid=500,anongid=503)\r\n/home/&nbsp;10.21.93.204(rw,sync,all_squash,anonuid=500,anongid=503)</pre><p>这段配置表示将本机的home目录允许10.21.93.204和205两台主机挂载。</p><pre class=\"brush:as3;toolbar:false\">rw&nbsp;：读写；\r\nro&nbsp;：只读；\r\nsync&nbsp;：同步模式，内存中数据时时写入磁盘；\r\nasync&nbsp;：不同步，把内存中数据定期写入磁盘中；\r\nno_root_squash&nbsp;：加上这个选项后，root用户就会对共享的目录拥有至高的权限控制，就像是对本机的目录操作一样。不安全，不建议使用；\r\nroot_squash：和上面的选项对应，root用户对共享目录的权限不高，只有普通用户的权限，即限制了root；\r\nall_squash：不管使用NFS的用户是谁，他的身份都会被限定成为一个指定的普通用户身份；\r\nanonuid/anongid&nbsp;：要和root_squash&nbsp;以及all_squash一同使用，用于指定使用NFS的用户限定后的uid和gid，前提是本机的/etc/passwd中存在这个uid和gid。</pre><h3>启动nfs服务：</h3><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; text-align: justify;\">/etc/init.d/rpcbind&nbsp;start;\r\n/etc/init.d/nfs&nbsp;start</pre><p>到这里服务端的nfs服务已经配置好了，再来看客户机上怎么挂载这个nfs的磁盘。</p><h3>客户端的配置</h3><p>同样需要安装nfs-utils</p><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; text-align: justify;\">&nbsp;yum&nbsp;install&nbsp;-y&nbsp;nfs-utils</pre><p>安装好之后，运行命令看看nfs服务器上的允许挂载的情况：</p><pre class=\"brush:as3;toolbar:false\">showmount&nbsp;-e&nbsp;10.21.93.208\r\nExport&nbsp;list&nbsp;for&nbsp;10.21.93.208:\r\n/home&nbsp;10.21.93.204,10.21.93.205</pre><p>发现208（服务器）上可允许的ip有204和205这两台机器。这个时候可以开始挂载了。<br/></p><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; text-align: justify;\">mount&nbsp;-t&nbsp;nfs&nbsp;-o&nbsp;nolock&nbsp;10.21.93.208:/home/&nbsp;/test/</pre><p>这句的命令是-t表示type为nfs,-o nolock表示不锁定。后面表示将10.21.93.208:/home/ 挂载到本机的/test目录下。注意，如果没有/test目录，需要创建。<br/></p><p>挂载好之后看看：</p><p>df -h</p><pre class=\"brush:as3;toolbar:false\">Filesystem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;&nbsp;Used&nbsp;Avail&nbsp;Use%&nbsp;Mounted&nbsp;on\r\n/dev/sda3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18G&nbsp;&nbsp;6.1G&nbsp;&nbsp;&nbsp;11G&nbsp;&nbsp;37%&nbsp;/\r\ntmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;495M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;495M&nbsp;&nbsp;&nbsp;0%&nbsp;/dev/shm\r\n/dev/sda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;194M&nbsp;&nbsp;&nbsp;27M&nbsp;&nbsp;158M&nbsp;&nbsp;15%&nbsp;/boot\r\n10.21.93.208:/home/&nbsp;&nbsp;&nbsp;18G&nbsp;&nbsp;6.1G&nbsp;&nbsp;&nbsp;11G&nbsp;&nbsp;37%&nbsp;/test</pre><p>发现10.21.93.208上的/home/目录已经被挂载到了本机的/test下。</p><p>我们在/test目录下创建一个文件：touch a.txt。然后看看详情：</p><p>[root@localhost test]# ls -l</p><p>总用量 8</p><p>-rw-r--r--. 1 ruanwenwu nobody &nbsp; &nbsp;0 3月 &nbsp;29 08:45 a.txt</p><p>drwx--x-wx. 3 mysql &nbsp; &nbsp; mysql &nbsp;4096 3月 &nbsp; 6 21:18 mysql</p><p>drwx------. 3 nobody &nbsp; &nbsp;nobody 4096 3月 &nbsp;27 08:37 ruanwenwu2</p><p>所有者是ruanwenwu,所属组为nobody。我们应该还记得，在我们的nfs服务的配置里，操作共享目录的用户和用户组id分别为500和503。我们再看看本机的/etc/passwd</p><p>[root@localhost test]# cat /etc/passwd|grep -E &quot;500|503&quot;</p><p>ruanwenwu:x:500:500::/home/ruanwenwu:/bin/bash</p><p>500是ruanwenwu,而没有找到503这个组。所以组是nobody。如果我们在本机，也就是204上，创建一个503的组会怎样呢？这个文件所属组会不会归到这个组下呢？</p><p><span style=\"color: rgb(255, 0, 0);\">结果没有，还是nobody~~,我表示蒙了，马上要回家赶地铁了，回头再研究吧。</span></p><h3>更改配置文件后的处理</h3><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; text-align: justify;\">exportfs&nbsp;-arv</pre><p>这样，就不需要重启nfs服务也能使更改生效。</p><h3>将nfs挂载加入到开机启动</h3><p>vim&nbsp;<span style=\"font-family: Verdana, Arial, sans-serif; font-size: medium; text-align: justify; background-color: rgb(255, 255, 255);\">/etc/fstab,加上一行：</span></p><pre class=\"brush:as3;toolbar:false\">10.21.93.208:/home/&nbsp;&nbsp;&nbsp;&nbsp;/test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nolock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;0</pre><p><span style=\"font-family: Verdana, Arial, sans-serif; font-size: medium; text-align: justify; background-color: rgb(255, 255, 255);\">然后运行：</span><br/></p><pre class=\"brush:as3;toolbar:false\">mount&nbsp;-a</pre><p style=\"text-align: justify;\"><font face=\"Verdana, Arial, sans-serif\" size=\"3\"><span style=\"background-color: rgb(255, 255, 255);\">可以发现已经挂载上了。而且即使以后重启电脑也能自动挂载上了。</span></font></p>','nfs','nfs服务配置','NFS是NETWORK FILE SERVICE的简称。它的优点是磁盘共享。 ','linux',0,166,1),(109,1490880595,1490926285,1490880595,'<p>								</p><h2>1.为什么要模块化编程</h2><h3><strong>命名冲突的故事</strong></h3><p>小A的代码不行了。utile.js被B改动导致。</p><h3><strong>文件依赖的故事</strong></h3><p>1.小A写的代码被小B，小C拿去用，各种不行，乃至以后的小D小E。</p><p>2.A.js依赖B.js，B.js依赖C.js。永无止境的依赖魔咒。可读性差。</p><h3><strong>模块化可以解决这两个问题</strong></h3><p>对外提供API接口，内部变量不可被污染，解决了命名冲突。</p><p>模块对内解决依赖关系，解决了依赖关系。</p><h2>2.什么是模块化</h2><h3><strong>从哪里来</strong></h3><p>js本身没有模块化的东西。只是后来网页程序逐渐复杂，我们的功能越来越多，于是有些人就开始写一些具有特定功能的插件。这些应该就是模块的前身了。</p><h3><strong>模块的发展过程</strong></h3><h4><strong>函数写法：</strong></h4><pre class=\"brush:as3;toolbar:false\">function&nbsp;m1(){\r\n　　　　//...\r\n}</pre><p>非常容易被污染的命名。</p><h4><strong>对象写法：</strong></h4><pre class=\"brush:as3;toolbar:false\">var&nbsp;module1&nbsp;=&nbsp;new&nbsp;Object({\r\n　　　　_count&nbsp;:&nbsp;0,\r\n　　　　m1&nbsp;:&nbsp;function&nbsp;(){\r\n　　　　　　//...\r\n　　　　},\r\n　　　　m2&nbsp;:&nbsp;function&nbsp;(){\r\n　　　　　　//...\r\n　　　　}\r\n　　});</pre><p>虽然m1和m2不再直接暴漏，但是内部依然能被访问，比如我们可以改变_count的值：module1._count = 5;</p><h4><strong>立即执行函数可以完全限制访问，并且提供对外接口。其实这就是模块的原型</strong></h4><pre class=\"brush:as3;toolbar:false\">　var&nbsp;module1&nbsp;=&nbsp;(function(){\r\n　　　　var&nbsp;_count&nbsp;=&nbsp;0;\r\n　　　　var&nbsp;m1&nbsp;=&nbsp;function(){\r\n　　　　　　//...\r\n　　　　};\r\n　　　　var&nbsp;m2&nbsp;=&nbsp;function(){\r\n　　　　　　//...\r\n　　　　};\r\n　　　　return&nbsp;{\r\n　　　　　　m1&nbsp;:&nbsp;m1,\r\n　　　　　　m2&nbsp;:&nbsp;m2\r\n　　　　};\r\n&nbsp;&nbsp;})();</pre><h4><strong>实现继承</strong></h4><pre class=\"brush:as3;toolbar:false\">　var&nbsp;module1&nbsp;=&nbsp;(function&nbsp;(mod){\r\n　　　　mod.m3&nbsp;=&nbsp;function&nbsp;()&nbsp;{\r\n　　　　　　//...\r\n　　　　};\r\n　　　　return&nbsp;mod;\r\n　})(module1);</pre><h4><strong>引入全局变量(其实就是其他模块)，依赖变得明显且充分，这个时候的依赖关系和变量冲突问题似乎解决了</strong></h4><pre class=\"brush:as3;toolbar:false\">var&nbsp;module1&nbsp;=&nbsp;(function&nbsp;($,&nbsp;YAHOO)&nbsp;{\r\n　　　　//...\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;=&nbsp;&quot;zhangshan&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{};\r\n})(jQuery,&nbsp;YAHOO);\r\nvar&nbsp;module1&nbsp;=&nbsp;(function&nbsp;($,&nbsp;YAHOO)&nbsp;{\r\n　　　　//...\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;=&nbsp;&quot;lisi&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{};\r\n})(jQuery,&nbsp;YAHOO);</pre><h2>3.成熟的模块化编程语言Node.js是如何实现模块化的呢</h2><h3><strong>这是一段基本的Node.js代码</strong><br/></h3><pre class=\"brush:as3;toolbar:false\">&#39;use&nbsp;strict&#39;;//&nbsp;引入hello模块:\r\nvar&nbsp;greet&nbsp;=&nbsp;require(&#39;./hello&#39;);\r\nvar&nbsp;s&nbsp;=&nbsp;&#39;Michael&#39;;&nbsp;\r\ngreet(s);&nbsp;//&nbsp;Hello,&nbsp;Michael!</pre><h3><strong>再看hello.js这个模块</strong></h3><pre class=\"brush:as3;toolbar:false\">&#39;use&nbsp;strict&#39;;\r\nvar&nbsp;s&nbsp;=&nbsp;&#39;Hello&#39;;\r\nfunction&nbsp;greet(name)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(s&nbsp;+&nbsp;&#39;,&nbsp;&#39;&nbsp;+&nbsp;name&nbsp;+&nbsp;&#39;!&#39;);&nbsp;\r\n}&nbsp;\r\nmodule.exports&nbsp;=&nbsp;greet;</pre><h3><strong>为什么exports一下，就能被别的模块使用了呢？</strong>Node.js模块的实现过程</h3><h4><strong>加载hello.js时先包装一下</strong></h4><pre>(function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;读取的hello.js代码:\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;s&nbsp;=&nbsp;&#39;Hello&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;=&nbsp;&#39;world&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(s&nbsp;+&nbsp;&#39;&nbsp;&#39;&nbsp;+&nbsp;name&nbsp;+&nbsp;&#39;!&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello.js代码结束\r\n})();</pre><h4>那么对外的接口是怎么输出的呢</h4><pre>//&nbsp;准备module对象:\r\nvar&nbsp;module&nbsp;=&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;&#39;hello&#39;,&nbsp;&nbsp;&nbsp;&nbsp;//模块属性,Node.js对这个对象进行了存储。\r\n&nbsp;&nbsp;&nbsp;&nbsp;exports:&nbsp;{}\r\n};\r\nvar&nbsp;load&nbsp;=&nbsp;function&nbsp;(module)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;读取的hello.js代码:\r\n&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;greet(name)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Hello,&nbsp;&#39;&nbsp;+&nbsp;name&nbsp;+&nbsp;&#39;!&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;module.exports&nbsp;=&nbsp;greet;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello.js代码结束\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;module.exports;\r\n};\r\nvar&nbsp;exported&nbsp;=&nbsp;load(module);//&nbsp;保存module:save(module,&nbsp;exported);</pre><p>这样就实现了模块的输出</p><h2>4.cmd和amd的区别</h2><p>CMD 推崇依赖就近，AMD 推崇依赖前置。看代码：</p><h4>&nbsp; CMD<br/></h4><pre class=\"brush:as3;toolbar:false\">define(function(require,&nbsp;exports,&nbsp;module)&nbsp;{\r\nvar&nbsp;a&nbsp;=&nbsp;require(&#39;./a&#39;)\r\na.doSomething()\r\n//&nbsp;此处略去&nbsp;100&nbsp;行\r\nvar&nbsp;b&nbsp;=&nbsp;require(&#39;./b&#39;)&nbsp;//&nbsp;依赖可以就近书写\r\nb.doSomething()\r\n//&nbsp;...\r\n})</pre><h3>AMD</h3><pre class=\"brush:as3;toolbar:false\">//&nbsp;AMD&nbsp;默认推荐的是\r\ndefine([&#39;./a&#39;,&nbsp;&#39;./b&#39;],&nbsp;function(a,&nbsp;b)&nbsp;{&nbsp;//&nbsp;依赖必须一开始就写好\r\na.doSomething()\r\n//&nbsp;此处略去&nbsp;100&nbsp;行\r\nb.doSomething()</pre><h2>5.sea.js模块化编程的实现</h2><p><a href=\"http://ruanwenwu.cn/blog/104.html\" target=\"_self\">http://ruanwenwu.cn/blog/104.html</a></p><p><br/></p><p>							</p>','js模块化开发','Js模块化编程PPT内容','Js模块化编程为我们解决了命名冲突和依赖的问题。','js',0,246,1),(110,1491355758,1491355758,1491355758,'','干劲','我为我激情燃烧的岁月感到光荣','最近看《人民的名义》。剧中陈岩石老革命同志这句话深深的感染了我：我为我激情燃烧的岁月感到光荣！我不禁自问，自己的岁月可曾燃烧过？可曾激情的燃烧过？','说说',0,133,1),(111,1491398334,1491398334,1491398334,'<h2>注意</h2><p>本文转载自自己的老师阿铭老师，仅作学习笔记使用，转载请注明出处：<a href=\"http://www.apelearn.com/study_v2/chapter21.html\" target=\"_self\">http://www.apelearn.com/study_v2/chapter21.html</a></p><h2>什么是pure-ftpd</h2><p>也许你对FTP不陌生，但是你是否了解FTP到底是个什么玩意？ FTP 是File Transfer Protocol（文件传输协议）的英文简称，而中文简称为 “文传协议” 用于Internet上的控制文件的双向传输。同时，它也是一个应用程序（Application）。用户可以通过它把自己的PC机与世界各地所有运行FTP协议的服务器相连，访问服务器上的大量程序和信息。FTP的主要作用，就是让用户连接上一个远程计算机（这些计算机上运行着FTP服务器程序）查看远程计算机有哪些文件，然后把文件从远程计算机上拷到本地计算机，或把本地计算机的文件送到远程计算机去。FTP用的比NFS更多，所以请你一定要熟练配置它。</p><p>其实在CentOS或者RedHat Linux上有自带的ftp软件叫做vsftp, 但阿铭介绍的并不是它，如果你有兴趣可以和阿铭交流，阿铭本章使用pure-ftpd搭建ftp服务器，因为这个软件比vsftp配置起来更加灵活和安全。</p><h2>安装pure-ftpd<a href=\"http://www.apelearn.com/study_v2/chapter21.html#pure-ftpd\" title=\"Permalink to this headline\"></a></h2><p>1. 下载软件</p><p>pure-ftpd 官网是&nbsp;<a href=\"http://www.pureftpd.org/project/pure-ftpd\">http://www.pureftpd.org/project/pure-ftpd</a>&nbsp;当前最新版本为1.0.42, 但阿铭不建议使用最新版本，最新版有可能有一些小bug.</p><pre>[root@localhost&nbsp;~]#&nbsp;cd&nbsp;/usr/local/src/\r\n[root@localhost&nbsp;src]#&nbsp;wget&nbsp;http://download.pureftpd.org/pub/pure-ftpd/releases/pure-ftpd-1.0.42.tar.bz2</pre><p>2. 安装pure-ftpd</p><pre>[root@localhost&nbsp;src]#&nbsp;tar&nbsp;jxf&nbsp;pure-ftpd-1.0.42.tar.bz2\r\n[root@localhost&nbsp;src]#&nbsp;cd&nbsp;pure-ftpd-1.0.42\r\n[root@localhost&nbsp;pure-ftpd-1.0.42]#&nbsp;./configure&nbsp;\\\r\n--prefix=/usr/local/pureftpd&nbsp;\\\r\n--without-inetd&nbsp;\\\r\n--with-altlog\\\r\n--with-puredb&nbsp;\\\r\n--with-throttling&nbsp;\\\r\n--with-peruserlimits&nbsp;&nbsp;\\\r\n--with-tls\r\n[root@localhost&nbsp;pure-ftpd-1.0.42]#&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install</pre><h2>配置pure-ftpd<a href=\"http://www.apelearn.com/study_v2/chapter21.html#id1\" title=\"Permalink to this headline\"></a></h2><p>1. 修改配置文件</p><p>pure-ftpd 编译安装很快就完成了，而且极少有出现错误的时候，下面就该配置它了:</p><pre>[root@localhost&nbsp;pure-ftpd-1.0.42]#&nbsp;cd&nbsp;configuration-file\r\n[root@localhost&nbsp;pure-ftpd-1.0.42]#&nbsp;mkdir&nbsp;-p&nbsp;/usr/local/pureftpd/etc/\r\n[root@localhost&nbsp;configuration-file]#&nbsp;cp&nbsp;pure-ftpd.conf&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/pureftpd/etc/pure-ftpd.conf\r\n[root@localhost&nbsp;configuration-file]#&nbsp;cp&nbsp;pure-config.pl&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/pureftpd/sbin/pure-config.pl\r\n[root@localhost&nbsp;configuration-file]#&nbsp;chmod&nbsp;755&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/pureftpd/sbin/pure-config.pl</pre><p>在启动pure-ftpd之前需要先修改配置文件，配置文件为/usr/local/pureftpd/etc/pure-ftpd.conf, 你可以打开看一下，里面内容很多，如果英文好，可以好好研究一番，下面是阿铭的配置文件，如果你嫌麻烦，直接拷贝过去即可:</p><pre>ChrootEveryone&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes\r\nBrokenClientsCompatibility&nbsp;&nbsp;no\r\nMaxClientsNumber&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;50\r\nDaemonize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes\r\nMaxClientsPerIP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8\r\nVerboseLog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nDisplayDotFiles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes\r\nAnonymousOnly&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nNoAnonymous&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nSyslogFacility&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ftp\r\nDontResolve&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes\r\nMaxIdleTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15\r\nPureDB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/pureftpd/etc/pureftpd.pdb\r\nLimitRecursion&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3136&nbsp;8\r\nAnonymousCanCreateDirs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nMaxLoad&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4\r\nAntiWarez&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes\r\nUmask&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;133:022\r\nMinUID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100\r\nAllowUserFXP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nAllowAnonymousFXP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nProhibitDotFilesWrite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nProhibitDotFilesRead&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nAutoRename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nAnonymousCantUpload&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no\r\nPIDFile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/pureftpd/var/run/pure-ftpd.pid\r\nMaxDiskUsage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99\r\nCustomerProof&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes</pre><p>2. 启动pure-ftpd</p><pre>[root@localhost&nbsp;~]#&nbsp;/usr/local/pureftpd/sbin/pure-config.pl&nbsp;/usr/local/pureftpd/etc/pure-ftpd.conf</pre><p>如果是启动成功，会显示一行长长的以Running开头的信息，否则那就是错误信息，如果你解决不了，请到阿铭论坛(<a href=\"http://www.aminglinux.com/bbs/forum-40-1.html\" target=\"_blank\">http://www.aminglinux.com/bbs/forum-40-1.html</a>)获取帮助吧。</p><p>3. 建立账号</p><pre>[root@localhost&nbsp;~]#&nbsp;mkdir&nbsp;/data/www/\r\n[root@localhost&nbsp;~]#&nbsp;useradd&nbsp;www\r\n[root@localhost&nbsp;~]#&nbsp;chown&nbsp;-R&nbsp;www:www&nbsp;/data/www/\r\n[root@localhost&nbsp;~]#&nbsp;/usr/local/pureftpd/bin/pure-pw&nbsp;useradd&nbsp;ftp_user1&nbsp;&nbsp;-uwww&nbsp;-d&nbsp;/data/www/\r\nPassword:\r\nEnter&nbsp;it&nbsp;again:</pre><p>其中，-u将虚拟用户ftp_user1与系统用户www关联在一起，也就是说使用ftp_user1账号登陆ftp后，会以www的身份来读取文件或下载文件。-d 后边的目录为ftp_user1账户的家目录，这样可以使ftp_user1只能访问其家目录/data/www/. 到这里还未完成，还有最关键的一步，就是创建用户信息数据库文件:</p><pre>[root@localhost&nbsp;~]#&nbsp;&nbsp;/usr/local/pureftpd/bin/pure-pw&nbsp;mkdb</pre><p>pure-pw还可以列出当前的ftp账号，当然也可以删除某个账号, 我们再创建一个账号:</p><pre>[root@localhost&nbsp;~]#&nbsp;&nbsp;/usr/local/pureftpd/bin/pure-pw&nbsp;&nbsp;useradd&nbsp;ftp_user2&nbsp;-uwww&nbsp;-d&nbsp;/tmp\r\n[root@localhost&nbsp;~]#&nbsp;&nbsp;/usr/local/pureftpd/bin/pure-pw&nbsp;mkdb</pre><p>列出当前账号:</p><pre>[root@localhost&nbsp;~]#&nbsp;/usr/local/pureftpd/bin/pure-pw&nbsp;list</pre><p>删除账号的命令为:</p><pre>[root@localhost&nbsp;~]#&nbsp;&nbsp;/usr/local/pureftpd/bin/pure-pw&nbsp;&nbsp;userdel&nbsp;ftp_user2</pre><h2>测试pure-ftpd<a href=\"http://www.apelearn.com/study_v2/chapter21.html#id2\" title=\"Permalink to this headline\"></a></h2><p>测试需要使用的工具叫做lftp, 先安装一下它:</p><pre>[root@localhost&nbsp;~]#&nbsp;yum&nbsp;install&nbsp;-y&nbsp;lftp</pre><p>测试:</p><pre>[root@localhost&nbsp;~]#&nbsp;touch&nbsp;/data/www/123.txt\r\n[root@localhost&nbsp;~]#&nbsp;lftp&nbsp;ftp_user1@127.0.0.1\r\n口令:\r\nlftp&nbsp;ftp_user1@127.0.0.1:~&gt;&nbsp;ls\r\ndrwxr-xr-x&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;514&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;www&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4096&nbsp;Jun&nbsp;12&nbsp;11:14&nbsp;.\r\ndrwxr-xr-x&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;514&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;www&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4096&nbsp;Jun&nbsp;12&nbsp;11:14&nbsp;..\r\n-rw-r--r--&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;514&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;www&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;Jun&nbsp;12&nbsp;11:14&nbsp;123.txt</pre><p>lftp的put方法是上传。</p><p><img src=\"/ueditor/php/upload/image/20170405/1491398299376143.png\" title=\"1491398299376143.png\" alt=\"blob.png\"/></p><p>lftp的get方法是下载。</p><p><img src=\"/ueditor/php/upload/image/20170405/1491398285982872.png\" title=\"1491398285982872.png\" alt=\"blob.png\"/></p><p>？可以看到所有的pure-ftp命令</p><p><br/></p><p>还可以通过ftp工具来连接，也可以通过ftp协议网址来访问：</p><p><img src=\"/ueditor/php/upload/image/20170405/1491398253286722.png\" title=\"1491398253286722.png\" alt=\"blob.png\"/></p>','pure-ftpd','pure-ftpd安装配置','pure-ftpd是一个ftp软件。','linux',0,143,1),(112,1491460265,1491460265,1491460265,'<h2>别的不说，就用到一个函数usort</h2><pre class=\"brush:as3;toolbar:false\">//这个需求，也是非常好的，采纳》推荐》专家等级》时间\r\nfunction&nbsp;my_sort($a,&nbsp;$b)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;if($a[&#39;z_good&#39;]&nbsp;==&nbsp;$b[&#39;z_good&#39;]){\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($a[&#39;is_recom&#39;]&nbsp;==&nbsp;$b[&#39;is_recom&#39;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($a[&#39;sort_z_level&#39;]&nbsp;==&nbsp;$b[&#39;sort_z_level&#39;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($a[&#39;z_version_time&#39;]&nbsp;==&nbsp;$b[&#39;z_version_time&#39;])&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$a[&#39;z_version_time&#39;]&nbsp;&lt;&nbsp;$b[&#39;z_version_time&#39;]&nbsp;?&nbsp;1&nbsp;:&nbsp;-1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$a[&#39;sort_z_level&#39;]&nbsp;&lt;&nbsp;$b[&#39;sort_z_level&#39;]&nbsp;?&nbsp;1&nbsp;:&nbsp;-1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$a[&#39;is_recom&#39;]&nbsp;&lt;&nbsp;$b[&#39;is_recom&#39;]&nbsp;?&nbsp;1&nbsp;:&nbsp;-1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$a[&#39;z_good&#39;]&nbsp;&lt;&nbsp;$b[&#39;z_good&#39;]&nbsp;?&nbsp;1&nbsp;:&nbsp;-1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><h2>用的时候这样：</h2><pre class=\"brush:as3;toolbar:false\">usort($returnReplyInfo,&nbsp;&quot;my_sort&quot;);</pre><h2>理论上再复杂的排序都可以实现。可能有人会问为什么不用sql搞定呢？像这样：<br/></h2><pre class=\"brush:as3;toolbar:false\">order&nbsp;by&nbsp;z_good&nbsp;desc,is_recom&nbsp;desc</pre><p>因为这个结果是个符合结果，不是一条sql查询出来的。</p>','usort','一个多维数组排序的例子','工作中遇到一个数据排序的问题。需要排序的结果集为一个问题的回复。优先级为：被采纳》被推荐》专家等级》回复时间','php',0,146,1),(113,1491531759,1491531759,1491531759,'','','老爸，祝你生日快乐','亲爱的老爸，儿子祝你生日快乐，天天快乐！','说说',0,129,1),(114,1491545157,1491545157,1491545157,'<h2>起因</h2><p>我自己开发了一个简易的框架。用过Thinkphp，ZF，公司的框架。了解过CI，SLIM，Laravel。在这些积累的基础之上，我觉得有必要掌握一套比较流行的框架。刚好laravel好像就是最好的选择。但是laravel要求php版本5.5.9，而我的php版本好像是5.5.6的。所以就想重新编译一下了。</p><p>我的环境是测试环境，运行了一个discuz网站<a href=\"http://www.111.com。因为进行的是在线安装测试，所以整个测试过程中线上的www.111.com的服务不能停，也就是网站要能正常访问。\">www.111.com。因为进行的是在线安装测试，所以整个测试过程中线上的www.111.com的服务不能停，也就是网站要能正常访问。</a> </p><h2>步骤</h2><h3>注意</h3><p>有人说可以在操作之前将原来的php-fpm进程杀死。我实际操作了一下，是不行的。杀死php-fpm网站直接就挂了。</p><h3>下载&amp;解压</h3><pre class=\"brush:as3;toolbar:false\">wget&nbsp;&nbsp;http://www.php.net/distributions/php-5.6.3.tar.gz&nbsp;&nbsp;\r\ntar&nbsp;-zxvf&nbsp;&nbsp;php-5.6.3.tar.gz</pre><h3>编译</h3><pre class=\"brush:as3;toolbar:false\">./configure&nbsp;--prefix=/usr/local/php&nbsp;--with-config-file-path=/usr/local/php/etc&nbsp;--with-fpm-user=www&nbsp;--with-fpm-group=www&nbsp;&nbsp;--enable-fpm&nbsp;--enable-opcache&nbsp;--with-mysql=mysqlnd&nbsp;--with-mysqli=mysqlnd&nbsp;--with-pdo-mysql=mysqlnd&nbsp;--disable-fileinfo&nbsp;&nbsp;&nbsp;--with-iconv-dir=/usr/local&nbsp;&nbsp;--with-freetype-dir&nbsp;--with-jpeg-dir&nbsp;--with-png-dir&nbsp;--with-zlib&nbsp;--with-libxml-dir=/usr&nbsp;--enable-xml&nbsp;&nbsp;&nbsp;--disable-rpath&nbsp;--enable-bcmath&nbsp;--enable-shmop&nbsp;--enable-exif&nbsp;--enable-sysvsem&nbsp;--enable-inline-optimization&nbsp;--with-curl&nbsp;&nbsp;&nbsp;--enable-mbregex&nbsp;--enable-mbstring&nbsp;&nbsp;--with-mcrypt&nbsp;--with-gd&nbsp;--enable-gd-native-ttf&nbsp;--with-openssl&nbsp;--with-mhash&nbsp;&nbsp;--enable-pcntl&nbsp;--enable-sockets&nbsp;--with-xmlrpc&nbsp;--enable-ftp&nbsp;--with-gettext&nbsp;--enable-zip&nbsp;--enable-soap&nbsp;--disable-ipv6&nbsp;&nbsp;--disable-debug&nbsp;&nbsp;\r\n--enable-tokenizer</pre><p>因为laravle是要求这几个扩展的：</p><p><img src=\"/ueditor/php/upload/image/20170407/1491544271146996.png\" title=\"1491544271146996.png\" alt=\"blob.png\"/></p><p>所以，确保以上几个扩展都在编译的参数里。</p><pre class=\"brush:as3;toolbar:false\">make&nbsp;&amp;&amp;&nbsp;make&nbsp;install</pre><p>安装过程异常顺利。可能是因为我编译安装php5.5版本解决了很多依赖问题吧。不过网上有人说会遇到这种问题：</p><p><img src=\"/ueditor/php/upload/image/20170407/1491544446849549.png\" title=\"1491544446849549.png\" alt=\"blob.png\"/></p><h3>修改配置文件</h3><p>还好之前我做好了笔记，直接拿过来贴上即可：</p><p><a href=\"http://ruanwenwu.cn/blog/85.html\" target=\"_self\">http://ruanwenwu.cn/blog/85.html</a></p><h3>优化php.ini</h3><p>这个我暂不做优化。</p><h3>加入启动项</h3><pre class=\"brush:as3;toolbar:false\">cp&nbsp;/usr/local/src/php-5.6.3/sapi/fpm/init.d.php-fpm&nbsp;/etc/init.d/php-fpm</pre><p>这时候会提示你，是否要覆盖原来的php-fpm，输入y就好了。</p><pre class=\"brush:as3;toolbar:false\">chkconfig&nbsp;--add&nbsp;php-fpm\r\nchkconfig&nbsp;php-fpm&nbsp;on</pre><h3>开启服务</h3><pre class=\"brush:as3;toolbar:false\">service&nbsp;php-fpm&nbsp;start</pre><p>如果你原来的php-fpm还在运行会提示错误。解决办法是:</p><pre class=\"brush:as3;toolbar:false\">ps&nbsp;aux|grep&nbsp;php-fpm</pre><p>找到主进程，kill掉。</p><p>kill 进程号</p><p>最后看一下升级后的php</p><p><img src=\"/ueditor/php/upload/image/20170407/1491545125139498.png\" title=\"1491545125139498.png\" alt=\"blob.png\"/></p><p>而这个时候，网站的服务也是正常的了。</p>','php编译安装','php在线升级到5.6.3','所谓在线升级，就是保持当前版本的php服务不停止。（我用的是nginx加php-fpm的配合）。大致的思路就是，把之前的php目录重命名，然后重新编译安装新版本（5.6.3），最后杀死老的php-fpm服务，开启新的服务。','php',0,119,1),(115,1491559655,1491559655,1491559655,'<h2>尝试失败</h2><p>在/etc/my.conf里添加skip-grant-tables,然后重启mysql服务。发现不用密码还是登陆不上。只能尝试别的办法。只是奇怪，之前这个方法是可以的</p><h2>关闭当前的mysql服务</h2><pre class=\"brush:as3;toolbar:false\">/etc/init.d/mysqld&nbsp;stop</pre><h2>开启安全模式</h2><p>开启安全模式服务，弹出一些话，不用管，ctrl+c进入下一个操作<br/></p><pre class=\"brush:as3;toolbar:false\">[root@iZwz943t8c42mpu9nmbwnxZ&nbsp;bin]#&nbsp;./mysqld_safe&nbsp;--skip-grant-tables&nbsp;&amp;\r\n[1]&nbsp;6945\r\n[root@iZwz943t8c42mpu9nmbwnxZ&nbsp;bin]#&nbsp;2017-04-07T08:06:57.175307Z&nbsp;mysqld_safe&nbsp;Logging&nbsp;to&nbsp;&#39;/opt/lampstack/mysql/data/iZwz943t8c42mpu9nmbwnxZ.err&#39;.\r\n2017-04-07T08:06:57.177216Z&nbsp;mysqld_safe&nbsp;Logging&nbsp;to&nbsp;&#39;/opt/lampstack/mysql/data/iZwz943t8c42mpu9nmbwnxZ.err&#39;.\r\n2017-04-07T08:06:57.201843Z&nbsp;mysqld_safe&nbsp;Starting&nbsp;mysqld&nbsp;daemon&nbsp;with&nbsp;databases&nbsp;from&nbsp;/opt/lampstack/mysql/data\r\n^C找回密码</pre><h2>找回密码操作</h2><h3>这个时候可以不用密码登陆了</h3><pre class=\"brush:as3;toolbar:false\">mysql&nbsp;-uroot</pre><h3>选择数据库</h3><pre class=\"brush:as3;toolbar:false\">use&nbsp;mysql</pre><h3>修改密码</h3><pre class=\"brush:as3;toolbar:false\">update&nbsp;user&nbsp;set&nbsp;authentication_string=PASSWORD(&#39;newpass&#39;)&nbsp;where&nbsp;User=&#39;root&#39;&nbsp;&nbsp;#5.7.6以上\r\nupdate&nbsp;user&nbsp;set&nbsp;password=PASSWORD(&#39;newpass&#39;)&nbsp;where&nbsp;User=&#39;root&#39;;&nbsp;#5.7.5&nbsp;之前</pre><h3>退出mysql</h3><pre class=\"brush:as3;toolbar:false\">exit</pre><h2>kill掉mysqld_safe的进程</h2><p>ps aux|grep msyqld#找到进程号,然后kill掉</p><h2>重启mysql</h2><pre class=\"brush:as3;toolbar:false\">/etc/init.d/mysqld&nbsp;start</pre><h2>使用新密码登陆</h2><pre class=\"brush:as3;toolbar:false\">mysql&nbsp;-uroot&nbsp;-pnewpass</pre><p>登陆成功后</p><pre class=\"brush:as3;toolbar:false\">SET&nbsp;PASSWORD&nbsp;=&nbsp;PASSWORD(&#39;your_new_password&#39;);</pre><p><br/></p>','mysql','mysql5.7.17找回root密码','帮朋友配了一台云主机。为了省事买了一个lamp的镜像。装好系统，发现什么文档都没有。数据库密码都不知去哪里找。只能重新找回一下。','mysql',0,188,1),(116,1491789595,1491789595,1491789595,'','风筝','躺在棒子杆上仰望风筝，特别放松','原来一切物质的体验比起这种都差了不知十万八千里啊！','说说',0,147,1),(117,1491829933,1491829933,1491829933,'<h2>千言万语总结成一句话<br/></h2><p>iconv是个有bug的东西，用的时候一定要跟//IGNORE一起用。ignore的意思是忽略转换时的错误，如果没有ignore参数，所有该字符后面的字符串都无法被保存。<br/></p><h2>我跨的坑</h2><p>用iconv转换一段文字，发现转换出来都是空字符串。搞了半天是开头的字符串就不识别，导致后面的都被忽略了。打开报错会提示非法字符。解决办法就是加ignore</p><pre class=\"brush:as3;toolbar:false\">$fcontent&nbsp;=&nbsp;iconv(&quot;gbk&quot;,&quot;utf-8//IGNORE&quot;,$fcontent);</pre><p><br/></p>','跨过的坑','iconv的坑','iconv是个有bug的东西。用的时候最好跟//IGNORE一起用。ignore的意思是忽略转换时的错误，如果没有ignore参数，所有该字符后面的字符串都无法被保存。','php',0,161,1),(118,1491898745,1491898745,1491898745,'<h2>实现效果<br/></h2><p>猛戳<a href=\"/index.php/Demo/Little/fromMohuToQing\" target=\"_blank\">这里</a></p><h2>代码很简单</h2><p>html</p><pre class=\"brush:as3;toolbar:false\">&lt;img&nbsp;id=&quot;img1&quot;&nbsp;width=&quot;539&quot;&nbsp;height=&quot;290&quot;&nbsp;src=&quot;/Public/img/ceshi.png&quot;&nbsp;/&gt;</pre><p>js</p><pre class=\"brush:as3;toolbar:false\">window.onload&nbsp;=&nbsp;function(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;oImg&nbsp;=&nbsp;document.getElementById(&quot;img1&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;oImgOri&nbsp;=&nbsp;new&nbsp;Image();\r\n&nbsp;&nbsp;&nbsp;&nbsp;oImgOri.src&nbsp;=&nbsp;&quot;/Public/img/ceshi-ori.png&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;oImgOri.onload&nbsp;=&nbsp;function(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;oImg.src&nbsp;=&nbsp;oImgOri.src;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><h2>原理</h2><p>很简单，就是先显示分辨率低的图片。当分辨率高的图片加载好之后，用高分辨率的图片替换低分辨率的图片。这样能有效减少用户等待时间。或者说，至少这样，用户可以先有模糊的图片看。</p>','图片优化','图片优化的一种方式','图片经常有一种特效。就是刚开始是模糊的，到后来变清晰。我这里记录一种实现办法。','js',0,214,1),(119,1492186856,1492186856,1492186856,'<h2>再一次感觉</h2><p>在成长的路上有人指引是一件很幸福的事情，哪怕这种指引是花钱买来的。而我，希望把自己绕过的一些坑记下来，放在这里，以免自己再次掉坑里，也希望能帮到有缘的朋友吧。</p><h2>步骤</h2><h3>一、首先要获得开发者资格。</h3><p>facebook的网站都是中文的。这一点非常容易实现。</p><h3>二、你需要先创建一个应用。</h3><p>这一点也非常容易实现。创建完成之后，你可以看到下图的界面。用箭头标出来的“应用编号”，“API版本”，“产品列表”(注意，我们调用Facebook的登录就需要“Facebook登录”这个产品。）</p><p><img src=\"/ueditor/php/upload/image/20170414/1492182084857521.png\" title=\"1492182084857521.png\" alt=\"blob.png\"/></p><h3>三、如何用Facebook提供的JS SDK来登录自己的网站。</h3><p>也就是通过Facebook登录自己的应用，我们也通过这一步拿到调用Facebook很多API的access_token。所以掌握这一步还是很关键的。理解这一步，你要对OAUTH2.0这个协议有个基本的了解。</p><p>就具体实现来说。Facebook提供各种平台的SDK。这里以JSSDK为例进行说明。Facebook的开发文档真的非常“傻瓜”，基本0配置就能使用。</p><p>设置“Facebook 登录”这个产品</p><p><img src=\"/ueditor/php/upload/image/20170414/1492182712277841.png\" title=\"1492182712277841.png\" alt=\"blob.png\"/></p><p>这里的“有效OAuth跳转网址”就是用户授权登录后要调回来的地址。这里我写的我的测试地址。</p><h3>测试地址下面的localhost/index.html文件内容</h3><pre class=\"brush:as3;toolbar:false\">&lt;!DOCTYPE&nbsp;html&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&lt;title&gt;Facebook&nbsp;Login&nbsp;JavaScript&nbsp;Example&lt;/title&gt;\r\n&lt;meta&nbsp;charset=&quot;UTF-8&quot;&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;script&gt;\r\n&nbsp;&nbsp;//&nbsp;This&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;results&nbsp;from&nbsp;from&nbsp;FB.getLoginStatus().\r\n&nbsp;&nbsp;function&nbsp;statusChangeCallback(response)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;statusChangeCallback&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(response);\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;response&nbsp;object&nbsp;is&nbsp;returned&nbsp;with&nbsp;a&nbsp;status&nbsp;field&nbsp;that&nbsp;lets&nbsp;the\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;app&nbsp;know&nbsp;the&nbsp;current&nbsp;login&nbsp;status&nbsp;of&nbsp;the&nbsp;person.\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Full&nbsp;docs&nbsp;on&nbsp;the&nbsp;response&nbsp;object&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;documentation\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;for&nbsp;FB.getLoginStatus().\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(response.status&nbsp;===&nbsp;&#39;connected&#39;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Logged&nbsp;into&nbsp;your&nbsp;app&nbsp;and&nbsp;Facebook.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testAPI();\r\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;person&nbsp;is&nbsp;not&nbsp;logged&nbsp;into&nbsp;your&nbsp;app&nbsp;or&nbsp;we&nbsp;are&nbsp;unable&nbsp;to&nbsp;tell.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.getElementById(&#39;status&#39;).innerHTML&nbsp;=&nbsp;&#39;Please&nbsp;log&nbsp;&#39;&nbsp;+\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;into&nbsp;this&nbsp;app.&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;//&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;when&nbsp;someone&nbsp;finishes&nbsp;with&nbsp;the&nbsp;Login\r\n&nbsp;&nbsp;//&nbsp;Button.&nbsp;&nbsp;See&nbsp;the&nbsp;onlogin&nbsp;handler&nbsp;attached&nbsp;to&nbsp;it&nbsp;in&nbsp;the&nbsp;sample\r\n&nbsp;&nbsp;//&nbsp;code&nbsp;below.\r\n&nbsp;&nbsp;function&nbsp;checkLoginState()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;FB.getLoginStatus(function(response)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statusChangeCallback(response);\r\n&nbsp;&nbsp;&nbsp;&nbsp;});\r\n&nbsp;&nbsp;}\r\n\r\n&nbsp;&nbsp;window.fbAsyncInit&nbsp;=&nbsp;function()&nbsp;{\r\n&nbsp;&nbsp;FB.init({\r\n&nbsp;&nbsp;&nbsp;&nbsp;appId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&#39;102183543663176&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;cookie&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;true,&nbsp;&nbsp;//&nbsp;enable&nbsp;cookies&nbsp;to&nbsp;allow&nbsp;the&nbsp;server&nbsp;to&nbsp;access&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;session\r\n&nbsp;&nbsp;&nbsp;&nbsp;xfbml&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;true,&nbsp;&nbsp;//&nbsp;parse&nbsp;social&nbsp;plugins&nbsp;on&nbsp;this&nbsp;page\r\n&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&#39;v2.8&#39;&nbsp;//&nbsp;use&nbsp;graph&nbsp;api&nbsp;version&nbsp;2.8\r\n&nbsp;&nbsp;});\r\n\r\n&nbsp;&nbsp;//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;initialized&nbsp;the&nbsp;JavaScript&nbsp;SDK,&nbsp;we&nbsp;call&nbsp;\r\n&nbsp;&nbsp;//&nbsp;FB.getLoginStatus().&nbsp;&nbsp;This&nbsp;function&nbsp;gets&nbsp;the&nbsp;state&nbsp;of&nbsp;the\r\n&nbsp;&nbsp;//&nbsp;person&nbsp;visiting&nbsp;this&nbsp;page&nbsp;and&nbsp;can&nbsp;return&nbsp;one&nbsp;of&nbsp;three&nbsp;states&nbsp;to\r\n&nbsp;&nbsp;//&nbsp;the&nbsp;callback&nbsp;you&nbsp;provide.&nbsp;&nbsp;They&nbsp;can&nbsp;be:\r\n&nbsp;&nbsp;//\r\n&nbsp;&nbsp;//&nbsp;1.&nbsp;Logged&nbsp;into&nbsp;your&nbsp;app&nbsp;(&#39;connected&#39;)\r\n&nbsp;&nbsp;//&nbsp;2.&nbsp;Logged&nbsp;into&nbsp;Facebook,&nbsp;but&nbsp;not&nbsp;your&nbsp;app&nbsp;(&#39;not_authorized&#39;)\r\n&nbsp;&nbsp;//&nbsp;3.&nbsp;Not&nbsp;logged&nbsp;into&nbsp;Facebook&nbsp;and&nbsp;can&#39;t&nbsp;tell&nbsp;if&nbsp;they&nbsp;are&nbsp;logged&nbsp;into\r\n&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;your&nbsp;app&nbsp;or&nbsp;not.\r\n&nbsp;&nbsp;//\r\n&nbsp;&nbsp;//&nbsp;These&nbsp;three&nbsp;cases&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;callback&nbsp;function.\r\n\r\n&nbsp;&nbsp;FB.getLoginStatus(function(response)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;statusChangeCallback(response);\r\n&nbsp;&nbsp;});\r\n\r\n&nbsp;&nbsp;};\r\n\r\n&nbsp;&nbsp;//&nbsp;Load&nbsp;the&nbsp;SDK&nbsp;asynchronously\r\n&nbsp;&nbsp;(function(d,&nbsp;s,&nbsp;id)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;js,&nbsp;fjs&nbsp;=&nbsp;d.getElementsByTagName(s)[0];\r\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(d.getElementById(id))&nbsp;return;\r\n&nbsp;&nbsp;&nbsp;&nbsp;js&nbsp;=&nbsp;d.createElement(s);&nbsp;js.id&nbsp;=&nbsp;id;\r\n&nbsp;&nbsp;&nbsp;&nbsp;js.src&nbsp;=&nbsp;&quot;//connect.facebook.net/en_US/sdk.js&quot;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;fjs.parentNode.insertBefore(js,&nbsp;fjs);\r\n&nbsp;&nbsp;}(document,&nbsp;&#39;script&#39;,&nbsp;&#39;facebook-jssdk&#39;));\r\n\r\n&nbsp;&nbsp;//&nbsp;Here&nbsp;we&nbsp;run&nbsp;a&nbsp;very&nbsp;simple&nbsp;test&nbsp;of&nbsp;the&nbsp;Graph&nbsp;API&nbsp;after&nbsp;login&nbsp;is\r\n&nbsp;&nbsp;//&nbsp;successful.&nbsp;&nbsp;See&nbsp;statusChangeCallback()&nbsp;for&nbsp;when&nbsp;this&nbsp;call&nbsp;is&nbsp;made.\r\n&nbsp;&nbsp;function&nbsp;testAPI()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Welcome!&nbsp;&nbsp;Fetching&nbsp;your&nbsp;information....&nbsp;&#39;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;FB.api(&#39;/me&#39;,&nbsp;function(response)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Successful&nbsp;login&nbsp;for:&nbsp;&#39;&nbsp;+&nbsp;response.name);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.getElementById(&#39;status&#39;).innerHTML&nbsp;=\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Thanks&nbsp;for&nbsp;logging&nbsp;in,&nbsp;&#39;&nbsp;+&nbsp;response.name&nbsp;+&nbsp;&#39;!&#39;;\r\n&nbsp;&nbsp;&nbsp;&nbsp;});\r\n&nbsp;&nbsp;}\r\n&lt;/script&gt;\r\n\r\n&lt;!--\r\n&nbsp;&nbsp;Below&nbsp;we&nbsp;include&nbsp;the&nbsp;Login&nbsp;Button&nbsp;social&nbsp;plugin.&nbsp;This&nbsp;button&nbsp;uses\r\n&nbsp;&nbsp;the&nbsp;JavaScript&nbsp;SDK&nbsp;to&nbsp;present&nbsp;a&nbsp;graphical&nbsp;Login&nbsp;button&nbsp;that&nbsp;triggers\r\n&nbsp;&nbsp;the&nbsp;FB.login()&nbsp;function&nbsp;when&nbsp;clicked.\r\n--&gt;\r\n\r\n&lt;fb:login-button&nbsp;scope=&quot;public_profile,email&quot;&nbsp;onlogin=&quot;checkLoginState();&quot;&gt;\r\n&lt;/fb:login-button&gt;\r\n\r\n&lt;div&nbsp;id=&quot;status&quot;&gt;\r\n&lt;/div&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre><p>文档里已经有详细的注释。但是一方面为了加深自己的理解，另一方面让英语不怎么好的人更好的理解，我将这段脚本的功能大概说一下。</p><p>大致是这样。异步加载sdk文件。然后调用FB.getLoginStatus方法。如果登录的话调用testAPI方法拿到用户信息。如果是未登录的话，就提示登录。然后最下面有个登录按钮。登陆后会执行checkLoginStatus这个方法。流程大致就是这样。显示的页面如下图</p><p><img src=\"/ueditor/php/upload/image/20170415/1492186554772541.png\" title=\"1492186554772541.png\" alt=\"blob.png\"/></p><p>这样通过获得的access_token就能调用很多API了。</p>','facebook','Facebook开放平台入门','帮朋友做了一个facebook开放平台相关的小项目。总结一下入门的知识。有兴趣的朋友可以看看哦。','php',0,262,1),(120,1492390409,1492390514,1492390409,'<p>								</p><h2>结论</h2><p>栅格布局最好跟功能组件分别开来。</p><h2>之前的效果</h2><p><img src=\"/ueditor/php/upload/image/20170417/1492390116198999.png\" title=\"1492390116198999.png\" alt=\"blob.png\"/></p><h1>之前的代码</h1><pre class=\"brush:as3;toolbar:false\">&lt;div&nbsp;class=&quot;row&quot;&nbsp;style=&quot;margin-top:10px;&quot;&gt;\r\n	&lt;div&nbsp;class=&quot;panel&nbsp;panel-default&nbsp;col-md-6&quot;&nbsp;style=&quot;padding:0;&quot;&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-heading&quot;&gt;\r\n		&lt;h3&nbsp;class=&quot;panel-title&quot;&gt;Albums&lt;/h3&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-body&quot;&gt;\r\n		&lt;div&nbsp;class=&quot;alert&nbsp;alert-warning&quot;&nbsp;role=&quot;alert&quot;&gt;no&nbsp;data&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&lt;/div&gt;\r\n	&lt;div&nbsp;class=&quot;panel&nbsp;panel-default&nbsp;col-md-6&quot;&nbsp;style=&quot;padding:0;&quot;&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-heading&quot;&gt;\r\n		&lt;h3&nbsp;class=&quot;panel-title&quot;&gt;Photos&lt;/h3&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-body&quot;&gt;\r\n		&lt;div&nbsp;class=&quot;alert&nbsp;alert-warning&quot;&nbsp;role=&quot;alert&quot;&gt;no&nbsp;data&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&lt;/div&gt;\r\n&lt;/div&gt;</pre><p>分开的原因就是把“row”这个属性放在面板里面了</p><pre class=\"brush:as3;toolbar:false\">&lt;div&nbsp;class=&quot;panel&nbsp;panel-default&nbsp;col-md-6&quot;&nbsp;style=&quot;padding:0;&quot;&gt;</pre><h2>解决办法</h2><p>在面板里面的row属性去掉，在外面套一层row就行了，就像这样</p><pre class=\"brush:as3;toolbar:false\">&lt;div&nbsp;class=&quot;col-md-6&quot;&gt;\r\n	&lt;div&nbsp;class=&quot;panel&nbsp;panel-default&quot;&nbsp;style=&quot;padding:0;&quot;&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-heading&quot;&gt;\r\n		&lt;h3&nbsp;class=&quot;panel-title&quot;&gt;Albums&lt;/h3&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-body&quot;&gt;\r\n		&lt;div&nbsp;class=&quot;alert&nbsp;alert-warning&quot;&nbsp;role=&quot;alert&quot;&gt;no&nbsp;data&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div&nbsp;class=&quot;col-md-6&quot;&gt;\r\n	&lt;div&nbsp;class=&quot;panel&nbsp;panel-default&quot;&nbsp;style=&quot;padding:0;&quot;&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-heading&quot;&gt;\r\n		&lt;h3&nbsp;class=&quot;panel-title&quot;&gt;Photos&lt;/h3&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;div&nbsp;class=&quot;panel-body&quot;&gt;\r\n		&lt;div&nbsp;class=&quot;alert&nbsp;alert-warning&quot;&nbsp;role=&quot;alert&quot;&gt;no&nbsp;data&lt;/div&gt;\r\n	&nbsp;&nbsp;&lt;/div&gt;\r\n	&lt;/div&gt;\r\n&lt;/div&gt;</pre><h2>效果<img src=\"/ueditor/php/upload/image/20170417/1492390336488681.png\" title=\"1492390336488681.png\" alt=\"blob.png\"/></h2><p>这样就美观多了。</p><p>							</p>','bootstrap','bootstrap面板布置','最开始写个面板组，一共两个面板。写完连在一起，十分难看。研究了一下，分开了。结论：栅格布局最好跟功能组件分别开来。','html',0,146,1),(121,1492423339,1492439404,1492423339,'<p>								</p><h2>问题</h2><p>记录到数据库的内容是被转码后的。其中的空格被转成&amp;nbsp;。将这个东西用html_entity_decode转过来的时候，&amp;nbsp;变成了“黑色方块”乱码。</p><h2>解决办法</h2><p>使用htmlspecials_decode转码而不是用html_entity_decode转码。转码后过滤</p><p>preg_replace(&quot;//&quot;,&quot;&amp;nbsp;&quot;,$str);</p><h2>区别</h2><p>htmlentities转码所有html标签。htmlspecialchars值转换&amp;,&lt;,&gt;,&#39;,&quot;这5个。</p><p>一般用htmlspecialchars。htmlentities在转码中文时，容易出现乱码。</p><p>							</p>','乱码',' html_entity_decode遇到“黑心方块”的问题','记录到数据库的内容是被转码后的。其中的空格被转成\"&nbsp;\" 。将这个东西用html_entity_decode转过来的时候， 编成了“黑色方块”乱码。','php',0,238,1),(122,1492932241,1492932371,1492932241,'<p>								</p><p><span style=\"font-size: 14px;\"><strong>本文转载自：<a href=\"http://www.cnblogs.com/wushangjue/p/4529063.html?utm_source=tuicool&utm_medium=referral\">http://www.cnblogs.com/wushangjue/p/4529063.html?utm_source=tuicool&amp;utm_medium=referral</a></strong></span></p><h1 class=\"postTitle\" style=\"margin: 0px; padding: 0px 0px 0px 5px; float: left; line-height: 1.5; width: 988.078125px; clear: both; font-size: 14px;\"><a class=\"postTitle2\" href=\"http://www.cnblogs.com/wushangjue/p/4529063.html\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179); text-decoration: none;\">AngularJS入门之动画</a></h1><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">AngularJS中ngAnimate模块支持动画效果，但是ngAnimate模块并未包含在AngularJS核心库中，因此需要使用ngAnimate需要在定义Module时声明对其的引用。</span></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">AngularJS中实现动画效果有两大种方式：</p><ul style=\"margin-left: 30px; padding: 0px; word-break: break-all;\" class=\" list-paddingleft-2\"><li><p>基于CSS的动画效果</p></li><ul style=\"list-style-type: square;\" class=\" list-paddingleft-2\"><li><p>CSS Transition&nbsp;Animation</p></li><li><p>CSS Class-based Animation</p></li></ul><li><p>基于Javascript的动画效果</p></li></ul><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">官方给出的能支持动画效果的Directives：</p><table class=\"ng-scope table table-bordered table-striped code-table\"><thead style=\"margin: 0px; padding: 0px;\"><tr style=\"margin: 0px; padding: 0px;\" class=\"firstRow\"><th style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">Directive</th><th style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">Supported Animations</th></tr></thead><tbody style=\"margin: 0px; padding: 0px;\"><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/ngRepeat#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngRepeat</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">enter, leave and move</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ngRoute/directive/ngView#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngView</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">enter and leave</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/ngInclude#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngInclude</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">enter and leave</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/ngSwitch#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngSwitch</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">enter and leave</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/ngIf#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngIf</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">enter and leave</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/ngClass#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngClass</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">add and remove (the CSS class(es) present)</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/ngShow#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngShow</a>&nbsp;&amp;&nbsp;<a href=\"https://docs.angularjs.org/api/ng/directive/ngHide#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngHide</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">add and remove (the ng-hide class value)</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ng/directive/form#animation-hooks\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">form</a>&nbsp;&amp;&nbsp;<a href=\"https://docs.angularjs.org/api/ng/directive/ngModel#animation-hooks\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngModel</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">add and remove (dirty, pristine, valid, invalid &amp; all other validations)</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ngMessages#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngMessages</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\">add and remove (ng-active &amp; ng-inactive)</td></tr><tr style=\"margin: 0px; padding: 0px;\"><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse;\"><a href=\"https://docs.angularjs.org/api/ngMessages#animations\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">ngMessage</a></td><td style=\"margin: 0px; padding: 3px; border-color: silver; border-collapse: collapse; word-break: break-all;\">enter and leave</td></tr></tbody></table><h2 style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">基于CSS的动画效果</h2><h2 style=\"margin: 10px 0px; padding: 0px; font-size: 21px; line-height: 1.5;\">1. CSS Transition Animation</h2><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">示例1（官方Demo）：</p><pre class=\"brush:as3;toolbar:false\">&lt;!DOCTYPE&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&nbsp;type=&quot;text/css&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;开始时的样式&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.fade.ng-enter&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transition:&nbsp;5s&nbsp;linear&nbsp;all;&nbsp;/*&nbsp;当使用css&nbsp;transition实现动画效果时，在开始时的样式中必须包含transition的设置&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;0;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;结束时的样式&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.fade.ng-enter.ng-enter-active&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular-animate.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;app&nbsp;=&nbsp;angular.module(&#39;cssBasedAnimationTest&#39;,&nbsp;[&#39;ngAnimate&#39;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&nbsp;ng-app=&quot;cssBasedAnimationTest&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;ng-if=&quot;bool&quot;&nbsp;class=&quot;fade&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fade&nbsp;me&nbsp;in&nbsp;out\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;ng-click=&quot;bool=true&quot;&gt;Fade&nbsp;In!&lt;/button&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;ng-click=&quot;bool=false&quot;&gt;Fade&nbsp;Out!&lt;/button&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">注意：使用CSS Transition时，ng-EVENT（动画开始前的样式）和ng-EVENT-active（动画执行完毕后的样式）这两组样式必须同时出现，且在ng-EVENT中必须包含transition的设置。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">本篇开头提到过，AngularJS核心库并不包含ngAnimate模块，因此我们首先需要在定义Module时，添加对ngAnimate模块引用的声明：</p><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &#39;Courier New&#39; !important;\">var&nbsp;app&nbsp;=&nbsp;angular.module(&#39;cssBasedAnimationTest&#39;,&nbsp;[&#39;ngAnimate&#39;]);</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">使用ngIf（ng-if）来控制class=&quot;fade&quot;的元素是否加载到DOM：</p><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &#39;Courier New&#39; !important;\">&lt;div&nbsp;ng-if=&quot;bool&quot;&nbsp;class=&quot;fade&quot;&gt;</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">注意：ngIf和ngShow/ngHide不同，ngIf在元素隐藏时DOM中并没有该元素，而使用ngShow/ngHide时元素依然存在于DOM中。&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">点击&quot;Fade In!&quot;按钮时，加载div到DOM并触发enter，AngularJS对元素自动添加ng-enter和ng-enter-active的样式，并从ng-enter到ng-enter-active执行样式转换。为了能看清过程，我们将ng-enter中的过渡时间设置为5s，点击&quot;Fade In!&quot;按钮后观察Html的变化。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><strong style=\"margin: 0px; padding: 0px;\">Step 1（点击前，如前面所说，ngIf在触发前，DOM中并没有div）：</strong></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><img class=\"myimg\" src=\"/ueditor/php/upload/image/20170423/1492931877810007.png\" alt=\"\"/></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><strong style=\"margin: 0px; padding: 0px;\">Step 2（点击按钮后，AngularJS自动添加了ng-animate、ng-enter、ng-enter-active这三个动画相关的样式名，并由ngAnimate模块执行动画效果）：</strong></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><img class=\"myimg\" src=\"/ueditor/php/upload/image/20170423/1492931877462668.png\" alt=\"\"/></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><strong style=\"margin: 0px; padding: 0px;\">Step 3（动画执行完后，示例中是5s后，ng-animate、ng-enter、ng-enter-active被移除，div的状态为ng-enter-active中指定的状态）：</strong></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><img class=\"myimg\" src=\"/ueditor/php/upload/image/20170423/1492931878301952.png\" alt=\"\"/></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">另外一种CSS transition的方法是使用CSS的Keyframe关键字，对于示例1中样式文件可改为如下：</p><pre class=\"brush:as3;toolbar:false\">&lt;style&nbsp;type=&quot;text/css&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;开始时的样式，使用keyframes不需要定义结束时的样式&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;.fade.ng-enter&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;animation:&nbsp;my_fade_animation&nbsp;0.5s&nbsp;linear;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-webkit-animation:&nbsp;my_fade_animation&nbsp;0.5s&nbsp;linear;\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;@keyframes&nbsp;my_fade_animation&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;0;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;@-webkit-keyframes&nbsp;my_fade_animation&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;0;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&lt;/style&gt;</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">这种写法中是不需要ng-EVENT-active的。</p><h2 style=\"margin: 10px 0px; padding: 0px; font-size: 21px; line-height: 1.5;\">2. CSS Class-based Animation:</h2><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">Class-based Animation即为通过ngClass、ngShow、ngHide等Directives执行动画效果。 &nbsp;</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">示例2：</p><pre class=\"brush:as3;toolbar:false\">&lt;!DOCTYPE&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&nbsp;type=&quot;text/css&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.fade.ng-hide&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transition:&nbsp;3s&nbsp;linear&nbsp;all;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;0;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.fade.ng-show&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transition:&nbsp;3s&nbsp;linear&nbsp;all;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;1;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular-animate.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;app&nbsp;=&nbsp;angular.module(&#39;cssClassBasedAnimationTest&#39;,&nbsp;[&#39;ngAnimate&#39;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&nbsp;ng-app=&quot;cssClassBasedAnimationTest&quot;&nbsp;ng-init=&quot;bool=true&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;ng-show=&quot;bool&quot;&nbsp;class=&quot;fade&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;ng-show.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;ng-hide=&quot;bool&quot;&nbsp;class=&quot;fade&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;ng-hide.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;ng-click=&quot;bool=!bool&quot;&gt;Toggle&lt;/button&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">本例改自官方Demo，除了官方Demo中有点问题之外，另外我自己添加了.fade.ng-show以及两个div分别使用ng-show和ng-hide两个属性。为了能看清Html的变化，动画过渡时间也设置成了3s。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><strong style=\"margin: 0px; padding: 0px;\">图1：</strong></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><img class=\"myimg\" src=\"/ueditor/php/upload/image/20170423/1492931879538798.png\" alt=\"\"/></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><strong style=\"margin: 0px; padding: 0px;\">图2：</strong></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\"><img class=\"myimg\" src=\"/ueditor/php/upload/image/20170423/1492931880294102.png\" alt=\"\"/></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">实际观察Html的变化，无论是ngShow还是ngHide，其实都是在隐藏元素时，默认添加ng-hide-animate、ng-hide-add、ng-hide-add-active样式。也就是针对像ngHide、ngShow等这些可以感知动画的Directives，由AngularJS的ngAnimate模块自动添加了CSS Transition动画。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">ngAminate能检测的行为是样式的add或者remove， 那如何显式的指定add和remove的样式呢？</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">示例3（官方Demo）：</p><pre class=\"brush:as3;toolbar:false\">&lt;!DOCTYPE&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&nbsp;type=&quot;text/css&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.highlight&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transition:&nbsp;3s&nbsp;linear&nbsp;all;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.highlight.on-add&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;white;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.highlight.on&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;yellow;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.highlight.on-remove&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;black;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular-animate.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;app&nbsp;=&nbsp;angular.module(&#39;cssClassBasedAnimationTest&#39;,&nbsp;[&#39;ngAnimate&#39;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&nbsp;ng-app=&quot;cssClassBasedAnimationTest&quot;&nbsp;ng-init=&quot;bool=true&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;ng-class=&quot;{on:onOff}&quot;&nbsp;class=&quot;highlight&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Highlight&nbsp;this&nbsp;box\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;ng-click=&quot;onOff=!onOff&quot;&gt;Toggle&lt;/button&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">我们让ng-class随着点击Toggle按钮变化，当onOff=true时样式on会被ngAnimate执行on-add的过程，反之则执行on-remove的过程。由于显式指定了样式，当我们运行示例3时，这个过程就一目了然了。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">&nbsp;&nbsp;</p><h2 class=\"contentTitle\" style=\"margin: 10px 0px; padding: 5px; width: 971.265625px; background-color: rgb(192, 192, 192); border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; font-size: 21px; line-height: 1.5;\">基于Javascript的动画效果:</h2><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">使用基于Javascript的动画效果可以让你在脚本中使用其他的Service甚至引用第三方的脚本进行动画的制作，使动画效果更丰富多变。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">与基于CSS的动画效果相似，基于Javascript的动画效果也会由AngularJS自动添加一些指定的样式到元素上，但基于Javascript的动画效果还需要使用<span class=\"kwd\" style=\"margin: 0px; padding: 0px; line-height: 1.5;\">module<span class=\"pun\" style=\"margin: 0px; padding: 0px; line-height: 1.5;\">.<span class=\"pln\" style=\"margin: 0px; padding: 0px; line-height: 1.5;\">animation<span class=\"pun\" style=\"margin: 0px; padding: 0px; line-height: 1.5;\">()添加动画脚本。</span></span></span></span></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">示例4：</p><pre class=\"brush:as3;toolbar:false\">&lt;!DOCTYPE&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/angular-animate.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;src=&quot;/Scripts/jquery-1.9.1.js&quot;&gt;&lt;/script&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;app&nbsp;=&nbsp;angular.module(&#39;javascriptBasedAnimationTest&#39;,&nbsp;[&#39;ngAnimate&#39;]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.animation(&#39;.slide&#39;,&nbsp;[function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enter:&nbsp;function&nbsp;(element,&nbsp;doneFn)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jQuery(element).fadeIn(1000,&nbsp;doneFn);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move:&nbsp;function&nbsp;(element,&nbsp;doneFn)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jQuery(element).fadeIn(1000,&nbsp;doneFn);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;leave:&nbsp;function&nbsp;(element,&nbsp;doneFn)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jQuery(element).fadeOut(1000,&nbsp;doneFn);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.controller(&#39;myController&#39;,&nbsp;[&#39;$scope&#39;,&nbsp;function&nbsp;($scope)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.students&nbsp;=&nbsp;[&quot;Tom&quot;,&quot;Jack&quot;,&quot;Alice&quot;,&quot;May&quot;,&quot;Thomas&quot;];\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})();\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&nbsp;ng-app=&quot;javascriptBasedAnimationTest&quot;&nbsp;ng-controller=&quot;myController&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;ng-if=&quot;isshow&quot;&nbsp;ng-repeat=&quot;stu&nbsp;in&nbsp;students&quot;&nbsp;class=&quot;slide&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{&nbsp;stu&nbsp;}}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;button&quot;&nbsp;value=&quot;Toggle&quot;&nbsp;ng-click=&quot;isshow=!isshow&quot;&nbsp;/&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">注：本例为了便于实现js的动画效果引入了jQuery。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">示例4中，我们对class=&#39;slide&#39;的元素的AngularJS中的默认行为添加了动画行为，当使用ngIf让元素enter或者remove时，将触发动画效果。</p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">关于更复杂的对象，也可参考参考资料中提到的AngularJS Hub的例子，本文就不展开了。</p><p>&lt;style type=&quot;text/css&quot;&gt;</p><p>&nbsp; &nbsp; /* 开始时的样式，使用keyframes不需要定义结束时的样式 */</p><p>&nbsp; &nbsp; .fade.ng-enter {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; animation: my_fade_animation 0.5s linear;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; -webkit-animation: my_fade_animation 0.5s linear;</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; @keyframes my_fade_animation {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; from {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacity: 0;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; to {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacity: 1;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; @-webkit-keyframes my_fade_animation {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; from {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacity: 0;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; to {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacity: 1;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; }</p><p>&lt;/style&gt;</p><h3 class=\"contentTile\" style=\"margin: 10px 0px; padding: 0px; font-size: 16px; line-height: 1.5;\">参考资料</h3><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">AngularJS官方文档：<a href=\"https://docs.angularjs.org/api/ngAnimate\" target=\"_blank\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">https://docs.angularjs.org/api/ngAnimate</a></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">ngAnimate：<a href=\"http://www.nganimate.org/\" target=\"_blank\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">http://www.nganimate.org/</a></p><p style=\"margin: 10px auto; padding: 0px; line-height: 1.5;\">AngularJS Hub:&nbsp;<a href=\"http://www.angularjshub.com/examples/animations/javascriptanimations/\" target=\"_blank\" style=\"margin: 0px; padding: 0px; color: rgb(7, 93, 179);\">http://www.angularjshub.com/examples/animations/javascriptanimations/</a></p><p><br/></p><p>							</p>','angular','angular.js动画入门','angular.js动画的一些知识点。转载的，用到的时候有个参考。','AngularJS',0,179,1),(123,1492933761,1492933914,1492933761,'<p>								</p><h2>实例</h2><h2><a href=\"http://ruanwenwu.cn/route/app/UIRoute3.html\">http://ruanwenwu.cn/route/app/UIRoute3.html</a></h2><h2>注意点</h2><h3>一、路由嵌套通过ui-view属性来实现。子页面实际上替换的是父页面的ui-view。</h3><p>比如这种结构：</p><pre class=\"brush:as3;toolbar:false\">.state(&#39;index.usermng&#39;,&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;&#39;/usermng&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;views:&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;main@index&#39;:&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateUrl:&nbsp;&#39;tpls3/usermng.html&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;controller:&nbsp;function($scope,&nbsp;$state)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.addUserType&nbsp;=&nbsp;function()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$state.go(&quot;index.usermng.addusertype&quot;);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.state(&#39;index.usermng.highendusers&#39;,&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;&#39;/highendusers&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateUrl:&nbsp;&#39;tpls3/highendusers.html&#39;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</pre><p>/highenduser这个地址的模板里的内容替换的是/usermng这个页面的模板里的ui-view。</p><h3>二、页面之间的转场动画，是通过ng-animation模块来实现的。</h3><p>这个模块要被作为依赖模块载入。实现动画的几种方式可以在<a href=\"/blog/122.html\" target=\"_blank\">上一篇博文</a>中了解。当前这个页面里的demo的转场动画是由css3的transtion来实现的。</p><p>							</p>','angular','angular.js中的ui-router实现路由','用angular.js可以实现单页应用。而单页应用的页面之间的跳转就要用到ui-router这个东西。这个东西比angular.js自带的ng-router的优势是，它可以实现路由嵌套。','AngularJS',0,249,1),(124,1493343960,1493569870,1493343960,'<p>								</p><p>好多年前，我搁下了心爱的笔，不再写一些东西。自那时以及后来很长一段时间，我觉得，有些感觉，将她放在心中默默感受就好了，因为无人言说，也无法言说。毕竟有些微妙的感觉，说不清楚。有些美好，也并不足外人道罢。<br/></p><p>可是我现在决定，我要重拾这个&quot;曾经的挚爱&quot;。</p><p>提起这个挚爱，我不禁想起一个情景。那是我读大二的时候，在教务处的办公室里，有一个老师问我：“你将来想做什么工作？”我毫不犹豫地说：“我想成为一个作家！”</p><p>后来我读了很多小说和诗歌，写作成为我的最爱。我记得有好多次，我写到了天亮。每写完一篇自己喜欢的文字都感觉特别的喜悦与满足。有一次写到天亮，下雪了，我兴致很高，打着伞出去看雪，吃早餐。因为人的心境的关系，这世界的一切在你眼中都是可以那么那么的美好的啊。</p><p>要不是有个作家朋友的突然出现，我想我不会觉出我正在失去一些于我最可贵的东西。要不是这个朋友的突然出现，我想我仍然会跟大多数的“正常人”一样，每天做的事情就是努力挣钱，不断学习挣钱的技能，一直到老吧。这太可怕了，对物质的追求和单调的循环占据了人生的一切。这样的人生继续下去，该有多苍白，多无趣呢？</p><p>不要让自己的内心世界继续荒芜下去了。停下脚步，参加一些活动，思考一下人生，多关心一下周围人和自己的内心世界吧。做一个勇敢，善良，有温度的人吧。</p><p>要不是这个朋友离我如此之近，我的感受也不会如此强烈。看着他的文字，你能想象这样一个人就在你的身边，说着文章里的话。这种感觉如此真实而又如此陌生，让我着迷，让我想起了自己曾经的那个“梦想”。</p><p>“记录生命，分享感动！”这即是我想成为作家的初衷了。试想，如果个读者读了我的文章，像我读了我这个朋友的文章一样，心境一下子变得明朗，心中生出光来，那将是我最为欣慰的事了。这也是我突然地要重新做这件事情的原因了。</p><p><br/></p><p>							</p>','心境','感觉有光在心中生长','“记录生命，分享感动！”这即是我想成为作家的初衷了。试想，如果个读者读了我的文章，像我读了我这个朋友的文章一样，心境一下子变得明朗，心中生出光来，那将是我最为欣慰的事了。这也是我突然地要重新做这件事情的原因了。','散文',0,147,0),(125,1493418517,1493440666,1493418517,'<p>								</p><p>今天晚上有篮球活动。他非常想去，可是还有不少工作要做。他在早上就做了决定，不打篮球，加班。</p><p>活动20：30开始。19:30有个朋友S邀他一起去，稍微“自我斗争”了一小会，他就高兴地答应了。又做了十分钟的工作，就和另外一个朋友Z一起出发了。</p><p>现在的他的心里发生了一种改变。他渴望生活就像他好久没有生活过一样。年复一年的工作与学习留给他的除了技能增长之外，竟好像只有一片空白。就好像一辆车或者别的高速运行的东西，只顾着前进，错过了所有的风景。这辆车，他现在想开得慢一点，看看经过的风景，拍一两张照片，或者干脆停下来，和聊得来的朋友谈谈心，做做一直想做的梦。</p><p>三个人在去球场的路上，谈笑着，那种感觉让它感觉真实，是读书与写作所不能给的。他虽爱写作，但是他害怕像他读过的一本小说里的一个人物一样，坐在轮椅上，永远生活在自己的小说里。这个人物在文学上取得了很高的成就，远处的人都崇拜他，而她的爱人，原本那个应该深爱他的人，却深深的鄙视他，鄙视他的真实的一无所有！</p><p>打篮球让他快活。好久不打篮球的他仿佛看到了读书时候的打篮球的自己。这两个自己都是快乐的。不同的是，那个青春时期的自己没想到今天会有个将来的自己在回过头去注视他。</p><p>差不多21：30分，他给老婆打电话，约她在地铁X站碰头。打完电话他就和朋友们愉快地告别了。朋友S和他同行。朋友S聊到他最近在看“微信读书”。他觉得那真是非常好的事情，大家都在追求美好的东西。</p><p>出了地铁，他搂着他老婆，又和她聊起昨天发生的那件不愉快的事。他老婆埋怨他态度不好，他希望老婆为人处世更有修养。他承认他的态度有问题，他给她道了歉。但是说回他老婆的问题，他老婆又开始把一切原因都推在别人身上，甚至又开始说起脏话。他很失望，说了一句：“臭脾气”，放开了搂着她老婆的手。于是两个人各走各路，谁也不想搭理谁了。</p><p>他觉得有点压抑，想吃东西。就在他在路边买瓜的空档，他老婆已走远，消失在前面的黑夜中。<br/></p><p>此刻他突然感觉累了，精疲力尽。夜晚的风吹在身上，都是孤独。这不是他理想中的婚姻状态，但是他也没有不继续过的意思。不单是为了孩子，更是因为他们之间曾经发生的一切，至少因为他肯定她是爱他的。他很早就明白，这种美满强求不来。</p><p>回到家里，两人无语。她玩她的手机，他躺在床上歇乏。快12点了，他一点睡意没有。他打开电脑，戴上耳机，写他对近期生活的一些感受。他也想起过去的很多事情。这些心理活动给他很大的力量，晚上的不悦也似乎也被全都赶走了。他突然觉得，他心里有一种特别的小幸福，能给他带来温暖，帮助他积极地去对待所有的人和事。写完这篇小文都凌晨1点半了。他合上电脑，心满意足的睡了。</p><p>第二天早上起来，他发现鼻子里流了好多血，还有点头疼。但这丝毫没有影响到他的好心情。洗漱完出门，他戴上耳机，准备跑步去地铁。</p><p>他特别喜欢跑步的感觉。他把跑步分为三个阶段。第一个阶段，精力充沛，跑的也快，这让他有一种强烈的自由而又有活力的感觉。第二个阶段是续航阶段，这个阶段跑速比较均匀，筋骨也活动开了。这个时候他一般都会看看天，看看树。碰到蓝天白云，清风拂面的时候，就有种奔向美好明天的幸福感。第三个阶段是坚持阶段，到这个时候人已经很累，喘着粗气。这确实他最喜欢的阶段。这个阶段他会给自己加油，每往前迈一步都是胜利的奖励，每迈出一步喜悦就会加倍。</p><p>每次跑到地铁站他都有点意犹未尽的感觉。1.3KM的路程不长，却是一天美丽的开始。</p><p>以往在通勤的路上，他都会看看专业相关的东西，可是今天他不打算看任何东西。他觉得他需要好好的想一想自己的人生，他需要好好的感受一下人生。</p><p>昨天受了他老婆气的销售员C小姐打电话给他，说她们公司今天会给他打个回访电话，了解一下商品的使用情况与他第她们服务的满意度。接到她的电话，他很高兴。因为C小姐的声音里听不出一丝的不悦与失落，而是满满的笑容与自信。他很赞叹C小姐能这么快就调整好了心态。他跟她说：“都是满分，请放心”。在他看来，与人相处，能帮就帮，不要难为人。C小姐的来电让他想：如果人与人之间都如此相处，那么这世界该多么美好。</p><p>							</p>','心境','他渴望生活，就像他好久没有生活过一样','年复一年的工作与学习留给他的除了技能增长之外，竟好像只有一片空白。','散文',0,139,0),(126,1493456826,1493457157,1493456826,'<p>								</p><p>我发现我最近又变得很敏感，柔软起来了。经过的事情和伴随事情的感想都能如电影画面一样定格在我的脑海中。</p><p>一大清早，约莫5点左右的光景，我就再也睡不着了，有太多的感想想要记录，想要表达。</p><p>文章写到一半，小孩子起来了，非得拉着我出去玩。正好赶上庙会，我俩脸都没洗，穿着凉拖鞋就上街了。小孩子欢喜的很，一路跑着，我在后面怎么喊她慢点都没用。她回头冲我调皮的笑的样子，肯定是这世上我觉得最美的事情。</p><p>打气球，蹦蹦床，旋转木马。庙会人还不多的时候，我们就玩了个遍。</p><p>她特别爱坐旋转木马，我看她坐旋转木马比她小时候坐摇摇车要快乐得多。她坐旋转木马的时候，我问她：“好玩吗？”。她说：“好玩”。小孩子的语气永远是那么认真，认真的让人觉得久违，觉得感动。每次她转到我的面前的时候，我一冲他摆剪刀手，冲她做鬼脸，她就会笑的特别快乐。有一次我冲她摆了剪刀手后，她笑了，转过去之后，我好像看到她有一个抹眼泪的动作，那一刻我的眼泪就涌上来了，就像此时此刻敲着这些文字的我。一个星期才能回来看孩子一次，我们欠她太多。</p><p>正玩着，她妈妈骑着电动车过来了，喊我们回去吃早餐，然后去练车。</p><p>妻子靠在我的肩上，看着小孩子在木马上旋转。当时并不觉得，现在想起来，这不就是平凡的幸福吗？</p><p>妻子新手上路一点也不怵，这让我大为赞叹。第一天开车就跑到90多公里每小时，用流行词说叫做：厉害了我的老婆大人！</p><p>老丈人是个开车的老手，坐在副驾驶上指导，一会说这一会说那，妻子都不耐烦了，说都没法开车了。后来老丈人干脆一言不说了。呵呵，想起这些细节其实挺有意思，这不就是生活吗？</p><p>中午吃了个便饭，妻子就开车载着我去驾校报了个名。托她姐姐找了点关系，便宜了1000块钱。作为一个业余的“文人”，我本应该不齿这种行为的。但是有人情在这里，我还是很谢谢妻子的姐姐。这么帮忙的，不计较回报的恐怕也就是我们的亲人吧。</p><p>说起亲人，今天早上我和三姐通了快10分钟的视频电话。我发现原来在至亲面前，你可以不知不觉已经卸下了所有防备，做了最真实的自己，笑出了真正的快乐。</p><p>三姐是个女强人。30出头的年纪已是一个大的品牌连锁店的店长。她跟我说最近工作积极性不怎么高，因为看到自己的上限了。她说老板不会重用她，也不敢。因为一来知道他不久后要离开那个地方，二来担心她能力太强影响到自己。我跟她说，不管怎样，我们应该积极对待生活，但是她是听不进去了，现在的状态是她自己的选择。此时此刻，我突然想到她小的时候。那时候我俩还老打架。读四年级的时候，我们在一个班，不记得为什么数学老师不停的让我上台做题，我记得我应该是哭了，她好像站起来质问老师为什么要这样。四年级的女生，为了弟弟质问老师，这需要多大的勇气啊。想到这里我的眼角又泛起了泪光。我想她们了。愿上帝保佑她们平安，幸福。</p><p>报完名，送走妻子的姐姐，我俩决定往东跑跑，去“看看东边的世界”。车速跑到80KM以上的时候，人生出一阵快感，怪不得好多人喜欢开快车，但是希望我亲爱的读者注意安全，平安才能回家。</p><p>原本准备回家后睡个午觉的，可是回家后都快3点了，索性就不睡了。打开电脑，打算追一下最近热播的《人民的名义》,看了半集，实在看不下去了。生命太宝贵，应该干一些能留下生命痕迹的事情。于是我打开编辑器，写下了这篇文章。如果有人读到这里，并觉得不是写了一大堆的废话，那我的时间应该没有白费吧。</p><p>就到这里吧。啊，我的心里这几天还有些别的微妙的感觉，我不确定这是什么，我也不知道该如何表达。这从未有过，我也不知道能持续多久。但是我能做的，就是做不要让自己后悔的事情，其他的就交给老天爷吧。</p><p>							</p>','心境','文不对题','我的心里这几天还有些别的微妙的感觉，我不确定这是什么，我也不知道该如何表达。这从未有过，我也不知道能持续多久。但是我能做的，就是做不要让自己后悔的事情，其他的就交给老天爷吧。','散文',0,132,0),(127,1493569217,1493569217,1493569217,'<p>晚上10点多，睡了一小会的小孩子下床来，开了灯，穿衣服。还在码字的我问她：“这么晚了还穿衣服干什么？”她说：“我要下楼跟姥姥睡。”说完，关了卧室的灯，带上房门出去了。过了一小会又推开门走到我身边对我说：“我要喝水。”我说：“要喝水下楼去倒啊。”她还是说：“要喝水。” 我又说：“要喝水下楼去倒啊。”她还是说：“我要喝水。”我凑近了看她，发现她眼里有泪光。我问她：“是不是害怕？”她说：“是”。我说：“爸爸陪你一起下去。”我抱着她，问她：“为什么不敢一个人下楼呢？” 她说：“怕小老鼠。”</p><p>喝完水，我说：“我们上去睡吧。”她说：“我热。你看我后背都湿了。”我说：“我们把两边的窗户打开就不会热了。”她还是不愿意上楼。我猜她还想出去玩，于是问她：“你是不是还想出去玩？”她说：“是。”我说：“已经好晚了，外边都没得玩了，还有好多抓小孩的坏人。”但是她不听，仍想出去玩。我有些困，有些不耐烦了，对她说：“我先上去了，你要是热，在摇椅上睡会。”我上楼的时候，看她边看我，边要往屋外走。上楼后我在窗口看着楼下，她到底是没敢出门。过了几分钟我下去看她，发现她侧卧在躺椅上。走近了，我又看她眼睛里有泪光，我的心里就不好受了，觉得自己做错了。我对她说：“我抱着你在躺椅上睡会？”她摇了摇头。我弯下腰，抱起她，她好像等这一刻好久了，紧紧地抱着我的脖子，把头埋在我的肩上。</p><p>我抱着她躺在摇椅上。我轻轻地拍着她的后背，一直到她睡熟了。我能感觉到她对我的依赖，我越发觉得，即使短暂的分别对她，对我都是一种煎熬。</p><p>写到这里我突然觉得，我们这些大人有时候觉得小孩子调皮实在是不该。如果我们能仔细的揣摩一下孩子的心理，也许孩子就会少很多“调皮”，多很多快乐。</p><p>说到揣摩，我今天收到新朋友，“老相识”的同事L的微信，说的是工作内容，说完后告诉我是想表达别的意思，让我自己悟。</p><p>先说“新朋友，老相识”这六个字的意思。这应该是很多人都有的体会，一群人在一起若干年却不能彼此称友，特别是在工作之后。我想了一下，造成这种情况大抵是因为大家都没有“交心”，最终成了“熟人”，连“新朋友”都算不上。我和这位L君“交心”也是这两天突然，偶然发生的事情。所以交个朋友算是十分难得且幸运的事了。</p><p>对于”让我悟&quot;的话，我揣摩了，但我不知道自己揣摩的对不对。是指我们之间以后只是工作关系？还是别的意思呢？如果真是这样，我能接受，但我会很难过。我有十年没交过“朋友”，因为我自己封闭了自己，同时我也没有遇到和自己趣味相投的人。而这位L君却让我格外“喜欢”。这种喜欢出于她让我感受到的“风度”，出于她文章里的思想。这种喜欢也会止于这两点，所谓君子之交，一切顺其自然罢了。</p><p>最近家里的开支大了许多，还是需要努力工作，好好学习，为将来挣更多的钱准备。决定了，明天去公司加班，做一下这周没有完成好的工作。我曾经说过：“要在工作中体现自己的价值。”这个价值观，我扔是要维护的。做一份工就做好它。不求做到最好，但求问心无愧吧。</p>','心境','揣摩','最近家里的开支大了许多，还是需要努力工作，好好学习，为将来挣更多的钱准备。决定了，明天去公司加班，做一下这周没有完成好的工作。我曾经说过：“要在工作中体现自己的价值。”这个价值观，我扔是要维护的。做一份工就做好它。不求做到最好，但求问心无愧吧。','散文',0,141,0),(128,1493746411,1494248718,1493746411,'<p>								</p><p>最近有点小忙。要工作，学习，考驾照，参加集体活动，还要在本月内完成一个个人项目。忙到22点才下班。</p><p>我现在回想那个伏案工作的自己画面，觉得这挺美好的，诺大的办公区灯关的七七八八了，还有个人执着的家伙认真地，带劲地工作着。</p><p>在地铁里做了两件事。1.把新项目的结构和实现思考了一遍。2.做了70道左右的科目一的题目。这很好，时间利用的很充分，给自己点个赞。</p><p>这么晚了，老婆还在地铁z站等着自己。远远地看见她，我不由得像往常高兴地和她打招呼，朝她走去。</p><p>她脸上带着疲惫和不悦，明显还在因为上个星期的事生气。</p><p>一路上，无论我跟她说什么，她都是一副漠不关心的样子。经过夜市，我说：“吃点东西吗？”其实我是想跟她好好聊聊。</p><p>我给她倒了半杯酒，然后敬他：“恭喜您成为有车一族！”她这才勉强笑了一下。</p><p>从店里出来，我搂着她，亲了她一下。我这么做想告诉她：希望这件事就这样过去了。可是她一点反应都没有。我笑着问她：“还在生气呢？”她不语。过了一小会终于说话了，怪我居然因为一个外人责怪她。我说：“你做错了，我怎么帮你？你要理解我，我跟一般人不太一样。”同时我我想说：“你在伤害别人的同时也深深的伤害了我。”但是我没说。她加快脚步，把我落在身后，说：“无论如何我都不能因为一个外人而说她。”我觉得她很不讲道理。刚好看到L君的更新，自己也想写下对生活的一些感受，干脆就不跟她回家，在路边码字了。</p><p>我看了L君文章，很为她高兴。在她眼里，心里，一切都是最好的安排。羡慕她的杜sir，希望他能珍惜这份“台灯的关爱”。</p><p>快1点了，困了，有点冷。</p><p>这一段时间生活给我的体验，有些密集的五味杂陈。好的，不好的，都平静地接受，细细的品味吧。此刻在这辈子不会再有，记下来，他就走不了了吧。</p><p>上个星期六陪女儿过了生日。我用三脚架架着相机录下了大家一起唱生日歌的过程。后来看回放，决定以后每年她过生日都要录像，这样她长大后每次看都会有被爱的感觉吧应该。</p><p>这个家庭生日聚会的气氛很好，每个人都显得很开心，我也表现出少有的“不拘谨”。我想，人只有完全地接纳了自己，接纳了别人才能感到真正的“和对方交流的乐趣”吧。</p><p>这席间的每一个人，包括我自己，他们急躁发脾气的样子我都见过。一对比，我就知道怎样的态度是好的，怎样的态度是不好的。怎样是幸福的，怎样是不幸的。此时此刻的我是幸福的，还是不幸福的呢？我大概是幸福的吧，因为我脸上此刻挂着微笑，也许是我接纳了自己，接纳了这世间的一切吧，好的，或者不好的，如果我们不能改变。</p><p>坐在石墩上，靠在树上，闭上眼睛就能睡着的感觉。冷风吹在胳膊上，感觉活的真是真切，挺好。</p><p>画上句号，回家睡觉。歇一歇，明天继续奔跑。</p><p>							</p>','心境','接纳','这一段时间生活给我的体验，有些密集的五味杂陈。好的，不好的，都平静地接受，细细的品味吧。此刻在这辈子不会再有，记下来，他就走不了了吧。','散文',0,116,0),(129,1493869732,1494248678,1493869732,'<p>								</p><h2>背景<br/></h2><p>客户端和wap端共用一套h5页面。h5页面需要保持登陆状态。</p><h2>问题</h2><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>登陆之后跳转回来是白页。</p></li><li><p>无法登陆成功。</p></li><li><p>登陆状态无法传递。</p></li></ol><h2>问题原因分析</h2><h3>登陆之后跳转回来是白页</h3><p>造成这个问题的原因是，使用php程序调用客户端的登陆协议，页面没有加载完，导致白页。解决办法就是不再使用php来执行登陆协议，而使用js来进行跳转。用js的好处是，页面已经加载完成，也就不会有白页了，这也是一般应该采用的方法。</p><p>这其中有个注意点：不是所有的webview页面都可以调用协议。除非客户端指定了该功能。</p><h3>无法登陆成功</h3><p>造成这个问题的原因是，webview页面通过登陆协议，成功之后，会执行webview中的js方法onLogin。但是可能是前人的坑，把这段代码注释了，而我用浏览器里的search搜索还能搜索到，这个坑有点深。</p><p>回调里采用ajax向php文件发送请求，在php里写cookie。但是这样的cookie到下次才能生效。</p><h3>登陆状态无法传递</h3><p>每打开一个webivew就相当于一个全新的浏览器，生成的cookie无法共用，导致登陆失败。</p><h2>解决办法</h2><p>原则：接口的设计应该是无状态的。也就是说，webview页面，作为一种客户端的另类接口，用cookie来保持登陆状态，本身就是不合理的。客户端的接口的权限判断是通过身份验证接口之后，获取到的相关token或者其他方式来进行。</p><p>所以这里把客户端和wap的身份验证方式区分开来。wap用cookie,客户端用token。状态存在的本质是获取用户信息，那么如果token能获取到用户信息，也就没有必要使用cookie了。</p><p><br/></p><p>备注：今天跟客户端的大神聊天。她说同一个webview里打开的页面之间是可以共享cookie的。也就是说如果在一个webview里打开一个h5页面，那么点这个h5页面打开的页面是可以和他的兄弟姐妹页面共享cookie的。<br/></p><p><br/></p><p><br/></p><p>							</p>','工作','客户端登陆问题排查记录','排除这个问题真是费了九牛二虎之力，记录一下过程，供日后参考。','工作',0,234,1),(130,1494002839,1494003708,1494002839,'<p>								</p><p>终于回到家啦，又见到我那亲爱的她，真好。</p><p>这个星期只有四天，可是我却觉得这四天是我过去这么多年，过过的最“漫长”的一周。因为这个星期我能感觉我的心中，像有风的海面，亢奋而不平静。但是一见到她，这所有的激烈而紊乱的情绪都平息了下来。</p><p>她姥爷开着三轮车，带着她来接她妈妈和我。在车上，她说：“爸爸，我告诉你一个秘密。”说着，她抱着我的脖子，很小声很小声的对着我的耳朵说：“你知道吗？我的图画本上的小公主手上的魔法棒可以变出光，让世界变得更漂亮。”</p><p>哈哈。</p><p>在车上，我们说好，回家要一起画月亮。</p><p>视线越过这院子里的枣树和香椿树的暗影，我们一起看月亮，星星。她说她要吃月亮，我就抱起她往天上蹦，说：“把你扔天上去喽！”。</p><p>在她的图画本上，我们各自画了一个月亮。我画了一个圆的，她画了一个弯的，就像她今晚看到的。我们把各自的月亮用彩笔涂成了黄色。</p><p>她的笑点特别特别低，能无缘无故的咯咯咯笑半天。这笑声让人听了会不由得觉得满足，是真的幸福。</p><p>有再多的忧与愁，听到她的笑声也放下了。</p><p>此刻，我听着钢琴曲，回忆最近生活的点滴。我突然觉得，坐在这里回忆这件事，就让我喜欢得很，像进入一种境界，经过的事情变成了一幅一幅画面，在脑海中，交替呈现。</p><p>今天早上，北京刮了特别大的沙层暴，树枝被吹断了一地，漫天都是黄沙。本是极不适合跑步的天气，但是我抑制不住内心想要奔跑的冲动。带上耳机我就像往常一样快速地跑起来了。这感觉我想这辈子不会常有了，那么大的沙尘，有那么一个人，那么倔强地奔跑着，内心充满喜悦。跑了不到一百米就满嘴都是沙子了，呵呵，呸了好多次，总算是把嘴里的沙子吐干净。</p><p>“要停下来吗？”</p><p>”当然不”！</p><p>于是我又跑起来，又开心起来。在跑步的末端的那种坚持会让人上瘾，跑完后汗流浃背的感觉会让你自豪，我亲爱的读者，不信你多试几次。</p><p>和梁先生的相识是一件极没想到的事情。今天我在聊天工具上对她说：“和你聊天很happy。” 她回复：“和好朋友聊天不都这样吗？” 好朋友这三个字，让我有些怀疑，有些期待。我想我们还不算好朋友吧，现在顶多只是谈得来的朋友。成为好朋友不是一件容易的事，不是一朝一夕的事。</p><p>让梁先生因为我工作效率的问题陪我加班，我有点过意不去，但还好事情应该是解决了。原来真的是这样，无论一件事情看起来有多难，你只要尽你所有，朝好的方向努力，就可能有你意想不到的结果呢！</p><p>和梁先生一人吃一碗拉面，从面上说开了，一直说到为什么写作这件事上。为什么写作呢？我们的观点大概是相近的吧。因为反省，因为生命只有一次，有一些事情，有一些情感，我们不记录下来，时间一久就会遗忘。记录下来，偶尔翻阅这些文字，除了想起那时的情感，记起那时的事情，还能多一份对当下生活的思考，多么有意思的事啊。</p><p>这个星期大部分的地铁时光献给了看《小王子》，听《小王子》。除了做这件事给我的“置身地铁外”的感觉——实际上我有在飞的感觉，然而，遗憾的是我并不能专心的看完或者听完一章。所以我不断地看或者听第一章，3分多钟一章的音频，听了20多遍，没有一遍我没有走神。我的心，原来一点也不平，一点也不安。直到见到我最爱的她，一见到她我就踏实了，开心了。</p><p>在小孩子的家庭生日聚会上唔到的道理，用在别的地方一样是很适用的。现在的我有些喜欢和谈得来的朋友聊聊天。聊天的时候，感觉节奏真的就慢下来了，生活又增添了几分乐趣。</p><p>Z君请我和梁先生吃饭。要是原来，我定要推脱一番，或者去了放不开的，可是现在我却欢喜的很，甚至有些迫不及待地，要和大家一起说会话，彼此了解更多一些。Z君说到自己大学没毕业，我也说自己没有毕业，本不是什么光彩的事，可是本着坦诚交友的原则，我就说了。跟喜欢的朋友在一起，我会瞧不起撒谎的自己。</p><p>听梁先生说要结婚了，我很为她感到高兴。找到对的人，就是找到幸福了。我又想起自己结婚的时候。上帝应该是个爱开玩笑的人吧，哈哈。</p><p>关于朋友之间的“小礼物”交换，这对我来说也是一种新的概念，真的是很有意思的。枣夹核桃很好吃，很好玩。忘了问了，我送你们的奶茶，你们喜欢喝吗？^_^</p><p>这个周工作很忙，但每每看到梁先生来的消息都要看一下，没时间就发个表情作回复。看她说她和他的杜Sir的故事，他们的结婚计划。听她如何要去好远的，别的城市去找她的闺蜜玩。我想，生活本该如此，我们都应该把生活过的有意思，有味，有情一些。可以把物质看的谈一些的，你说对吗，正在读这篇文章的我的读者？真正的幸福，永远来自你最亲的人，跟钱好像不太有关。</p><p>当然我们还是要努力挣钱的，哈哈！接下来几个周，我要集中精力把手头的项目完成好才行。认真的人最帅~加油</p><p>对了，宝贝，如果若干年后，你看到爸爸的这篇文章，说不定第二天，我们一起去外边跑步了。你现在还喜欢跑步吗？<br/></p><p>							</p>','心境','一人一个月亮','在她的图画本上，我们各自画了一个月亮。我画了一个圆的，她画了一个弯的，就像她今晚看到的。我们把各自的月亮用彩笔涂成了黄色。','散文',0,155,0),(131,1494005338,1494005338,1494005338,'','心境','在我心的深处，没有惧怕，没有悲哀，有的只是一丝别离的怅然。','看三毛，就像在她面前听她诉说。就那么安静的听她说就觉得好满足哦。','说说',0,154,0),(132,1494062391,1494062391,1494062391,'<p>我听着这钢琴曲，</p><p>看见音符从我身上流淌向窗外。</p><p>我的脸上没有丝毫悲喜，</p><p>我想我是陶醉在这舒伯特的《小夜曲》中了。</p><p>我突然意识到，</p><p>这是我极爱的一种感觉。</p><p>这感觉就像抛弃了这身皮囊，</p><p>变作空气的一部分，</p><p>随风飘向未知的远方。</p><p>我渐渐的消散，</p><p>变得不存在而又无处不在。</p><p>我的心中没有一丝情感。</p><p>我飞到很高很高的高空。</p><p>我看见地球上的人与物，</p><p>我看见有音乐包围着他们。</p><p>我看见死神拿着镰刀，穿着黑色的斗篷向我飞来。</p><p>我的身体已然不在了，可是我还能闭上眼，而且再也没有醒来的需要。</p>','心境','小夜曲随想','我听着这钢琴曲，\r\n看见音符从我身上流淌向窗外。\r\n我的脸上没有丝毫悲喜，\r\n我想我是陶醉在这舒伯特的《小夜曲》中了。','诗歌',0,150,0),(133,1494170878,1494248478,1494170878,'<p>								</p><p>夜晚10点，我放下手中的工作，下楼，走到院子里，打算卧在摇椅上看看月亮，星星。</p><p>楼顶的太阳能热水器正在上水，水上满了，溢出来，哗啦啦地打在地上。客厅的灯已经关了。我打开门问：“爸，在上水吗？” “关了”，妈回答我。我关上门，慢慢地，听不到任何声响了。</p><p>我带上耳机，单曲循环舒伯特的《小夜曲》。</p><p>白天洗的球鞋干了，我拿起它们，半卧在摇椅上穿鞋带。有那么一刻，我觉得我似乎是在专心的在做这一件事，别的事都没放在心上了。</p><p>中午好好睡了2个多小时。感觉N年没有睡得这么踏实过了。是因为看通透了一些事情，还是自己的心真的慢下来了呢？<br/></p><p>今天理了发，洗了澡，剪了手脚指甲，换了干净的衣服。现在我躺在摇椅上看月亮，感觉人的内外都很干净。看着在晚风中不停摆动的树叶，我方觉内心很平静。</p><p>某一刻，我想象自己在月亮上找到一个地方。我静静地坐在那里，好像在思考一些事情，好像又什么也没想。</p><p>我留恋地起身，在这之前，我在心里面说：“真希望就样一直到老。”&nbsp;</p><p><br/></p><p>							</p>','心情','看月亮','白天洗的球鞋干了，我拿起它们，半卧在摇椅上穿鞋带。有那么一刻，我觉得我似乎是在专心的在做这一件事，别的事都没放在心上了。','散文',0,130,0),(134,1494283052,1494338910,1494283052,'<p>								</p><p>孩子的母亲，</p><p>见字如面。</p><p>还有20分钟，我就要动身去火车站了。临走时看到一些关于家庭教育的内容，觉得有必要跟你分享一下。</p><p>因为小孩的错误，母亲很严厉的训斥了小孩，然后对孩子说：“妈妈说你都是为你好！”母亲认为责骂只是一种爱的方式，可是这种责骂甚至“打骂”在小孩子看来也是一种爱的方式吗？答案是：会的。他会怀疑，但是他会学会这种方式。也许有一天，当我们老了，走不动了，他会这样责备我们：“我都跟你说了多少次了？让你多穿点衣服出门！记不住了吗？医生怎么跟你说的？”我想我们听到这样的话，一定会很难受。然而，这却是我们教会他的爱的方式。</p><p>我打你，骂你是因为我爱你？还是你的情绪管理太差？</p><p>在孩子看来：你满嘴是爱，却面目狰狞。</p><p>上周我带小孩子出去跑步，她跟我说：“她不要这个妈妈了。”我问她为什么。她说：“这个妈妈打人。”也许小孩子表达的不太准确，但是我们是不是不应该反思一下：女儿对她本应该最爱的妈妈，难道是这样的情感？</p><p>我们经常限制小孩子玩游戏，但是我们自己做到了吗？小孩子曾经就有一次问我：“你不让我玩，那为什么你要玩呢？”我说：“大人可以玩，小孩不可以玩。”现在想想，简直就是太荒谬，太牵强的理由。从那以后，我觉得以后再也不要在小孩子面前玩游戏，或者整天刷微信。这种教育比说起说教好像不显山露水，但是影响却是深远的。</p><p>这两天在家里的时候，我带她上小铺，有垃圾都会找垃圾桶，我觉得这就很好。最好的教育方式就是父母的示范。</p><p>文武&nbsp;&nbsp;&nbsp;&nbsp;北京</p><p>2017/05/09</p><p>							</p>','亲情','给孩子母亲的一封信','我打你，骂你是因为我爱你？还是你的情绪管理太差？\r\n在孩子看来：你满嘴是爱，却面目狰狞。','生活',0,138,0),(135,1494304219,1494427798,1494304219,'<p>								</p><p><br/></p><p><br/></p><p>第一章 我对大人的看法<br/></p><p>他们中的大多数已经不能明白不能再简单的事情。他们趋利，虚荣，愚蠢，做着一些自以为重要，而实际上毫无意义的事情。</p><p>对小孩子一定要多说鼓励的话。</p><h2>第二章 飞机坠入沙漠，我认识了小王子</h2><p>遇到知己，同类，性情相投的人是很难的事，也是很值得珍惜的事。</p><p>没有功利性的相识，是一件十分有趣的事情，是一段感情很好的打开方式。我和小王子的相识就是这样。简短的接触，彼此都开始喜欢上对方。</p><p>第三章 我逐渐了解小王子的来历</p><p>对新事物要保持好奇心。</p><p>保持专注力。</p><p>把物质看低一些。对自身的处境不要太在意。</p><p>第四章 小王子生活的星球引起我的思考</p><p>偏见很伤人。</p><p>看人要看本质的东西。数字相关的都不是本质的东西。</p><p>看到有人如此痛苦地回忆，如此艰难地去记住已经离别6年的朋友，我很感动，又有点悲伤。</p><p>第五章 要警惕猴面包树的危险</p><p>有些事可以拖延，但是有些事却是万万拖延不得的。</p><h2>第十二章 小王子拜访一个酒鬼</h2><p>我们是否也做过和酒鬼一样荒谬的事情，明知做着错的事情，还要一错再错？</p><p>我们是否也像酒鬼一样，用一些事情来麻痹自己，逃避现实？</p><h2>第十三章 小王子去拜访一个商人</h2><p>什么是重要的事情？什么是真正的拥有？</p><p>我现在觉得陪自己的家人比挣钱重要。做启迪人性的事情比学专业技术重要。努力去做一件事，比这件事的结果重要。</p><p>你拥有一条宠物狗，你每天和他玩耍，给他吃的，这是拥有。你有一双球鞋，你很爱惜，经常洗刷它，这是拥有。你有一个漂亮的妻子，你不能让她快乐，这不是拥有。你有一座别墅，你荒废它，这不是拥有。拥有是对你所有的付出，否则，那不是拥有，是占有。</p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p>							</p>','思考','小王子读后有感','我们是否也做过和酒鬼一样荒谬的事情，明知做着错的事情，还要一错再错？','读书',0,136,0),(136,1494338609,1494338609,1494338609,'<p>晚上给妈妈打了个电话，半天没人接，我就挂断了。快10点的时候，她打过来电话，问我是不是有什么事。我说：“没什么事，就是想给你们打点钱。”她一听我要给她打钱，就急得很。</p><p>“我哪里要你给我们打钱。我们不缺钱花！”</p><p>我说：“你们存起来。”</p><p>“我们存起来有什么用？你负担这么重。我们还没有老到挣不到钱。我们帮不上你忙就算了，不能添加你的负担！”</p><p>“我没有什么负担。”我说，但是她仍是不肯要的。</p><p>“你要是打了，是要急死我的！”</p><p>“好吧。”</p><p>我很为自己不能在他们身边尽孝而感到难过。在我看来，生活的好与坏真的不重要。再者，挣着钱就是好，没挣着钱就是坏了吗？我的父亲，母亲啊，儿子真希望过着贫穷的生活，也希望陪伴在你们左右。</p>','思考','妈妈的来电','我很为自己不能在他们身边尽孝而感到难过。','生活',0,149,0),(137,1494431123,1494431276,1494431123,'','心境','看见流星','','说说',0,129,0),(138,1494510356,1494549356,1494510356,'<p>								</p><p><br/></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">数都数不清了。原来我们已经度过了人生中的那么多岁月。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">那些流逝的情感，那些我们曾经心动过的人，那些我们与朋友们一起做过的事情。好多现在还记得，好多都记不清楚了。我不由得疼惜，为那些到现在变成空白的记忆。所以现在我要写作，记下自己的心情，写出自己和周围的人发生的故事。还有这件事，写一篇迟来的读后感。</span></p><h1><span style=\"font-family: punctuation; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 24px;\">岁月静好</span></h1><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">跌跌撞撞的一天又一天，一直这么的随心所欲，抑或是肆无忌惮，还无时无刻不在坚守自我，始终难以舍弃我的初衷。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">随心所欲的年纪是可贵的。那时的我们锋芒毕露，正义凛然，忠于内心，鄙视虚伪。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">我想趁着年轻能够靠着自己的努力，即使是微薄的付出，去锻炼自己的意志。是的，这个社会是不会为了我来喘息一秒钟。即便这样，我也不愿意轻易妥协。即便妥协，即便输，也得让我输的心甘情愿。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">我们天真，顽强，易怒，易喜，从挑战自己中获得很大的乐趣。我们可以失败，但不会认输。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">能说心里话的人，并没有减少，感谢你们长期对我的不弃和沟通。有些人断了联系很多年，但是某个不经意的时刻，又递进了友情，并且更珍贵无比。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">朋友是我们最珍惜的人。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">包容？这是个很好的名词，无数我身边的朋友被自己的另一半宠着疼着，彼此陪伴着度过彼此最活力青葱的年华，看到他们眼神里透漏出的笃定相守，让我对千百年来永无停止赞颂并且人人都在追求的爱情更有信心：愿得一人心，白首不相离。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">读到这里有些感动。自己那时也有一份懵懂，纯洁，但没有表达的爱恋。至今回想起来，仍是我心中淡淡的忧伤。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">关于取悦，我们做最好的自己是取悦自己，除此之外也会取悦别人，这没什么不好的。不过，取悦自己的同时能够得到赏识或者提升自己的魅力，自然也取悦了他人。如果非要蛮不讲理，苛求他人为自己做些什么，以此来取悦自我，无论是否能够满足，也只是一种被动的过程，不见得自己对他人的要求，真心能够取悦自己，事过之后，就真的得不偿失了。更没必要由于他人的违心或者自我得不到对方的关注而闷闷不乐，无论何时何地，offer自己和他人，才是最好，最愉快。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">玫瑰只是静静地矗立在花丛中，就得到所有人的喜欢。所以，我们要做的只是做最好的自己。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">说说我自己。我沉浸在一个氛围里面太久，是会迷失自己的。这种氛围包括亲情，友情，爱情，生活环境等。我需要间断性的出去走走，小旅行也算是小逃离吧。我也相信万物万情的守恒，一种心情或者体验久了，都容易疲劳，类似于审美疲劳，也会心境疲劳。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">那时，在要分离的前夕。我跟她说，毕业后我要环游全国。我不怕苦，不怕累，只希望活的坚强，自由而有诗意。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">而我本身也是一个在亲人面前肆无忌惮，在朋友面前真诚付出，在不熟悉的人面前会尽力完善自己。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">我们对好朋友倾诉衷肠，对亲人豪不掩饰，家人和朋友是我们一生中温暖的陪伴。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">往往，人与人之间距离越近，越容易产生正面冲突，可是获得原谅也越快，越不容易记仇。父母跟孩子之间，夫妻之间便是如此，不过不代表是恋人之间。恋爱阶段是会互相挑对方，这种挑可以褒义可以贬义。如果两人奔着结婚的目的或者是深爱到一定程度，对于对方身上所展露出来的缺点，要么一方包容，要么另一方努力克制。当然，两个人都要努力，这是很正常的。如果真的因为这个缺点，另一方不可原谅，一味挑剔，岁月经不起磨耗，人人都有缺陷，在力求另一半多么完美的时候，先审视自己吧。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">任何情感都需要经营。多一些包容，多一些付出，多一些原谅，事情不会变得很糟。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">最好的便是包容原谅，一起变得更美好。如若不能而导致恋人就此而散也大有人在了。转身再去寻找下一个对的人，万万千千的世界，有春暖就会有花开，不见得真的谁比谁更好。都是有心人，好好的就好。不小心的擦身而过，抱憾的人也大有人在了。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">嗯。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">有些事经过时间的洗涤，沉淀下来的也该是真善美了。即使之前有太多的理由来争辩一个对自己最有力的上风，现在看来也没必要了。即便当初多么奋力来说服他人了解自己的苦楚或者委屈，但是人生不是判断题，不是谁对谁错。即便别人理解你了，宠着你了，如若不是真心，只是表面的和谐，那么之后的暴风骤雨，岂是当初我们会预想到的？这个时候一切矛头都会指向你，源于当初的你所谓的委屈，你委屈了你还引起了大浪潮……究竟谁错了？谁对了？再细想想，真是莫名其妙，苦笑一个…</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">少在意自己一些，多关心别人一些，这样人与人之间的相处会舒服很多。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">再也不要对不确定不熟悉的人和事，苛求那么多，不要在真相和大结局之前，就放上你所有的筹码。不要太过于轻易透露自己的负面情绪。有苦衷，先扛着，有泪，再忍着。人生不是处处都是自己的主场，给自己轻松点，慢慢的，也就云淡风轻了～</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">负面情绪需要释放。也不用扛着，忍着。找到合适的对象，告诉他你的苦恼。说不定，说完就舒畅了呢。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">生命不堪脆弱，勇气不足以支撑我们获得自己期望的一切，但求无悔于心。是是非非，走过且过，风风雨雨，历过则晴。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">还挺豁达的感觉。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">我依然怀恋青纯岁月，还有那几个女孩激励共勉的话。那么刻骨铭心，那么铿锵有力，播种在如花的季节，如今也在璀璨斑斓。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">仿佛看到几个边走，边说笑着的女孩。空气中弥漫着青春的纯粹与活力。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">得得失失，平常心。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">平常心，放得安然。</span></p><p><span style=\"font-family: punctuation; color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 16px;\">终会岁月静好。&nbsp;</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">终会岁月静好。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">首先这是一种很奇妙的感觉。因为隔着时间差，所以生出穿越时空的错觉。一句话，等三年，这种对话，不常有。</span></p><p><span style=\"font-family: punctuation; color: rgb(146, 208, 80); background-color: rgb(255, 255, 255); font-size: 16px;\">阅读的过程，其实更像是一种倾听。从这篇文章中我听出一个鲜活的生命。她对生活有自己的理解，对自己有明确的要求，对未来有美好的憧憬。这是文字感染人的地方，因为总有共鸣的时候。</span></p><p><br/></p><p><br/></p><p>							</p>','温暖','读《岁月静好》','关于取悦，我们做最好的自己是取悦自己，除此之外也会取悦别人，这没什么不好的。','散文',0,123,0),(139,1494696683,1494697815,1494696683,'<p>								</p><p>《小王子》是我“觉醒”以来，认真看的第一本小说。上下班的途中，我会一直读，一直听。读或者听的时候，我会想象故事里的画面，很多时候我完全沉浸在故事里了。因此我最近常有一种走不出的天真而忧伤的感觉。</p><p>小王子让我试着放下一些“大人们”才会做的事情。他教我理解了什么是拥有，什么是责任，什么是重要，什么是爱。我一直在接受，思索，同时我也常疑惑作者想要表达的。我有时候些恍惚，仿佛分不清现实和小说的界限。我在尽量不让自己往“大人们”那边靠拢，可我的孤独感，越强烈了。</p><p>二姐的回家加重了我的忧郁。</p><p>她在微信群里发了一些老爸老妈的照片。原来真爱真的是这样，朝着他们存在的方向望去就会感到快乐。</p><p>她在家呆了一个星期，在家里做了很多的事情。洗鞋子，炒菜，打理花盆，帮老妈理菜，包粽子...... 离开的那天，老爸为她做了一桌子的菜，被她吃得干干净净。</p><p>老爸骑着摩托车送她到车站后，下了很大的雨。在车站，二姐给老爸拍了几张照片。有两张照片他是坐在凳子上照的。其中一张他看着二姐，神情悲伤，张着嘴，像在道别；另一张他没看二姐，神情凝重。二姐还给他拍了一段视频，视频中他边和二姐说话边笑，笑的很开心。可是，和家人团聚的时光有多快乐，离别就会有多不舍，多痛苦。我给他打电话的时候，他已经到家了，说雨下了一小会就停了。我现在想象父亲独自一人骑车回家的场景，我的心也是落寞的。</p><p>她后来在群里发了老爸的诊断报告。病情很严重，需要动手术。看到这个消息，我的心情更低落了。我们爱的人承受痛苦，我们也会感同身受。于是我开始和妻子商量回老家的事情。</p><p>我现在面临的情况是：我刚买了车，下个月要还车贷，手上没有存款，老婆刚辞了工作，我接的一个私人项目才做到一半，老爸又生了重病。在写这篇文章之前，我一直觉得自己的处境艰难，犹豫要不要让老婆回去处理，我留在北京上班。现在我完全否定这一点了。我仿佛听见小王子在跟我说：“想清楚什么是重要的事情。”现在我坦然了，至少我仍能向银行借到钱，能不能及时还上，是否影响征信我也不在意了。带上小孩，回家看看，给老爸看病才是最重要的。</p><p>我很为我的爸爸难过，尤其想到他正受着疾病的折磨的时候。</p><p>还好朋友A那里永远阳光灿烂。每每她有消息来，都能驱散我头顶的乌云，让我高兴起来。她今天“责备”我的“失信”，没有去参加公司的集体活动。 现在想想，我纵有自己的无奈，却仍是极后悔的，尤其是在看了她的新文章之后。我完全能感受到这些美，但我的心却被苦涩填满了。</p><p><br/></p><p>							</p>','心境','回家','我仿佛听见小王子在跟我说：“想清楚什么是重要的事情。”','生活',0,130,0),(140,1494812545,1494812545,1494812545,'<p>我还没有买《房思琪的初恋乐园》。我只是在京东上看了一些书评和文章摘要。但是我已经很为作者感到痛心疾首。她的梦想是一面写小说，一面像大江健三郎所说的：从书呆子变成读书人，再从读书人变成知识分子。可是，梦想有多美好，现实就能有多残忍！</p><p>我从书的摘要中看到一些血淋淋的描述，我感到震惊，愤怒，痛苦。我警告我自己，一定不要成为那些让自己鄙视的人！</p><p>作者的访谈我看过。她说书中所写的，都是她亲身经历的。她说人类历史上最大规模的屠杀是房思琪似的强暴。但是让我震惊的是，他仍能从李国华身上看到美的地方。她应该是太“爱美”，太懂得美。我大概是能体会到她对那些美的眷念，因为我也一样。</p><p>多想不做现在这份工作，像大江健三郎所说的：从书呆子变成读书人，再从读书人变成知识分子。</p>','思考','震惊','多想不做现在这份工作，像大江健三郎所说的：从书呆子变成读书人，再从读书人变成知识分子。','散文',0,118,0),(141,1494900778,1494900778,1494900778,'<p>今天早上在地铁里读到一篇《小王子》的影评。影评上说，小王子长大后，心里只装着工作，渐渐地失去了心中的纯真，善良。小女孩的出现，让他开始找回自己。我突然觉得，自己不就是小王子，朋友a不就是那个小女孩吗？<br/></p><p>可是现实并非童话，找回来的真善美，真的就不会再次被丢掉吗？</p><p>是的，我们大部分人不是富二代，我们必须工作，而且必须得努力工作，因为生存这件事一点也不好玩，必须认真对待。没有生存，谈何真善美呢？</p><p>朋友a给了我启发：将工作和生活区分开来，适时的从工作中抽离出来，审视自己，改善自己，追求内心渴望的美好。这样，我们也许就能免于再次麻痹。</p><p>看这篇影评给我十分平静的心情，感觉心中风轻云淡。</p><p>候车的时候我想到即将要见到的父亲母亲。要是他们不愿意去医院检查，治疗，我该怎么办？万一我坚持他治疗，给他巨大的痛苦而不得康复，我该怎么办？万一手术失败，我失去他了，我该怎么办？这所有的后果我想我都是承担不起的。我有些迷茫。</p><p>刚刚妻子打电话过来说，小孩子磕着腿了。在跟小孩子讲电话时，我听出她有点难过。我安慰她，过两天就会好了。她问我什么时候回来，我说下午5点就到家了。她又问我：“爸爸你穿着什么衣服？”我说：“就穿着t–shirt”。“那要是脏了怎么办？“今天脏了没有关系，明天就换了。”</p><p>妻子打来电话责备我，说我不能去驾校考试也不提前说跟学校说一下，现在已经报上去了，如果不能取消就算我没考过。我是有错，但是这样的责备，却几乎要抵消了我刚对她产生的感激之情。真的是很重要的事情吗？如果换一种方式，是不是这样的事情也会成我们老了之后，津津有味的谈资呢？</p><p>我们都要学会包容，但是包容却是有代价的。写到这里，我想我是否会对这件事包容她呢？答案是：会。但是这种包容后却藏着一丝惧怕，惧怕类似的事情重演。当已无力包容，剩下的只有争吵或者隔阂了吧。</p><p>小女孩为他送别，对他来说意义非凡。如果没有她的送别，小王子的路程应该是分外孤独和沉重的。也许这就是朋友于我们的意义，给彼此温暖和力量。</p><p>很感谢小女孩，小王子又一次看到了自己的内心世界。</p>','心情','日记170516','候车的时候我想到即将要见到的父亲母亲。要是他们不愿意去医院检查，治疗，我该怎么办？万一我坚持他治疗，给他巨大的痛苦而不得康复，我该怎么办？万一手术失败，我失去他了，我该怎么办？这所有的后果我想我都是承担不起的。我有些迷茫。','生活',0,129,0),(142,1495001820,1495013627,1495001820,'<p>								</p><p>尽管高铁的速度已经是以前的3倍，回家仍然花了整整一天。早上6点出发，一直到下午5点才到。</p><p>在高铁上写了一篇日记，做了一些工作。临下车的时候，跟邻座聊了一会天，得知他在香山的某部队做财务工作，此次前往襄阳参加集体培训。浅浅的交谈，却为平淡的旅程添了不少乐趣。</p><p>一路路过平原，路过丘陵，路过大山，路过隧道。最喜欢看山间的小水塘，一汪青绿，想必里面会有很多鱼儿。</p><p>高铁的体验很平稳，坐了4个半小时不觉得累。</p><p>坐车的时候仍听或者读《小王子》。每次听小王子都会有一种恍惚感，就像进入另外一个世界。并不是每次读都有所得，大多的时候我感觉很迷惑，不明白作者到底想要表达的是什么。然而，我敢肯定这是种很高明的手法，在二战的非常时期用一种隐晦的方式来表达自己的观点。</p><p>下车的地方就是前几天父亲送别二姐的车站。为了省钱，我打算步行200米走到车站坐公共汽车回家。路上经过教育局，我想起妈妈曾经带我来过这里。小学的奥赛班，初中的火箭班，高考复读，妈妈都代我或者带着我求过人，可是我的性格是倔的，她求了人我也没原意去走这些后门。</p><p>还没走到车站，妻子打电话过来说家里的饭快做好了，问我到哪里了。我说准备去坐公车，她说让我打车，快点回来吃饭。于是我用微信叫了车。</p><p>车很快就到了。开车的师傅是本地人。上车的时候我问师傅：“您到了小板，回来的时候还能拉着人吗？”师傅说：“拉不到。我也就是挣个上下班的油钱，刚下班了，拉拉活。”师傅车开得慢，眼神很柔和。我们在车上有一搭没一搭的聊着天。约莫十分钟就到了，父亲已经在路口等我。车子开过了一点，我打开车窗，回过头高兴地朝父亲挥了挥手，然后把头缩回到车内用手机结账。父亲看我在车里磨蹭，说：“我来帮你给?”说着就要掏钱出来。</p><p>从车里出来，我包都没背好就跨上了父亲的摩托车的后座。父亲载着我，轧过在路上晾晒的豌豆桔梗，吱吱嘎嘎地响。</p><p>一进家门就发现桌上摆了了一满桌的菜。我放下包经过到厨房的过道，瞥见一群小鸡。厨房里，妈妈正在将蒸菜从锅里端出来。妈妈见到我甚至没有说一句：“回来啦！”我也没有说：“我回来啦。”父亲母亲还有我，我们感觉就像从来没有离开过彼此一样亲密。</p><p>我问妻子：“天骄呢？”</p><p>“下午没睡觉，这会在上面睡了。你上去看看他吃饭不吃饭。”</p><p>我上楼来，看到小东西在蚊帐罩着的床上睡得正香，肘子和膝盖上的擦痕很明显。我推了推她，问：“吃饭吗？”她微微睁开眼，摇了摇头。我问她：“还想继续睡会是吗？”“嗯。”我说：“那接着睡吧。”我对刚上楼第一眼看到她熟睡的样子印象特别深刻。它让你有一种守护的冲动，如果这种守护有个期限，那肯定是一生一世。</p><p>桌上有父亲今天钓的小鲫鱼，家里自己养的土鸡蛋，还有蔊菜，蒸菜，西红柿汤，鹅肉，青椒炒肉，实在是很丰盛的大餐。父亲不能喝酒。他给我准备了两瓶600ML的罐装啤酒。还没开始吃，大伯挑着桶从门口路过，我们请他一起吃饭。</p><p>大伯的脸上总是挂着豁达，看上去充满智慧的笑容。那是眼角和嘴角都会弯曲的笑容，是发自内心的。而我的父亲和我平时都是比较沉默的人，只有在真心高兴时才会这样。</p><p>家里的白酒还剩下差不多4分之一，我全倒给他了。大伯70多岁了。我倒给他的时候还担心他喝不了，所以一边倒一边问：“喝得了这么多吗？”大伯的回答很随意但充满豪气：“倒多少，喝多少。”</p><p>家里的菜要么是自己家种的，要么就是在河里钓的，特别新鲜。</p><p>吃了一小会，二伯也从家门口经过，我们也把他请过来一起喝酒。他说吃过了，但拗不过我们拉他，就过来一起喝酒了。二伯也老了，但是感觉比他年轻的时候快活。也许到了知天命的年龄，大多数人都活透了，也就没那么多负担了吧。我想，若不是受疾病困扰，父亲也应该是这样的。</p><p>二伯说，15天前，他割树枝的时候，他的右手食指的筋被割断了。现在外表看起来正常，但是已经不能弯曲，不能使力了。我想：如果治疗及时，肯定是可以接起来的。一定是为了不让子女担心，不愿花钱才成了这样。二伯说这件事的时候，脸上带着好玩的笑容，就像在说别人的手指一样。</p><p>吃了一会，有个本家的哥哥也被拉了进来。他说吃过东西了，做下来不吃东西，只是跟我们聊天。他跟父亲说：“现在不敢吃太多，要不然肚子胀。”我看他确实有点肚子，于是对他说：“可以跑跑步。”父亲告诉我：“你哥哥脚不行了。”于是我这哥哥给我讲了他脚的故事：说是有一次他在大货车里装货，司机操作失误导致前面的货要倒下来了，他见状一慌，从货车上跳下来，把两个脚跟都摔成了粉碎性骨折。后来做手术，打了钢钉，到现在都没取出来。他说，从那以后到现在，半年多了，一直在家玩，什么也干不了。于是我很感叹人的际遇。我发现，我的父亲，母亲，我的姐姐们，我的妻子，孩子，以及我和我身边所有了解的人，每个人都有自己的故事。</p><p>吃完饭呆了好一会儿，天已经全黑了，小孩子拉着我要去超市买裙子，被她奶奶看到了。她奶奶说：“早上去超市看了一回，姗姗觉得不好看，就没买。我说：“小朋友喜欢就好啦。”后来我们就一家人一起去给她买衣服去了。</p><p>在超市，她把我拉着蹲下来，在我耳边小声的说：“爸爸，我喜欢那件衣服。”“哈哈”，我问：“哪一件？”说着她就拉着我去看那件衣服。那是一条裙子，上面是蓝白相间的大条纹背心，下面是雪花纺的裙摆，裙子的下摆边缘镶着蓝色的细纹。我看了也非常喜欢，说：“挺好看。”后来我们就买了这一件，她奶奶给付的钱。</p><p>回来的路上，他爷爷牵着她，我搂着她妈妈，我们5个人走在回家的小马路上，我的内心感觉平和而幸福。</p><p>回到家我们搬了3把靠椅，一张凳子到2楼的楼顶乘凉。</p><p>栀子花上只开了一朵，被小孩子摘了下来。闻一下，足以赶走所有的疲惫。我最近总是乏，闻到这花的香味才知道怎样是精神充沛。以后当要少熬夜才行。</p><p>我跟父亲说：“天骄现在会做10以内的加法。”父亲就考她：“5-2等于多少？”妻子说：“她们现在只学了加法。”父亲又问她：“10+10等于多少？”于是她就拉过我的手，从她自己的手指一直数到我的手，最后终于得出答案：“20。”“哈哈”，大家都很高兴。每次见父亲高兴的样子，我都有点心疼，不知道怎么开口跟他说看病的事，担心这一切的欢乐时光再也不会有了。聊了一会天，父亲下楼去了，孩子和妻子也进屋了。我和妈妈聊起爸爸的病情。</p><p>妈妈说她很愧疚，因为我买车的时候她没有帮我。原本准备给我一万，后来担心父亲随时发病，才没有。我说这回回来想要给父亲看病。至少先带他倒武汉检查一下。母亲也同意，但是说：“先得做他的思想工作。他最听方方的话，让她给他做工作。”后来我们聊到三姐和二姐。她们都是那么孝顺，我很惭愧。</p><p>现在我觉得回家是一件很对的事情。不管目的有没有达到，至少我和小孩子的回来给她们带来很多的快乐。</p><p>家里住了两只燕子，它们时常在屋子里飞来飞去。</p><p>							</p>','心情','回家','我上楼来，看到小东西在蚊帐罩着的床上睡得正香，肘子和膝盖上的擦痕很明显。我推了推她，问：“吃饭吗？”她微微睁开眼，摇了摇头。我问她：“还想继续睡会是吗？”“嗯。”我说：“那接着睡吧。”我对刚上楼第一眼看到她熟睡的样子印象特别深刻。它让你有一种守护的冲动，如果这种守护有个期限，那肯定是一生一世。','生活',0,290,0),(143,1495093734,1495266525,1495093734,'<p>								</p><p>原本打算晚上做一些工作，可是合作方的接口出故障，没法弄了。<br/></p><p>爸爸在看一个叫《远战越勇》的节目。现在的我对电视节目提不起一丝兴趣，就拿了电脑到阳台上写日记了。</p><p>星夜和昨晚一样璀璨。蛙声此起彼伏。有凉风吹过，树叶沙沙作响。我开始回忆白天的见闻。</p><p>早上睡到9点多钟还没解乏。是疲惫还是身体欠佳呢？</p><p>现在是5月，可确是夏天的气候。九点多钟的艳阳，覆盖了整个大地。还好有风，尚能感到一丝凉快。</p><p>起的太晚，去集市没有赶上“卖锅盔”的，只吃了一碗黄潭米粉，真是久违的味道啊。刚吃完，肚子就不舒服了，定是在去集上之前，妈妈给我的“疏便果冻”起了作用。回来蹲了茅坑就通畅了。妈妈的关怀真是无处不在。</p><p>从河南驻马店等地来了好多的收割机，它们白天在田地里，乡间的路上穿梭，收麦子，晚上会在镇上吃烧烤，喝酒，晾晒衣裳。旅居的日子一定是辛苦而充满新奇的。</p><p>今天我们家收麦子。我和妈妈在家门口拦到一台收割机，师傅说先帮上一户人家卸完麦子就去收我们的。于是父亲戴了帽子。我问母亲还有没有帽子，母亲却给我找来一顶斗笠，哈哈，戴着挺有意思。</p><p>我们正领着收割机去田里的时候，小孩子和妻子回来了。远远地，小孩子站在那里不走了。妻子说：“累了，走不动了。”于是我走过去，抱起她走到地里。我把斗笠给她，她不要。我们只好顶着太阳，在地里走了。后来她妈妈打着一把粉红色的伞过走了来了。我把小孩架在我的脖子上。妻子把伞递给我们，自己拿过斗笠。我们就在田埂上看机器收麦子了。</p><p>跟着机器的应该是一家三口。一对50岁的夫妻，一个30岁左右的男人。开车的应该是爸爸，儿子负责洽谈，收钱，指路什么的。他们一家三口都晒得黝黑，女人带着面巾，却也仍是不管用的。</p><p>车子要到我们的田间需要跨过一条小沟。于是他们从车上搬下来两条钢板架上，收割机的履带就从上面过去了。</p><p>我们只有三厢田的麦子，隔壁是别人家的。我们收的时候，“别人家”也来了。刚开始机器走过了一些，割到“别人家”的了，我看到“别人家”的女人气的都跳起来了，对了开车的师傅喋喋不休，哈哈。</p><p>不一会，收割机就开出去了。看着远处两台收割机，小孩子问：“爸爸你看哪个跑得快？”戴面巾的女人听了觉得有趣，回过头来看她，笑着问：“你说哪个跑得快？”</p><p>厨房里的柴火格子里堆满了碗口粗细的木头劈成的柴火。妈妈说，这些柴火都是爸爸锯了然后劈的。我很惊诧，这么多的柴火！妈妈说：“外面还有一大堆！”</p><p>小鸡们围着鸡妈妈，亦步亦趋地在院子里觅食。</p><p>妻子嘱我去买一瓶海鲜生抽和一袋鸡精。小孩子定是要跟着去的。到了超市，拿了生抽，又给她买了一个闪光的发卡，一个玩具电风扇，一块巧克力。此外，我还买了一包中华烟，我自己不抽，是给爸爸的好友费伯买的。他们经常在一起聊聊天，钓鱼。昨天，费伯听父亲说我的腰疼，便跟父亲说要带我去费湾看病。他说看病的医生是他的侄女，他带过去不用排队。看病的医生在当地非常有名气，是治疗跌打损伤的世家。原本回家是准备给父亲看病的，这倒好我自己先看上了。</p><p>父亲，费伯和妻子早已在路口等我们。打完招呼，我们就上车了，我把烟塞给费伯，道了谢。</p><p>费伯70多岁，180左右的身高，体型仍魁梧挺拔，戴一幅茶色眼镜，说话声音洪亮。看得出来，这位费伯对父亲十分喜欢，一路上尽跟他聊天，我有一种完全被忽略的感觉。回来的时候我记得他对父亲说了一句：“你怎么老不带手机？”说着，还拍了他的大腿一下，哈哈。我很为父亲有这样一个朋友而感到高兴。</p><p>停车后要过一条大河。河里有一条渡船。渡船上有一位老太太从容地拉着船。因为拉船的奶奶认识这位费伯，死活没肯收钱。我对这位奶奶说：“我来帮您拉一下？”但是果断被拒绝了。老人应该是惯了，看起来拉得不难。</p><p>下船，走过长而陡的堤岸，上来就是“世家”的诊所了。屋里差不多排了20多个人。在屋里的东角有个格子，医生就在这里问诊。费伯径直走到格子里，并喊我也进去。我明显感觉格子里的人的敌意，而我也是反对插队的，但我早过了执拗的年纪了。</p><p>出诊的是个40岁左右的女医生，头上隐约有些白发，慈眉善目，但眼神中有些疲惫，我想是因为她一天要看太多的病人。</p><p>他摸了一下我的腰，不等我说完病情，她就说：“你这是个老损腰，有十年了，不是新伤。”我十分惊讶，说：“是的。真有快10年了。”</p><p>医生在写药方，妻子问她：“看得好吗？”</p><p>“看的好。”</p><p>“要吃多久的药？”</p><p>“一直吃到不疼为止。”她又问我：“在家呆多久？”</p><p>我说：“半个月。”</p><p>“那正好，给你开15天的药。走的时候，再来找我看一下。”</p><p>到现在我都惊讶：怎么一摸就知道得这么准呢？</p><p>我们抓药的时候，老费拉着父亲去看他在费湾的老房子。有个朋友，真是件很好的事情。</p><p>回到家，小孩子绊在石头上，摔了一大跤。哇的一下就哭了，边哭边说：“爸爸没有牵着我。”这“小报告”打得。哈哈。我赶紧抱她起来，发现昨天摔伤的地方又流血了。</p><p>在医院处理完后，他爷爷骑着摩托车来载她。我让他抱紧爷爷。</p><p>我看着他们远去的背影，我看到她回头看了我三次，我感觉到一种我们之前的依恋。</p><p>我有一个缺点：我的眼中没活，看见别人干活我才会跟着做。傍晚看到父亲在把麦子堆起来，我也拿了一把塑料铲子跟着一起干起来。回家干点活的感觉，就像还欠的债一样。但是妈妈大多时候是阻拦我干活的。我能十分感受到她对我的溺爱，从小到大都是这样。</p><p>我在这里写了不多一会儿，所有人都加入到我这里来了，于是我放下电脑，跟大家一块聊天。</p><p>妈妈对我妻子说：“你可能觉得我偏心，觉得我对文武更好一些。哪里有不喜欢自己女婿，不喜欢自己儿媳的呢？只是我现在有心无力。我再喜欢文武，也只能放在心上。我对这样的“表白”很感动，尽管她不说我也是知道得。</p><p>妻子和父母对生二胎的事情有很大的分歧。父母觉得小孩应该有个兄弟姐妹，长大了不至于那么孤单。妻子也认同这一点，但是她认为应该有足够的物质保障的前提下才能要二胎，她认为这是对子女负责。我没有发表任何观点，但是我认为：不管贫穷富有，有个亲人都是很美好的事情。</p><p>这两天妻子和母亲的相处十分融洽。看到她们齐心协力地做饭，偶尔互相表示关心，我很开心。妻子炒菜的时候，我过去慰问她：“累不累啊？”帮她揉了揉肩膀。</p><p>吃完晚饭，我们一家三口就去田间放风筝去了。妻子放风筝，我把小孩架在脖子上看。后来我实在驼不动她，放她下来，结果又摔了她。妻子非常生气，又“面目狰狞”地说了我一回。我自是理亏，没有回嘴，抱着孩子回去上药去了。但是这样的责备，却扼杀了刚刚放风筝产生的其乐融融的美好。然而妻子对我和孩子的爱，我是没有怀疑的。</p><p>							</p>','日志','回家第二天','我很为父亲有这样一个朋友而感到高兴。','生活',0,256,0),(144,1495122161,1495122161,1495122161,'<p>在家的日子平淡如水，但总有值得记录的感动。所以我还要努力去回忆，留住这些生命中细微却珍贵的瞬间。</p><p>小孩子今年5岁，但爱美的天性已经显露无疑。昨天晚上洗的裙子，今天早上就去阳台看了好几回，一干就收回来换上了。她说她要变成小公主。哈哈。这还不止，中午非要我带她去超市买新裙子和鞋子。</p><p>我说我手上没钱，她摸了我所有的口袋，仍是不信。我让她找她妈妈，但是她不肯。后来我敌不过她的梨花带雨，跟她商量：“让我睡半个小时，我们就去。”她还是不答应。后来他爷爷午休起来了，拉着她正要往超市走，邻居的新访爷过来向我们借泵灌溉水田。正好我们的水田也需要灌溉，所以她的小小愿望就被放在一边了。</p><p>傍晚，我和母亲把门口嗮着的谷子扫成堆，装袋。装了差不多8袋，这就是全年的收成了。</p><p>我们需要用板车把这些粮食拉到后院。早些的时候，板车被用来拉水管到水田里去了。</p><p>我问母亲：“爸爸呢？”</p><p>“去水田里收管子去了。”</p><p>我说：“我去找他。顺便把板车拉回来。”</p><p>妻子和小孩子也要跟着，于是我们就一起去水田了。</p><p>我去的时候，父亲刚断了水泵的电，开始收管子。管子里还有水，我们收的时候需要把水先推出来。于是我在前面推水，父亲在后面卷管子。</p><p>“啊啊啊！“</p><p>突然听到妻子的尖叫声。原来她看到一只青蛙。父亲笑了，我也笑了，小孩子也笑了。</p><p>收好东西，我拉着板车，一家人就往家走了。快到的时候，母亲赶紧过来接我手中的板车。她深怕我拉不动，以为我的腰的情况很严重。邻居新坊爷见了我们这么多人，开玩笑，大概是说我们全家出动来收水管这件事。</p><p>爸爸不能干重体力活。收好水管，我和妈妈把粮食搬到板车上。她总是只让我抬扎口袋的那边，说那边轻一些。我有些无语，但我明白，即使过了而立之年的我，在她眼中仍是个孩子，现在更是一个“伤员”孩子。</p><p>我们搬粮食的时候，老费骑着自行车来找爸爸玩。妈妈对他说：“父亲在后院。”于是他拐回去找父亲去了。</p><p>我和母亲拉第一车粮食到后院的时候，老费就已经走了。我问母亲：“怎么玩了这么会就走了？”“肯定是看我们在忙。”妈妈说。</p><p>我的朋友a呢，你在读我吗？哈哈。</p><p>拉第二车的时候，有几包粮食不好下手，母亲不让我帮忙，她一个人搬，吓得我不行，还好没出什么事。</p><p>中午刚吃完饭的时候，老爸接到一个电话，说有快递要他去取一下。于是他载着小孩子，我自己单骑一辆摩托车，两台车一前一后地出发了。我在后视镜里看到她们，小小的影子却是我内心的温暖的源泉。</p><p>吃完晚饭，爷爷坐在门口，抱着小孩子，手舞足蹈地，一遍又一遍地唱“我爱北京天安门~”。他们玩得真的非常开心，非常开心，就像电视剧中煽情的美好回忆。妈妈跟我说：“父亲每天睡觉前都要看小孩子的好多视频才会睡觉。”于是我提醒我自己：“一定要多回来看看啊！”</p><p>父亲的爱有时候是比较隐晦的，而这种隐晦的爱往往最让人感动。我今天才知道，父亲在我回家之前的几分钟，匆匆地去超市买了一箱拉罐啤酒。今天才知道，我非常感动。真希望，上苍开恩，让他们有更多的年月。</p><p>晚饭吃的有些多，我拉她妈妈去田间散步，消食。小孩子和他爷爷玩得不亦乐乎，我们叫不动她。于是我们只俩人手拉着手去了。</p><p>田间的小道，弯弯曲曲地向远处的村落展开。路的左侧是收割了的，和没有收割的金色麦田。路的右侧是水稻田，田里的秧苗正抽着小细牙儿。</p><p>借着落日的余晖，我看妻子。我和妻子从相识到现在7年了。妻子是美丽的。她顾家，勤劳，聪明。我时常感激她为家庭的付出，但这种感激往往被她得发脾气所消耗。我反复地对她有怨心继而释怀。此刻我看她，仿佛回到我们初恋的时候。</p><p>我称赞她：“你这两天的表现真不错！和老妈相处的很融洽啊。”</p><p>她却说：“那只是表面上的。”</p><p>“表面上这样就行了。”</p><p>有些事不能强求，她们之间的“婆媳关系”，能这样我就阿弥陀佛了。</p><p>走在路上，我拉她到我的身边，亲了她一下。此时我抬头看天，发现星星们不知道躲那里去了。</p>','日志','回家第三天','走在路上，我拉她到我的身边，亲了她一下。此时我抬头看天，发现星星们不知道躲那里去了。','生活',0,298,0),(145,1495246156,1495246156,1495246156,'<p>看了朋友关于骑行去西藏的专题日记，非常震撼。然后花了一点时间了解骑行去西藏的路线，困难以及沿途风景。十分佩服能够完成这项壮举的人。</p><p>论坛里有人问：“为什么要骑行去西藏？”有人说：“为了祭奠即将逝去的青春。”有人说：“人生有两件事必须做。一是要谈一场轰轰烈烈的爱情，二是要来一次说走就走的旅行。”人不必照着别人活，人也不必因为有前人的言行而故意不照着为之。人生只有一次，听自己的心声最重要。</p><p>我在论坛里了看了一些沿线的图片。诚然是有风景壮丽的地方，然而一路的苦难却是美景的十倍乃至二十倍。非有超出常人的体力，毅力与智慧，这样的行程最好不要尝试。从前我不知道有这样的事，幸好今天，现在我知道了，我觉得我的内心埋下了一颗骑行去西藏的种子。</p><p>我为什么要去呢？我看着星空，久久得不出答案。我只是知道我想要去，我想要去看看这个世界，也审视一下自己的内心。</p><p>也许趁换工作的间隙，一个多月的时间。或许因为这样一次出行，看人看事也会不同了吧。</p><p>父亲的病仍是我最大的心事。有好几次我要跟他说他病的事情，话到嘴边又咽了回去。</p><p>二姐前天打电话跟我说，她身边好多人都是肿瘤，不看还“活得好好的“，看了不久就都死了，我真不希望父亲是其中一个。</p><p>刚刚回屋，父亲还在看电视，我有种想跟他说的冲动，话到嘴边仍是没说出口，担心说了他晚上没法睡了。明天看看什么时候说吧，不说肯定也是不行的。</p><p>我知道我是珍惜他现在我所能见的他的快乐。进了医院，人难免愁苦。这是我们所有人都不愿面对的。</p><p>今天早上我看母亲在田里忙，我赶紧卷了裤腿走到她那里。她在割地里的草。我说要帮她弄，她断是不肯的。我只好陪她在那里聊天。我想我陪她说说话，她的劳累不至于那么无聊吧。我们说到爸爸的病情，说到小孩子带给他的快乐。母亲有时候会停下来，专门跟我说话。有时候我都怀疑，我在这里会不会延长她的劳动时间。</p><p>父亲走到田埂上来了，母亲催我赶紧走：“说，你看你在这里，你爸爸也要过来了。”我听了急忙朝他走过去。</p><p>他是去跟正在收割麦子的村民聊天去了。我走过去找他。</p><p>这个村民的麦田里全是野麦。野麦比家麦长很多，容易倒，收割起来非常不容易，收割机动不动就卡死。我看这块麦田的主人也只是一脸无奈，然而也并没有其他办法，也无可抱怨。种瓜得瓜种豆得豆的道理谁都懂。</p><p>父亲说今天他来做饭。我们俩走到家里的菜园门口。他打开菜园的网门，对我说：“去家里拿个装菜的东西，我们摘点菜。“我回到家里拿到菜篓子，问妻子和小孩子要不要一起去。他们很愿意。刚好大姐夫今天到家里做客（也不算做客，因为外甥读初中，我家离初中近，他就住在我家里，晚上下夜自习回来方便。），他就一起过来了。妻子嫌篓子泥巴多，换了一个篮子，于是我们4个人浩浩荡荡地去采摘去了。</p><p>采摘蔬菜是一件很新鲜，有趣的事情。我们摘了豆角，辣椒，蔊菜和黄瓜。</p><p>父亲的厨艺非常了得，做出来的菜样样都是色香味俱全。</p><p>中午我在客厅的凉椅上午休，着了点凉，起来后头疼了好一会儿。睡得时候依稀感觉有人给我盖了一件爸爸的外套，后来知道那是妈妈。</p><p>吃完晚饭，小孩子又要他爷爷带着她出去玩。他们骑着摩托车走了，在路的转角，小孩子快乐地朝我挥手。我被这个瞬间触动到，露齿笑了。</p><p>傍晚，太阳已经不那么强烈。妈妈拿了锄头去田里除草。小孩子和她爷爷也回来了。我拿着风筝去放风筝，过了一会她爷爷和她就过来了。我们一起把风筝放到很高的高空。后来，他爷爷带着她去远处的玉米地去玩去了。我坐在田根上，看风筝，跟妈妈聊天。我觉得她在那里干活，我在这里放风筝有些不合适，但我太了解她的固执。她说：“天天真是大家的开心果。“我说：“是”。</p><p>过了一会儿，妻子过来找我。她说：“我把碗洗了。”我说：“我知道，我看你在屋里转来转去就知道了。”她继续说：“你妈忙完地里还要洗碗肯定很累。”于是我很赞赏她的为母亲着想，同时惭愧自己的眼里没活。这真是个很大的缺点，以后当尽力改正。</p><p>后来，我把风筝的线轮固定在一捆棉花梗下面，让风筝自己在天上飞。</p><p>小孩子带我们去看她发现的“最美的世界”。去那里要经过一个微型的独木桥，然后在一片玉米地的边上，还有一小丛盛开着的太阳花。这就是她所说的“最美丽的世界”。</p><p>我们在路上发现好多野的草莓。我们一起去采了野的粽子叶。</p>','思考','回家第四天','采摘蔬菜是一件很新鲜，有趣的事情。我们摘了豆角，辣椒，蔊菜和黄瓜。','生活',0,221,0),(146,1495417136,1495417136,1495417136,'<p>我原以为随着回家日子的增多，我的新鲜感会降低，就再无可记录。现在我意识到，只要有一双能发现美的眼睛，再平淡的日子也能过得心满意足。</p><p>这种心满意足来源于一些生活片段和瞬间。每当这样的片段或者瞬间发生，就好像有一股电流在心中经过，让人或感动，或珍惜，或感慨，或惊讶，或幸福。</p><p>这次回家没有带相机，出门也习惯了不带手机。每有拍照的冲动，难免觉得可惜。还好我的脑子能临时的记住一些画面，后来用文字记录下来，竟也能成为永恒。</p><p>现在已过了凌晨，我失眠了，起来写日记，所以这应该算是前天发生的事了。</p><p>吃完晚饭，我和父亲去水田收灌溉工具。迎着落日的余晖，父亲和我一前一后的走在田间小道上。我们说了些什么，我全记不得了。但我清晰地记得我那时的感觉：我觉很幸福，有爸爸在身边。我觉得真的是这样，陪伴最是温情，哪怕两个人在一起什么也不用说。可我给他们的陪伴太少。</p><p>我们才开始工作，妈妈就跟来了。我赶紧把泵上的管子卷起来，把泵往板车上提。</p><p>父亲母亲和我是下午4点多钟去灌的水田。母亲拉着板车走在最前面，父亲和我一前一后地跟着。这一回我们没有拿很多的线和管子，因为供电的地方就在水源旁边，水田离水源也很近。这是另一块水田。</p><p>母亲将泵放入水中，问父亲：“这样行不行？”父亲说：“行了。”</p><p>只接了一根管子就到了我们的田里。插上插头，水就突突地往田里灌了。这一次水管只有一个漏水的地方了，因为下午父亲用胶带把漏水的地方全部缠了一遍。放出水来，母亲就回家了。我和父亲在田埂边上看了大约30分钟。有很多蚯蚓从被淹的土里爬出来，寻找上岸的出路。后来，我们沿着我们田的边沿检查了一遍是否有缺口，就回家了。</p><p>画面回到收水管的场景。我卷着管子，父亲和母亲在前边抖着管子里的水。抖完水，她就来抢我手中的管子。她的动作比我的麻利得多，开始她也像我一样提着管子卷，后来她干脆把管子放到地上，往前推着走。一小会，就卷完了。</p><p>母亲拉着板车在前面走，父亲和我在后面一前一后地跟着。这感觉就像，我又做了一回小孩子。</p><p>小孩子真的来了，远远地，迎着夕阳，喊着：“奶奶，奶奶”，奋力地朝我们跑过来。这是我这两天觉得最美的第一个画面。</p><p>母亲要把她放在板车的头上坐着，起初她还有点害怕，拒绝上去，坐上去之后就恢复了平时的开心。我跟她说：“爸爸小时候就喜欢这样坐在板车上。”这是我这两天觉得最美的又一个画面，母亲拉着她，我和父亲一前一后地走着。</p><p>昨天晚上我们一家人在阳台聊天。我终于对父亲说了病的事。我尽量让自己听起来“不经意”一些。我说：“听亚姐说你的膀胱里有阴影。”“结石。”父亲斩钉截铁地说。我看过诊断书，上面并没有给出结论。于是我明白父亲的意思了。我们说这个话题，让他变得非常急躁。他说：“不要谈论这个话题。”我想，他是不愿意和我一起去医院的。他的话里也有对住院做手术的恐惧。我不忍心逼他，他所说的感受我听着都很痛苦，何况他是亲身经历。</p><p>疾病的话题让大家感到沉重，今天的夜聊早早地散了。我仍和妻子在二楼的阳台聊着天。</p><p>我跟她说：“我想骑自行车去西藏。”</p><p>她很反对：“哪里有你这么大年纪还去的。再说，你去西藏玩去了，我们生活怎么办。我还想去玩呢！”</p><p>“我会在能保证你们正常生活的前提下去的。可能是换工作的时候。况且我不是去玩的。去玩也不选择骑自行车了。”</p><p>“你不换工作了？”</p><p>“暂时不换。”</p><p>“你为什么不换。你之前不是说要换的吗？”</p><p>“现在不适合换。况且在这里我还能接触到新的，感兴趣的东西。在这里我也没有做到最好。”说到这里，我想：“不走的原因里，还有一点是，不舍得这么快就和朋友说分别。”我没有和妻子说明这一点，免得她误会或者不理解。</p><p>“那你觉得你在这里有上升的空间？”</p><p>“有啊。”</p><p>“如果你们主管，总监不走你能有机会？”</p><p>“你这种想法在职场是很要不得的。如果你这么想，在哪里都是没有机会的。”</p><p>“但是你换个工作肯定不是换普通的，肯定是高级的。高级的就可以带人啊，管理啊。”</p><p>“我们组里就有高级程序员。大家都干一样的活。”</p><p>“那你换个工作，工资高很多。你看看招聘要求，看看那些3万的工作你都干不干得了？”她有些急，说着就去屋里拿手机去了。</p><p>我看了几条招聘信息，还真干得了。</p><p>“干得了”，我说：“但是我们得想得长远一点吧？今年跳，明年跳，以后还有得跳吗？还有竞争力吗？况且我还真没打算要走。”</p><p>“你之前不是打算吗？”</p><p>“人的想法会变的，之前的想法就不要管它了吧。”</p><p>“你要是不换工作，我就不找工作了。”</p><p>“你这是很消极的想法。我换不换工作，跟你找不着工作有什么关系？”</p><p>“你明明可以赚更多的钱，干嘛要我承担更多的压力？”</p><p>“在这里也有加薪的机会啊。”</p><p>“那能加多少？”</p><p>“如果你不想工作，那就不要出来找工作了。”</p><p>“我不工作，你挣得刚好够我们开支。”</p><p>“我们开支有那么多了吗？”</p><p>于是我们开始计算每个月的开支，果真每个月少说也要8000块。我有些惊讶。</p><p>我叹了一口气：“工作，挣钱的事就交给我，让我自己处理吧。只是不要把你的思想强加给我了。”</p><p>“我哪里强加给你了？”</p><p>“你在说‘我希望’的时候。这听起来不像强加，但实际上却是一种心理暗示。意思就是我要你怎样怎样。我问你，你关心我吗？”</p><p>“关心。”</p><p>“关心就应该关心对方想要的什么，尊重对方的决定。比如说你想呆家里看孩子，我尊重你的决定，我同意。”</p><p>“如果意见不一致呢？”</p><p>“那另一方必须做出妥协。”</p><p>“你知道我为什么想去骑车去西藏吗？”我看着星空，语气放慢下来。</p><p>“为什么？”</p><p>“因为我想考验一下我自己。”</p><p>“那为什么不从湖北骑到北京？”</p><p>“因为不够难。”</p><p>“我觉得已经很难了。”</p><p>“但是没什么风景。”</p><p>“还是为了看风景。”</p><p>“你能理解那种很想去做一件事的心情吗？你有没有特别想做的事情？”</p><p>“有很多啊。我想去巴黎，加拿大……”妻子微微笑着，慢慢地说，45度角仰望着星空，眼角有泪流出来。</p><p>我帮她擦着眼泪，说：“你在说这段话的时候感觉特别美好。这种状态特别好，是我从来没有认识的你。”</p><p>我还记得我们开过的玩笑。我问她：“你想多久去玩一次？”</p><p>“一个月一次。”</p><p>“一个月一次，一次一个月？”</p><p>现在是凌晨3点22分，鸡正在叫，我刚才仿佛听到楼下父亲的呻吟，我的心跳突然加速，呼吸变得急促，我感觉完全笼罩在恐惧之中了。</p><p>我要尽快完成我和妻子的这段对话，好去休息一会。但是这段对话是我认为我们认识以来最重要的一次对话，所以可能我会尽量去还原，不会那么快了。</p><p>“我的梦想只有一个。而你的那么多。现在你的梦想，也是我的梦想。我们一个一个来完成。”</p><p>“我想先去巴黎。”</p><p>“为什么是巴黎呢？”</p><p>“因为小时候看电视，好多都是在巴黎的，觉得特别浪漫。”</p><p>“好，就巴黎。今年我们实现这个梦想，就在十一！”</p><p>话说到这里，我们之间好像又重新认识了。我跟她说：“你有没有发现，当我们在谈论一些精神上的东西的时候，我们变得没那么尖锐了。”是的，那是我们心的归宿，那些我们最渴望做的事。我说：“当我们老了，不是我们有几套房，有几台车，值得我们骄傲和回忆的，永远是我们做过的事。生命中最重要的是去体验。”</p><p>我们一起简单地看了去巴黎的行程，估算了费用。我们都很高兴。妻子说：“今天这场谈话还很高兴。”</p><p>这场谈话太长了，我漏了很多，有很多我也记不起来了。先后顺序可能也是有误差的。但是表达我的心情应是足够了。</p><p>“我真正关心的那一节”我想是受了朋友a的启发。我们只需做更好的自己，又何必强求别人根据自己的喜好去改变呢？现在想想，我在对话中和妻子也谈到了。我说：“我老觉得你不够温柔。可是我没有想过什么导致的。是不是受你父亲的影响呢？我不够关心你，却要求你去改变。”妻子听了也动容。人都是“吃软不吃硬”的吧。</p><p>说起体验，这两天，我学了骑摩托车：启动时要拉着离合器。起步时，给点油，必须慢慢松离合，否则会熄火。刹车时必须拉离合，否则也会熄火。我还学着做了两道菜。一道猪肝汤，一道炒米粉。</p><p>猪肝汤：猪肝和里脊肉切成片，放入碗中。加少许食盐，水，然后放入适量淀粉，将猪肝捏成糊状。油锅烧开，加入葱姜，炒香，倒入水。大火烧开后，放鸡精，盐调味，然后放入猪肝，烧开，打入鸡蛋花即可。</p><p>炒米粉：最好使用东莞米粉。炒之前用水泡开，一般30分钟至40分钟。准备调料：不要用油。锅里放适量清水，加入酱油，盐，鸡精，加热少许即可起锅。因为粉中不加汤，如果直接放入调料，调料会化不开，炒不匀，所有就有了制作调料这一步。炒：锅烧热，放油炒热，加入葱姜蒜爆香。打入一个鸡蛋，炒散。放入喜欢的青菜，炒蔫，放入粉丝，适量翻炒后加入事先制作好的调料汁，迅速翻炒，起锅。</p><p><br/></p>','心情','回家第六天','现在是凌晨3点22分，鸡正在叫，我刚才仿佛听到楼下父亲的呻吟，我的心跳突然加速，呼吸变得急促，我感觉完全笼罩在恐惧之中了。','生活',0,140,0),(147,1495641837,1495642417,1495641837,'<p>								</p><p>2017年5月22日 &nbsp;阴<br/></p><p>今天是阴雨的天气。父亲早上问我是否要和他一起去钓鱼。我特别想去，可是因为有些工作不能再拖，我说我不去了。后来我见他约费伯，费伯说担心雨下大，也不去，他就作罢了。刚好今天村里来了打田的机器，他就和母亲张罗打田的事了。</p><p>天骄，如果你在看爸爸的文章，可能你不理解什么叫“打田”了。打田就是用机器将水田的泥打烂，以便于秧苗的生长。就像在普通的田地里的耕田一样。</p><p>吃完早饭回来，我望见他们在秧田里，就独自一人去找他们去了。爸爸站在田埂上。妈妈在水田里挖土加固堤坝，以防水田的水流出去。我下到地里，走到她的身边说：“我来帮你弄一下。”她说：“你不会弄。”总是这样。</p><p>她常对我说：“我希望所有的苦和累到我这里就结束。我就是受苦的命”。今天她又对我说这样的话。我说：“你可以不吃这个苦。我们又不是不养你。”“不愿意加重你们的负担。”她总是这么说。</p><p>在集上吃完早餐，小孩子又要去超市。每天都要去3，4回超市的小孩子，我表示“醉醉的”。我们经常跟她开玩笑：“给你开个超市得了，省的你老想去超市。”她在超市看中了一个用水画画的玩具，34块钱。我和她妈妈不愿意给她买，因为在这里也住不了多久，不想给她花太多钱买太多玩具。好说歹说，最后给她买了个小订书机，才把他哄回了家。</p><p>回到家里她对我“苦苦纠缠”，还是想要买那个玩具。她奶奶见了，给了她50块，说：“让爸爸带你去买吧。”母亲在家里挣钱特别不容易。每天早上5点不到就起床准备卖菜，一天只能挣20到30块。但是她在花某些钱的时候，却一点不吝惜，就像对小孩子这样，而她平时是极省的。</p><p>我对小孩子说：“摩托车的钥匙在爷爷那。爸爸要去找爷爷拿钥匙。你现在家里等一会。”“嗯。”交代完我就去田里找父亲去了。到了田里，我发现父亲在挖土加固水田的堤坝。我担心他累到，却说的不动声色：“我来帮你挖会。”“你不会的。”他说，那语气跟母亲一模一样。有时候我感到，这虽是溺爱，却让我明白，我该如何看重对子女的关爱。</p><p>给小孩子买完玩具回来，刚好见他们从地里回来。越过小树丛，我看到他们几乎并肩同行着，都戴了草帽。父亲的新，母亲的旧。父亲戴着眼镜，穿着黑色格子衬衫，母亲穿着涤纶锦花短袖。他们脸上都洋溢着微笑，应该是在交谈。也许父母亲的微笑只有在子女看来才有那份特别的慈爱吧。这是我今天觉得最美的第一个画面。</p><p>说起慈爱，父亲刚给我送来了蚊香。小小的关爱真是温暖极了的啊。</p><p>父亲母亲的一生是艰难的。不单生活上艰难，平日里争吵也不少。但是终究伴了一生，这却是极浪漫的事。母亲昨天对我说：“我现在学会了忍耐。他现在这样，我只希望他尽量能开心一点。”听了她的话，我仿佛对爱有了更深的理解。</p><p>睡了午觉起来已经是下午3点半多了。我站在二楼的窗户往外看，他们又在田里了。</p><p>连续4天了，工作的事非常不顺，没有一次要做工作是没有问题的。今天也一样，又出问题了。我望向窗外，看见有人用手遮着头在小跑，下雨了。我往远处看，妈妈正拉着板车往家走，没有打伞。我急忙下楼找了雨伞，跑过去接她。其实雨并不算大，她说她不打伞。田间的路也很窄，我们并排也不好走，我就收了伞。她居然光着脚。我问她：“你怎么不穿鞋。”她回答：“田里刚打完，不平，下去弄了一下。”</p><p>她要把板车拉到后院，让我去开一下后门。我们家是路边第二家，靠着路的这一家后门口没有铺水泥，有些砖渣，碎石。我担心她经过的时候扎着脚，我从前门跑到后门，开了门去截她，但是她终究没有把板车交给我，她说：“你的腰还没好。”我又感到无奈，同时再次的对她感到敬佩。</p><p>下午饭我和父亲去一家酒楼吃的。有个表哥的妈妈脑梗出院了，请亲朋好友去吃饭。我很为他妈妈的康复和这份孝心感到高兴。</p><p>原本我在忙着一些工作，有不去与席的打算。可是父亲一叫我，我就去了。我想多陪陪他。女儿也跟着，通常有人出门，她是必要跟着的，跟我小时候一样。</p><p>现在外面下着毛毛雨。父亲问我：“还在下吧？”“嗯。”他走到阳台。我跟着他出来。他走到大树的下面说：“可以到这里来坐。”我看树下面果然没雨，说：“可以。”我就把椅子从门廊那里搬到了大树底下。父亲有说：“我那把钓鱼的雨伞可以拿过来用。”我说：“去看看。”于是我们一起到楼下找到了那把遮阳伞。我们把它拿到2楼的阳台上，并组装了起来。那是一把很大的伞，最后插在了栀子花的大花盆上，刚好遮住两把椅子。这是极好的情景，我和父亲坐着伞下，躲着淅淅沥沥的夜雨。栀子的香味一阵一阵的散发出来，香的正好。</p><p>说好明天去医院了。我有几次想说和父亲说这个话题，话到嘴边还是咽下去了。既然说好了，就明天专门来说吧。</p><p>是母亲告诉我他愿意去检查的。母亲跟我说她是这样跟他说的：“你看儿子媳妇专门回来一趟，你要是不去，你这些儿女以后就不会管你了的。“大概是这样。听到这个消息我有点矛盾。我既希望他去检查，又担心这要将他推向痛苦的深渊。</p><p>							</p>','日志','回家第七天','母亲跟我说她是这样跟他说的：“你看儿子媳妇专门回来一趟，你要是不去，你这些儿女以后就不会管你了的。“大概是这样。听到这个消息我有点矛盾。我既希望他去检查，又担心这要将他推向痛苦的深渊。','生活',0,460,0),(148,1497051985,1497183090,1497051985,'<p>								</p><p>它咬着牙，用尽所有力气推开压在他头顶的泥土，窜了出来，世界光亮了。</p><p>“欢迎来到这个世界，小向日葵。”它身边一棵老杨树欠着身对它说，慈爱地。</p><p>“向日葵？”</p><p>“你的名字。”老杨树抖了一下枝干，老怪老怪的。</p><p>“哦。”小向日葵说，揉了揉眼睛，看周围。</p><p>“哇哦！”小向日葵赞叹这世界。</p><p>“爷爷，您叫什么名字？”</p><p>“我叫杨树。”</p><p>“很高兴认识您。”</p><p>“我也很高兴认识你，不过我早就认识你了，哈哈哈哈。他们这些家伙已经迫不及待了，来，我给你介绍一下你的邻居们。”小向日葵这才发现它周围一双双好奇地看着它的眼睛。“这位，最漂亮的，最娇艳的，玫瑰小姐！”树林里起一阵骚动，一只松鼠爬到老杨树上，吹出几声不怎么连贯的口哨。玫瑰有些害羞，越发红艳的夺目了。“人数众多的，草先生和女士们！”“耶!”草们欢呼。“口哨吹得很烂的松鼠。”老杨树说，耸了耸肩，将松鼠赶了下来。“兔子有时候会过来玩，到时候你就认识了。”小向日葵礼貌地跟所有人打招呼，从此开始了它的丛林生活。</p><p>树林里的阳光很少，小向日葵尽量不让自己的叶子长得太大，以免遮住了别的植物。但是它长得很直，几乎没有一丝弯曲，很快他的个头就超过了玫瑰。</p><p>有一天，它的心上生出一个花苞，它不知道那是什么，它很好奇，于是请教老杨树：“杨树爷爷，我头上这是什么呀？”老杨树回答它：“这是你的使命。”“使命？”小向日葵低声自语，它有些不解，但也没放在心上。</p><p>小向日葵的性格十分安静，大部分的时间它只是默默地生长。他爱他周围的一切:老杨树，玫瑰，草先生女士们，还有松鼠和兔子。有时候一些鸟儿歇在老杨树上，它们唱歌，偶尔说一些它听不懂的一些话。说着说着，它们就飞走了。</p><p>它和玫瑰挨得最近也最为要好，它们了解对方的一切事情，它们无话不谈。小向日葵给玫瑰起了个名字：“爱哭鬼”，玫瑰则常取笑小向日葵只有一个花苞。</p><p>有一天晚上下了很大的雨，向日葵奋力地倾着身体，伸展开叶子护着玫瑰。雨停了，它们对视了一眼，玫瑰羞了，低下头，向日葵缓缓地收回叶子，立正了身体，迅速地看了玫瑰一眼，又看向别处。</p><p>玫瑰变得越发依赖向日葵的陪伴，对它有说不完的话，向日葵则把保护玫瑰当做自己的责任。</p><p>有一天，林子里来了一位老奶奶，她发现了玫瑰，便把它挖走了。大家都很伤心但又无可奈何。</p><p>好在时间能抚平一切伤痛，当向日葵已不再为玫瑰的离开自己的生活而感到悲伤，它也已经盛放了自己。它的花每天不由自主的向着太阳转动。早晚的太阳都很温柔，可是中午的太阳却十分炙热，有时候向日葵觉得它的花瓣都被太阳晒伤了。他有些不理解自己为什么要这样一直围着太阳转下去。它问老杨树，老杨树告诉它：“这是你的使命。”“又是这句话。”它心想，但是这一次他仍不能明白。“我不明白——”老杨树打断它：“可是孩子，时间会教会你一切。”</p><p>向日葵仍每天围着太阳打转，直到有一天林子里飞来一只蝴蝶，婷婷地歇在向日葵的花上，缓缓地扇动着翅膀。</p><p>“你好啊。我叫向日葵。”</p><p>“你好，我叫蝴蝶。”</p><p>“蝴蝶，你真美丽！”</p><p>“哈哈，”蝴蝶说，在空中做了一连串漂亮的旋转，然后优雅地降下来，咯咯地：“从小到大，见过我的都这么说。”老杨树不屑地瞥了蝴蝶一眼，转过头去。蝴蝶突然想起来，前几天它还是只丑陋的毛毛虫。“哎呀，今天的太阳实在是太大了，热死我了。”蝴蝶尴尬地，娇声说，对着向日葵：“大个子，你就不能帮我遮着点吗？”向日葵只默地伸出一片叶子挡在蝴蝶头上。“向日葵，”蝴蝶悄声对向日葵，“这林子里，就你还像点样，别的没一个是我喜欢的，哈哈哈。”</p><p>太阳落山了，向日葵不再需要望着太阳了，他低下头，想起白天认识的蝴蝶。她觉得这只蝴蝶很美丽，但并不因此对它有好感，它甚至有点讨厌它。</p><p>第二天蝴蝶又幽默地飞过来：“单花苞的，我又来啦。”向日葵正望着太阳，它不看她，但他觉得有点想笑，同时他又想起了玫瑰曾也这么叫过他。蝴蝶飞到他和太阳之间，在他的花心投下一幅倩影。“天天看着太阳无不无聊？来，我给你跳一支舞。说完就跳了起来，大家都看她跳，连杨树都忍不住赞叹：“哇哦！”向日葵正想说：“蝴蝶，你跳得真好。”蝴蝶就说了：“怎么样，我跳得好吧？哈哈哈！有水喝吗？“”没有。“小向日葵说。</p><p>今天，向日葵觉得蝴蝶还挺好玩的，尽管他仍觉得她太骄傲。但偶一想起她，他还有笑出声来的时候。</p><p>第三天早上，向日葵把所有叶子的露水全收集到花的心中，不看太阳，以免花中的水被晒干了。老杨树见他这样，问：“你这是做什么呢？”“没做什么。”向日葵说，有些脸红。</p><p>向日葵时不时地望着树林外：蝴蝶怎么还不来呢。“唉。”老杨树叹了口气，但是向日葵完全没有听见。远远地，向日葵终于看到蝴蝶翩翩地飞过来了。他很激动，有些不像独处时的自己。“哎呦喂，今天居然没看太阳，不错哦，哈哈！“蝴蝶一见向日葵就打趣。</p><p>“蝴蝶，我给你准备水了今天，你看，在我的花里。”</p><p>“哈哈，我尝尝！“蝴蝶喝了一口，说：”嗯，真好喝！“向日葵看着蝴蝶喝水，他非常开心。</p><p>“单苞，我给你讲个故事，听完不许笑。”</p><p>“好。”</p><p>“从前有一头驴，有一天，它的主人牵着它去赶集。走到半路，主人突然发现自己没带钱，又懒得回去拿，就对驴说：”驴啊，我的好驴，回去帮我拿一下钱。“驴听了就往回走，结果它迷路了，它的主人再也没见过它。哈哈哈哈哈哈！好笑吗？”</p><p>“不好笑。”</p><p>从这天后，向日葵满脑子都是蝴蝶，见到她是他最开心的事。他再也不看太阳，只每天接了露水，默默地等着蝴蝶出现。</p><p>蝴蝶每天都会来找向日葵玩，直到第十三天，这天她出现得非常晚，几乎快天黑了。她看起来很虚弱，可她仍然扬着嘴角：“有水喝吗？“”有，你怎么了？“蝴蝶喝了一口水，挤出一个大大的微笑，说：“我累了，今天不走了，就在你这里过夜行吗？”“好。”向日葵有些不知所措，他收紧叶子，为她搭了个小屋子。他看着她睡，他觉得她睡得特别特别的甜。天空露出了鱼肚白，蝴蝶醒了过来，看着睡着的向日葵，落下大滴大滴的眼泪。她亲了他一下，在心里跟他道别：“再见了，单苞。”她艰难的起飞，一直坚持飞到向日葵所在的树林很远的地方，重重地跌在地上，死去了，地上的枯枝穿破了她的翅膀，触目惊心的。</p><p>向日葵仍每天的收集露水，巴巴地望着蝴蝶平时来的方向。不过是一日复一日，一日又复一日的希望又失望。</p><p>“咳咳咳咳”，向日葵咳嗽的厉害。他这才发现自己的叶子黄了一半，花心的籽好多都干瘪了。“”再这样下去，你要死的！“老杨树这天又劝他，语重心长地：”我告诉你，她死了，蝴蝶的生命只有14天！“</p><p>向日葵不愿相信，但它回想起第13天蝴蝶来找他的情景，他的心凝固了。他垂下头，面目痛苦地变得扭曲。“啊！“向日葵仰天大叫一声，眼泪像断了帘的珠子，爬满了它整张脸，这声音撕心裂肺，震荡宇宙！这一夜，他的叶子全黄了，花里的籽掉了一半。”</p><p>他们都觉得他会死掉，但是它没有。在他最难过的时候，太阳从来没有放弃过他，日日给他温暖，竟也使他恢复过来。于是他又开始追随太阳的脚步，痴痴地，像从来没发生过旁的事情。</p><p>他终于明白老杨树说的话：“时间可以抚平一切伤口。”他也终于明白了他的使命，他穷极一生只需要做的唯一一件事情：孕育葵花籽。</p><p>他从来没对太阳说过感激的话，他把她的温暖放在心上，现在他居然能欣赏她的午间的炙热。</p><p>有一天，那位老奶奶又来到这里，发现他这颗结满葵花籽的向日葵，甚是欢喜，只一折，便毙了它的命。“哎”，老杨树叹了口气，不再言语。</p><p>不知道过了多少年后了，这一天有一家三口来这片树林踏青，五岁的女儿惊呼：“哇！这里有一朵好好看的花哦！”“那是玫瑰。”父亲说，走过来仔细看时，发现旁边居然还有一株向日葵，笔直地，伸展着叶子，紧挨着玫瑰。“天骄你看，这是一棵向日葵。”</p><p>“什么是向日葵？”</p><p>“我们经常吃的瓜子，就是这种植物里长的。”</p><p>“爸爸，玫瑰很好看，我们把她挖回家吧。”</p><p>“好啊！”</p><p>							</p>','心境','小向日葵','有一天晚上下了很大的雨，向日葵奋力地倾着身体，伸展开叶子护着玫瑰。雨停了，它们对视了一眼，玫瑰羞了，低下头，向日葵缓缓地收回叶子，立正了身体，迅速地看了玫瑰一眼，又看向别处。','故事',0,313,0),(149,1497108106,1497108269,1497108106,'<p>								</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开电车的人开电车。在大太阳底下，电车轨道像两条光莹莹的，水里钻出来的曲蟮，抽长了，又缩短了；抽长了，又缩短了，就这么样往前移——柔滑的，老长老长的曲蟮，没有完，没有完……开电车的人眼睛盯住了这两条蠕蠕的车轨，然而他不发疯。&nbsp;<br/></p><p><br/>　　 如果不碰到封锁，电车的进行是永远不会断的。封锁了。&nbsp;<br/>　　&nbsp;<br/>　　 摇铃了。“叮玲玲玲玲玲，”每一个“玲”字是冷冷的一小点，一点一点连成了一条虚线，切断了时间与空间。&nbsp;<br/>　　&nbsp;<br/>　　 电车停了，马路上的人却开始奔跑，在街的左面的人们奔到街的右面，在右面的人们奔到左面。商店一律地沙啦啦拉上铁门。女太太们发狂一般扯动铁栅栏，叫道：“让我们进来一会儿！我这儿有孩子哪，有年纪大的人！”然而门还是关得紧腾腾的。铁门里的人和铁门&nbsp;外的人眼睁睁对看着，互相惧怕着。&nbsp;<br/>　　&nbsp;<br/>　　电车里的人相当镇静。他们有座位可坐，虽然设备简陋一点，和多数乘客的家里的情形比较起来，还是略胜一筹。街上渐渐地也安静下来，并不是绝对的寂静，但是人声逐渐渺茫，像睡梦里所听到的芦花枕头里的赶咐。这庞大的城市在阳光里盹着了，重重地把头搁在人们的肩上，口涎顺着人们的衣服缓缓流下去，不能想象的巨大的重量压住了每一个人。&nbsp;<br/>　　&nbsp;<br/>　　 上海似乎从来没有这么静过——大白天里！一个乞丐趁着鸦雀无声的时候，提高了喉咙唱将起来：“阿有老爷太太先生小姐做做好事救救我可怜人哇？阿有老爷太太……”然而他不久就停了下来，被这不经见的沉寂吓噤住了。&nbsp;<br/>　　&nbsp;<br/>　　还有一个较有勇气的山东乞丐，毅然打破了这静默。他的嗓子浑圆嘹亮：“可怜啊可怜！一个人啊没钱！”悠久的歌，从一个世纪唱到下一个世纪。音乐性的节奏传染上了开电车的。开电车的也是山东人。他长长地叹了一口气，抱着胳膊，向车门上一靠，跟着唱了起来：“可怜啊可怜！一个人啊没钱！”&nbsp;<br/>　　&nbsp;<br/>　　 电车里，一部分的乘客下去了。剩下的一群中，零零落落也有人说句把话。靠近门口的几个公事房里回来的人继续谈讲下去。一个人撒喇一声抖开了扇子，下了结论道：“总而言之，他别的毛病没有，就吃亏在不会做人。”另一个鼻子里哼了一声，冷笑道：“说他不会&nbsp;做人，他把上头敷衍得挺好的呢！”&nbsp;<br/>　　&nbsp;<br/>　　一对长得颇像兄妹的中年夫妇把手吊在皮圈上，双双站在电车的正中，她突然叫道：“当心别把裤子弄脏了！”他吃了一惊，抬起他的手，手里拎着一包熏鱼。他小心翼翼使那油汪汪的纸口袋与他的西装裤子维持二寸远的距离。他太太兀自絮叨道：“现在干洗是什么价钱？做一条裤子是什么价钱？”&nbsp;<br/>　　&nbsp;<br/>　　坐在角落里的吕宗桢，华茂银行的会计师，看见了那熏鱼，就联想到他夫人托他在银行附近一家面食摊子上买的菠菜包子。女人就是这样！弯弯扭扭最难找的小胡同里买来的包子必定是价廉物美的！她一点也不为他着想——一个齐齐整整穿着西装戴着玳瑁边眼镜提着公事皮包的人，抱着报纸里的热腾腾的包子满街跑，实在是不像话！然而无论如何，假使这封锁延长下去，耽误了他的晚饭，至少这包子可以派用场。他看了看手表，才四点半。该是心理作用罢？他已经觉得饿了。他轻轻揭开报纸的一角，向里面张了一张。一个个雪白的，喷出出淡淡的麻油气味。一部分的报纸粘住了包子，他谨慎地把报纸撕了下来，包子上印了铅字，字都是反的，像镜子里映出来的，然而他有这耐心，低下头去逐个认了出来：&nbsp;“讣告……申请……华股动态……隆重登场候教……”都是得用的字眼儿，不知道为什么转载到包子上，就带点开玩笑性质。也许因为“吃”是太严重的一件事了，相形之下，其他的一切都成了笑话。吕宗桢看着也觉得不顺眼，可是他并没有笑，他是一个老实人。他从&nbsp;包子上的文章看到报上的文章，把半页旧报纸读完了，若是翻过来看，包子就得跌出来，只得罢了。他在这里看报，全车的人都学了样，有报的看报，没有报的看发票，看章程，看名片。任何印刷物都没有的人，就看街上的市招。他们不能不填满这可怕的空虚——不然，他们的脑子也许会活动起来。思想是痛苦的一件事。&nbsp;<br/>　　&nbsp;<br/>　　 只有吕宗桢对面坐着的一个老头子，手心里骨碌碌骨碌碌搓着两只油光水滑的核桃，有板有眼的小动作代替了思想。&nbsp;<br/>　　&nbsp;<br/>　　 他剃着光头，红黄皮色，满脸浮油，打着皱，整个的头像一个核桃。他的脑子就像核桃仁，甜的，滋润的，可是没有多大意思。&nbsp;<br/>　　&nbsp;<br/>　　 老头子右首坐着吴翠远，看上去像一个教会派的少奶奶，但是还没有结婚。她穿着一件白洋纱旗袍，滚一道窄窄的蓝边——深蓝与白，很有点讣闻的风味。她携着一把蓝白格子小遮阳伞。头发梳成千篇一律的式样，唯恐唤起公众的注意。&nbsp;<br/>　　&nbsp;<br/>　　 然而她实在没有过分触目的危险。她长得不难看，可是她那种美是一种模棱两可的，仿佛怕得罪了谁的美，脸上一切都是淡淡的，松弛的，没有轮廓。连她自己的母亲也形容不出她是长脸还是圆脸。&nbsp;<br/>　　&nbsp;<br/>　　在家里她是一个好女儿，在学校里她是一个好学生。大学毕了业后，翠远就在母校服务，担任英文助教。她现在打算利用封锁的时间改改卷子。翻开了第一篇，是一个男生做的，大声疾呼抨击都市的罪恶，充满了正义感的愤怒，用不很合文法的，吃吃艾艾的句子，骂着“红嘴唇的卖淫妇……大世界……下等舞场与酒吧间”。翠远略略沉吟了一会，就找出红铅笔来批了一个“Ａ”字。若在平时，批了也就批了，可是今天她有太多的考虑的时间，她不由地要质问自己，为什么她给了他这么好的分数：不问倒也罢了，一问，她竟涨红了脸。她突然明白了：因为这学生是胆敢这么毫无顾忌地对她说这些话的唯一的一个男子。&nbsp;<br/>　　&nbsp;<br/>　　 他拿她当做一个见多识广的人看待；他拿她当做一个男人，一个心腹。他看得起她。翠远在学校里老是觉得谁都看不起她——从校长起，教授、学生、校役……学生们尤其愤慨得厉害：“申大越来越糟了！一天不如一天！用中国人教英文，照说，已经是不应当，何况是&nbsp;没有出过洋的中国人！”翠远在学校里受气，在家里也受气。吴家是一个新式的，带着宗教背景的模范家庭。家里竭力鼓励女儿用功读书，一步一步往上爬，爬到了顶儿尖儿上——一个二十来岁的女孩子在大学里教书！打破了女子职业的新纪录。然而家长渐渐对她失掉了兴趣，宁愿她当初在书本上马虎一点，匀出点时间来找一个有钱的女婿。&nbsp;<br/>　　&nbsp;<br/>　　她是一个好女儿，好学生。她家里都是好人，天天洗澡，看报，听无线电向来不听申曲滑稽京戏什么的，而专听贝多芬瓦格涅的交响乐，听不懂也要听。世界上的好人比真人多……翠远不快乐。&nbsp;<br/>　　&nbsp;<br/>　　 生命像圣经，从希伯莱文译成希腊文，从希腊文译成拉丁文，从拉丁文译成英文，从英文译成国语。翠远读它的时候，国语又在她脑子里译成了上海话。那未免有点隔膜。&nbsp;<br/>　　&nbsp;<br/>　　 翠远搁下了那本卷子，双手捧着脸。太阳滚热地晒在她背脊上。&nbsp;<br/>　　&nbsp;<br/>　　 隔壁坐着个奶妈，怀里躺着小孩，孩子的脚底心紧紧抵在翠远的腿上。小小的老虎头红鞋包着柔软而坚硬的脚……&nbsp;<br/>　　&nbsp;<br/>　　 这至少是真的。&nbsp;<br/>　　&nbsp;<br/>　　电车里，一位医科学生拿出一本图画簿，孜孜修改一张人体骨骼的简图。其他的乘客以为他在那里速写他对面盹着的那个人。大家闲着没事干，一个一个聚拢来，三三两两，撑着腰，背着手，围绕着他，看他写生。拎着熏鱼的丈夫向他妻子低声道：“我就看不惯现在兴的这些立体派，印象派！”他妻子附耳道：“你的裤子！”&nbsp;<br/>　　&nbsp;<br/>　　 那医科学生细细填写每一根骨头，神经，筋络的名字。有一个公事房里回来的人将折扇半掩着脸，悄悄向他的同事解释道：“中国画的影响。现在的西洋画也时兴题字了，倒真是‘东风西渐’！”&nbsp;<br/>　　&nbsp;<br/>　　 吕宗桢没凑热闹，孤零零地坐在原处。他决定他是饿了。&nbsp;<br/>　　&nbsp;<br/>　　大家都走开了，他正好从容地吃他的菠菜包子，偏偏他一抬头，瞥见了三等车厢里有他一个亲戚，是他太太的姨表妹的儿子。他恨透了这董培芝。培芝是一个胸怀大志的清寒子弟，一心只想娶个略具资产的小姐。吕宗桢的大女儿今年方才十三岁，已经被培芝睃在眼里，心里打着如意算盘，脚步儿越发走得勤了。吕宗桢一眼望见了这年青人，暗暗叫声不好，只怕培芝看见了他，要利用这绝好的机会向他进攻。若是在封锁期间和这董培芝困在一间屋子里，这情形一定是不堪设想！&nbsp;<br/>　　&nbsp;<br/>　　 他匆匆收拾起公事皮包和包子，一阵风奔到对面一排座位上，坐了下来。现在他恰巧被隔壁的吴翠远挡住了，他表侄绝对不能够看见他。翠远回过头来，微微瞪了他一眼。糟了！这女人准是以为他无缘无故换了一个座位，不怀好意。他认得出那被调戏的女人的脸谱——脸板得纹丝不动，眼睛里没有笑意，嘴角也没有笑意，连鼻洼里都没有笑意，然而不知道什么地方有一点颤巍巍的微笑，随时可以散布开来。觉得自己太可爱了的人，是熬不住要笑的。&nbsp;<br/>　　&nbsp;<br/>　　 该死，董培芝毕竟看见了他，向头等车厢走过来了，满卑地，老远地就躬着腰，红喷喷的长长的面颊，含有僧尼气息的灰布长衫——一个吃苦耐劳，守身如玉的青年，最合理想的乘龙快婿。宗桢迅疾地决定将计就计，顺水推舟，伸出一只手臂来搁在翠远背后的窗台上，&nbsp;不声不响宣布了他的调情的计划。他知道他这么一来，并不能吓退了董培芝，因为培芝眼中的他素来是一个无恶不作的老年人。由培芝看来，过了三十岁的人都是老年人，老年人都是一肚子的坏。培芝今天亲眼看见他这样下流，少不得一五一十要去报告给他太太听——气气他太太也好！谁叫她给他弄上这么一个表侄！气，活该气！&nbsp;<br/>　　&nbsp;<br/>　　 他不怎么喜欢身边这女人。她的手臂，白倒是白的，像挤出来的牙膏。她的整个的人像挤出来的牙膏，没有款式。&nbsp;<br/>　　&nbsp;<br/>　　 他向她低声笑道：“这封锁，几时完哪？真讨厌！”翠远吃了一惊，掉过头来，看见了他搁在她身后的那只胳膊，整个身子就僵了一僵，宗桢无论如何不能容许他自己抽回那只胳膊。他的表侄正在那里双眼灼灼望着他，脸上带着点会心的微笑。如果他夹忙里跟他表侄对一对眼光，也许那小子会怯怯地低下头去——处女风韵的窘态；也许那小子会向他挤一挤眼睛——谁知道？&nbsp;<br/>　　&nbsp;<br/>　　 他咬一咬牙，重新向翠远进攻。他道：“您也觉着闷罢？&nbsp;<br/>　　&nbsp;<br/>　　我们说两句话，总没有什么要紧！我们——我们谈谈！”他不由自主的，声音里带着哀恳的调子。翠远重新吃了一惊，又掉回头来看了他一眼。他现在记得了，他瞧见她上车的——非常戏剧化的一刹那，但是那戏剧效果是碰巧得到的，并不能归功于她。他低声道：“你知道么？我看见你上车，前头的玻璃上贴的广告，撕破了一块，从这破的地方我看见你的侧面，就只一点下巴。”是乃络维奶粉的广告，画着一个胖孩子，孩子的耳朵底下突然出现了这女人的下巴，仔细想起来是有点吓人的。“后来你低下头去从皮包里拿钱，我才看见你的眼睛，眉毛，头发。”拆开来一部分一部分地看，她未尝没有她的一种风韵。&nbsp;<br/>　　&nbsp;<br/><br/>　　翠远笑了。看不出这人倒也会花言巧语——以为他是个靠得住的生意人模样！她又看了他一眼。太阳光红红地晒穿他鼻尖下的软骨。他搁在报纸包上的那只手，从袖口里出来，黄色的，敏感的——一个真的人！不很诚实，也不很聪明，但是一个真的人！她突然觉得炽热，快乐。她背过脸去，细声道：“这种话，少说些罢！”&nbsp;<br/>　　&nbsp;<br/>　　宗桢道：“嗯？”他早忘了他说了些什么。他眼睛盯着他表侄的背影——那知趣的青年觉得他在这儿是多余的，他不愿得罪了表叔，以后他们还要见面呢，大家都是快刀斩不断的好亲戚；他竟退回三等车厢去了。董培芝一走，宗桢立刻将他的手臂收回，谈吐也正经起来。他搭讪着望了一望她膝上摊着的练习簿，道：“申光大学……您在申光读书！”&nbsp;<br/>　　&nbsp;<br/>　　 他以为她这么年青？她还是一个学生？她笑了，没做声。&nbsp;<br/>　　&nbsp;<br/>　　 宗桢道：“我是华济毕业的。华济。”她颈子上有一粒小小的棕色的痣，像指甲刻的印子。宗桢下意识地用右手捻了一捻左手的指甲，咳嗽了一声，接下去问道：“您读的是哪一科？”&nbsp;<br/>　　&nbsp;<br/>　　翠远注意到他的手臂不在那儿了，以为他态度的转变是由于她端凝的人格，潜移默化所致。这么一想，倒不能不答话了，便道：“文科。您呢？”宗桢道：“商科。 ”他忽然觉得他们的对话，道学气太浓了一点，便道：“当初在学校里的时候，忙着运动，出了学校，又忙着混饭吃。书，简直没念多少！”翠远道：“你公事忙么？”宗桢道：“忙得没头没脑。早上乘电车上公事房去，下午又乘电车回来，也不知道为什么去，为什么来！我对于我的工作一点也不感到兴趣。说是为了挣钱罢，也不知道是为谁挣的！”翠远道：“谁都有点家累。”&nbsp;<br/>　　&nbsp;<br/>　　 宗桢道：“你不知道——我家里——咳，别提了！”翠远暗道：&nbsp;<br/>　　&nbsp;<br/>　　 “来了！他太太一点都不同情他！世上有了太太的男人，似乎都是急切需要别的女人的同情。”宗桢迟疑了一会，方才吞吞吐吐，万分为难地说道：“我太太——一点都不同情我。”<br/>　　&nbsp;<br/>　　翠远皱着眉毛望着他，表示充分了解。宗桢道：“我简直不懂我为什么天天到了时候就回家去。回到哪儿去？实际上我是无家可归的。”他褪下眼镜来，迎着亮，用手绢予拭去上面的水渍，道：“咳！混着也就混下去了，不能想——就是不能想！”近视眼的人当众摘下眼镜子，翠远觉得有点秽亵，仿佛当众脱衣服似的，不成体统。宗桢继续说道：“你——你不知道她是怎么样的一个女人！”翠远道：“那么，你当初……”宗桢道：“当初我也反对来着。她是我母亲给订下的。&nbsp;<br/>　　&nbsp;<br/>　　 我自然是愿意让我自己拣，可是……她从前非常的美……我那时又年青……年青的人，你知道……”翠远点点头。&nbsp;<br/>　　&nbsp;<br/>　　宗桢道：“她后来变成了这么样的一个人——连我母亲都跟她闹翻了，倒过来怪我不该娶了她！她……她那脾气——她连小学都没有毕业。”翠远不禁微笑道：“ 你仿佛非常看重那一纸文凭！其实，女子教育也不过是那么一回事！”她不知道为什么她说出这句话来，伤了她自己的心。宗桢道：“当然哪，你可以在旁边说风凉话，因为你是受过上等教育的。你不知道她是怎么样的一个——”他顿住了口，上气不接下气，刚戴上了眼镜子，又褪下来擦镜片。翠远道：“你说得太过分了一点罢？”宗桢手里捏着眼镜，艰难地做了一个手势道：&nbsp;<br/>　　&nbsp;<br/>　　 “你不知道她是——”翠远忙道：“我知道，我知道。”她知道他们夫妇不和，决不能单怪他太太，他自己也是一个思想简单的人。他需要一个原谅他，包涵他的女人。&nbsp;<br/>　　&nbsp;<br/>　　 街上一阵乱，轰隆轰隆来了两辆卡车，载满了兵。翠远与宗桢同时探头出去张望；出其不意地，两人的面庞异常接近。在极短的距离内，任何人的脸都和寻常不同，像银幕上特写镜头一般的紧张。宗桢和翠远突然觉得他们俩还是第一次见面。在宗桢的眼中，她的脸像一朵淡淡几笔的白描牡丹花，额角上两三根吹乱的短发便是风中的花蕊。&nbsp;<br/>　　&nbsp;<br/>　　 他看着她，她红了脸，她一脸红，让他看见了，他显然是很愉快。她的脸就越发红了。&nbsp;<br/>　　&nbsp;<br/>　　 宗桢没有想到他能够使一个女人脸红，使她微笑，使她背过脸去，使她掉过头来。在这里，他是一个男子。平时，他是会计师，他是孩子的父亲，他是家长，他是车上的搭客，他是店里的主顾，他是市民。可是对于这个不知道他的底细的女人，他只是一个单纯的男子。&nbsp;<br/>　　&nbsp;<br/>　　他们恋爱着了。他告诉她许多话，关于他们银行里，谁跟他最好，谁跟他面和心不和，家里怎样闹口舌，他的秘密的悲哀，他读书时代的志愿……无休无歇的话，可是她并不嫌烦。恋爱着的男子向来是喜欢说，恋爱着的女人向来是喜欢听。恋爱着的女人破例地不大爱说话，因为下意识地她知道：男人彻底地懂得了一个女人之后，是不会爱她的。&nbsp;<br/>　　&nbsp;<br/>　　 宗桢断定了翠远是一个可爱的女人——白，稀薄，温热，像冬天里你自己嘴里呵出来的一口气。你不要她，她就悄悄地飘散了。她是你自己的一部分，她什么都懂，什么都宽宥你。你说真话，她为你心酸；你说假话，她微笑着，仿佛说：&nbsp;<br/>　　&nbsp;<br/>　　 “瞧你这张嘴！”&nbsp;<br/>　　&nbsp;<br/>　　宗桢沉默了一会，忽然说道：“我打算重新结婚。”翠远连忙做出惊慌的神气，叫道：“你要离婚？那……恐怕不行罢？”&nbsp;<br/>　　&nbsp;<br/>　　 宗桢道：“我不能够离婚。我得顾全孩子们的幸福。我大女儿今年十三岁了，才考进了中学，成绩很不错。”翠远暗道：&nbsp;<br/>　　&nbsp;<br/>　　 “这跟当前的问题又有什么关系？”她冷冷地道：“哦，你打算娶妾。”宗桢道：“我预备将她当妻子看待。我——我会替她安排好的。我不会让她为难。”翠远道：“可是，如果她是个好人家的女孩子，只怕她未见得肯罢？种种法律上的麻烦……”宗桢叹了口气道：“是的。你这话对。我没有这权利。&nbsp;<br/>　　&nbsp;<br/>　　我根本不该起这种念头……我年纪也太大了。我已经三十五了。”翠远缓缓地道：“其实，照现在的眼光看来，那倒也不算大。”宗桢默然。半晌方说道：“你…… 几岁？”翠远低下头去道：“二十五。”宗桢顿了一顿，又道：“你是自由的么？”翠远不答。宗桢道：“你不是自由的。即使你答应了，你的家里人也不会答应的，是不是？……是不是？”&nbsp;<br/>　　&nbsp;<br/>　　 翠远抿紧了嘴唇。她家里的人——那些一尘不染的好人——她恨他们！他们哄够了她。他们要她找个有钱的女婿，宗桢没有钱而有太太——气气他们也好！气，活该气！&nbsp;<br/>　　&nbsp;<br/>　　 车上的人又渐渐多了起来，外面许是有了“封锁行将开放”的谣言，乘客一个一个上来，坐下，宗桢与翠远给他们挤得紧紧的，坐近一点，再坐近一点。&nbsp;<br/>　　&nbsp;<br/>　　宗桢与翠远奇怪他们刚才怎么这样的糊涂，就想不到自动地坐近一点，宗桢觉得她太快乐了，不能不抗议。他用苦楚的声音向她说：“不行！这不行！我不能让你牺牲了你的前程！你是上等人，你受过这样好的教育……我——我又没有多少钱，我不能坑了你的一生！”可不是，还是钱的问题。他的话有理。翠远想道：“完了。 ”以后她多半是会嫁人的，可是她的丈夫决不会像一个萍水相逢的人一股的可爱——封锁中的电车上的人……一切再也不会像这样自然。再也不会……呵，这个人，这么笨！这么笨！她只要他的生命中的一部分，谁也不希罕的一部分。他白糟蹋了他自己的幸福。那么愚蠢的浪费！她哭了，可是那不是斯斯文文的，淑女式的哭。她简直把她的眼泪唾到他脸上。他是个好人——世界上的好人又多了一个！&nbsp;<br/>　　&nbsp;<br/>　　 向他解释有什么用？如果一个女人必须倚仗着她的言语来打动一个男人，她也就太可怜了。&nbsp;<br/>　　&nbsp;<br/>　　宗桢一急，竟说不出话来，连连用手去摇撼她手里的阳伞。她不理他。他又去摇撼她的手，道：“我说——我说——这儿有人哪！别！别这样！等会儿我们在电话上仔细谈。你告诉我你的电话。”翠远不答。他逼着问道：“你无论如何得给我一个电话号码。”翠远飞快地说了一遍道：“七五三六九。”&nbsp;<br/>　　&nbsp;<br/>　　 宗桢道：“七五三六九？”她又不做声了。宗桢嘴里喃喃重复着：“七五三六九，”伸手在上下的口袋里掏摸自来水笔，越忙越摸不着。翠远皮包里有红铅笔，但是她有意地不拿出来。&nbsp;<br/>　　&nbsp;<br/>　　 她的电话号码，他理该记得。记不得，他是不爱她，他们也就用不着往下谈了。&nbsp;<br/>　　&nbsp;<br/>　　 封锁开放了。“叮玲玲玲玲玲”摇着铃，每一个“玲”字是冷冷的一点，一点一点连成一条虚线，切断时间与空间。&nbsp;<br/>　　&nbsp;<br/>　　一阵欢呼的风刮过这大城市。电车当当当往前开了。宗桢突然站起身来，挤到人丛中，不见了。翠远偏过头去，只做不理会。他走了。对于她，他等于死了。电车加足了速力前进，黄昏的人行道上，卖臭豆腐干的歇下了担子，一个人捧着文王神卦的匣子，闭着眼霍霍地摇。一个大个子的金发女人，背上背着大草帽，露出大牙齿来向一个意大利水兵一笑，说了句玩笑话。翠远的眼睛看到了他们，他们就活了，只活那么一刹那。车往前当当地跑，他们一个个的死去了。&nbsp;<br/>　　&nbsp;<br/>　　 翠远烦恼地合上了眼。他如果打电话给她，她一定管不住她自己的声音，对他分外的热烈，因为他是一个死去了又活过来的人。&nbsp;<br/>　　&nbsp;<br/>　　 电车里点上了灯，她一睁眼望见他遥遥坐在他原先的位子上。她震了一震——原来他并没有下车去！她明白他的意思了：封锁期间的一切，等于没有发生。整个的上海打了个盹，做了个不近情理的梦。&nbsp;<br/>　　&nbsp;<br/>　　 开电车的放声唱道：“可怜啊可怜！一个人啊没钱！可怜啊可……”一个缝穷婆子慌里慌张掠过车头，横穿过马路。开电车的大喝道：“猪猡！”&nbsp;<br/>　　&nbsp;<br/>　　 吕宗桢到家正赶上吃晚饭。他一面吃一面阅读他女儿的成绩报告单，刚寄来的。他还记得电车上那一回事，可是翠远的脸已经有点模糊——那是天生使人忘记的脸。他不记得她说了些什么，可是他自己的话他记得很清楚——温柔地：&nbsp;<br/>　　 “你——几岁？”慷慨激昂地：“我不能让你牺牲了你的前程！”&nbsp;<br/>　　&nbsp;<br/>　　饭后，他接过热手巾，擦着脸，踱到卧室里来，扭开了电灯。一只乌壳虫从房这头爬到房那头，爬了一半，灯一开，它只得伏在地板的正中，一动也不动。在装死么？在思想着么？整天爬来爬去，很少有思想的时间罢？然而思想毕竟是痛苦的。宗桢捻灭了电灯，手按在机括上，手心汗潮了，浑身一滴滴沁出汗来，像小虫子痒痒地在爬。他又开了灯，乌壳虫不见了，爬回窠里去了。&nbsp;<br/>　　&nbsp;<br/>　　 （一九四三年八月）张爱玲</p><p><br/></p><p>							</p>','张爱玲','封锁','电车里点上了灯，她一睁眼望见他遥遥坐在他原先的位子上。她震了一震——原来他并没有下车去！她明白他的意思了：封锁期间的一切，等于没有发生。整个的上海打了个盹，做了个不近情理的梦。 ','转载',0,320,1),(150,1497370687,1497443905,1497370687,'<p>								</p><p>6月1日 晴天？<br/></p><p>离家已三天。</p><p>下班了，我听到黄绮珊的《灯塔》，想起了我和父亲在医院的时光。有天早上我们照例去的很早，那时护士长还没来查房，我给父亲放了云飞的歌。一会，他坐起身，摘下耳机递给我，说：“你听这首歌看看，听了告诉我有什么感受。”他说这话的时候是笑着的，我感觉他的眼里，嘴角和声音里都是父爱，这中间还夹着几分对我对这音乐的评价的期待。我极认真地听完了这首歌曲：《天边》。我对他说：“这首歌里包含了很多的东西，有壮志豪情，有对自由生活的向往，有对爱情和家庭生活的憧憬——”。他打断我：“对美好生活的向往！”“对！”，我表示赞同，笑了，他也笑了。</p><p>我们一起听过这些歌，我再独自听的时候，我们便也是在一起的了。今天晚上我跑步，伴着这些歌，仿佛他在身边。</p><p>今天我在海淀黄庄换乘地铁的时候，我就在想：我一定要留住这些我们在一起的时光，我怕我有一天忘了这些细节，而实际上我正在忘记！生活大多是柴米油盐的平淡日子，这样的日子太容易叫人忘记了，可是有亲人相伴的平淡日子是真幸福的啊！</p><p>我早就要记录的，也记录了一部分，可原本计划中的这些时间都让给了和亲人们的相伴。这大多是下半夜的时候了，我们可能就是看着电视，有一句没一句的瞎聊，可我就是喜欢。</p><p>今天，我跟朋友借了一万，转给在家里照顾父亲的大姐。后来我又不得不要回来4000过自己的生活。二姐说我做决定太过冲动。我说不要乱给人贴标签。</p><p>&nbsp;</p><p>5月22日 晴？</p><p>晚上吃完饭，父亲和我去家附近的邮局取了3000块钱，放在我的钱包，明天就要去医院了。父亲母亲知道我的为难，他们不愿意花我的钱，而我也是不愿他们看病花自己的钱的，但我不懂得说服人。</p><p>&nbsp;</p><p>5月23日 晴</p><p>今天我们都起得很早，差不多6点半。大姐夫也很早就来了。妻子不愿带小孩去医院，哄小孩子去超市了。父亲母亲，涛哥和我，我们4人坐公交车去的医院。父亲今天大概穿了一件黑白相间的条纹短袖，衣服插在裤带里，下身着西裤和皮鞋。父亲在我眼中向来是个潇洒的人，仪表堂堂，谈吐不凡。</p><p>我们拿着病例和一些之前的检查结果直接去门诊找医生看的病。还不等医生开口，父亲便对医生说：“我这是石头。”医生没搭他的话，看完片子和相关报告，建议住院做进一步检查。我们出了诊室往楼下走，母亲却偷偷回去咨询医生，父亲发现了就回来埋怨母亲，说都问过了又去问什么？我想他是害怕我们又瞒着他的病情，这让他很多时候变得急躁。他有坏情绪的时候，都给了母亲，而母亲只默默地忍受了。她只希望他能多陪她些日子。她曾多次对我说：“现在我学会了忍耐。他这样，我也不敢跟他计较，怕他心情更不好。”我发现今天来医院，她的神色跟昨天大不一样，劳累，哀伤，眼睛里覆了一层泪的波浪。我肯定她是偷偷背着我们哭过了。后来我知道，她一夜没合眼的。</p><p>我们到外科13楼办了住院手续。趁父亲不在的时候，母亲告诉我：“医生说他长东西了，一多半是那个东西”。安排好父亲的病房和床位后，我和涛哥一起去内科一楼去缴的费。交了2000的押金，刷的我的卡。这些钱是我今天早上从借呗里借出来的一部分。在来之前，母亲是绝不同意用我的钱的，他知道我的近况。她说：“我很高兴你是为的有钱的难。我们现在还有些积蓄，先用，等实在不够了才用你们的。”</p><p>三姐知道父亲住院，通过微信转给我2000。</p><p>早上10点多的时候姨姐仙君过来看父亲。中午没有安排治疗，她请我们到外边吃饭。餐馆是一家地道的天门餐馆。她点了几样大菜，有油焖大虾，田鸡，杂鱼火锅，团子等等。菜的味道是很不错的。趁姨姐不注意的时候，我去把帐结了，花了468块。末了，她去结账，回来时有些尴尬，硬是塞给我500块。</p><p>下午，医生没有安排父亲做任何检查和治疗，晚些的时候，我们都回家了，父亲一个人在医院过夜。在回家的路上我就后悔，父亲一个人在医院该多无聊啊。后来我问他这晚睡得怎么样，他告诉我晚上蚊子很多，睡不好。我很奇怪，病房里这么多人怎么没人去买蚊香呢？</p><p>&nbsp;</p><p>5月24 晴</p><p>母亲一大早就去卖菜了。6点多就给我打电话，说费伯要开车去看父亲，叫我早起床准备和他一起去。</p><p>一会，涛哥也过来了。小孩子的妈妈还在睡觉，我和涛哥带着小孩子去市场上吃早餐，我付的钱。吃完又给小孩子买了一个玩具。回到家，费伯已经在那里等了。放下东西我们三人就上了费伯的车。</p><p>到了医院，带费伯见到父亲，我就去办农村合作医疗的手续了。回来的时候，费伯已经走了。后来父亲跟我说费伯给了他200块钱。</p><p>费伯走了不久，标伯伯就过来了，他是我的姨父，是昨天请我们吃饭的姨姐的父亲，这家人是我们走得最近的亲戚。</p><p>中午，还是在昨天那个餐厅，我们请这位伯伯吃饭。这位伯伯特别朴素，不让我们多点，大多是蔬菜，和鱼，这顿饭才花了186，我付的钱。</p><p>下午医生没有安排，我们问过医生后就家去了。</p><p>到家差不多3点左右，妻子说想去钓龙虾，小孩子也想去。父亲听了，说：“隔壁的继普前几天就在附近的沟里钓了两斤。”说着还去隔壁问了。继普不在家，他媳妇给我们指了方向，还告诉我们在她家后门口的坡地那儿可以挖到蚯蚓。我们回家里拿了锹和一个用来盛蚯蚓的生了锈的铁盒，走到坡地，父亲挖，我捡，不一会我们就挖了好几条。然后，我们在后院找了三根树枝，分别系上绳子和蚯蚓。一切准备工作做好了，我们戴上草帽，拿了桶，就出发了。继普的媳妇带着孩子，也跟着一起过来了。</p><p>这是一块大约长5米宽1.5米的小水坑，手掌深的水。我们去的时候看到好多的龙虾歇在水面上的草边。等我们走近，它们便惊得不见了踪影。大多的龙虾都比较傻，它们一看到蚯蚓就一股脑地冲上来，用它们的大钳子夹了往嘴里塞，我们把它们提到岸上它们也不松开，必须把它们重重地跌在桶里它们才肯放手。妻子钓的非常开心，她说这是她回来过得最开心的一天。</p><p>小孩子总是无常兴的，钓了一会，便失去了耐心，说要去找她爷爷。他爷爷本是同来的，不过来一会就说要帮我们看看还有没有别的可钓的地方，说着就走了。我和妻子钓的高兴，就由他们去了。钓了差不多两个小时，收获约两斤。</p><p>傍晚，妻子做饭，母亲去水田里了。饭快做好的时候，我去水田喊她回来吃饭。我见她的时候，她正在去对岸不远的水田里，佝着腰，拿一根顶上套着一个编织袋的竹竿，贴着水田的表面轻缓地挥着。她把裤腿卷过膝盖，每走一步腿都会陷进约莫齐膝盖的淤泥里。我见她这样很心疼，说：“我来帮你弄一下吧。”这是一件非常不容易且脏的事，我在说这话的时候竟然没有十足的要跳进这水田的冲动。她肯定是拒绝我的帮忙的。她的动作很均匀，每走一步，从左糊到右，到边上了，再打回来。我问她：“这是做什么？”她说：“刚撒下的种子，浮在面上，如果不用泥巴盖着点，就被鸟吃掉许多了。”“原来是这样，”，我说：“怪不得看到那边那么多鸟在水田里。”</p><p>我坐在水田的边上看她糊田。她仍同我讲那些她对我说过无数遍的话：“这么大的房子，要是他不在了，我一个人该怎么过？”此时此刻，我打着这些文字，想起小时候他们那些打架的情景。年轻的时候闹过那么多次离婚的人，到老来，尽管仍不时的争吵，却是再也离不开彼此了。少来夫妻老来伴，说的就是这样吧。</p><p>糊完田，她还要给水田开两道纵着的浅沟，让多余的水从这两条线流出田外。她用绳子拉着一个坛子在水田里走，这样水田里就画出了线。我看她有些吃力的时候，有几次还差点跌倒。我现在很恼自己的“问这问那而无所作为”，以后再有这样的情形，我定要脱了鞋就往这坑里跳的。</p><p>差不多快弄完了，爸爸和涛哥还有天骄过来了。父亲插着腰站在田埂上看着母亲，我很能感受到父亲的相帮而又无能为力，我感受到他们对彼此深深的关爱。</p><p>&nbsp;</p><p>5月25日 晴</p><p>涛哥今天走了。我很感激涛哥这两天为我们做的一切。他待爸爸妈妈跟亲生的爸妈一样，回家才几天时间，大多的时间在我们这边了。是啊，本来就是一家人了。希望他和大姐能拥有持久的幸福。</p><p>我和父亲骑摩托车去的医院。到市区之前是我载着他，到市区之后，他便要载着我，说市区交通复杂，担心我处理不好，我没与他争。再有这样的事，我当要争。我载着他时觉得自己是个成年人，他载着我时我便是个孩子了。这样与父亲的骑行，竟真是成了最后一次。想到这，我感觉痛，痛的电流从头上掠过肩膀，到心上，宛若刀扎！</p><p>下午仍没有安排治疗。回来的时候，我坚持载他过市区，他说我最快开到了65公里每小时。</p><p>晚上大家都睡了，妻子拉着我聊天，不让我睡觉。我们窝在沙发上，说对方的优缺点。我说：“你的优点很多：勤劳，美丽，孝顺，聪明，单纯，你唯一的缺点就是脾气有些大。”她说：“你的缺点就是不听别人意见。”“这是优点好不好？这说明我有主见。”我又说：“其实你的衣品可以提高一些。”说这话的时候我有些自责，我该主动陪她去买衣服的。这些年尽在网上买衣服了，这是我的不是。她说：“我早就想衣服了，你得陪我一起去看。“我答应了。</p><p>&nbsp;</p><p>5月26日 晴</p><p>上午我像前几日一样陪父亲来医院挂针。医生告知我们今天下午两点半做膀胱镜手术。挂上针后，妻子打电话来说要我陪她去买衣服，我让她过来。她下车后，我跟父亲说好就去会她了。女儿也一起来了，我们一家三口在天门的街道上逛。</p><p>妻子的身材是很好的，穿长裙特别的漂亮。有一件藏蓝色，点着白梅的棉麻料的长裙，上面有些衬衫的样子，下面是大小到正合适的裙摆，她穿着特别有一种东方女人的温婉。我有意要买给她，但她说穿这衣服老得端着，就没有买。后来我们又看中了一条混黄色，纱纺料的分体长裙，她穿着就像是在海边度假的感觉。她问我这两条哪个好，我说都好，都买下都可以，一条比较淑女，一条出去旅游。可是后来她一件也没要，说要再看看。我们去到另一家店，她试的第一件衣服就让大家都很惊艳。应是雪纺的衣服，新款式，好料子。但她说腰那里的布料磨着人有些疼，于是3个店员轮番的想要说服他，有的说是因为新衣服，过一下水就好了，更有一位说是可以直接先买了，体验一下这种风格的衣服，不穿的话放着就可以了。她问我的意见时，我在心里有些埋怨她的“问题多”，不愿再给意见，于是我说：“衣服穿着很好看，要不要你自己做决定。”过了一会我觉出自己的不是，觉得自己不够有耐心，而且我的话里有让她买了这一件的暗示，但我可能忽略了她穿着不舒服的事实，于是我温柔地对她说：“你自己做决定，买不买都行，要是穿着不舒服就别买。”她确定穿着不舒服，于是我们放弃了这条视觉上很惊艳的裙子。</p><p>后来我们回去买了那条假日风的，还有另一条也是十分时尚的长裙。有一日我学车，她带着墨镜，穿着这身衣服来接我，风吹起她的裙摆，美极了。</p><p>除了两条裙子，我还给妻子买了两双鞋子，一双NB运动鞋，一双白色的皮质平底鞋。</p><p>买完衣服已经快下午两点了，我们带小孩子一起吃了炸鸡和薯条，不好吃，这样的食品以后还是少吃为妙。吃到一半我很着急，担心赶不上父亲的膀胱经手术，就先去了医院。</p><p>我刚走到病房门口，恰好碰到父亲的主治医生杨大夫迎面向我走来。杨大夫说让我带着父亲到12楼的手术室门口等候做手术。</p><p>手术室门口有一排座椅，3个凳子，坐满了人。这些人都是来做膀胱镜手术的。每过几分钟医生便会叫一个病人的名字，然后再过几分钟叫家属给扶出来。</p><p>父亲进去的时间是最长的，超过了半个小时。终于听到医生喊：“阮泽兵的家属！”我急忙冲进去，发现父亲还躺在手术台上，有些被失礼地，当着众多的医护人员。因此我扶他起来时很有些慌乱，同时内心感到很气愤，至少在这家医院，医生对病人的尊重是没有的，我为它们的职业素养感到羞愧！</p><p>我和母亲扶父亲坐定后一会，医生出来了，他叫我跟着他去送一下膀胱镜的切片检查。上楼梯的时候，我问医生情况，医生说根据经验判断是肿瘤，还需要做了切片的病理分析后才能确诊。尽管我早猜测到是这样，但我仍然很接受不了。</p><p>接检的科室一个人都看不见，鬼寂的很。窗口有个门铃，按了，过了一会有个年轻的男医生探出头来，接了切片就准备要往屋内走。我让他等会，我又拿回放病理切片的小杯子看了看里面的切片，这就是要父亲命的东西。</p><p>送完检，我给二姐打了个电话，跟她说了情况。我不知道怎么去面对父亲。过了好久我才回到病房，我假装没什么事，说：“已经送过去了，要过<span style=\"font-family:Calibri\">4</span>到<span style=\"font-family:Calibri\">5</span>天才能出结果。”父亲说：“出了结果很快就能出院了。”听了这句话我的心很痛，但我不能表现出来。我说：“先看看结果再说。”</p><p>今天因为做膀胱镜的缘故，父亲吃完早餐后就不能吃也不能喝。手术后两个小时内也不让吃喝。他饿得很，几次说有些晕。</p><p>晚上六点多，我离开医院，母亲陪父亲在医院过夜。</p><p>&nbsp;</p><p>5月27日 晴</p><p>我还没睡醒，母亲就回来了。我问她在医院睡得怎样。她说她一夜未眠，说着她就要哭：“怎么睡得着啊？”。我劝她：“你不是总要我们坚强吗？你自己要保重，就当为了我们几个孩子。”但无济于事的，哀伤占据了她的全部思绪。她告诉我，标伯伯早上去医院看爸爸去了，所以她回来了。</p><p>吃完饭，我又去了医院。我到病房时，标伯伯还在。</p><p>下午医院没有安排，输完液，我和父亲就回家了。</p><p>回到家，他又下地了。没有人敢告诉他真实的病情。</p><p>晚上父亲想看歌唱节目《越战越勇》里王伟的表演，于是我拿了电脑和他到二姐的房间看。不知道什么时候妈妈过来了，我们三个一边看，一边议论王伟的表演和经历。我突然想起姐姐们“埋怨”我发家里的照片少，于是我提议照了了一张合照。</p><p><img src=\"/ueditor/php/upload/image/20170614/1497443656320131.png\" title=\"1497443656320131.png\" alt=\"image.png\" width=\"711\" height=\"547\"/></p><p>&nbsp;</p><p>5月28日 晴</p><p>明天我就要离开了。大家提前过端午节。母亲把哲哲的爷爷叫过来一起过节了。晚上吃完饭，我们一家人躺在沙发上看电视。</p><p>父亲拍了拍我的腿，说：“明天就要走了！”我说：“是啊！还没玩够。”于是我觉出他对我的不舍，我又何尝不是？</p><p>他乏的快，9点左右下楼去睡了。母亲对我说：“今天下午，哲哲的爷爷躺在凉椅上睡觉，我对他说：‘文武，你这样睡不怕着凉？’”。听她说这话，我吓得紧，她必是神情恍惚的很，才能将哲哲的爷爷看成我。</p><p>&nbsp;</p><p>5月29日 晴</p><p>早上我骑车载着父亲，我们先去华侨客运站买了去武汉的汽车票，然后直奔医院。医生说今天没有安排，于是我们直接回家了。</p><p>回到家见到刚到家的大姐，已经从超市回来，给天骄买了一身衣服。见到大姐我很高兴，可是马上就不得不要走了。</p><p>小孩子知道她小姑要回来，不肯走了，说要留在湖北，让她大姑和小姑给她买好看的衣服。</p><p>下午5点已经到了北京。高铁上接到三姐的电话，她也已经到家了。</p><p>人生啊我耐你何？</p><p>&nbsp;</p><p>6月2日 晴</p><p>我往父亲的账上打了2000，这2000是方姐给我的微信转账。</p><p>							</p>','日志','回家的最后几天','下班了，我听到黄绮珊的《灯塔》，想起了我和父亲在医院的时光。','生活',0,181,0),(151,1497653249,1497746132,1497653249,'<p>								</p><p>回到家，下了车，岳父母在院子里乘凉。</p><p>我问他们：“还没吃饭吧？”</p><p>岳父光着膀子，“等你吃饭呢。”</p><p>我拎着包往屋里走，“以后这么晚就不要等我吃饭了，太晚了。爸您怎么不穿件衣裳，凉不凉？”</p><p>“不凉，穿衣服有点透不出气。”</p><p>岳母说：“让他穿不听。”</p><p>我看了一眼挂在墙上的时钟，刚过9点半。</p><p>开了一瓶啤酒，妻子不喝，我给岳父母各倒了一满杯，然后我自己也倒了一杯。</p><p>“妈，今天唱歌了吗？”</p><p>“哈哈，今天没唱。”</p><p>“吃完饭再唱一会？”我建议。</p><p>“哈哈，今天不唱了，准备睡觉了。”</p><p>“好吧。唱歌还挺高兴。”我咧嘴笑着说。</p><p>妻子今天做的菜很多，有咸鸭蛋，炒土豆丝，灯笼椒炒肉片，西红柿炒蛋，凉拌西红柿，炒黄瓜片还有煎豆腐。样样都很美味。</p><p>“你们知道了吗？姗姗今天被扣了3分。”</p><p>“怎么回事啊？“岳父问，有些惊讶。</p><p>“逆行。“我说。</p><p>妻子把情况大致的描述了一下，但是岳父母没能明白。于是我用几只筷子摆作车道，演示了一下。</p><p>妻子说：“我在网上查了一下，这种情况可以申诉，原本我过去是要加油的，哪里知道加油站停止服务了，我只好往前走了一段。”</p><p>“是逆行了。”岳父说。</p><p>“他们是不是没事就在看监控找违章啊？”我戏谑。</p><p>岳父有点动气，提高了嗓门：“可不是！这些人，这些罚款多少都到了一些人手中。”</p><p>“你小点声！”岳母斥责。</p><p>“告他们去！“</p><p>“不值得，为了这点钱。”我对岳父说。</p><p>“咳，你不知道，前些天，有个人因为2块钱，打了场官司，最后赢了。”</p><p>“真不值得。”我说，“为了这么点钱，耽误这么多工夫。”</p><p>“为了一口气！”</p><p>我不再评论这件事，吃一堑长一智吧。</p><p>晚上妻子骑着电动车带着小孩子去接的我。出站的时候，远远地，我看见他们。妻子开心地望着我，小孩子叫喊着：“爸爸，爸爸！”</p><p>我从“解忧杂货店”的故事中跳出来，高兴地朝他们挥手。“天骄！”</p><p>早上也是她们送的我，不过一般早上是我骑车。每次到涿州东站都会比检票时间早10多分钟。她们一定是要陪我过了这10多分钟才会走的。小孩子每次都特别舍不得我去上班，有好几次，我临要进站，她便哭，妻子不得不抱着她走开。我总是要给她们一人一个kiss goodbye，这几乎成了一个告别的仪式。今天开会，会议还没开始的时候，我们闲聊。丁玲听说我每日来回涿州，他问我：“你这样多长时间了。”</p><p>“半个月。”</p><p>他很惊讶，“你心态真好！看你能坚持多久。”</p><p>我想到妻子和小孩子每日接送我的画面：很久很久吧。</p><p>							</p>','心情','妻子和小孩子接送我上班','晚上妻子骑着电动车带着小孩子去接的我。出站的时候，远远地，我看见他们。妻子开心地望着我，小孩子叫喊着：“爸爸，爸爸！”','生活',0,281,0),(152,1497675901,1497746204,1497675901,'<p>								</p><p>每次写文章，我都是写完了再想标题，唯独这一次是例外，因为这一次我想记叙的就一件事情：我和岳父大人一起做午餐。</p><p>学完车回来，我把三轮车停好，摘了两颗杏儿，正在屋外的井边洗的时候，听到岳父大人的声音：“回来啦？”</p><p>“嗯，今天晚了点。”</p><p>我吃着杏儿，拉开大门。电扇还在吹着，前面的摇椅晃着，没见父亲人。我走进厨房，岳父大人正在切菜。</p><p>“你们吃了吗？”</p><p>“我和你妈11点就吃了。吃了点昨天剩的。”</p><p>“怎么吃的这么早？”</p><p>“你妈早上没吃早餐。”</p><p>岳父大人正在切猪肉，砧板上有一盘已经切好的蒜薹，另外一个盘子里放了4个已经除了壳的鸡蛋，还没打散。</p><p>“您歇会吧，我吃了这两个杏儿，我来炒。”</p><p>“你炒啊？”</p><p>“恩。”</p><p>我快速吃完两个杏儿，扔了核儿。天气炎热，我打开冰箱。</p><p>“喝点酒。”</p><p>岳父从厨房走出来：“这里有半瓶的，中午我跟你妈一人喝了一杯。”</p><p>“再开一只吧，这么点也不够我喝。”</p><p>我再打开一只，倒了一杯，一饮而尽。</p><p>我把肉切成丝。打开火。</p><p>“这个锅有点薄。”我发现换了我们从北京住处拿回来的那个锅。</p><p>岳父没有回答。</p><p>“就用它吧。”</p><p>我打开抽油烟机。锅烧热后，放了差不多两勺油，等油烧热，放上葱姜。闻到香味后，倒少许酱油，放入肉丝，稍翻炒，倒入蒜薹。我做这些的时候，岳父一直站在我的身后看。</p><p>“您和妈手上的钱还够用吗？”</p><p>“够用。”岳父顿了一下，又说：“稍微少点。”</p><p>“等姗姗回来，我跟她说，再给您200。”</p><p>我喜欢颠勺。第一次颠，没掌握好力度，洒出来不少菜。</p><p>“炒就行了啊！”</p><p>“我习惯颠勺。您看那些饭店的大师傅，都是这么弄的。”</p><p>“人家那是先用水焯过的。”</p><p>我老实地用锅铲翻着，偶尔再颠几下，总有掉出来的时候。炒的差不多，锅里有点干了，岳父说：“给着点水？”</p><p>“恩。”</p><p>加完水，基本是岳父来炒了。他翻得很小心，就像给小树苗培土一样。后来还闷了一小会。最后他放了盐和鸡精。鸡精放多了，我用锅铲盛出来点，扔到垃圾桶。回来，我又颠了几下，出锅了。</p><p>第二道菜是炒鸡蛋。我把鸡蛋打散的时候，岳父已经把锅里烧热并倒了油。油有点多，鸡蛋也打得很散，所以鸡蛋一放到油里就开始剧烈的膨胀起来，几乎把锅沾满了。</p><p>“你翻一下锅吧。”</p><p>“太满了，还有油。用锅铲翻一下好了。”于是我用锅铲一半一半地翻了过来。翻好就准备起锅了。我小心地把鸡蛋往盘子里扒，可是鸡蛋实在太大块，一下子翻过来，一大块掉到盘子外边，趁岳父不注意，我赶紧用手把这部分鸡蛋搂回来了。哈哈。</p><p>“爸，您再吃点吧。”</p><p>“不吃了，你吃吧。有饼。”</p><p>“这么多菜，不要主食了。”</p><p>“还有粥。”</p><p>我坐在桌边吃饭，听到他盛粥的声音，我赶紧起身去厨房接。</p><p>“谢谢爸。”</p><p>“别客气！”</p><p>我喝着粥，他又给我撕了一些饼过来，放在盘子与盘子的边缘连接的地方。</p><p>我吃着饭，他去午休去了。</p><p>原本是要午休一小时再去学车的，但我觉出一种很有必要记录的冲动，就写下了上面这篇文章。</p><p>懂得所以懂得。</p><p>							</p>','','我和岳父大人做午餐','原本是要午休一小时再去学车的，但我觉出一种很有必要记录的冲动，就写下了上面这篇文章。','生活',0,420,0),(153,1498492875,1498525968,1498492875,'<p>								</p><p>今天跟朋友聊天，说到自己的经历，便把以前写的文章几乎全看了一遍。很为以前的自己感动。这样的曾经也给现在的我十分的动力。原来自己是从这样走过来的。</p><p>并非说现在不好，恰好相反，现在的幸福是以前所不能想象的。</p><p>今天吃完饭的时候，小孩子淘气，将冰箱里的隔层扔到院子里的废旧物品堆，找不到了。她妈妈很生气，严厉地责备了她。问小孩子为什么要扔掉。小孩子说：“觉得不好看。”我跟她解释：“冰箱的隔层虽然不好看，但是还有用，所以不能扔掉。以后要是想扔什么东西，拿不定主意，可以问问大人‘这个东西能扔吗’”。我看她眼里有泪光，直直地看着她妈妈。我责备她妈妈，说她不该如此小题大做，把道理跟小孩子解释清楚就好了。小孩子觉得委屈，哇哇地哭了起来。她妈妈还要拉着她教训，最后还用力地打了她的屁股。我很生气：“你这样做太过分了！”说完我抱着小孩子到院子里和她说话。</p><p>我问她：“今天你跟那个姐姐都玩了什么？”</p><p>“我们写2了。”</p><p>“是不是写得又快又好？”</p><p>她就笑了，“我们还画了画。爸爸，你带我去高铁玩好吗？”</p><p>我想到今天答应了同事要回家做一些工作，犹豫了一下，还是愉快地答应了。</p><p>她妈妈洗完碗了，我问她：“一起去高铁吗？”</p><p>“恩。”</p><p>于是我们一家三口又来到高铁站“绕圈”了。边绕边聊边开玩笑，这就是很好的幸福了。虽然偶有不和谐的时候，但很快就会过去，就像今天发生的事情一样。</p><p>话说回到“看自己以前的文章”这件事上。看的时候，我怀疑自己是否变了，变得不那么热心，不那么“敏感”，不那么存粹...... 肯定是变了的，不过最近发生的事让我确信，现在的我仍有曾经的影子的。重要的是，那个曾经的梦想，现在“若有若无”的回来了，这让我十分的欣慰。</p><p>上个星期五晚上，我仍坐高铁回家。排队安检的时候，有个女同志拉着箱子和提包，急得跟无头苍蝇似得，这队看看，那队瞅瞅。她说她的车马上就要开了，想要插队进站。无奈人太多，两边有围栏，插不进去。见状我走出队列向她提议：“你把行李给我，你走到队头上去，我把行李递给你。”她答应了。我拉着她的行李在队伍头上等她。我想：如果我是个坏人，把她的行李拿走了呢？可见她仍然选择了相信我，这也是件很让人感动的事情。见她走过来，我把行李搬起来，越过栏杆，递给她。她向我道谢，匆匆走了。我很开心。</p><p>后来我在候车室等车。距离检票还有一段时间，我打开电脑构思小说。有个中年男人在我面前停留了一会，我瞥见好像是一张票从他兜里掉出来了。我看了他一眼，他应该是浑然不觉。见还无人提醒他，我说：“您的票掉了吗？”他这才发现，捡起票，向我道了谢。我很开心。</p><p>我也怀疑自己的文笔或者灵性不如以前。应该是这样吧，以前的自己太过存粹，总像是舍身取义的样子。尽管如此，对于“文学创作”这件事——其实我不太喜欢将自己的写作冠以“文学创作”这样的词汇——我仍然会继续下去。因为有一种温度在吸引我。</p><p>最近看的《解忧杂货铺》就有这样的温度。所以最近我在构思小说的时候，我第一点想到的不是如何去让故事更吸引人，而是这个东西出来，能否温暖人心，给人正能量。</p><p>除了温度，还有一些感动和故事，值得记录的。</p><p>我还发现，我以前看的书其实挺多的，用嗜书如命来形容以前的自己真不为过。但我不想做个书呆子，我甚至讨厌书呆子，我觉得读书应该是让一个人更加生动而不是让人更加死板。</p><p>我又想，要不是遇见这位朋友，至少我现在的幸福与希望将会少了很多很多吧。所以，向你道一声谢谢，不知道你是否也会有那份做了好事的喜悦呢？”</p><p>							</p>','心情','读过去的文章','今天跟朋友聊天，说到自己的经历，便把以前写的文章几乎全看了一遍。很为以前的自己感动。这样的曾经也给现在的我十分的动力。原来自己是从这样走过来的。','散文',0,285,0),(154,1498879131,1498879597,1498879131,'<p>								</p><p>浪失先生，</p><p>您好啊！</p><p>初次给您写信，想到要给您添麻烦，心中十分忐忑。可是心中太烦恼了，所以还是拜托您了。</p><p>我叫文武，今年31岁，上有老下有小。老人家身体都不太好，隔三差五可能就要住院。家里就我一个人上班养家，我的薪水也不怎么高。每个月付完各种账单，基本没有什么余钱。妻子认为我应该努力地工作和学习，争取换一份薪水更高的工作。我完全理解她对我的这种期望。实际上在过去的很长的一段时间，我都是这么做的。可是现在我心境发生了一些变化，让我继续像以前一样有些为难。</p><p>是因为梦想的原因。其实这是我20出头时就有的梦想。只是因为后来生活的洗礼，让我渐渐地放下来了。如今再次的找回这个梦想了，我的内心再次感受到那种拥有梦想的充实与希望。我想一直追寻下去。</p><p>我的梦想是成为一名作家。我希望能写出“著名”的作品，这样我在作品里表达的“我对人生的理解”能被更多的人知道。如果有人因为我的作品，被打动，被温暖，被改变，这将是我生命中最大的意义之一。</p><p>可是我不得不花很多的时间去学习，去工作来改善家庭的生活环境，因为现在的我，单凭创作是根本养不了家的。在写这封之前的2到3个月的时间中，我基本停止了工作技能的学习。我将大部分的精力都投入到小说的阅读和“试创作”中。同时我也不像以前那样热衷于工作了。尽管我仍然要求自己认真地工作，但是我不再愿意为工作付出更多的精力，基本每天到下班点我就离开公司。</p><p>前几天我和一个以前的同事约好吃饭，所以我订了晚上9点04分的火车回家。没想到后来他睡过了头，爽了约。确定他要爽约的时候，刚下班不久，那时我还没出公司，但是我也不愿待在公司工作和学习，而是径直去了火车站，在那里看了2个小时的书才上的车。</p><p>我把这件事告诉了妻子。妻子说我这样很不好。她说我跟以前很不一样了。没有以前积极，也没有以前快乐，老是心事重重。他告诉我一定要面对现实，理想的事情以后有钱再做就好了。</p><p>昨天早上妻子和小孩子又送我上班。在路上我们又说到这个问题。她们日日这样接送我，让我感到内心非常温暖，同时又觉得责任重大。我好像一下子放弃了梦想。我告诉自己：今天要努力地工作了！实际上我也这么做了。昨天是这么久以来头一次加班，一直到不得不走才离开公司。在进地铁站的时候，我仿佛听见内心有个声音在说：“今天心情糟糕透了！”我分析了一下原因，一来是因为比较劳累，再无精力做我的阅读和写作研究，二来是因为我不知道这样努力工作的意义，难道就是为了过更好的生活吗？您也可以理解成我不太喜欢我现在的工作。我只是不喜欢浑浑噩噩地生活。</p><p>今天是周末。早上送完小孩去学校。妻子说要和我一起学习。学习工作技能。我们面对面坐着。她学习，我却在写这样的一封信。我发现我在“写作”的时候，我是直面着自己的内心世界的，积极的，消极的，全在那里。周末的日子，一家人应该出去做一些有趣的事情才好，而不是在一起学习，为了过上更好的生活吧？</p><p>抱歉，向您说了这么多的烦恼。只是将这些烦恼写出来，心里就舒服很多了啊。我自己也该想想，是不是有两全其美的办法呢？</p><p>如果您太忙可以不必理会这封信，或者不必按照您对外说的那样“当天就回”，我也不会很快去牛奶箱去取信的。拜托您了，感激不尽。</p><p>文武</p><p>2017年7月1日 涿州</p><p>							</p>','心境','给杂货铺的第一封信','抱歉，向您说了这么多的烦恼。只是将这些烦恼写出来，心里就舒服很多了啊。我自己也该想想，是不是有两全其美的办法呢？','散文',0,161,0),(155,1499132554,1499132554,1499132554,'<p>文武，</p><p>你好。</p><p>很惊讶，第一次收到来自中国的信件，谢谢你对我这个老头子的信任。</p><p>一个人要养活一大家子人，老人家身体还不怎么好；努力地做着自己不喜欢的工作；希望通过学习换一份薪水更高的工作，改善家人的生活条件；最重要的，是想坚持自己的梦想，对吗？</p><p>真是让人头疼啊，这么多烦恼，哈哈！在日本这种情况也是很普遍呢，男子肩负着家庭的重担。大多数情况下，这也是没有办法的事情，毕竟小孩需要妻子的照顾。老人家没有养老保险吗，如果是这样的话，确实也不能不管。</p><p>如果像你所说的，通过学习能换一份薪水更高的工作，我支持你这样去做，如果在现在的公司看不到前途的话。</p><p>你说：“尽管不喜欢现在的工作，你仍然努力。”这说明你在工作上也是有责任心的，这很好。可是你为什么要不喜欢你现在的工作呢？你说你不喜欢“浑浑噩噩”的生活，如果不喜欢还要认真去做，那实际上，你不就是在“浑浑噩噩”的生活了吗？可不可以去尝试去喜欢你现在这份工作呢？去发现其中的乐趣？哪怕是很平凡的工作，只要认真地去做，都会获得别人的认可呢！</p><p>你说工作、学习和追求梦想产生了冲突。究竟是没有任何调和的余地了吗？我想你所说的主要是时间分配的问题吧。你每天在通勤上花费的时间是多少呢？这一段时间内，你可以阅读，思考，如果条件允许的话，你甚至可以写作。下班后的一两个小时，你可以留在公司工作或者学习来提高自己的专业技能，为更好的物质生活而努力。</p><p>能不能想点其他的法子，也能挣到钱呢？</p><p>周六日的话，我不建议你和妻子把时间都花在学习或者工作上，带着小朋友出去玩一玩，这样能增加家庭的幸福感，也会给你继续前进的动力的。如果实在要占用这两天的时间，也请不要太劳累自己，时间久了会感到厌倦，反而不能坚持下去。</p><p>我的建议需要你付出更多的努力，你的心必须能静下来，你的心中要时刻的看到你的两个目标。除此之外，我也想不到更好的办法了。虽然会累一点，但是心中也会更充实吧。我已经记不清楚是什么时候知道的一个人，一个美国人，他和你的梦想一样，想成为一个作家。他是那种很“狂野”的家伙，每天只睡4个小时，其他时间都用来创作，最后他果然成功了。根据你的情况来看，你是不可能这样的。不过，只要坚持下去，就有成功的可能呢！</p><p>读了你的来信，除了因为你的烦恼而“头疼”，我也“被你的文字温暖”了。因为你追求梦想的挣扎，因为你创作的初衷：希望温暖，改变到人。看看，现在我这老头子就是被你温暖了的人，我之所以做这件事，和你的初衷是一样的。尽自己的能力，对人或者事有所帮助，真是让人感到由衷的喜悦啊!</p><p>最后希望你能拿走自己的烦恼，就像取下头顶的帽子那样，哈哈，因为生活还是开心的继续为好。</p><p>和你通信很愉快，希望你一切顺利。如果你觉得我的建议对你有帮助，愿意继续和我通信，请随时写信给我。</p><p>浪失</p><p>2017年7月4日&nbsp; &nbsp;&nbsp;</p><p><br/></p>','书信','给文武的第一封回信','我的建议需要你付出更多的努力，你的心必须能静下来，你的心中要时刻的看到你的两个目标。除此之外，我也想不到更好的办法了。虽然会累一点，但是心中也会更充实吧。','书信',0,124,0),(156,1499231330,1499235412,1499231330,'<p>								</p><p>不知道夜里几点开始下的雨。似梦非梦中，滴答滴答的雨声，不间断的，直到天亮。像又做了一回婴儿，听了一首很长摇篮曲。不愿彻底醒来，将昨晚早起工作的“承诺”抛到了九霄云外。</p><p>在家里吃早餐总是惬意的，和吃什么东西无关。大多时候是小米粥，如果有前一天晚上剩下的生的菜，抓两把，蘸酱或者不蘸，吃起来便觉得自己像一只羊，有意思的。今天还吃了一个蒸土豆，是那种小土豆，带皮蒸的。我也是最近两天才第一次吃，好吃且感觉新鲜。感兴趣的读者可以试一下，不错的。</p><p>雨停的刚好，院子里的空气舒服的也刚好，时间却很紧了——我只剩下20分钟不到的时间赶到火车站。听见三轮车下家里养的土狗的呜呜声——不是我们熟知的那种犬吠——分明听得出来哀求的意思。我走过去蹲下来看它，发现栓它的链子绞在山轮车的轴承上，成一坨，使它完全动弹不得。我拉着链子，试着去解开。平时它和我不甚亲近，总是有意的和我保持距离。有时候我要摸它，它都是要避开的。这一次避无可避，我看它眼睛里似乎有泪光，急促地摇着尾巴。我想它是知道我在解救它，表示感激。可是实在绞得太死，一时半会我没解开，时间又很紧，于是我起身回屋告诉了岳父，然后急匆匆地去了厕所。后来我出门经过它的时候，它已经“得救”，仍泪眼汪汪的看着我，摇着尾巴，看样子并没有因为我没有亲自去解救它而不对我心存感激。动物尚且如此，而况人乎？</p><p>仍然和妻子和女儿kiss goodbye，有趣的是女儿一定要和我亲嘴。</p><p>我拒绝她，“亲额头就好了。”</p><p>她反驳：“为什么和妈妈亲嘴呢？”</p><p>“因为丈夫和妻子之间才可以这样。”我回答她。</p><p>在火车上码字能总给我一种“做了自己”的感觉。做自己喜欢做的事情，是真的好。</p><p>“浪失先生”的答复全都说到我的心里去了。对于一个全陌生的人，能这样认真的回答，实在让人敬佩！听了先生的建议，仿佛烦恼一下子全都没了，就像“帽子被摘掉了”。</p><p>好像回到以前一样了，觉得自己的工作有趣味，愿意把工作做得更好，愿意做更多的工作。</p><p>朋友的话总能解开我的疑惑。我问她：“那些好故事是怎么构思出来的？”</p><p>“琢磨出来的。”</p><p>我便开朗：只是因为自己的努力还不够啊！</p><p>她也分享给我她以前写给她嫂子的书信。里面有些很好的建议，也有一些我并不赞同。但是探讨这些问题本身就是很有趣味的事。只是心中总想着工作，并不能谈得畅快。</p><p>加班，然后赶火车，在火车上写下了这篇文章的开头。</p><p><br/></p><p>							</p>','思考','解救小狗','“浪失先生”的答复全都说到我的心里去了。对于一个全陌生的人，能这样认真的回答，实在让人敬佩！听了先生的建议，仿佛烦恼一下子全都没了，就像“帽子被摘掉了”。','生活',0,331,0),(157,1500969028,1500969054,1500969028,'<p>								</p><p><img src=\"/ueditor/php/upload/image/20170725/1500968994535658.png\" title=\"1500968994535658.png\" alt=\"image.png\"/></p><p>报错：</p><p><img src=\"/ueditor/php/upload/image/20170725/1500969012932189.png\" title=\"1500969012932189.png\" alt=\"image.png\"/></p><p>							</p>','','ie7下json中的最后一个字段后面有逗号导致js失效的问题','ie7下json中的最后一个字段后面有逗号导致js失效的问题','js',0,302,1),(158,1503045740,1503045740,1503045740,'<p><img src=\"/ueditor/php/upload/image/20170818/1503045714858587.png\" title=\"1503045714858587.png\" alt=\"90BC16575E5B7381C76924EA13966FC5.png\" width=\"599\" height=\"439\"/></p>','口腔溃疡','口腔溃疡的特效药','口腔溃疡让人很崩溃，朋友推荐了一种药，特别管用，贴上秒不疼。','生活',0,115,1),(159,1503059045,1503059045,1503059045,'<p>这一期的教程是laravel的入门。</p><p><br/></p><p>主要内容有：</p><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>laravel安装</p></li><li><p>目录结构</p></li><li><p>laravel的Mvc实现</p></li><li><p>路由</p></li><li><p>控制器</p></li><li><p>数据库查询</p><p>a.原始查询</p><p>b.查询构造器</p><p>c.eloquent</p></li><li><p>blade模板引擎</p><p></p></li></ol><p><br/></p><p>基本上掌握了上面这些知识就可以用laravel开发一个CURD的应用了。</p><p>有兴趣的一起来看一下吧。</p>','','laravel5.2入门（一）','laravel实在太火了，我也来蹭个热度。在这里记录一下自己的学习过程。','laravel5.2入',0,85,1),(160,1503061721,1503150886,1503061721,'<p>								</p><p>laravel的安装就是让Laravel跑起来，就像这样：<br/></p><p><img src=\"/ueditor/php/upload/image/20170818/1503061104754513.png\" title=\"1503061104754513.png\" alt=\"image.png\"/></p><p>laravel官方是有教程的，不过是全英文的，而且比较啰嗦，嫌麻烦的可以在我这里凑合看一下啦。废话不说，直接上步骤。官方文档：<a href=\"https://docs.golaravel.com/docs/5.2/installation/\" target=\"_blank\">https://docs.golaravel.com/docs/5.2/installation/</a></p><p>一、安装composer</p><p>这里：<a href=\"https://pkg.phpcomposer.com/#how-to-install-composer\" target=\"_blank\">https://pkg.phpcomposer.com/#how-to-install-composer</a>，有简洁明了的教程。我补充两点。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;1.使用全局安装。这样使用起来方便。<br/></p><p>&nbsp; &nbsp; 2.使用国内的镜像。不能科学上网的痛，你们懂得。使用国内镜像的方法：在命令行下运行下面这句命令就行了。</p><pre style=\"box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; padding: 19.7969px 66px 19.7969px 33px; margin-top: 0px; margin-bottom: 1.6em; line-height: 1.6; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; background-color: rgb(247, 247, 247); border: none; border-radius: 0px; position: relative; max-width: 100%; tab-size: 4;\">composer&nbsp;config&nbsp;-g&nbsp;repo.packagist&nbsp;composer&nbsp;https://packagist.phpcomposer.com</pre><p>二、使用composer安装laravel</p><p>这个也很简单，安装好composer的国内镜像后，也就是一句命令的事。</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">composer&nbsp;create-project&nbsp;--prefer-dist&nbsp;laravel/laravel&nbsp;blog&nbsp;&quot;5.2.*&quot;</pre><p>上面这条命令会把项目安装到命令执行的目录下，命名为blog。</p><p><br/></p><p>三、配置虚拟机</p><p>这个其实不应该在这里讲。所以我只把自己的配置贴一下。</p><pre class=\"brush:as3;toolbar:false\">&lt;VirtualHost&nbsp;*:80&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;ServerAdmin&nbsp;webmaster@dummy-host2.example.com\r\n&nbsp;&nbsp;&nbsp;&nbsp;DocumentRoot&nbsp;&quot;/Applications/XAMPP/xamppfiles/htdocs/test/blog/public&quot;\r\n&nbsp;&nbsp;&nbsp;&nbsp;ServerName&nbsp;laravel.ruanwenwu.com\r\n&nbsp;&nbsp;&nbsp;&nbsp;ErrorLog&nbsp;&quot;logs/dummy-host2.example.com-error_log&quot;\r\n&nbsp;&nbsp;&nbsp;&nbsp;CustomLog&nbsp;&quot;logs/dummy-host2.example.com-access_log&quot;&nbsp;common\r\n&lt;/VirtualHost&gt;</pre><p>注意，在host里添加一条域名解析哦：</p><p><img src=\"/ueditor/php/upload/image/20170819/1503150803631348.png\" title=\"1503150803631348.png\" alt=\"image.png\"/></p><p>四、跑起来了<br/></p><p>访问：laravel.ruanwenwu.com。我不是在线上配置的，所以就不要访问了，哈哈。</p><p>五、下节预告</p><p>环境配好了，下一节我们讲目录结构。</p><p>							</p>','laravel','laravel5.2入门（二）——laravel的安装（MAMP环境）','laravel的安装就是把laravel跑起来。','laravel5.2入',0,87,1),(161,1503191730,1503195974,1503191730,'<p>								</p><h3>一、目录概览</h3><p><img src=\"/ueditor/php/upload/image/20170820/1503191050731872.png\" title=\"1503191050731872.png\" alt=\"image.png\" width=\"736\" height=\"743\"/></p><p>上图基本上画出了laravel的Mvc结构。感兴趣的同学可以把环境搭好，然后仔细看看。对了，数据库的配置在这个地方。配置起来也很方便，以我们一般使用的Mysql为例。</p><p>1.打开文件：config/database.php<br/></p><p>2.配置数据库类型为mysql</p><pre class=\"brush:as3;toolbar:false\">&nbsp;&nbsp;&nbsp;&nbsp;&#39;default&#39;&nbsp;=&gt;&nbsp;env(&#39;DB_CONNECTION&#39;,&nbsp;&#39;mysql&#39;),</pre><p>3.链接数据库<br/></p><p>修改项目目录下的.env文件的DB配置部分</p><p class=\"p1\"><span class=\"s1\"></span></p><pre class=\"brush:as3;toolbar:false\">DB_CONNECTION=mysql\r\nDB_HOST=127.0.0.1\r\nDB_PORT=3306\r\nDB_DATABASE=test\r\nDB_USERNAME=root\r\nDB_PASSWORD=</pre><h3>二、下节预告<br/></h3><p>了解了框架的基本目录结构和Mvc构成，接下来我们看laravel的路由。laravel的路由很强大，比起传统的rewrite方法节省很多功夫，很有必要学好哦。</p><p>							</p>','laravel','laravel5.2入门（三）——laravel的目录结构和mvc（MAMP环境）','这一节对laravel的目录结构和Mvc实现有个大概的认识。','laravel5.2入',0,86,1),(162,1503199383,1503220032,1503199383,'<p>								</p><h2>一、什么是路由<br/></h2><p>路由就是给你一个url，给我找到对应的控制器的方法，运行相应的程序。</p><h2>二、基础路由</h2><h3>基础路由</h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;foo&#39;,&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&#39;Hello&nbsp;World&#39;;\r\n});</pre><h3>路由配置文件</h3><p>http/routes.php</p><h3>路由的请求类型</h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get($uri,&nbsp;$callback);\r\nRoute::post($uri,&nbsp;$callback);\r\nRoute::put($uri,&nbsp;$callback);\r\nRoute::patch($uri,&nbsp;$callback);\r\nRoute::delete($uri,&nbsp;$callback);\r\nRoute::options($uri,&nbsp;$callback);</pre><h3>满足多种请求方式<br/></h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::match([&#39;get&#39;,&nbsp;&#39;post&#39;],&nbsp;&#39;/&#39;,&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n});\r\nRoute::any(&#39;foo&#39;,&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n});</pre><h3>在路由中传参<br/></h3><p>一个参数：</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;user/{id}&#39;,&nbsp;function&nbsp;($id)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&#39;User&nbsp;&#39;.$id;\r\n});</pre><p>多个参数：</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;posts/{post}/comments/{comment}&#39;,&nbsp;function&nbsp;($postId,&nbsp;$commentId)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n});</pre><p>可选参数和默认参数<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;user/{name?}&#39;,&nbsp;function&nbsp;($name&nbsp;=&nbsp;null)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$name;\r\n});\r\nRoute::get(&#39;user/{name?}&#39;,&nbsp;function&nbsp;($name&nbsp;=&nbsp;&#39;John&#39;)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$name;\r\n});</pre><h3>使用正则对参数进行限制<br/></h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;user/{name}&#39;,&nbsp;function&nbsp;($name)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n})-&gt;where(&#39;name&#39;,&nbsp;&#39;[A-Za-z]+&#39;);\r\nRoute::get(&#39;user/{id}&#39;,&nbsp;function&nbsp;($id)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n})-&gt;where(&#39;id&#39;,&nbsp;&#39;[0-9]+&#39;);\r\nRoute::get(&#39;user/{id}/{name}&#39;,&nbsp;function&nbsp;($id,&nbsp;$name)&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n})-&gt;where([&#39;id&#39;&nbsp;=&gt;&nbsp;&#39;[0-9]+&#39;,&nbsp;&#39;name&#39;&nbsp;=&gt;&nbsp;&#39;[a-z]+&#39;]);</pre><h3>全局限定。意思就是说这个规则会应用到所有指定的参数名中。</h3><p>修改<span style=\"color: rgb(244, 100, 95); font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 12px; white-space: pre; background-color: rgb(240, 242, 241);\">RouteServiceProvider：</span></p><p><span style=\"color: rgb(244, 100, 95); font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 12px; white-space: pre; background-color: rgb(240, 242, 241);\"></span></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">public&nbsp;function&nbsp;boot(Router&nbsp;$router){\r\n&nbsp;&nbsp;&nbsp;&nbsp;$router-&gt;pattern(&#39;id&#39;,&nbsp;&#39;[0-9]+&#39;);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;parent::boot($router);\r\n}</pre><h2><span style=\"color: rgb(244, 100, 95); font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 12px; white-space: pre; background-color: rgb(240, 242, 241);\"></span>三、路由命名</h2><h3>一般命名<br/></h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;user/profile&#39;,&nbsp;[&#39;as&#39;&nbsp;=&gt;&nbsp;&#39;profile&#39;,&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;//\r\n}]);</pre><h3>命名同时，指定控制器和action</h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;user/profile&#39;,&nbsp;[\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;as&#39;&nbsp;=&gt;&nbsp;&#39;profile&#39;,&nbsp;&#39;uses&#39;&nbsp;=&gt;&nbsp;&#39;UserController@showProfile&#39;\r\n]);</pre><p>或者：<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::get(&#39;user/profile&#39;,&nbsp;&#39;UserController@showProfile&#39;)-&gt;name(&#39;profile&#39;);</pre><h3>集体命名<br/></h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::group([&#39;as&#39;&nbsp;=&gt;&nbsp;&#39;admin::&#39;],&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;Route::get(&#39;dashboard&#39;,&nbsp;[&#39;as&#39;&nbsp;=&gt;&nbsp;&#39;dashboard&#39;,&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Route&nbsp;named&nbsp;&quot;admin::dashboard&quot;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);\r\n});</pre><p>注意：这个集体路由的访问，比如dashboard的地址为：/dashboard而不是/admin/dashboard。只不过它的别名为：admin::dashboard。这个别名可以用来获取路由的地址，下面我们马上就会讲到。</p><h3>路由地址获取和跳转<br/></h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">//&nbsp;Generating&nbsp;URLs...\r\n$url&nbsp;=&nbsp;route(&#39;profile&#39;);\r\n//&nbsp;Generating&nbsp;Redirects...\r\nreturn&nbsp;redirect()-&gt;route(&#39;profile&#39;);</pre><h3>给命名路由传参</h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\"><h3>Route::get(&#39;user/{id}/profile&#39;, [&#39;as&#39; =&gt; &#39;profile&#39;, function ($id) {<br/> &nbsp; &nbsp;//}<br/>]);<br/>$url = route(&#39;profile&#39;, [&#39;id&#39; =&gt; 1]);<br/></h3></pre><h2>四、集体路由</h2><p>集体路由主要用来分享一些属性，避免不必要的重复，比如：middleware,namespace。</p><h3>中间件</h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\"><h3>Route::group([&#39;middleware&#39; =&gt; &#39;auth&#39;], function () {<br/> &nbsp; &nbsp;Route::get(&#39;/&#39;, function () &nbsp; &nbsp;{<br/> &nbsp; &nbsp; &nbsp; &nbsp;// Uses Auth Middleware &nbsp; &nbsp;<br/> &nbsp; &nbsp;});<br/><br/> &nbsp; &nbsp;Route::get(&#39;user/profile&#39;, function () {<br/> &nbsp; &nbsp; &nbsp; &nbsp;// Uses Auth Middleware &nbsp; &nbsp;<br/> &nbsp; &nbsp;});<br/>});<br/></h3></pre><h3>指定命名空间<br/></h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::group([&#39;namespace&#39;&nbsp;=&gt;&nbsp;&#39;Admin&#39;],&nbsp;function(){\r\n&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Controllers&nbsp;Within&nbsp;The&nbsp;&quot;App\\Http\\Controllers\\Admin&quot;&nbsp;Namespace\r\n&nbsp;&nbsp;&nbsp;&nbsp;Route::group([&#39;namespace&#39;&nbsp;=&gt;&nbsp;&#39;User&#39;],&nbsp;function()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Controllers&nbsp;Within&nbsp;The&nbsp;&quot;App\\Http\\Controllers\\Admin\\User&quot;&nbsp;Namespace&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;});\r\n});</pre><h3>指定前缀</h3><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\"><h3>Route::group([&#39;prefix&#39; =&gt; &#39;admin&#39;], function () {<br/> &nbsp; &nbsp;Route::get(&#39;users&#39;, function () &nbsp; &nbsp;{<br/> &nbsp; &nbsp; &nbsp; &nbsp;// Matches The &quot;/admin/users&quot; URL &nbsp; &nbsp;<br/> &nbsp; &nbsp;});<br/>});<br/></h3></pre><p>还可以在前缀上传入参数<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">Route::group([&#39;prefix&#39;&nbsp;=&gt;&nbsp;&#39;accounts/{account_id}&#39;],&nbsp;function&nbsp;()&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;Route::get(&#39;detail&#39;,&nbsp;function&nbsp;($accountId)&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Matches&nbsp;The&nbsp;&quot;/accounts/{account_id}/detail&quot;&nbsp;URL&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;});\r\n});</pre><h2>五、CSRFtoken</h2><p>csrftoken用来防止外站提交请求。<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">//&nbsp;Vanilla&nbsp;PHP&lt;?php&nbsp;echo&nbsp;csrf_field();&nbsp;?&gt;\r\n//&nbsp;Blade&nbsp;Template&nbsp;Syntax{{&nbsp;csrf_field()&nbsp;}}</pre><p>上面这段代码，用来在模板中生成一个html的input。</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;_token&quot;&nbsp;value=&quot;&lt;?php&nbsp;echo&nbsp;csrf_token();&nbsp;?&gt;&quot;&gt;</pre><p>有时候，我们有一些请求不需要验证csrf，我们可以把这些Url排除：<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">&lt;?phpnamespace&nbsp;App\\Http\\Middleware;\r\nuse&nbsp;Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken&nbsp;as&nbsp;BaseVerifier;\r\nclass&nbsp;VerifyCsrfToken&nbsp;extends&nbsp;BaseVerifier{\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;URIs&nbsp;that&nbsp;should&nbsp;be&nbsp;excluded&nbsp;from&nbsp;CSRF&nbsp;verification.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;$except&nbsp;=&nbsp;[\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;stripe/*&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;];</pre><p>x-csrf-token<br/></p><p>ajax请求中携带token。</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">$.ajaxSetup({\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers:&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;X-CSRF-TOKEN&#39;:&nbsp;$(&#39;meta[name=&quot;csrf-token&quot;]&#39;).attr(&#39;content&#39;)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n});</pre><h2>六、表单method‘造假&#39;<br/></h2><p>一般form不支持put,delete,patch，那么我们可以通过这样的方式来实现这些请求。</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">&lt;form&nbsp;action=&quot;/foo/bar&quot;&nbsp;method=&quot;POST&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;_method&quot;&nbsp;value=&quot;PUT&quot;&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;_token&quot;&nbsp;value=&quot;{{&nbsp;csrf_token()&nbsp;}}&quot;&gt;\r\n&lt;/form&gt;</pre><p>要生成这个’造假‘input,也可以这样：<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">&lt;?php&nbsp;echo&nbsp;method_field(&#39;PUT&#39;);&nbsp;?&gt;</pre><p>或者：</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; hyphens: none; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.125) 0px 1px 1px; vertical-align: middle;\">{{&nbsp;method_field(&#39;PUT&#39;)&nbsp;}}</pre><h2>七、下节预告</h2><p>数据库查询的三种方法:raw,查询构造，eloquent。</p><p><br/></p><p><br/></p><p><br/></p><p>							</p>','laravel','laravel5.2入门（四）——laravel的路由（MAMP环境）','laravel的路由很强大，很好用，好好学习一下吧。','laravel5.2入',0,69,1),(163,1503245383,1503245383,1503245383,'<p>这一节我不打算记录的很详细了，毕竟主要是给自己看，记录一下自己的学习过程。感兴趣的可以留言和我讨论哦。</p><p>一、配置</p><p>前面我已经讲过了数据库的配置，这里补充一下主从的配置。<br/></p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 1px; vertical-align: middle; text-size-adjust: auto;\">&#39;mysql&#39;&nbsp;=&gt;&nbsp;[\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;read&#39;&nbsp;=&gt;&nbsp;[\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;host&#39;&nbsp;=&gt;&nbsp;&#39;192.168.1.1&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;],\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;write&#39;&nbsp;=&gt;&nbsp;[\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;host&#39;&nbsp;=&gt;&nbsp;&#39;196.168.1.2&#39;\r\n&nbsp;&nbsp;&nbsp;&nbsp;],\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;driver&#39;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&#39;mysql&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;database&#39;&nbsp;&nbsp;=&gt;&nbsp;&#39;database&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;username&#39;&nbsp;&nbsp;=&gt;&nbsp;&#39;root&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;password&#39;&nbsp;&nbsp;=&gt;&nbsp;&#39;&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;charset&#39;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&#39;utf8&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;collation&#39;&nbsp;=&gt;&nbsp;&#39;utf8_unicode_ci&#39;,\r\n&nbsp;&nbsp;&nbsp;&nbsp;&#39;prefix&#39;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&#39;&#39;,],</pre><p>laravel会自动根据不同的查询语句选择适当的数据库连接。<br/></p><p>二、运行原生sql语句</p><pre class=\" language-php\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Operator Mono&quot;, &quot;Fira Code&quot;, Consolas, Monaco, &quot;Andale Mono&quot;, monospace; font-size: 11px; text-shadow: rgb(255, 255, 255) 0px 1px; direction: ltr; word-break: normal; line-height: 2; tab-size: 4; padding: 10px; margin-top: 10px; margin-bottom: 20px; background-color: rgba(238, 238, 238, 0.35); border-radius: 3px; box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 1px; vertical-align: middle; text-size-adjust: auto;\">&lt;?php\r\nnamespace&nbsp;App\\Http\\Controllers;\r\nuse&nbsp;DB;\r\nuse&nbsp;App\\Http\\Controllers\\Controller;\r\nclass&nbsp;UserController&nbsp;extends&nbsp;Controller{\r\n&nbsp;&nbsp;&nbsp;&nbsp;/**\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Show&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;of&nbsp;the&nbsp;application&#39;s&nbsp;users.\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Response\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/\r\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;index()\r\n&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$users&nbsp;=&nbsp;DB::select(&#39;select&nbsp;*&nbsp;from&nbsp;users&nbsp;where&nbsp;active&nbsp;=&nbsp;?&#39;,&nbsp;[1]);\r\n\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;view(&#39;user.index&#39;,&nbsp;[&#39;users&#39;&nbsp;=&gt;&nbsp;$users]);\r\n&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p>三、查询构造器</p><p>四、eloquent</p><p><br/></p><p>具体的东西我也不想细写了，准备写一个项目练手，这样来得还更实在。在通过阅读文档之后，发现laravel操作数据库还是非常方便的。</p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>','laravel','laravel5.2入门（五）——数据库（MAMP环境）','这一节讲数据库的配置（包括主从）、数据库的raw查询（原生sql）、查询构造器查询','laravel5.2入',0,366,1);
/*!40000 ALTER TABLE `z_post` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_tag`
--

DROP TABLE IF EXISTS `z_tag`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_tag` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(25) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=70 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_tag`
--

LOCK TABLES `z_tag` WRITE;
/*!40000 ALTER TABLE `z_tag` DISABLE KEYS */;
INSERT INTO `z_tag` VALUES (2,'自我介绍'),(5,'框架'),(6,'zolframework'),(7,'架构'),(8,'瀑布流'),(9,'代码高亮'),(10,'移动端性能优化'),(11,'温暖'),(12,'offsetParent'),(13,'scrollTop'),(14,'js运动'),(15,'缓冲运动'),(16,'干劲'),(17,'分享'),(18,'亲情'),(19,'js事件'),(20,'css3'),(21,'php设计模式'),(22,'小技巧'),(23,'撒哈拉沙漠的故事'),(24,'DOMDocument'),(25,'分页'),(26,'oop'),(27,'权限管理'),(28,'工作'),(29,'加密'),(30,'做人'),(31,'算法'),(32,'上拉加载'),(33,'linux'),(34,'openssh-clients'),(35,'mac'),(36,'跨过的坑'),(37,'搜索'),(38,'oauth登陆'),(39,'安全'),(40,'RPMForge'),(41,'php编译安装'),(42,'nginx'),(43,'听音乐'),(44,'心情'),(45,'php-fpm'),(46,'php://input'),(47,'base64'),(48,'wordpress'),(49,'coreseek'),(50,'重定向'),(51,'日志'),(52,'女儿'),(53,'js模块化开发'),(54,'nfs'),(55,'pure-ftpd'),(56,'usort'),(57,'mysql'),(58,'风筝'),(59,'图片优化'),(60,'facebook'),(61,'bootstrap'),(62,'乱码'),(63,'angular'),(64,'心境'),(65,'思考'),(66,'张爱玲'),(67,'书信'),(68,'口腔溃疡'),(69,'laravel');
/*!40000 ALTER TABLE `z_tag` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `z_user`
--

DROP TABLE IF EXISTS `z_user`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `z_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `type` tinyint(3) unsigned NOT NULL DEFAULT '1' COMMENT '1.git.',
  `openid` varchar(55) NOT NULL DEFAULT '' COMMENT 'openid',
  `avatar` varchar(255) NOT NULL DEFAULT '',
  `ctime` int(11) NOT NULL DEFAULT '0',
  `lastlogin` int(11) NOT NULL DEFAULT '0' COMMENT '最后登录时间',
  `nickname` varchar(50) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  KEY `openid` (`openid`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `z_user`
--

LOCK TABLES `z_user` WRITE;
/*!40000 ALTER TABLE `z_user` DISABLE KEYS */;
INSERT INTO `z_user` VALUES (1,1,'12878115','https://avatars0.githubusercontent.com/u/12878115?v=3',1490453306,1490453306,'ruanwenwu'),(2,1,'4101156','https://avatars1.githubusercontent.com/u/4101156?v=3',1490000933,1490000933,'gh72029002'),(3,1,'9713422','https://avatars3.githubusercontent.com/u/9713422?v=4',1502345995,1502345995,'axios94');
/*!40000 ALTER TABLE `z_user` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2017-10-09  2:01:02
