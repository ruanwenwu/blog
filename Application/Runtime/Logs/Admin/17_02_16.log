[ 2017-02-16T14:28:41+08:00 ] 203.130.43.155 /admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000291s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000306s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000344s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.

[ 2017-02-16T14:28:41+08:00 ] 203.130.43.155 /admin.php/Login/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000010s ]
INFO: [ app_init ] --END-- [ RunTime:0.000266s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000281s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000318s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000032s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000071s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.004803s ]
INFO: [ view_parse ] --END-- [ RunTime:0.004840s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000148s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000180s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000314s ]
INFO: [ app_end ] --END-- [ RunTime:0.000348s ]

[ 2017-02-16T14:28:42+08:00 ] 203.130.43.155 /admin.php/Login/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000013s ]
INFO: [ app_init ] --END-- [ RunTime:0.000284s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000406s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000444s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000030s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000068s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.004384s ]
INFO: [ view_parse ] --END-- [ RunTime:0.004421s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000148s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000178s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000314s ]
INFO: [ app_end ] --END-- [ RunTime:0.000347s ]

[ 2017-02-16T14:28:44+08:00 ] 203.130.43.155 /admin.php/Ajax/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000249s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000338s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000374s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.

[ 2017-02-16T14:28:44+08:00 ] 203.130.43.155 /admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000239s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000347s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000385s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_category` [ RunTime:0.0006s ]
SQL: SELECT * FROM `z_category`  [ RunTime:0.0001s ]
SQL: SHOW COLUMNS FROM `z_tag` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_tag`  [ RunTime:0.0001s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000068s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000111s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 361 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 424 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 438 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.014145s ]
INFO: [ view_parse ] --END-- [ RunTime:0.014181s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000114s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000145s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000331s ]
INFO: [ app_end ] --END-- [ RunTime:0.000381s ]

[ 2017-02-16T14:28:48+08:00 ] 203.130.43.155 /admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000247s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000303s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000341s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_category` [ RunTime:0.0005s ]
SQL: SELECT * FROM `z_category`  [ RunTime:0.0001s ]
SQL: SHOW COLUMNS FROM `z_tag` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_tag`  [ RunTime:0.0001s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000062s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000101s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 361 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 424 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 438 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.013361s ]
INFO: [ view_parse ] --END-- [ RunTime:0.013395s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000108s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000139s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000311s ]
INFO: [ app_end ] --END-- [ RunTime:0.000348s ]

[ 2017-02-16T14:32:26+08:00 ] 203.130.43.155 /admin.php/Ajax/addNewPost
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000013s ]
INFO: [ app_init ] --END-- [ RunTime:0.000247s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000305s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000345s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
NOTIC: [8] Undefined index: id /data/wwwroot/blog/Application/Admin/Controller/AjaxController.class.php 第 53 行.
SQL: SHOW COLUMNS FROM `z_post` [ RunTime:0.0006s ]
SQL: INSERT INTO `z_post` (`title`,`category`,`tag`,`summary`,`content`,`pubtime`,`mtime`,`ctime`) VALUES ('数据加密和解密','php','加密','几种常用的，好用的加解密的方法','<p>&lt;?php</p><p>class Algos</p><p>{</p><p>&nbsp; &nbsp; &nbsp;/**</p><p>&nbsp; &nbsp; &nbsp;* 获得用户唯一码 (用户信息+进程信息+时间戳+随机数)</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function getUniqueCode(){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #获得唯一的用户信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $cookieArr = &nbsp;$_COOKIE;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $userId &nbsp; &nbsp;= isset($cookieArr[&quot;zol_userid&quot;]) ? $cookieArr[&quot;zol_userid&quot;]</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: isset($cookieArr[&quot;ip_ck&quot;]) ? $cookieArr[&quot;ip_ck&quot;] : $_SERVER[&#39;REMOTE_ADDR&#39;];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $userIp &nbsp; &nbsp;= $_SERVER[&#39;REMOTE_ADDR&#39;];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #时间信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $time &nbsp; &nbsp; &nbsp;= microtime(true);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #服务器信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $server = $_SERVER[&#39;SERVER_ADDR&#39;];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #进程信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $pid = &#39;&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (function_exists(&#39;getmypid&#39;)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$pid = getmypid();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $rand = rand(0, 1000);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return md5($userId . $userIp .$time. $pid . $server .$rand );</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp;/**</p><p>&nbsp; &nbsp; &nbsp;* URL的签名算法，返回一个token字符串</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function urlSign($paramArr){</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;queryParam&#39; &nbsp;=&gt; &#39;&#39;, &nbsp;#请求参数，可以传入参数数组（一维） 也可以传入name=a&amp;age=12的参数</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; &#39;&#39;, &nbsp;#签名的密钥</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;timeInfo&#39; &nbsp; &nbsp;=&gt; 0, &nbsp; #添加时间信息</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; if(!$queryParam)return &#39;&#39;;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; if(is_string($queryParam)) parse_str($queryParam,$queryParam);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #对参数数组进行排序，保证参数传入的顺序不同，同样能得到结果</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ksort($queryParam);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $queryString = array();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; foreach ($queryParam as $key =&gt; $val){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($queryString, $key . &#39;=&#39; . $val);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $queryString = join(&#39;&amp;&#39;, $queryString);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if($timeInfo){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $queryString .= &quot;#&quot; .time(); #将时间戳并入</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sign = &nbsp;self::fastEncode(array(&#39;value&#39;=&gt;$queryString,&#39;cryptkey&#39;=&gt;$cryptkey));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }else{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sign = hash_hmac(&quot;sha1&quot;,$queryString,$cryptkey);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return $sign;</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp;/**</p><p>&nbsp; &nbsp; &nbsp;* 获得URL的签名的时间戳</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function getUrlSignTm($paramArr){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;signStr&#39; &nbsp; &nbsp; =&gt; &#39;&#39;, &nbsp;#请求参数，可以传入参数数组（一维） 也可以传入name=a&amp;age=12的参数</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; &#39;&#39;, &nbsp;#签名的密钥</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $sign = &nbsp;self::fastDecode(array(&#39;value&#39;=&gt;$signStr,&#39;cryptkey&#39;=&gt;$cryptkey));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #时间戳部分</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $tm &nbsp; = (int)substr($sign, strpos($sign, &quot;#&quot;)+1);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #签名部分</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $data = substr($sign, 0,strpos($sign, &quot;#&quot;));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if($data)parse_str($data,$data);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;data&#39; =&gt; $data,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;tm&#39; &nbsp; =&gt; $tm,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 3DES 加密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>public static function des3Encrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$td = mcrypt_module_open(MCRYPT_3DES, &#39;&#39;, MCRYPT_MODE_ECB, &#39;&#39;);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_enc_get_iv_size($td), MCRYPT_DEV_URANDOM);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$key = substr($cryptkey, 0, mcrypt_enc_get_key_size($td));</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_init($td, $key, $iv);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$ret = self::base64UrlEncode(mcrypt_generic($td, $value));</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_deinit($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_module_close($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>return $ret;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>}</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 3DES 解密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>public static function des3Dencrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$td = mcrypt_module_open(MCRYPT_3DES, &#39;&#39;, MCRYPT_MODE_ECB, &#39;&#39;);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_enc_get_iv_size($td), MCRYPT_DEV_URANDOM);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$key = substr($cryptkey, 0, mcrypt_enc_get_key_size($td));</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_init($td, $key, $iv);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$ret = trim(mdecrypt_generic($td, self::base64UrlDecode($value))) ;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_generic_deinit($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>mcrypt_module_close($td);</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>return $ret;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">	</span>}</p><p>&nbsp; &nbsp;&nbsp;</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 快速的加密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function fastEncode($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; return self::_fastCode($value,&#39;ENCODE&#39;,$cryptkey);</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 快速的解密算法</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function fastDecode($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; return self::_fastCode($value,&#39;DECODE&#39;,$cryptkey);</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; private static function _fastCode($string, $operation = &#39;DECODE&#39;, $key = &#39;&#39;, $expiry = 0) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $auth_key = &#39;%&amp;zol_zwt!Q@W#$6y8i&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $ckey_length = 4;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $key &nbsp;= md5($key ? $key : $auth_key);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $keya = md5(substr($key, 0, 16));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $keyb = md5(substr($key, 16, 16));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $keyc = $ckey_length ? ($operation == &#39;DECODE&#39; ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : &#39;&#39;;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $cryptkey = $keya.md5($keya.$keyc);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $key_length = strlen($cryptkey);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $string = $operation == &#39;DECODE&#39; ? self::base64UrlDecode(substr($string, $ckey_length)) : sprintf(&#39;%010d&#39;, $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $string_length = strlen($string);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $result = &#39;&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $box = range(0, 255);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $rndkey = array();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; for($i = 0; $i &lt;= 255; $i++) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rndkey[$i] = ord($cryptkey[$i % $key_length]);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; for($j = $i = 0; $i &lt; 256; $i++) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $j = ($j + $box[$i] + $rndkey[$i]) % 256;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp = $box[$i];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$i] = $box[$j];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$j] = $tmp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; for($a = $j = $i = 0; $i &lt; $string_length; $i++) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $a = ($a + 1) % 256;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $j = ($j + $box[$a]) % 256;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp = $box[$a];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$a] = $box[$j];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $box[$j] = $tmp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; if($operation == &#39;DECODE&#39;) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() &gt; 0) &amp;&amp; substr($result, 10, 16) == substr(md5(substr($result, 26).$keyb), 0, 16)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return substr($result, 26);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return &#39;&#39;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; } else {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $keyc.str_replace(&#39;=&#39;, &#39;&#39;, self::base64UrlEncode($result));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 简单的加密形式</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function simpleEncrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $mcrypt_cipher_alg &nbsp;= MCRYPT_RIJNDAEL_128;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_get_iv_size($mcrypt_cipher_alg,MCRYPT_MODE_ECB));</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $newString = mcrypt_encrypt($mcrypt_cipher_alg, $cryptkey, $value, MCRYPT_MODE_ECB, $iv);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return bin2hex($newString);</p><p><br/></p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 简单的解密形式</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; public static function simpleDecrypt($paramArr) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; $options = array(</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;value&#39; &nbsp; &nbsp; &nbsp; =&gt; 0, #加密的字符</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cryptkey&#39; &nbsp; &nbsp;=&gt; 0, #加密用的key</p><p>&nbsp; &nbsp; &nbsp; &nbsp; );</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (is_array($paramArr))$options = array_merge($options, $paramArr);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; extract($options);</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $mcrypt_cipher_alg &nbsp;= MCRYPT_RIJNDAEL_128;</p><p><span class=\"Apple-tab-span\" style=\"white-space:pre\">		</span>$iv = mcrypt_create_iv(mcrypt_get_iv_size($mcrypt_cipher_alg,MCRYPT_MODE_ECB));</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; $string &nbsp; &nbsp;= pack(&quot;H*&quot;,$value);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return trim(mcrypt_decrypt($mcrypt_cipher_alg, $cryptkey, $string, MCRYPT_MODE_ECB, $iv));</p><p><br/></p><p>&nbsp; &nbsp; }</p><p><br/></p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 适合url传输的base64编码</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; private static function base64UrlEncode($value){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return rtrim(strtr(base64_encode($value), &#39;+/&#39;, &#39;-_&#39;), &#39;=&#39;);</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; /**</p><p>&nbsp; &nbsp; &nbsp;* 适合url传输的base64解码</p><p>&nbsp; &nbsp; &nbsp;*/</p><p>&nbsp; &nbsp; private static function base64UrlDecode($value){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return base64_decode(strtr($value, &#39;-_&#39;, &#39;+/&#39;));</p><p>&nbsp; &nbsp; }</p><p><br/></p><p>}</p><p><br/></p>','1487226745','1487226745','1487226745') [ RunTime:0.0469s ]
SQL: SHOW COLUMNS FROM `z_category` [ RunTime:0.0005s ]
SQL: SELECT * FROM `z_category` WHERE `name` = 'php' LIMIT 1   [ RunTime:0.0002s ]
SQL: SHOW COLUMNS FROM `z_tag` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_tag` WHERE `name` = '加密' LIMIT 1   [ RunTime:0.0001s ]
SQL: INSERT INTO `z_tag` (`name`) VALUES ('加密') [ RunTime:0.0005s ]

[ 2017-02-16T14:32:27+08:00 ] 203.130.43.155 /admin.php/Post/all
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000019s ]
INFO: [ app_init ] --END-- [ RunTime:0.000313s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000360s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000398s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_post` [ RunTime:0.0007s ]
SQL: SELECT COUNT(*) AS tp_count FROM `z_post` LIMIT 1   [ RunTime:0.0002s ]
SQL: SELECT * FROM `z_post` ORDER BY ctime desc LIMIT 0,20   [ RunTime:0.0004s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000069s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000130s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/c171e2b85832ae9943251ee8295bfacb.php 第 361 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.013457s ]
INFO: [ view_parse ] --END-- [ RunTime:0.013498s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000140s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000181s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000367s ]
INFO: [ app_end ] --END-- [ RunTime:0.000404s ]

[ 2017-02-16T14:32:28+08:00 ] 203.130.43.155 /admin.php/Post/all
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000014s ]
INFO: [ app_init ] --END-- [ RunTime:0.000251s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000313s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000350s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_post` [ RunTime:0.0006s ]
SQL: SELECT COUNT(*) AS tp_count FROM `z_post` LIMIT 1   [ RunTime:0.0001s ]
SQL: SELECT * FROM `z_post` ORDER BY ctime desc LIMIT 0,20   [ RunTime:0.0001s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000066s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000124s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/c171e2b85832ae9943251ee8295bfacb.php 第 361 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.013387s ]
INFO: [ view_parse ] --END-- [ RunTime:0.013425s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000161s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000193s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000345s ]
INFO: [ app_end ] --END-- [ RunTime:0.000383s ]

