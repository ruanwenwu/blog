[ 2017-05-04T11:27:57+08:00 ] 203.130.43.155 /admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000247s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000355s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000394s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.

[ 2017-05-04T11:27:57+08:00 ] 203.130.43.155 /admin.php/Login/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000009s ]
INFO: [ app_init ] --END-- [ RunTime:0.000219s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000275s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000372s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000031s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000070s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.004484s ]
INFO: [ view_parse ] --END-- [ RunTime:0.004522s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000150s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000183s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000302s ]
INFO: [ app_end ] --END-- [ RunTime:0.000335s ]

[ 2017-05-04T11:27:57+08:00 ] 203.130.43.155 /admin.php/Login/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000294s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000308s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000345s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000030s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000070s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.004324s ]
INFO: [ view_parse ] --END-- [ RunTime:0.004363s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000106s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000138s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000351s ]
INFO: [ app_end ] --END-- [ RunTime:0.000385s ]

[ 2017-05-04T11:27:58+08:00 ] 203.130.43.155 /admin.php/Ajax/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000249s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000305s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000340s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.

[ 2017-05-04T11:27:59+08:00 ] 203.130.43.155 /admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000010s ]
INFO: [ app_init ] --END-- [ RunTime:0.000217s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000314s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000352s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_category` [ RunTime:0.0005s ]
SQL: SELECT * FROM `z_category`  [ RunTime:0.0001s ]
SQL: SHOW COLUMNS FROM `z_tag` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_tag`  [ RunTime:0.0001s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000064s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000103s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 361 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 424 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 438 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.013185s ]
INFO: [ view_parse ] --END-- [ RunTime:0.013220s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000108s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000139s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000350s ]
INFO: [ app_end ] --END-- [ RunTime:0.000389s ]

[ 2017-05-04T11:27:59+08:00 ] 203.130.43.155 /admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000011s ]
INFO: [ app_init ] --END-- [ RunTime:0.000248s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000345s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000383s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_category` [ RunTime:0.0005s ]
SQL: SELECT * FROM `z_category`  [ RunTime:0.0001s ]
SQL: SHOW COLUMNS FROM `z_tag` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_tag`  [ RunTime:0.0001s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000062s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000115s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 361 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 424 行.
NOTIC: [8] Undefined variable: hospitalInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 438 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.013338s ]
INFO: [ view_parse ] --END-- [ RunTime:0.013374s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000111s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000144s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000310s ]
INFO: [ app_end ] --END-- [ RunTime:0.000348s ]

[ 2017-05-04T11:48:52+08:00 ] 203.130.43.155 /admin.php/Ajax/addNewPost
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000256s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000368s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000408s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
NOTIC: [8] Undefined index: id /data/wwwroot/blog/Application/Admin/Controller/AjaxController.class.php 第 53 行.
SQL: SHOW COLUMNS FROM `z_post` [ RunTime:0.0006s ]
SQL: INSERT INTO `z_post` (`title`,`category`,`tag`,`summary`,`content`,`pubtime`,`mtime`,`ctime`) VALUES ('客户端活动使用登陆问题排查记录','工作','工作','排除这个问题真是费了九牛二虎之力，记录一下过程，供日后参考。','<h2>背景</h2><p>客户端和wap端共用一套h5页面。h5页面需要保持登陆状态。</p><h2>问题</h2><ol class=\" list-paddingleft-2\" style=\"list-style-type: decimal;\"><li><p>登陆之后跳转回来是白页。</p></li><li><p>无法登陆成功。</p></li><li><p>登陆状态无法传递。</p></li></ol><h2>问题原因分析</h2><h3>登陆之后跳转回来是白页</h3><p>造成这个问题的原因是，使用php程序调用客户端的登陆协议，页面没有加载完，导致白页。解决办法就是不再使用php来执行登陆协议，而使用js来进行跳转。用js的好处是，页面已经加载完成，也就不会有白页了，这也是一般应该采用的方法。</p><p>这其中有个注意点：不是所有的webview页面都可以调用协议。除非客户端指定了该功能。</p><h3>无法登陆成功</h3><p>造成这个问题的原因是，webview页面通过登陆协议，成功之后，会执行webview中的js方法onLogin。但是可能是前人的坑，把这段代码注释了，而我用浏览器里的search搜索还能搜索到，这个坑有点深。</p><p>回调里采用ajax向php文件发送请求，在php里写cookie。但是这样的cookie到下次才能生效。</p><h3>登陆状态无法传递</h3><p>每打开一个webivew就相当于一个全新的浏览器，生成的cookie无法共用，导致登陆失败。</p><h2>解决办法</h2><p>原则：接口的设计应该是无状态的。也就是说，webview页面，作为一种客户端的另类接口，用cookie来保持登陆状态，本身就是不合理的。客户端的接口的权限判断是通过身份验证接口之后，获取到的相关token或者其他方式来进行。</p><p>所以这里把客户端和wap的身份验证方式区分开来。wap用cookie,客户端用token。状态存在的本质是获取用户信息，那么如果token能获取到用户信息，也就没有必要使用cookie了。</p>','1493869732','1493869732','1493869732') [ RunTime:0.0102s ]
SQL: SHOW COLUMNS FROM `z_category` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_category` WHERE `name` = '工作' LIMIT 1   [ RunTime:0.0002s ]
SQL: SHOW COLUMNS FROM `z_tag` [ RunTime:0.0003s ]
SQL: SELECT * FROM `z_tag` WHERE `name` = '工作' LIMIT 1   [ RunTime:0.0002s ]

[ 2017-05-04T11:48:53+08:00 ] 203.130.43.155 /admin.php/Post/all
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000295s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000304s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000342s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_post` [ RunTime:0.0006s ]
SQL: SELECT COUNT(*) AS tp_count FROM `z_post` LIMIT 1   [ RunTime:0.0002s ]
SQL: SELECT * FROM `z_post` ORDER BY ctime desc LIMIT 0,20   [ RunTime:0.0005s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000071s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000113s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/c171e2b85832ae9943251ee8295bfacb.php 第 361 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.012863s ]
INFO: [ view_parse ] --END-- [ RunTime:0.012901s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000115s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000150s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000322s ]
INFO: [ app_end ] --END-- [ RunTime:0.000361s ]

[ 2017-05-04T11:48:54+08:00 ] 203.130.43.155 /admin.php/Post/all
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000012s ]
INFO: [ app_init ] --END-- [ RunTime:0.000248s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000352s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000390s ]
NOTIC: [8] A session had already been started - ignoring session_start() /data/wwwroot/blog/ThinkPHP/Common/functions.php 第 1263 行.
SQL: SHOW COLUMNS FROM `z_post` [ RunTime:0.0006s ]
SQL: SELECT COUNT(*) AS tp_count FROM `z_post` LIMIT 1   [ RunTime:0.0001s ]
SQL: SELECT * FROM `z_post` ORDER BY ctime desc LIMIT 0,20   [ RunTime:0.0002s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000057s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000098s ]
NOTIC: [8] Undefined variable: userInfo /data/wwwroot/blog/Application/Runtime/Cache/Admin/c171e2b85832ae9943251ee8295bfacb.php 第 361 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.012921s ]
INFO: [ view_parse ] --END-- [ RunTime:0.012959s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000155s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000188s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000317s ]
INFO: [ app_end ] --END-- [ RunTime:0.000356s ]

